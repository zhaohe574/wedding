import{as as e,bd as a,q as l,c as t,s as n,v as o,x as r,V as i,aZ as s,d as c,o as u,b as d,w as p,e as m,g as v,y as f,f as y,n as h,A as k,z as g,j as x,t as P,h as b,i as C,F as V,au as w,m as j,b7 as _,b6 as E}from"./index-e3492752.js";import{_ as S}from"./popup.b8b85cf1.js";import{U as I,C as B}from"./event.5568c9d8.js";import{b as K,d as O,u as D,a as T}from"./index.f1be293a.js";import{i as z}from"./is-boolean.00bf65dc.js";import{i as A}from"./is-number.7ef6fec2.js";import{Z as N}from"./z-index.5f93cfb9.js";import"./index.89b6df5d.js";import{i as W}from"./is-empty.c0d66e4a.js";import{t as $}from"./error.a3858cc2.js";import{c as H}from"./clone-deep.2124c060.js";import{_ as U}from"./_plugin-vue_export-helper.1b428a4d.js";const Z=K({showCancel:{type:Boolean,default:!0},cancelText:{type:String,default:"取 消"},cancelColor:String,showConfirm:{type:Boolean,default:!0},confirmText:{type:String,default:"确 定"},confirmColor:String,mask:Boolean,zIndex:{type:Number,default:N.popup}}),q=K({...Z,modelValue:{type:O([String,Number,Array]),default:""},open:Boolean,data:{type:O([Array]),default:()=>[]},allowConfirmBeforeScrollEnd:{type:Boolean,default:!1},immediateChange:{type:Boolean,default:!0},indicatorHeight:{type:Number,default:44},labelKey:{type:String,default:"label"},valueKey:{type:String,default:"value"},childrenKey:{type:String,default:"children"}}),F=e=>{const{emit:l}=i(),t=n(!1),c=n(!0);o((()=>e.open),(e=>{t.value=e}));const u=()=>{l("update:open",!1)};let d="signle";const p=a=>{if(s(a)){const l=H(a);return Object.prototype.hasOwnProperty.call(l,e.childrenKey)&&delete l[e.childrenKey],{label:a[e.labelKey],value:a[e.valueKey],originalData:l}}return{label:a,value:a,originalData:a}},m=(a,l=1,t=[])=>{y.value.length<l&&y.value.push(...Array.from({length:l-y.value.length},(()=>[]))),y.value[l-1]=[...a.map((e=>p(e)))];let n=0;t.length&&(n=y.value[l-1].findIndex((e=>e.value===t[l-1])),n=~n?n:0),a[n]&&Object.prototype.hasOwnProperty.call(a[n],e.childrenKey)&&m(a[n][e.childrenKey],l+1,t)},v=n(!1);let f=!1;const y=n([]),h=n([]),k=()=>{let l=[];l=void 0===e.modelValue||!e.modelValue&&["multiple","cascade"].includes(d)||a(e.modelValue)&&!e.modelValue.length?Array.from({length:y.value.length},(()=>0)):a(e.modelValue)?y.value.map(((a,l)=>{let t=0;return t=e.modelValue[l]?a.findIndex((a=>a.value===e.modelValue[l])):0,~t?t:0})):y.value.map(((a,l)=>{const t=y.value[l].findIndex((a=>a.value===e.modelValue));return-1===t?0:t})),h.value=l};o((()=>e.data),(()=>{(()=>{const{data:l}=e;l&&(a(l)||$("TnPicker","picker选择器数据不正确，请传递数组格式的数据"),0!==l.length&&(a(l[0])?(d="multiple",y.value=l.reduce(((e,a)=>(e.push(a.map((e=>p(e)))),e)),[])):!a(l[0])&&s(l[0])&&Object.prototype.hasOwnProperty.call(l[0],e.childrenKey)?(d="cascade",m(l,1,e.modelValue)):(d="signle",y.value=[l.map((e=>p(e)))]),r((()=>{k()}))))})()}),{immediate:!0,deep:!0});const g=()=>{if("signle"!==d||a(e.data[0])){const e=H(h.value);return e.splice(y.value.length),e.map(((e,a)=>{var l;return W(null==(l=y.value[a][e])?void 0:l.value,0)}))}return y.value[0][h.value[0]].value},x=()=>{if("signle"!==d||a(e.data[0])){const e=H(h.value);return e.splice(y.value.length),e.map(((e,a)=>{var l;return W(null==(l=y.value[a][e])?void 0:l.originalData,void 0)}))}return y.value[0][h.value[0]].originalData},P=a=>{"cascade"===d&&m(e.data,1,a),r((()=>{k()}))};let b=!1;o((()=>e.modelValue),(e=>{b?b=!1:P(e)}),{deep:!0});let C=null,V=!1;return{openPopup:t,showPicker:c,pickerData:y,currentPickerIndex:h,isPickerScrolling:v,closePopupEvent:()=>{u(),P(e.modelValue),l("close")},pickerViewPickStartEvent:()=>{v.value=!0,l("pickstart")},pickerViewPickerEndEvent:()=>{v.value=!1,l("pickend")},pickerViewChangeEvent:a=>{if(V)return;C=setTimeout((()=>{V=!1,C&&clearTimeout(C),C=null}),300),V=!0;let t=h.value.findIndex(((e,l)=>e!==a.detail.value[l]));if(t=~t?t:0,h.value=a.detail.value,"cascade"===d){let a=e.data;for(let n=0;n<t;n++)a=a[h.value[n]][e.childrenKey];const l=h.value[t];y.value.splice(t+1),a[l]&&Object.prototype.hasOwnProperty.call(a[l],e.childrenKey)&&(m(a[l][e.childrenKey],t+2),h.value=y.value.map(((e,a)=>a<=t?h.value[a]:0)))}b=!0;const n=g(),o=x();l(B,n,t,o),f&&(f=!1,l(I,n))},confirmEvent:()=>{if(v.value){if(!e.allowConfirmBeforeScrollEnd)return;f=!0}const a=g(),t=x();b=!0,l(I,a),r((()=>{l("confirm",a,t)})),u()},cancelEvent:()=>{P(e.modelValue),l("cancel"),u()},initDefaultPickerIndex:k,resetPickerIndexWithPosition:(e,a)=>{h.value=h.value.map(((l,t)=>t>=e&&(!a||t<=a)?0:l))}}},J=U(c({__name:"picker",props:q,emits:{[I]:l=>e(l)||A(l)||a(l),"update:open":e=>z(e),[B]:(e,a,l)=>!0,confirm:(e,a)=>!0,pickstart:()=>!0,pickend:()=>!0,cancel:()=>!0,close:()=>!0},setup(e,{expose:a}){const n=e,{openPopup:o,showPicker:r,pickerData:i,currentPickerIndex:s,isPickerScrolling:c,closePopupEvent:I,pickerViewPickStartEvent:B,pickerViewPickerEndEvent:K,pickerViewChangeEvent:O,confirmEvent:z,cancelEvent:A,initDefaultPickerIndex:N,resetPickerIndexWithPosition:W}=F(n),{ns:$,overlayOpacity:H,operationBtnClass:U,operationBtnStyle:Z}=(e=>{const a=D("picker"),[n,o]=T(l(e,"cancelColor"),"text"),[r,i]=T(l(e,"confirmColor"),"text"),s=t((()=>e.mask?.5:0)),c=t((()=>(l,t)=>{const o=[a.e("operation-btn"),a.em("operation-btn",l)];return!e.allowConfirmBeforeScrollEnd&&t&&o.push(a.em("operation-btn","disabled")),"cancel"===l?n.value&&o.push(n.value):"confirm"===l&&r.value&&o.push(r.value),o.join(" ")})),u=t((()=>e=>{const a={};return"cancel"===e?n.value||(a.color=o.value||"var(--tn-color-danger)"):"confirm"===e&&(r.value||(a.color=i.value||"var(--tn-color-primary)")),a}));return{ns:a,overlayOpacity:s,operationBtnClass:c,operationBtnStyle:u}})(n);return a({resetPickerViewIndex:()=>{N()},resetPickerIndexWithPosition:W}),(e,a)=>{const l=j,t=E,D=_;return u(),d(S,{modelValue:y(o),"onUpdate:modelValue":a[0]||(a[0]=e=>w(o)?o.value=e:null),"open-direction":"bottom",overlay:!0,"overlay-opacity":y(H),radius:0,"safe-area-inset-bottom":!1,"z-index":e.zIndex,onClose:y(I)},{default:p((()=>[m(l,{class:f(["tn-u-safe-area",[y($).b()]])},{default:p((()=>[v(" 操作按钮 "),m(l,{class:f([y($).e("operation"),y($).is("only-confirm",!e.showCancel)])},{default:p((()=>[e.showCancel?(u(),d(l,{key:0,class:f([y(U)("cancel",!1)]),style:h(y(Z)("cancel")),onClick:k(y(A),["stop"])},{default:p((()=>[g(e.$slots,"cancel",{},(()=>[x(P(n.cancelText),1)]),!0)])),_:3},8,["class","style","onClick"])):v("v-if",!0),m(l,{class:f([y(U)("confirm",y(c))]),style:h(y(Z)("confirm")),onClick:k(y(z),["stop"])},{default:p((()=>[g(e.$slots,"confirm",{},(()=>[x(P(n.confirmText),1)]),!0)])),_:3},8,["class","style","onClick"])])),_:3},8,["class"]),v(" 内容区域 "),m(l,{class:f([y($).e("content")])},{default:p((()=>[y(r)?(u(),d(D,{key:0,class:f([y($).e("picker-view")]),value:y(s),"indicator-style":`height: ${n.indicatorHeight||44}px;`,"indicator-class":"tn-picker-indicator","immediate-change":e.immediateChange,onChange:y(O),onPickstart:y(B),onPickend:y(K)},{default:p((()=>[(u(!0),b(V,null,C(y(i),((e,a)=>(u(),d(t,{key:a,class:f([y($).e("picker-view-column")])},{default:p((()=>[(u(!0),b(V,null,C(e,((e,a)=>(u(),d(l,{key:a,class:f(y($).e("content-item"))},{default:p((()=>[m(l,{class:f(["tn-text-ellipsis-1",y($).em("content-item","data")])},{default:p((()=>[x(P(e.label),1)])),_:2},1032,["class"])])),_:2},1032,["class"])))),128))])),_:2},1032,["class"])))),128))])),_:1},8,["class","value","indicator-style","immediate-change","onChange","onPickstart","onPickend"])):v("v-if",!0)])),_:1},8,["class"])])),_:3},8,["class"])])),_:3},8,["modelValue","overlay-opacity","z-index","onClose"])}}}),[["__scopeId","data-v-950de2ef"]]);export{J as T,Z as p};
