import{as as e,aZ as l,s as a,v as t,d as i,c as o,o as s,b as n,w as c,e as d,y as u,f as r,j as m,t as v,g as k,A as p,m as f,h as _,i as y,F as g,a_ as h,n as C,l as b,a1 as w,O as I,aX as A,aD as x,aq as D,k as R,aP as L,r as j,a as z,G as H,a$ as S,I as N,aJ as $,b0 as V,J as B}from"./index-e3492752.js";import{_ as F}from"./page-meta.a4be6114.js";import{_ as E}from"./icon.e613abcd.js";import{_ as O}from"./popup.b8b85cf1.js";import{T}from"./avatar.b1292efe.js";import{b as W,d as J,u as M}from"./index.f1be293a.js";import"./index.89b6df5d.js";import{i as U}from"./is-number.7ef6fec2.js";import{_ as q}from"./_plugin-vue_export-helper.1b428a4d.js";import{a as G,b as P,l as X,c as Z,t as K,d as Q,e as Y,f as ee}from"./dynamic.b225a591.js";import"./z-index.5f93cfb9.js";import"./is-boolean.00bf65dc.js";import"./_objectToString.c905654b.js";import"./is-empty.c0d66e4a.js";import"./event.5568c9d8.js";import"./install.8446dea8.js";import"./badge.46a4bc76.js";import"./index.04c93aab.js";const le=W({showLike:{type:Boolean,default:!0},showDislike:{type:Boolean,default:!0},likeIcon:{type:String,default:"like"},activeLikeIcon:{type:String,default:"like-fill"},likeIconColor:{type:String,default:"tn-gray-dark"},activeLikeIconColor:{type:String,default:"tn-red"},dislikeIcon:{type:String,default:"like-break"},activeDislikeIcon:{type:String,default:"like-fill"},dislikeIconColor:{type:String,default:"tn-gray-dark"},activeDislikeIconColor:{type:String,default:"tn-gray-dark"}}),ae=W({...le,data:{type:J(Array),default:()=>[]}}),te={like:l=>U(l)||e(l),dislike:l=>U(l)||e(l),reply:e=>l(e),delete:l=>U(l)||e(l),"show-more":e=>l(e)},ie=(e,l)=>{const i=a([]);t((()=>e.data),(()=>(()=>{const{data:l}=e,a=[];l.forEach((e=>{const{id:l,avatar:t,nickname:i,date:o,position:s,content:n,likeActive:c,likeCount:d,dislikeActive:u,disabledReply:r,commentCount:m,allowDelete:v}=e,k={id:l,avatar:t,nickname:i,date:o,position:s,content:n,likeActive:c,likeCount:d,dislikeActive:u,disabledReply:r,allowDelete:v,hidden:!1,commentCount:m||0,comment:[]};a.push(k)})),i.value=a})()),{immediate:!0});const o=e=>{let l=-1,a=-1;return i.value.forEach(((t,i)=>{var o;null==(o=null==t?void 0:t.comment)||o.forEach(((t,o)=>{if(t.id===e)return l=i,void(a=o)}))})),{index:l,subIndex:a}};return{listData:i,likeClickHandle:(e,a,t)=>{let o=null;o=void 0===t?i.value[a]:i.value[a].comment[t],o.likeActive=!o.likeActive,o.likeActive?o.likeCount++:o.likeCount--,o.dislikeActive&&(o.dislikeActive=!1),l("like",e)},dislikeClickHandle:(e,a,t)=>{let o=null;o=void 0===t?i.value[a]:i.value[a].comment[t],o.dislikeActive=!o.dislikeActive,o.likeActive&&(o.likeActive=!1,o.likeCount--),l("dislike",e)},replyClickHandle:e=>{e.disabledReply||l("reply",{id:e.id,nickname:e.nickname})},deleteClickHandle:e=>{l("delete",e)},replyOperationClickHandle:e=>{var a;const t=i.value.find((l=>l.id===e));t.comment.length>=t.commentCount?t.hidden=!t.hidden:l("show-more",{id:e,currentCommentCount:(null==(a=i.value.find((l=>l.id===e)))?void 0:a.comment.length)||0})},addCommentData:(e,l)=>{const a=(e,l)=>{const t=[];return l.forEach((l=>{const{id:i,avatar:o,nickname:s,date:n,position:c,content:d,likeActive:u,likeCount:r,dislikeActive:m,disabledReply:v,allowDelete:k,comment:p}=l,f={id:i,avatar:o,nickname:s,authorNickname:e,date:n,position:c,content:d,likeActive:u,likeCount:r,dislikeActive:m,disabledReply:v,allowDelete:k};t.push(f),(null==p?void 0:p.length)&&t.push(...a(s,p))})),t},t=i.value.findIndex((l=>l.id===e));-1!==t&&i.value[t].comment.push(...a("",l))},addCommentReplyWithId:(e,l)=>{let a=i.value.findIndex((l=>l.id===e)),t=-1;if(-1===a){const{index:l,subIndex:i}=o(e);a=l,t=i}if(-1!==a||-1!==t){if(-1===t)i.value[a].comment.unshift({id:l.id,avatar:l.avatar,nickname:l.nickname,authorNickname:"",date:l.date,position:l.position,content:l.content,allowDelete:l.allowDelete,likeActive:!1,likeCount:0,dislikeActive:!1,disabledReply:l.disabledReply});else{const e=i.value[a].comment[t].nickname;i.value[a].comment.splice(t+1,0,{id:l.id,avatar:l.avatar,nickname:l.nickname,authorNickname:e,date:l.date,position:l.position,content:l.content,allowDelete:l.allowDelete,likeActive:!1,likeCount:0,dislikeActive:!1,disabledReply:!1})}i.value[a].commentCount++}else i.value.unshift({id:l.id,avatar:l.avatar,nickname:l.nickname,authorNickname:"",date:l.date,position:l.position,content:l.content,allowDelete:l.allowDelete,likeActive:!1,likeCount:0,dislikeActive:!1,disabledReply:l.disabledReply,hidden:!1,commentCount:0,comment:[]})},deleteCommentReplyWithId:e=>{let l=i.value.findIndex((l=>l.id===e)),a=-1;if(-1===l){const{index:t,subIndex:i}=o(e);l=t,a=i}-1===l&&-1===a||(-1===a?i.value.splice(l,1):(i.value[l].comment.splice(a,1),i.value[l].commentCount--))}}},oe=q(i({__name:"comment-bottom-operation",props:W({...le,data:{type:J(Object),default:()=>({date:"",position:"",likeActive:!1,likeCount:0,dislikeActive:!1})},showDelete:Boolean,showReply:Boolean}),emits:{like:()=>!0,dislike:()=>!0,delete:()=>!0},setup(e,{emit:l}){const a=e,t=M("tn-comment-bottom-operation"),i=o((()=>void 0!==a.likeIconColor?a.likeIconColor:"tn-gray-dark")),_=o((()=>void 0!==a.activeLikeIconColor?a.activeLikeIconColor:"tn-red")),y=o((()=>void 0!==a.dislikeIconColor?a.dislikeIconColor:"tn-gray-dark")),g=o((()=>void 0!==a.activeDislikeIconColor?a.activeDislikeIconColor:"tn-gray-dark")),h=()=>{l("like")},C=()=>{l("dislike")},b=()=>{l("delete")};return(e,l)=>{const a=f;return s(),n(a,{class:u([r(t).b()])},{default:c((()=>[d(a,{class:u([r(t).e("left")])},{default:c((()=>[d(a,{class:u([r(t).e("date")])},{default:c((()=>[m(v(e.data.date),1)])),_:1},8,["class"]),e.data.position?(s(),n(a,{key:0,class:u([r(t).e("position")])},{default:c((()=>[m(v(e.data.position),1)])),_:1},8,["class"])):k("v-if",!0),e.showReply?(s(),n(a,{key:1,class:u([r(t).e("reply")])},{default:c((()=>[m("回复")])),_:1},8,["class"])):k("v-if",!0),e.showDelete?(s(),n(a,{key:2,class:u(r(t).e("delete")),onClick:p(b,["stop"])},{default:c((()=>[m(" 删除 ")])),_:1},8,["class","onClick"])):k("v-if",!0)])),_:1},8,["class"]),d(a,{class:u([r(t).e("right")]),onClick:p((e=>null),["stop"])},{default:c((()=>[e.showLike?(s(),n(a,{key:0,class:u([r(t).e("like-container")]),onClick:p(h,["stop"])},{default:c((()=>[d(a,{class:u(["like",[r(t).e("icon")]])},{default:c((()=>[d(E,{name:e.data.likeActive?e.activeLikeIcon:e.likeIcon,color:e.data.likeActive?r(_):r(i)},null,8,["name","color"])])),_:1},8,["class"]),d(a,{class:u([r(t).e("like-value")])},{default:c((()=>[m(v(e.data.likeCount),1)])),_:1},8,["class"])])),_:1},8,["class","onClick"])):k("v-if",!0),e.showDislike?(s(),n(a,{key:1,class:u(["dislike",[r(t).e("icon")]]),onClick:p(C,["stop"])},{default:c((()=>[d(E,{name:e.data.dislikeActive?e.activeDislikeIcon:e.dislikeIcon,color:e.data.dislikeActive?r(g):r(y)},null,8,["name","color"])])),_:1},8,["class","onClick"])):k("v-if",!0)])),_:1},8,["class","onClick"])])),_:1},8,["class"])}}}),[["__scopeId","data-v-fe537a0e"]]),se=q(i({__name:"index",props:ae,emits:te,setup(e,{expose:l,emit:a}){const t=e,i=M("tn-comment-list"),{listData:o,likeClickHandle:w,dislikeClickHandle:I,replyClickHandle:A,deleteClickHandle:x,replyOperationClickHandle:D,addCommentData:R,addCommentReplyWithId:L,deleteCommentReplyWithId:j}=ie(t,a);return l({addCommentData:R,addCommentReply:L,deleteCommentReply:j}),(e,l)=>{const a=f,t=b,R=h("TnIcon");return s(),n(a,{class:u([r(i).b()])},{default:c((()=>[(s(!0),_(g,null,y(r(o),((l,o)=>(s(),n(a,{key:o,class:u([r(i).e("item")])},{default:c((()=>[d(a,{class:u([r(i).e("item-data")])},{default:c((()=>[d(a,{class:u([r(i).em("item-data","left")])},{default:c((()=>[d(a,{class:u([r(i).e("avatar")])},{default:c((()=>[d(T,{url:l.avatar,size:"70"},null,8,["url"])])),_:2},1032,["class"])])),_:2},1032,["class"]),d(a,{class:u([r(i).em("item-data","right")])},{default:c((()=>[d(a,{class:u([r(i).e("main-data")]),onClick:p((e=>r(A)(l)),["stop"])},{default:c((()=>[d(a,{class:u([r(i).e("nickname")])},{default:c((()=>[m(v(l.nickname),1)])),_:2},1032,["class"]),d(a,{class:u([r(i).e("content")])},{default:c((()=>[m(v(l.content),1)])),_:2},1032,["class"]),d(a,{class:u([r(i).e("bottom-operation")])},{default:c((()=>[d(oe,{data:{date:l.date,position:l.position,likeActive:l.likeActive,likeCount:l.likeCount,dislikeActive:l.dislikeActive},"show-like":e.showLike,"show-dislike":e.showDislike,"like-icon":e.likeIcon,"active-like-icon":e.activeLikeIcon,"dislike-icon":e.dislikeIcon,"like-icon-color":e.likeIconColor,"active-like-icon-color":e.activeLikeIconColor,"dislike-icon-color":e.dislikeIconColor,"show-delete":l.allowDelete,"show-reply":!l.disabledReply,onLike:()=>r(w)(l.id,o),onDislike:()=>r(I)(l.id,o),onDelete:()=>r(x)(l.id)},null,8,["data","show-like","show-dislike","like-icon","active-like-icon","dislike-icon","like-icon-color","active-like-icon-color","dislike-icon-color","show-delete","show-reply","onLike","onDislike","onDelete"])])),_:2},1032,["class"])])),_:2},1032,["class","onClick"]),d(a,{class:u([r(i).e("reply-data")]),style:C({height:""+(l.hidden?"0px":"auto")})},{default:c((()=>[(s(!0),_(g,null,y(l.comment,((l,t)=>(s(),n(a,{key:t,class:u([r(i).e("reply-item")])},{default:c((()=>[d(a,{class:u([r(i).em("reply-item","left")])},{default:c((()=>[d(a,{class:u([r(i).e("avatar")])},{default:c((()=>[d(T,{url:l.avatar,size:"40"},null,8,["url"])])),_:2},1032,["class"])])),_:2},1032,["class"]),d(a,{class:u([r(i).em("reply-item","right")]),onClick:p((e=>r(A)(l)),["stop"])},{default:c((()=>[d(a,{class:u([r(i).e("reply-nickname"),r(i).e("nickname")])},{default:c((()=>[d(a,{class:"nickname"},{default:c((()=>[m(v(l.nickname),1)])),_:2},1024),l.authorNickname?(s(),n(a,{key:0,class:"author-nickname"},{default:c((()=>[m(v(l.authorNickname),1)])),_:2},1024)):k("v-if",!0)])),_:2},1032,["class"]),d(a,{class:u([r(i).e("content")])},{default:c((()=>[m(v(l.content),1)])),_:2},1032,["class"]),d(a,{class:u([r(i).e("bottom-operation")])},{default:c((()=>[d(oe,{data:{date:l.date,position:l.position,likeActive:l.likeActive,likeCount:l.likeCount,dislikeActive:l.dislikeActive},"show-like":e.showLike,"show-dislike":e.showDislike,"like-icon":e.likeIcon,"active-like-icon":e.activeLikeIcon,"dislike-icon":e.dislikeIcon,"like-icon-color":e.likeIconColor,"active-like-icon-color":e.activeLikeIconColor,"dislike-icon-color":e.dislikeIconColor,"show-delete":l.allowDelete,"show-reply":!l.disabledReply,onLike:()=>r(w)(l.id,o,t),onDislike:()=>r(I)(l.id,o,t),onDelete:()=>r(x)(l.id)},null,8,["data","show-like","show-dislike","like-icon","active-like-icon","dislike-icon","like-icon-color","active-like-icon-color","dislike-icon-color","show-delete","show-reply","onLike","onDislike","onDelete"])])),_:2},1032,["class"])])),_:2},1032,["class","onClick"])])),_:2},1032,["class"])))),128))])),_:2},1032,["class","style"]),l.commentCount>0?(s(),n(a,{key:0,class:u([r(i).e("show-more-operation")]),onClick:p((e=>r(D)(l.id)),["stop"])},{default:c((()=>[d(a,{class:u([r(i).em("show-more-operation","tips")])},{default:c((()=>{var e;return[!(null==(e=null==l?void 0:l.comment)?void 0:e.length)||l.hidden?(s(),n(t,{key:0},{default:c((()=>[m(" 查看"+v(l.commentCount)+"条回复 ",1)])),_:2},1024)):l.commentCount>l.comment.length?(s(),n(t,{key:1},{default:c((()=>[m(" 加载更多回复 ")])),_:1})):l.commentCount===l.comment.length?(s(),n(t,{key:2},{default:c((()=>[m(" 收起 ")])),_:1})):k("v-if",!0)]})),_:2},1032,["class"]),d(a,{class:u([r(i).em("show-more-operation","icon")])},{default:c((()=>[d(R,{name:l.commentCount>l.comment.length||l.hidden?"down":"up"},null,8,["name"])])),_:2},1032,["class"])])),_:2},1032,["class","onClick"])):k("v-if",!0)])),_:2},1032,["class"])])),_:2},1032,["class"])])),_:2},1032,["class"])))),128))])),_:1},8,["class"])}}}),[["__scopeId","data-v-faafb310"]]),ne=q(i({__name:"dynamic_detail",setup(e){const l=w(),t=o((()=>{var e;return null==(e=l.userInfo)?void 0:e.id})),i=a(0),p=a(null),h=a([]),C=a("hot"),T=a(1),W=a(!0),J=a(!1),M=a(!1),U=a(""),q=a(null),le=a(null),ae=a(),te=e=>({1:"图文",2:"视频",3:"案例",4:"活动"}[e]||""),ie=e=>e?e>=1e4?(e/1e4).toFixed(1)+"w":e>=1e3?(e/1e3).toFixed(1)+"k":e:0,oe=async(e=!1)=>{if(!J.value){J.value=!0;try{e&&(T.value=1,h.value=[]);const l=((await P({dynamic_id:i.value,page:T.value,page_size:20,sort:C.value})).data||[]).map((e=>{var l,a;return{id:e.id,avatar:(null==(l=e.user)?void 0:l.avatar)||"/static/images/user/default_avatar.png",nickname:(null==(a=e.user)?void 0:a.nickname)||"匿名用户",date:e.create_time||"",position:e.location||"",content:e.content||"",likeActive:e.is_liked||!1,likeCount:e.like_count||0,dislikeActive:!1,disabledReply:!1,allowDelete:e.user_id===t.value,commentCount:e.reply_count||0,comment:[]}}));e?h.value=l:h.value.push(...l),W.value=20===l.length}catch(l){console.error(l)}finally{J.value=!1}}},ne=e=>{C.value=e,oe(!0)},ce=()=>{W.value&&!J.value&&(T.value++,oe())},de=async({id:e,currentCommentCount:l})=>{var a;try{const o=((await P({dynamic_id:i.value,parent_id:e,page:Math.floor(l/20)+1,page_size:20})).data||[]).map((e=>({id:e.id,avatar:e.user_avatar||"/static/images/user/default_avatar.png",nickname:e.user_nickname||"匿名用户",date:e.create_time||"",position:e.location||"",content:e.reply_user_nickname?`回复 @${e.reply_user_nickname}：${e.content}`:e.content,likeActive:e.is_liked||!1,likeCount:e.like_count||0,dislikeActive:!1,disabledReply:!0,allowDelete:e.user_id===t.value})));null==(a=ae.value)||a.addCommentData(e,o)}catch(o){x({title:o.message||"加载失败",icon:"none"})}},ue=async()=>{if(l.isLogin)try{await X({id:i.value}),p.value.is_liked=!p.value.is_liked,p.value.like_count+=p.value.is_liked?1:-1}catch(e){x({title:e.message||"操作失败",icon:"none"})}else R({url:"/pages/login/login"})},re=async()=>{if(l.isLogin)try{await Z({id:i.value}),p.value.is_collected=!p.value.is_collected,p.value.collect_count+=p.value.is_collected?1:-1,x({title:p.value.is_collected?"收藏成功":"取消收藏",icon:"none"})}catch(e){x({title:e.message||"操作失败",icon:"none"})}else R({url:"/pages/login/login"})},me=async()=>{if(l.isLogin)try{await K({follow_type:p.value.user_type,follow_id:p.value.user_id}),p.value.is_followed=!p.value.is_followed,x({title:p.value.is_followed?"关注成功":"取消关注"})}catch(e){x({title:e.message||"操作失败",icon:"none"})}else R({url:"/pages/login/login"})},ve=async e=>{if(l.isLogin)try{await Q({id:e})}catch(a){x({title:a.message||"操作失败",icon:"none"})}else R({url:"/pages/login/login"})},ke=()=>{1===p.value.allow_comment?l.isLogin?(q.value=null,le.value=null,M.value=!0):R({url:"/pages/login/login"}):x({title:"该动态不允许评论",icon:"none"})},pe=({id:e,nickname:a})=>{if(1!==p.value.allow_comment)return void x({title:"该动态不允许评论",icon:"none"});if(!l.isLogin)return void R({url:"/pages/login/login"});const t=(e,l)=>{for(const a of e){if(a.id===l)return a;if(a.comment&&a.comment.length>0){const e=t(a.comment,l);if(e)return e}}return null},i=t(h.value,e);i&&(q.value={id:e,user_nickname:a},le.value=i,M.value=!0)},fe=async()=>{var e,a,t;if(U.value.trim())try{const o={dynamic_id:i.value,content:U.value.trim()};q.value&&(o.parent_id=le.value.id,o.reply_user_id=q.value.id);const s=await Y(o);x({title:"评论成功"});const n={id:s.comment_id||Date.now(),avatar:(null==(e=l.userInfo)?void 0:e.avatar)||"/static/images/user/default_avatar.png",nickname:(null==(a=l.userInfo)?void 0:a.nickname)||"我",date:"刚刚",position:"",content:U.value.trim(),likeActive:!1,likeCount:0,dislikeActive:!1,disabledReply:!!q.value,allowDelete:!0};q.value?null==(t=ae.value)||t.addCommentReply(le.value.id,n):oe(!0),U.value="",M.value=!1,q.value=null,le.value=null,p.value.comment_count++}catch(o){x({title:o.message||"评论失败",icon:"none"})}},_e=async e=>{var l;if((await L({title:"提示",content:"确定要删除该评论吗？"})).confirm)try{await ee({comment_id:e}),x({title:"删除成功"}),null==(l=ae.value)||l.deleteCommentReply(e),p.value.comment_count--}catch(a){x({title:a.message||"删除失败",icon:"none"})}};return I((e=>{e.id&&(i.value=Number(e.id),(async()=>{try{const e=await G({id:i.value});let l=[];e.tags&&("string"==typeof e.tags?l=e.tags.split(",").map((e=>e.trim())).filter(Boolean):Array.isArray(e.tags)&&(l=e.tags)),p.value={...e,tags:l,video:e.video_url||e.video||"",video_cover:e.video_cover||""}}catch(e){x({title:e.message||"加载失败",icon:"none"}),setTimeout((()=>{D()}),1500)}})(),oe(!0))})),A((()=>{var e,l;return{title:(null==(l=null==(e=p.value)?void 0:e.content)?void 0:l.slice(0,30))||"精彩动态",path:`/pages/dynamic_detail/dynamic_detail?id=${i.value}`}})),(e,l)=>{const a=j(z("page-meta"),F),i=H,o=b,w=f,I=S,A=j(z("tn-icon"),E),x=N,D=$,R=V,L=j(z("tn-popup"),O);return s(),_(g,null,[d(a,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),p.value?(s(),n(w,{key:0,class:"dynamic-detail"},{default:c((()=>[k(" 主体内容 "),d(x,{"scroll-y":"",class:"content-scroll"},{default:c((()=>[k(" 用户信息卡片 "),d(w,{class:"user-card"},{default:c((()=>[d(w,{class:"flex items-start"},{default:c((()=>[d(i,{src:p.value.user_avatar||"/static/images/user/default_avatar.png",class:"user-avatar",mode:"aspectFill"},null,8,["src"]),d(w,{class:"flex-1"},{default:c((()=>[d(w,{class:"flex items-center justify-between"},{default:c((()=>[d(w,null,{default:c((()=>[d(w,{class:"flex items-center"},{default:c((()=>[d(o,{class:"user-name"},{default:c((()=>[m(v(p.value.user_nickname),1)])),_:1}),2===p.value.user_type?(s(),n(w,{key:0,class:"user-badge badge-staff"},{default:c((()=>[m(" 服务人员 ")])),_:1})):k("v-if",!0),3===p.value.user_type?(s(),n(w,{key:1,class:"user-badge badge-official"},{default:c((()=>[m(" 官方 ")])),_:1})):k("v-if",!0),1===p.value.is_top?(s(),n(w,{key:2,class:"user-badge badge-top"},{default:c((()=>[m(" 置顶 ")])),_:1})):k("v-if",!0),1===p.value.is_hot?(s(),n(w,{key:3,class:"user-badge badge-hot"},{default:c((()=>[m(" 热门 ")])),_:1})):k("v-if",!0)])),_:1}),d(o,{class:"user-time"},{default:c((()=>[m(v(p.value.create_time),1)])),_:1})])),_:1}),p.value.user_id!==r(t)?(s(),n(w,{key:0,class:u(["follow-btn",p.value.is_followed?"follow-btn-active":"follow-btn-inactive"]),onClick:me},{default:c((()=>[m(v(p.value.is_followed?"已关注":"+ 关注"),1)])),_:1},8,["class"])):k("v-if",!0)])),_:1})])),_:1})])),_:1}),k(" 内容区域 "),d(w,{class:"content-wrapper"},{default:c((()=>{return[k(" 类型标签和动态标签 "),d(w,{class:"badges-row"},{default:c((()=>{return[p.value.dynamic_type?(s(),n(o,{key:0,class:u(["type-badge",(e=p.value.dynamic_type,{1:"bg-blue-100 text-blue-500",2:"bg-purple-100 text-purple-500",3:"bg-green-100 text-green-500",4:"bg-orange-100 text-orange-500"}[e]||"bg-gray-100 text-gray-500")])},{default:c((()=>[m(v(te(p.value.dynamic_type)),1)])),_:1},8,["class"])):k("v-if",!0),(s(!0),_(g,null,y(p.value.tags,((e,l)=>(s(),n(w,{key:l,class:"tag-item"},{default:c((()=>[d(o,{class:"tag-text"},{default:c((()=>[m("#"+v(e),1)])),_:2},1024)])),_:2},1024)))),128))];var e})),_:1}),k(" 文字内容 "),d(w,{class:"content-text"},{default:c((()=>[m(v(p.value.content),1)])),_:1}),k(" 图片 "),p.value.images&&p.value.images.length>0?(s(),n(w,{key:0,class:u(["image-grid",(e=p.value.images.length,1===e?"grid-cols-1":2===e||4===e?"grid-cols-2":"grid-cols-3")])},{default:c((()=>[(s(!0),_(g,null,y(p.value.images,((e,l)=>(s(),n(i,{key:l,src:e,class:"grid-image",mode:"aspectFill",onClick:e=>{return a=p.value.images,void B({urls:a,current:l});var a}},null,8,["src","onClick"])))),128))])),_:1},8,["class"])):k("v-if",!0),k(" 视频 "),p.value.video?(s(),n(w,{key:1,class:"video-wrapper"},{default:c((()=>[d(I,{src:p.value.video,class:"video-player",poster:p.value.video_cover,controls:"","object-fit":"contain"},null,8,["src","poster"])])),_:1})):k("v-if",!0)];var e})),_:1}),k(" 互动数据 "),d(w,{class:"stats-bar"},{default:c((()=>[d(w,{class:"stats-left"},{default:c((()=>[d(w,{class:"stat-item"},{default:c((()=>[d(A,{name:"eye",size:"32"}),d(o,null,{default:c((()=>[m(v(p.value.view_count)+" 浏览",1)])),_:1})])),_:1}),d(w,{class:"stat-item"},{default:c((()=>[d(A,{name:"heart",size:"32"}),d(o,null,{default:c((()=>[m(v(p.value.like_count)+" 点赞",1)])),_:1})])),_:1}),d(w,{class:"stat-item"},{default:c((()=>[d(A,{name:"star",size:"32"}),d(o,null,{default:c((()=>[m(v(p.value.collect_count)+" 收藏",1)])),_:1})])),_:1})])),_:1}),k(" 位置信息 "),p.value.location?(s(),n(w,{key:0,class:"location-info"},{default:c((()=>[d(A,{name:"map-pin",size:"28",color:"#64748b"}),d(o,{class:"location-text"},{default:c((()=>[m(v(p.value.location),1)])),_:1})])),_:1})):k("v-if",!0)])),_:1})])),_:1}),k(" 评论区 "),d(w,{class:"comment-section"},{default:c((()=>[d(w,{class:"comment-header"},{default:c((()=>[d(o,{class:"comment-title"},{default:c((()=>[m("评论 ("+v(p.value.comment_count)+")",1)])),_:1}),d(w,{class:"comment-sort"},{default:c((()=>[d(o,{class:u(["sort-item",{"sort-item-active":"hot"===C.value}]),onClick:l[0]||(l[0]=e=>ne("hot"))},{default:c((()=>[m(" 最热 ")])),_:1},8,["class"]),d(o,{class:"sort-divider"},{default:c((()=>[m("|")])),_:1}),d(o,{class:u(["sort-item",{"sort-item-active":"new"===C.value}]),onClick:l[1]||(l[1]=e=>ne("new"))},{default:c((()=>[m(" 最新 ")])),_:1},8,["class"])])),_:1})])),_:1}),k(" 评论列表 - 使用图鸟评论列表组件 "),0===h.value.length?(s(),n(w,{key:0,class:"comment-empty"},{default:c((()=>[m(" 暂无评论，快来抢沙发吧~ ")])),_:1})):(s(),n(w,{key:1,class:"comment-list-wrapper"},{default:c((()=>[d(se,{ref_key:"commentListRef",ref:ae,data:h.value,"show-dislike":!1,"like-icon":"like-fill","active-like-icon":"like","active-like-icon-color":"tn-red",onLike:ve,onReply:pe,onDelete:_e,onShowMore:de},null,8,["data"])])),_:1})),k(" 加载更多评论 "),W.value&&h.value.length>0?(s(),n(w,{key:2,class:"load-more"},{default:c((()=>[J.value?(s(),n(o,{key:0},{default:c((()=>[m("加载中...")])),_:1})):(s(),n(o,{key:1,onClick:ce},{default:c((()=>[m("点击加载更多")])),_:1}))])),_:1})):k("v-if",!0)])),_:1}),k(" 底部占位 "),d(w,{class:"bottom-spacer"})])),_:1}),k(" 底部操作栏 "),d(w,{class:"action-bar",style:{"padding-bottom":"calc(16rpx + env(safe-area-inset-bottom))"}},{default:c((()=>[k(" 评论输入框 - 根据 allow_comment 控制显示 "),1===p.value.allow_comment?(s(),n(w,{key:0,class:"comment-input-trigger",onClick:ke},{default:c((()=>[m(" 说点什么... ")])),_:1})):(s(),_(g,{key:1},[k(" 评论已关闭提示 "),d(w,{class:"comment-disabled-tip"},{default:c((()=>[d(A,{name:"info-circle",size:"28",color:"#999"}),d(o,{class:"tip-text"},{default:c((()=>[m("该动态已关闭评论")])),_:1})])),_:1})],2112)),d(w,{class:"action-buttons"},{default:c((()=>[d(w,{class:u(["action-btn",p.value.is_liked?"action-btn-like-active":"action-btn-like"]),onClick:ue},{default:c((()=>[d(A,{name:p.value.is_liked?"like-fill":"like",size:"44"},null,8,["name"]),d(o,{class:"action-btn-text"},{default:c((()=>[m(v(ie(p.value.like_count)),1)])),_:1})])),_:1},8,["class"]),d(w,{class:u(["action-btn",p.value.is_collected?"action-btn-collect-active":"action-btn-collect"]),onClick:re},{default:c((()=>[d(A,{name:p.value.is_collected?"star-fill":"star",size:"44"},null,8,["name"]),d(o,{class:"action-btn-text"},{default:c((()=>[m(v(ie(p.value.collect_count)),1)])),_:1})])),_:1},8,["class"]),d(w,{class:"action-btn action-btn-comment"},{default:c((()=>[d(A,{name:"chat",size:"44"}),d(o,{class:"action-btn-text"},{default:c((()=>[m(v(ie(p.value.comment_count)),1)])),_:1})])),_:1}),d(D,{class:"share-btn action-btn action-btn-share","open-type":"share"},{default:c((()=>[d(A,{name:"share",size:"44"}),d(o,{class:"action-btn-text"},{default:c((()=>[m("分享")])),_:1})])),_:1})])),_:1})])),_:1}),k(" 评论输入弹窗 "),d(L,{modelValue:M.value,"onUpdate:modelValue":l[4]||(l[4]=e=>M.value=e),"open-direction":"bottom","safe-area-inset-bottom":!0,radius:24,height:"60%"},{default:c((()=>[d(w,{class:"comment-popup"},{default:c((()=>[d(w,{class:"popup-header"},{default:c((()=>[d(w,{class:"popup-title-bar"},{default:c((()=>[d(o,{class:"popup-title-text"},{default:c((()=>[m(v(q.value?`回复 @${q.value.user_nickname}`:"发表评论"),1)])),_:1}),d(w,{class:"popup-close",onClick:l[2]||(l[2]=e=>M.value=!1)},{default:c((()=>[d(A,{name:"close",size:"32",color:"#94a3b8"})])),_:1})])),_:1})])),_:1}),d(w,{class:"popup-body"},{default:c((()=>[d(R,{modelValue:U.value,"onUpdate:modelValue":l[3]||(l[3]=e=>U.value=e),class:"comment-textarea",placeholder:q.value?`回复 @${q.value.user_nickname}`:"说点什么...",maxlength:500,"auto-height":!0,focus:M.value,"placeholder-class":"textarea-placeholder"},null,8,["modelValue","placeholder","focus"])])),_:1}),d(w,{class:"popup-footer"},{default:c((()=>[d(o,{class:"char-count"},{default:c((()=>[m(v(U.value.length)+"/500",1)])),_:1}),d(D,{class:u(["submit-btn",{"submit-btn-disabled":!U.value.trim()}]),disabled:!U.value.trim(),onClick:fe},{default:c((()=>[m(" 发送 ")])),_:1},8,["class","disabled"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})):(s(),_(g,{key:1},[k(" 加载中 "),d(w,{class:"flex items-center justify-center h-screen"},{default:c((()=>[d(o,{class:"text-gray-400"},{default:c((()=>[m("加载中...")])),_:1})])),_:1})],2112))],64)}}}),[["__scopeId","data-v-9b781dac"]]);export{ne as default};
