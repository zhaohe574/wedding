import{am as e,br as t,bs as r,bt as n,bu as a,bv as s,k as o,bw as i,bx as u}from"./index-e3492752.js";function c(){return e.get(t)}const l={requestInterceptorsHook(e,t){const{urlPrefix:r,baseUrl:n,withToken:s}=t;if(e.header=e.header??{},r&&(e.url=`${r}${e.url}`),n&&(e.url=`${n}${e.url}`),s&&!e.header.token){const t=c();t&&(e.header.token=t)}return e.header.version=a.version,e.params&&(e.data=e.params,delete e.params),e},async responseInterceptorsHook(e,t){const{isTransformResponse:r,isReturnDefaultResponse:n,isAuth:a}=t;if(n)return e;if(!r)return e.data;const{code:i,data:u,msg:l}=e.data;switch(i){case s.SUCCESS:return l&&uni.$u.toast(l),u;case s.FAILED:return l&&uni.$u.toast(l),Promise.reject(l);case s.TOKEN_INVALID:const e=k();return await e.logout(),a&&!c()&&o({url:"/packages/pages/admin_login/admin_login"}),Promise.reject(l);default:return u}},async responseInterceptorsCatchHook(e,t){var r;return(null==(r=e.method)?void 0:r.toUpperCase())==i.POST&&uni.$u.toast("请求失败，请重试"),Promise.reject(t)}},d={requestOptions:{timeout:a.timeout},baseUrl:a.baseUrl,isReturnDefaultResponse:!1,isTransformResponse:!0,urlPrefix:"adminapi",ignoreCancel:!1,withToken:!0,isAuth:!0,retryCount:2,retryTimeout:1e3,requestHooks:l};const m=new r(n(d,f||{}));var f;function p(e){return m.get({url:"/financial.financial_report/overview",data:e})}function g(e){return m.get({url:"/financial.financial_report/incomeTrend",data:e})}function h(e){return m.get({url:"/order.order/statistics",data:e})}const k=u({id:"adminStore",state:()=>({token:e.get(t)||null,adminInfo:{}}),getters:{isLogin:e=>!!e.token},actions:{async login(r){const n=await function(e){return m.post({url:"/login/account",data:e},{withToken:!1,isAuth:!1})}({...r,terminal:2});return this.token=n.token,this.adminInfo=n,e.set(t,n.token),n},async logout(){try{await m.post({url:"/login/logout"})}finally{this.token="",this.adminInfo={},e.remove(t)}}}});export{p as a,g as b,h as c,k as u};
