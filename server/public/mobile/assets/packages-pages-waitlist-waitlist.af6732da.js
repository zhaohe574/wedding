import{d as a,u as e,s as l,P as t,o as s,h as o,e as r,f as c,w as n,g as i,F as u,i as f,b as d,j as _,r as m,a as p,l as y,m as v,y as g,n as b,t as C,A as k,k as h,aP as $,aD as w,G as z}from"./index-e3492752.js";import{_ as F}from"./page-meta.a4be6114.js";import{_ as S}from"./icon.e613abcd.js";import{a as j,c as x}from"./schedule.38544613.js";import{_ as D}from"./_plugin-vue_export-helper.1b428a4d.js";import"./index.f1be293a.js";const N=D(a({__name:"waitlist",setup(a){const D=e(),N=[{value:-1,label:"全部"},{value:0,label:"等待中"},{value:1,label:"已通知"},{value:2,label:"已下单"},{value:3,label:"已过期"}],I=l(!1),A=l(-1),M=l([]),P=async()=>{I.value=!0;try{const a={};A.value>=0&&(a.status=A.value);const e=await j(a);M.value=e||[]}finally{I.value=!1}},G=a=>({0:"clock",1:"notification-fill",2:"check-circle-fill",3:"close-circle-fill"}[a]||"clock"),H=a=>({0:"#1890FF",1:"#FA8C16",2:"#52C41A",3:"#999999"}[a]||"#999999"),T=(a,e)=>{if(a.startsWith("#")){const l=a.replace("#","");return`rgba(${parseInt(l.substring(0,2),16)}, ${parseInt(l.substring(2,4),16)}, ${parseInt(l.substring(4,6),16)}, ${e})`}return a},W=a=>{if(!a)return"未知时间";let e;if("string"==typeof a)e=new Date(a);else{if("number"!=typeof a)return"未知时间";e=a<1e10?new Date(1e3*a):new Date(a)}if(isNaN(e.getTime()))return"未知时间";return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`},Y=a=>{if(null==a?void 0:a.time_slot_desc)return a.time_slot_desc;const e=Number(null==a?void 0:a.time_slot);return Number.isFinite(e)&&{0:"全天",1:"早礼",2:"午宴",3:"晚宴"}[e]||"未知场次"};return t((()=>{P()})),(a,e)=>{const l=m(p("page-meta"),F),t=y,j=v,q=m(p("tn-icon"),S),B=z;return s(),o(u,null,[r(l,{"page-style":c(D).pageStyle},null,8,["page-style"]),r(j,{class:"waitlist-page"},{default:n((()=>[i(" 筛选标签 "),r(j,{class:"filter-tabs"},{default:n((()=>[(s(),o(u,null,f(N,(a=>r(j,{class:g(["tab-item",{active:A.value===a.value}]),key:a.value,onClick:()=>{A.value=a.value,P()}},{default:n((()=>[r(t,{class:"tab-label",style:b(A.value===a.value?{color:c(D).primaryColor}:{})},{default:n((()=>[_(C(a.label),1)])),_:2},1032,["style"]),A.value===a.value?(s(),d(j,{key:0,class:"tab-indicator",style:b({background:c(D).primaryColor})},null,8,["style"])):i("v-if",!0)])),_:2},1032,["class","onClick"]))),64))])),_:1}),i(" 空状态 "),I.value||0!==M.value.length?i("v-if",!0):(s(),d(j,{key:0,class:"empty-state"},{default:n((()=>[r(q,{name:"inbox",size:"120",color:"#CCCCCC"}),r(t,{class:"empty-text"},{default:n((()=>[_("暂无候补记录")])),_:1}),r(t,{class:"empty-hint"},{default:n((()=>[_("档期满时可加入候补，有空位时会通知您")])),_:1})])),_:1})),i(" 候补列表 "),r(j,{class:"waitlist-list"},{default:n((()=>[(s(!0),o(u,null,f(M.value,(a=>(s(),d(j,{class:"waitlist-card",key:a.id},{default:n((()=>{return[i(" 状态标签（顶部） "),r(j,{class:g(["status-ribbon",(e=a.notify_status,{0:"status-waiting",1:"status-notified",2:"status-ordered",3:"status-expired"}[e]||"")])},{default:n((()=>[r(q,{name:G(a.notify_status),size:"28",color:H(a.notify_status)},null,8,["name","color"]),r(t,null,{default:n((()=>[_(C(a.notify_status_desc),1)])),_:2},1024)])),_:2},1032,["class"]),i(" 卡片头部：人员信息 "),r(j,{class:"card-header"},{default:n((()=>[r(j,{class:"staff-section"},{default:n((()=>[r(j,{class:"avatar-wrapper"},{default:n((()=>{var e;return[r(B,{src:null==(e=a.staff)?void 0:e.avatar,class:"staff-avatar",mode:"aspectFill"},null,8,["src"]),r(j,{class:"avatar-border",style:b({borderColor:c(D).primaryColor})},null,8,["style"])]})),_:2},1024),r(j,{class:"staff-info"},{default:n((()=>[r(t,{class:"staff-name"},{default:n((()=>{var e;return[_(C((null==(e=a.staff)?void 0:e.name)||"未知人员"),1)]})),_:2},1024),r(j,{class:"staff-tag",style:b({background:T(c(D).primaryColor,.1),borderColor:T(c(D).primaryColor,.2)})},{default:n((()=>[r(q,{name:"shield-check",size:"24",color:c(D).primaryColor},null,8,["color"]),r(t,{class:"staff-category",style:b({color:c(D).primaryColor})},{default:n((()=>{var e;return[_(C((null==(e=a.staff)?void 0:e.category_name)||"服务人员"),1)]})),_:2},1032,["style"])])),_:2},1032,["style"])])),_:2},1024)])),_:2},1024)])),_:2},1024),i(" 预约信息区域 "),r(j,{class:"info-section"},{default:n((()=>[r(j,{class:"info-item"},{default:n((()=>[r(j,{class:"icon-wrapper",style:b({background:T(c(D).primaryColor,.1)})},{default:n((()=>[r(q,{name:"calendar",size:"36",color:c(D).primaryColor},null,8,["color"])])),_:1},8,["style"]),r(j,{class:"info-content"},{default:n((()=>[r(t,{class:"info-label"},{default:n((()=>[_("预约日期")])),_:1}),r(t,{class:"info-value"},{default:n((()=>[_(C(a.schedule_date),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),a.package||a.package_id?(s(),d(j,{key:0,class:"info-item"},{default:n((()=>[r(j,{class:"icon-wrapper",style:b({background:T(c(D).secondaryColor,.1)})},{default:n((()=>[r(q,{name:"gift",size:"36",color:c(D).secondaryColor},null,8,["color"])])),_:1},8,["style"]),r(j,{class:"info-content"},{default:n((()=>[r(t,{class:"info-label"},{default:n((()=>[_("套餐")])),_:1}),r(t,{class:"info-value"},{default:n((()=>{var e;return[_(C((null==(e=a.package)?void 0:e.name)||"套餐已删除"),1)]})),_:2},1024)])),_:2},1024)])),_:2},1024)):i("v-if",!0),r(j,{class:"info-item"},{default:n((()=>[r(j,{class:"icon-wrapper",style:b({background:T(c(D).accentColor,.1)})},{default:n((()=>[r(q,{name:"time",size:"36",color:c(D).accentColor},null,8,["color"])])),_:1},8,["style"]),r(j,{class:"info-content"},{default:n((()=>[r(t,{class:"info-label"},{default:n((()=>[_("时间段")])),_:1}),r(t,{class:"info-value"},{default:n((()=>[_(C(Y(a)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),i(" 底部：时间 + 操作按钮 "),r(j,{class:"card-footer"},{default:n((()=>[r(j,{class:"time-info"},{default:n((()=>[r(q,{name:"clock",size:"28",color:"#999999"}),r(t,{class:"time-text"},{default:n((()=>[_(C(W(a.create_time)),1)])),_:2},1024)])),_:2},1024),r(j,{class:"action-buttons"},{default:n((()=>[1===a.notify_status?(s(),d(j,{key:0,class:"btn btn-book",style:b({background:`linear-gradient(135deg, ${c(D).ctaColor} 0%, ${c(D).ctaColor} 100%)`,color:c(D).btnColor}),onClick:k((e=>(a=>{const e=[`staff_id=${a.staff_id}`,`date=${a.schedule_date}`];a.package_id&&e.push(`package_id=${a.package_id}`),null!==a.time_slot&&void 0!==a.time_slot&&e.push(`time_slot=${a.time_slot}`),h({url:`/packages/pages/schedule_calendar/schedule_calendar?${e.join("&")}`})})(a)),["stop"])},{default:n((()=>[r(q,{name:"check-circle",size:"28",color:c(D).btnColor},null,8,["color"]),r(t,null,{default:n((()=>[_("立即预约")])),_:1})])),_:2},1032,["style","onClick"])):i("v-if",!0),0===a.notify_status||1===a.notify_status?(s(),d(j,{key:1,class:"btn btn-cancel",onClick:k((e=>(a=>{$({title:"取消候补",content:"确定要取消该候补吗？取消后需要重新加入候补队列。",confirmColor:"#FF2C3C",success:async e=>{if(e.confirm)try{await x({id:Number(a.id)}),w({title:"取消成功",icon:"success"}),P()}catch(l){w({title:l.message||"操作失败",icon:"none"})}}})})(a)),["stop"])},{default:n((()=>[r(q,{name:"close-circle",size:"28",color:"#666666"}),r(t,null,{default:n((()=>[_("取消候补")])),_:1})])),_:2},1032,["onClick"])):i("v-if",!0)])),_:2},1024)])),_:2},1024)];var e})),_:2},1024)))),128))])),_:1})])),_:1})],64)}}}),[["__scopeId","data-v-5d760797"]]);export{N as default};
