import{d as t,C as e,s as a,P as l,o as s,h as r,e as o,w as n,j as u,t as d,b as i,F as c,i as f,aD as x,aq as p,k as m,r as g,a as _,m as b,n as y,l as h}from"./index-e3492752.js";import{_ as v}from"./navigation-bar.2687311c.js";import{_ as j}from"./page-meta.a4be6114.js";import{_ as w}from"./button.c1dc664f.js";import{u as k,a as C,b as M,c as $}from"./admin.5b05ff33.js";import"./_plugin-vue_export-helper.1b428a4d.js";import"./icon.e613abcd.js";import"./index.f1be293a.js";import"./loading.2b80eb94.js";import"./index.89b6df5d.js";import"./debounce.096fb07a.js";const N=t({__name:"admin_dashboard",setup(t){const N=k(),P=e(),F=a({}),q=a({}),z=a([]),A=a(!1),B=t=>Number(t||0).toFixed(2),D=t=>{var e;const a=Number((null==(e=q.value)?void 0:e.total_orders)||0);return a?Math.min(100,Math.round(t/a*100)):0},L=async()=>{if(!A.value){A.value=!0;try{const[t,e,a]=await Promise.all([C(),M({type:"daily"}),$()]);F.value=t||{},q.value=a||{},(t=>{const e=Object.entries(t||{}).slice(-7),a=e.map((([,t])=>Number(t||0))),l=Math.max(...a,1);z.value=e.map((([t,e])=>{const a=Number(e||0);return{label:t.slice(5),value:a,height:Math.max(12,Math.round(a/l*140))}}))})((null==e?void 0:e.data)||{})}catch(t){const e="string"==typeof t?t:(null==t?void 0:t.msg)||(null==t?void 0:t.message)||"加载失败";x({title:e,icon:"none"})}finally{A.value=!1}}},O=async()=>{await N.logout(),m({url:"/packages/pages/admin_login/admin_login"})};return l((async()=>{await(async()=>{var t,e,a;return(null==(t=P.config)?void 0:t.feature_switch)||await P.getConfig(),1!==(null==(a=null==(e=P.config)?void 0:e.feature_switch)?void 0:a.admin_dashboard)?(x({title:"管理员看板已关闭",icon:"none"}),setTimeout((()=>p()),1200),!1):!!N.isLogin||(m({url:"/packages/pages/admin_login/admin_login"}),!1)})()&&L()})),(t,e)=>{const a=g(_("navigation-bar"),v),l=g(_("page-meta"),j),x=b,p=h,m=g(_("tn-button"),w);return s(),r(c,null,[o(l,{"page-style":t.$theme.pageStyle},{default:n((()=>[o(a,{title:"管理员看板","front-color":t.$theme.navColor,"background-color":t.$theme.navBgColor},null,8,["front-color","background-color"])])),_:1},8,["page-style"]),o(x,{class:"min-h-screen bg-[#f6f6f6] pb-[40rpx]"},{default:n((()=>[o(x,{class:"bg-white mx-[24rpx] mt-[24rpx] rounded-lg p-[24rpx]"},{default:n((()=>[o(x,{class:"flex items-center justify-between"},{default:n((()=>[o(x,{class:"text-base font-semibold"},{default:n((()=>[u("概览")])),_:1}),o(x,{class:"text-xs text-gray-400",onClick:L},{default:n((()=>[u("刷新")])),_:1})])),_:1}),o(x,{class:"grid grid-cols-2 gap-[16rpx] mt-[20rpx]"},{default:n((()=>[o(x,{class:"bg-[#f8fafc] rounded-lg p-[20rpx]"},{default:n((()=>[o(x,{class:"text-xs text-gray-400"},{default:n((()=>[u("总收入")])),_:1}),o(x,{class:"text-lg font-semibold mt-[6rpx]"},{default:n((()=>[u("¥"+d(B(F.value.total_income)),1)])),_:1})])),_:1}),o(x,{class:"bg-[#f8fafc] rounded-lg p-[20rpx]"},{default:n((()=>[o(x,{class:"text-xs text-gray-400"},{default:n((()=>[u("净收入")])),_:1}),o(x,{class:"text-lg font-semibold mt-[6rpx]"},{default:n((()=>[u("¥"+d(B(F.value.net_income)),1)])),_:1})])),_:1}),o(x,{class:"bg-[#f8fafc] rounded-lg p-[20rpx]"},{default:n((()=>[o(x,{class:"text-xs text-gray-400"},{default:n((()=>[u("订单数")])),_:1}),o(x,{class:"text-lg font-semibold mt-[6rpx]"},{default:n((()=>[u(d(F.value.order_count||0),1)])),_:1})])),_:1}),o(x,{class:"bg-[#f8fafc] rounded-lg p-[20rpx]"},{default:n((()=>[o(x,{class:"text-xs text-gray-400"},{default:n((()=>[u("利润率")])),_:1}),o(x,{class:"text-lg font-semibold mt-[6rpx]"},{default:n((()=>[u(d(F.value.profit_rate||0)+"%",1)])),_:1})])),_:1})])),_:1})])),_:1}),o(x,{class:"bg-white mx-[24rpx] mt-[20rpx] rounded-lg p-[24rpx]"},{default:n((()=>[o(x,{class:"text-base font-semibold"},{default:n((()=>[u("收入趋势")])),_:1}),0===z.value.length?(s(),i(x,{key:0,class:"text-center text-gray-400 py-[40rpx]"},{default:n((()=>[u("暂无数据")])),_:1})):(s(),i(x,{key:1,class:"flex items-end gap-[12rpx] mt-[24rpx]",style:{height:"180rpx"}},{default:n((()=>[(s(!0),r(c,null,f(z.value,(e=>(s(),i(x,{key:e.label,class:"flex-1 flex flex-col items-center justify-end"},{default:n((()=>[o(x,{class:"w-[18rpx] rounded-t",style:y({height:e.height+"rpx",background:t.$theme.primaryColor})},null,8,["style"]),o(x,{class:"text-[20rpx] text-gray-400 mt-[8rpx]"},{default:n((()=>[u(d(e.label),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1}))])),_:1}),o(x,{class:"bg-white mx-[24rpx] mt-[20rpx] rounded-lg p-[24rpx]"},{default:n((()=>[o(x,{class:"text-base font-semibold"},{default:n((()=>[u("订单统计")])),_:1}),o(x,{class:"text-xs text-gray-400 mt-[8rpx]"},{default:n((()=>[u("总订单 "+d(q.value.total_orders||0)+" · 已收款 ¥"+d(B(q.value.paid_amount)),1)])),_:1}),o(x,{class:"mt-[20rpx]"},{default:n((()=>[(s(!0),r(c,null,f(q.value.status_counts||[],(e=>(s(),i(x,{key:e.status,class:"mb-[14rpx]"},{default:n((()=>[o(x,{class:"flex items-center justify-between text-xs text-gray-500"},{default:n((()=>[o(p,null,{default:n((()=>[u(d(e.label),1)])),_:2},1024),o(p,null,{default:n((()=>[u(d(e.count),1)])),_:2},1024)])),_:2},1024),o(x,{class:"h-[10rpx] bg-gray-100 rounded-full mt-[6rpx] overflow-hidden"},{default:n((()=>[o(x,{class:"h-full rounded-full",style:y({width:D(e.count)+"%",background:t.$theme.primaryColor})},null,8,["style"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),o(x,{class:"mx-[24rpx] mt-[24rpx]"},{default:n((()=>[o(m,{type:"danger",shape:"round",size:"lg",plain:!0,onClick:O},{default:n((()=>[u(" 退出登录 ")])),_:1})])),_:1})])),_:1})],64)}}});export{N as default};
