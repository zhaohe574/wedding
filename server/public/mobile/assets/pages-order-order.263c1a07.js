import{d as e,u as a,c as r,r as t,a as l,o,b as s,w as d,g as c,e as i,n,f as u,j as _,t as m,h as p,F as f,i as y,y as v,A as g,l as b,m as k,G as C,s as h,M as x,v as w,O as j,P as S,aS as N,aT as A,k as $,aP as E,aD as F}from"./index-e3492752.js";import{_ as D}from"./page-meta.a4be6114.js";import{_ as z}from"./tabs-item.3a07d27c.js";import{_ as B}from"./tabs.f4a1a0ed.js";import{_ as P}from"./loading.2b80eb94.js";import{_ as T}from"./icon.e613abcd.js";import{_ as I}from"./tabbar.vue_vue_type_script_setup_true_lang.d2dbfaf9.js";import{g as O,a as M,c as V,b as U,d as G}from"./order.1e435880.js";import{_ as H}from"./_plugin-vue_export-helper.1b428a4d.js";import"./badge.46a4bc76.js";import"./index.f1be293a.js";import"./index.89b6df5d.js";import"./is-number.7ef6fec2.js";import"./_objectToString.c905654b.js";import"./is-empty.c0d66e4a.js";import"./index.04c93aab.js";import"./event.5568c9d8.js";import"./is-boolean.00bf65dc.js";import"./u-icon.c576501f.js";const R=H(e({name:"OrderCard",options:{virtualHost:!0},props:{order:null},setup(e,{emit:h}){const x=e,w=a(),j=e=>{const a=Number(e??-1);return Number.isFinite(a)&&a>=0?{0:"全天",1:"早礼",2:"午宴",3:"晚宴"}[a]||"未知场次":"未选择场次"},S={pending_confirm:{text:"待确认",color:"#F59E0B",bgColor:"rgba(245, 158, 11, 0.12)"},pending_pay:{text:"待支付",color:"#F97316",bgColor:"rgba(249, 115, 22, 0.12)"},paid:{text:"已支付",color:"#19BE6B",bgColor:"rgba(25, 190, 107, 0.12)"},in_service:{text:"服务中",color:"#3B82F6",bgColor:"rgba(59, 130, 246, 0.12)"},completed:{text:"已完成",color:"#16A34A",bgColor:"rgba(22, 163, 74, 0.12)"},reviewed:{text:"已评价",color:"#10B981",bgColor:"rgba(16, 185, 129, 0.12)"},cancelled:{text:"已取消",color:"#9CA3AF",bgColor:"rgba(156, 163, 175, 0.12)"},paused:{text:"已暂停",color:"#F59E0B",bgColor:"rgba(245, 158, 11, 0.12)"},refunded:{text:"已退款",color:"#EF4444",bgColor:"rgba(239, 68, 68, 0.12)"}},N=r((()=>{const e=new Map;return x.order.items.forEach((a=>{const r=a.staffName||"服务人员";e.has(r)||e.set(r,{name:r,avatar:a.staffAvatar||"/static/images/default-avatar.png"})})),Array.from(e.values())})),A=r((()=>{const e=new Set;return x.order.items.forEach((a=>{e.add(a.packageName||"服务套餐")})),Array.from(e.values())})),$=r((()=>{const e=new Set;return x.order.items.forEach((a=>{const r=a.serviceDate||"未选择日期",t=a.timeSlotDesc||j(a.timeSlot);e.add(`${r} ${t}`)})),Array.from(e.values())})),E=r((()=>{const e=new Map;return x.order.items.forEach((a=>{const r=a.serviceDate||"未选择日期",t=a.timeSlotDesc||j(a.timeSlot);e.has(r)||e.set(r,[]);const l=e.get(r);l.some((e=>e.timeSlot===a.timeSlot))||l.push({timeSlot:a.timeSlot,timeSlotDesc:t})})),Array.from(e.entries()).map((([e,a])=>({date:e,slots:a.sort(((e,a)=>e.timeSlot-a.timeSlot))})))})),F=r((()=>N.value[0]||{name:"服务人员",avatar:"/static/images/default-avatar.png"})),D=r((()=>N.value.length<=1?F.value.name:`${F.value.name} 等${N.value.length}人`)),z=r((()=>0===A.value.length?"服务套餐":A.value.length<=2?A.value.join(" / "):`${A.value[0]} 等${A.value.length}个套餐`));r((()=>0===$.value.length?"未选择档期":$.value.length<=2?$.value.join(" / "):`${$.value[0]} 等${$.value.length}个场次`));const B=r((()=>{var e;return(null==(e=S[x.order.status])?void 0:e.text)||"未知状态"})),P=r((()=>{const e=S[x.order.status];return{backgroundColor:(null==e?void 0:e.bgColor)||"#F5F5F5",color:(null==e?void 0:e.color)||"#999999"}})),I=e=>"primary"===e?{color:w.btnColor}:{color:"#666666"},O=()=>{h("click",x.order.id)};return(a,r)=>{const j=b,S=k,N=C,A=t(l("tn-icon"),T);return o(),s(S,{class:"order-card",onClick:O},{default:d((()=>[c(" 状态标签 "),i(S,{class:"order-card__status",style:n(u(P))},{default:d((()=>[i(j,{class:"order-card__status-text"},{default:d((()=>[_(m(u(B)),1)])),_:1})])),_:1},8,["style"]),c(" 订单抬头 "),i(S,{class:"order-card__header"},{default:d((()=>[i(S,{class:"order-card__order-info"},{default:d((()=>[i(j,{class:"order-card__order-sn"},{default:d((()=>[_("订单号："+m(e.order.orderNo),1)])),_:1}),i(j,{class:"order-card__order-time"},{default:d((()=>[_(m(e.order.createTime),1)])),_:1})])),_:1})])),_:1}),c(" 人员/套餐信息 "),i(S,{class:"order-card__main"},{default:d((()=>[c(" 人员信息 "),i(S,{class:"order-card__staff-section"},{default:d((()=>[i(N,{class:"order-card__avatar",src:u(F).avatar,mode:"aspectFill"},null,8,["src"]),i(S,{class:"order-card__staff-info"},{default:d((()=>[i(j,{class:"order-card__staff-name"},{default:d((()=>[_(m(u(D)),1)])),_:1}),i(j,{class:"order-card__package-name"},{default:d((()=>[_(m(u(z)),1)])),_:1})])),_:1})])),_:1}),c(" 服务信息 "),i(S,{class:"order-card__service-info"},{default:d((()=>[c(" 预约时间场次 "),i(S,{class:"order-card__info-row"},{default:d((()=>[i(S,{class:"order-card__info-icon-wrapper"},{default:d((()=>[i(A,{name:"calendar",size:"28",color:u(w).primaryColor},null,8,["color"])])),_:1}),i(S,{class:"order-card__info-content"},{default:d((()=>[i(j,{class:"order-card__info-label"},{default:d((()=>[_("预约档期")])),_:1}),c(" 按日期分组显示场次 "),i(S,{class:"order-card__schedule-list"},{default:d((()=>[(o(!0),p(f,null,y(u(E),((e,a)=>(o(),s(S,{key:a,class:"order-card__schedule-item"},{default:d((()=>[i(S,{class:"order-card__schedule-date"},{default:d((()=>[i(j,{class:"order-card__schedule-date-text"},{default:d((()=>[_(m(e.date),1)])),_:2},1024)])),_:2},1024),i(S,{class:"order-card__schedule-slots"},{default:d((()=>[(o(!0),p(f,null,y(e.slots,((e,a)=>{return o(),s(S,{key:a,class:"order-card__schedule-slot",style:n({backgroundColor:(r=u(w).primaryColor,`${r}1A`),color:u(w).primaryColor,borderColor:u(w).primaryColor})},{default:d((()=>[_(m(e.timeSlotDesc),1)])),_:2},1032,["style"]);var r})),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}),c(" 服务地址 "),i(S,{class:"order-card__info-row"},{default:d((()=>[i(S,{class:"order-card__info-icon-wrapper"},{default:d((()=>[i(A,{name:"location",size:"28",color:"#999999"})])),_:1}),i(S,{class:"order-card__info-content"},{default:d((()=>[i(S,{class:"order-card__location-wrapper"},{default:d((()=>[i(j,{class:"order-card__location-text"},{default:d((()=>[_(m(e.order.location),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),c(" 价格信息 "),i(S,{class:"order-card__price"},{default:d((()=>[i(S,{class:"order-card__price-left"},{default:d((()=>[e.order.discount>0?(o(),s(S,{key:0,class:"order-card__price-detail"},{default:d((()=>[i(j,{class:"order-card__price-label"},{default:d((()=>[_("原价：")])),_:1}),i(j,{class:"order-card__price-original"},{default:d((()=>[_("¥"+m(e.order.originalPrice),1)])),_:1})])),_:1})):c("v-if",!0),e.order.discount>0?(o(),s(S,{key:1,class:"order-card__price-detail"},{default:d((()=>[i(j,{class:"order-card__price-label"},{default:d((()=>[_("优惠：")])),_:1}),i(j,{class:"order-card__price-discount"},{default:d((()=>[_("-¥"+m(e.order.discount),1)])),_:1})])),_:1})):c("v-if",!0)])),_:1}),i(S,{class:"order-card__price-right"},{default:d((()=>[i(j,{class:"order-card__price-label-total"},{default:d((()=>[_("实付")])),_:1}),i(S,{class:"order-card__price-total-wrapper"},{default:d((()=>[i(j,{class:"order-card__price-symbol",style:n({color:u(w).ctaColor})},{default:d((()=>[_("¥")])),_:1},8,["style"]),i(j,{class:"order-card__price-total",style:n({color:u(w).ctaColor})},{default:d((()=>[_(m(e.order.actualPrice),1)])),_:1},8,["style"])])),_:1})])),_:1})])),_:1}),c(" 操作按钮 "),e.order.actions&&e.order.actions.length?(o(),s(S,{key:0,class:"order-card__actions"},{default:d((()=>[(o(!0),p(f,null,y(e.order.actions,((e,a)=>{return o(),s(S,{key:a,class:v(["order-card__action-btn",{"order-card__action-btn--primary":"primary"===e.type}]),style:n((r=e.type,"primary"===r?{background:`linear-gradient(135deg, ${w.primaryColor} 0%, ${w.primaryColor} 100%)`,borderColor:w.primaryColor}:{background:"transparent",borderColor:"#E5E5E5"})),onClick:g((a=>(e=>{h("action",e,x.order)})(e)),["stop"])},{default:d((()=>[i(j,{class:"order-card__action-text",style:n(I(e.type))},{default:d((()=>[_(m(e.text),1)])),_:2},1032,["style"])])),_:2},1032,["class","style","onClick"]);var r})),128))])),_:1})):c("v-if",!0)])),_:1})}}}),[["__scopeId","data-v-174abf0a"]]),q=H(e({__name:"order",setup(e){const m=a(),v=[{label:"全部",value:"",key:"all"},{label:"待确认",value:0,key:"pending_confirm"},{label:"待支付",value:1,key:"pending_pay"},{label:"已支付",value:2,key:"paid"},{label:"服务中",value:3,key:"in_service"},{label:"已完成",value:4,key:"completed"},{label:"已评价",value:5,key:"reviewed"},{label:"已取消",value:6,key:"cancelled"},{label:"已暂停",value:7,key:"paused"},{label:"已退款",value:8,key:"refund"}],g=h(0),C=r((()=>v[g.value].value)),H=h([]),q=h(!1),J=h(1),K=h(!0),L=x({all:0,pending_confirm:0,pending_pay:0,paid:0,in_service:0,completed:0,reviewed:0,cancelled:0,paused:0,refund:0}),Q=e=>{const a=Number(e??-1);return Number.isFinite(a)&&a>=0?{0:"全天",1:"早礼",2:"午宴",3:"晚宴"}[a]||"未知场次":"未选择场次"},W=e=>0===e?[{text:"取消",type:"secondary",action:"cancel"}]:1===e?[{text:"取消",type:"secondary",action:"cancel"},{text:"支付",type:"primary",action:"pay"}]:3===e?[{text:"确认完成",type:"primary",action:"confirm"}]:[4,5,6,8].includes(e)?[{text:"删除",type:"secondary",action:"delete"}]:[],X=e=>e.staff&&e.staff.avatar?e.staff.avatar:"/static/images/default-avatar.png",Y=async(e=!1)=>{if(!q.value){q.value=!0;try{e&&(J.value=1,H.value=[]);const a={page:J.value,page_size:10};""!==C.value&&(a.status=C.value);const r=await O(a),t=(Array.isArray(null==r?void 0:r.data)?r.data:[]).map((e=>{const a=Number(e.discount_amount||0)+Number(e.coupon_amount||0);return{id:e.id,orderNo:e.order_sn,status:(r=e.order_status,{0:"pending_confirm",1:"pending_pay",2:"paid",3:"in_service",4:"completed",5:"reviewed",6:"cancelled",7:"paused",8:"refunded"}[r]||"pending_pay"),createTime:e.create_time,location:e.service_address||"服务地址未填写",originalPrice:Number(e.total_amount||0),discount:a,actualPrice:Number(e.pay_amount||0),items:(e.items||[]).map((e=>({id:e.id,staffId:e.staff_id,staffName:e.staff_name,staffAvatar:X(e),packageName:e.package_name,serviceDate:e.service_date,timeSlot:e.time_slot,timeSlotDesc:Q(e.time_slot)}))),actions:W(e.order_status)};var r}));e?H.value=t:H.value.push(...t);const l=Number((null==r?void 0:r.last_page)||1);K.value=J.value<l}catch(a){console.error(a)}finally{q.value=!1}}},Z=async()=>{try{const e=await M();Object.assign(L,e)}catch(e){console.error(e)}},ee=()=>{K.value&&!q.value&&(J.value++,Y())},ae=e=>{$({url:`/pages/order_detail/order_detail?id=${e}`})},re=()=>{A({url:"/packages/pages/staff_list/staff_list"})},te=(e,a)=>{switch(e.action){case"pay":le(a.id);break;case"cancel":oe(a.id);break;case"confirm":se(a.id);break;case"delete":de(a.id);break;default:ae(a.id)}},le=e=>{$({url:`/pages/order_detail/order_detail?id=${e}&action=pay`})},oe=async e=>{if((await E({title:"提示",content:"确定要取消该订单吗？"})).confirm)try{await V({id:e,reason:"用户取消"}),F({title:"订单已取消"}),Y(!0),Z()}catch(a){F({title:a.message||"操作失败",icon:"none"})}},se=async e=>{if((await E({title:"提示",content:"确定服务已完成吗？"})).confirm)try{await U({id:e}),F({title:"订单已完成"}),Y(!0),Z()}catch(a){F({title:a.message||"操作失败",icon:"none"})}},de=async e=>{if((await E({title:"提示",content:"确定要删除该订单吗？"})).confirm)try{await G({id:e}),F({title:"删除成功"}),Y(!0),Z()}catch(a){F({title:a.message||"操作失败",icon:"none"})}};return w(g,(()=>{Y(!0)})),j((e=>{if(void 0!==e.status){const a={pending_confirm:0,pending_pay:1,paid:2,in_service:3,completed:4,reviewed:5,cancelled:6,paused:7,refund:8};let r=e.status;r="string"==typeof r&&void 0!==a[r]?a[r]:Number(r);const t=v.findIndex((e=>e.value===r));-1!==t&&(g.value=t)}})),S((()=>{Y(!0),Z()})),N((()=>{ee()})),(e,a)=>{const r=t(l("page-meta"),D),C=t(l("tn-tabs-item"),z),h=t(l("tn-tabs"),B),x=k,w=t(l("tn-loading"),P),j=b,S=t(l("tn-icon"),T),N=t(l("tabbar"),I);return o(),p(f,null,[i(r,{"page-style":u(m).pageStyle},null,8,["page-style"]),i(x,{class:"order-page"},{default:d((()=>[c(" 状态筛选标签 "),i(x,{class:"status-tabs-wrapper"},{default:d((()=>[i(h,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value=e),scroll:!0,height:"96rpx",class:"tabs-main","active-color":u(m).primaryColor},{default:d((()=>[(o(),p(f,null,y(v,((e,a)=>i(C,{key:a,title:e.label,badge:L[e.key]>0?String(L[e.key]):""},null,8,["title","badge"]))),64))])),_:1},8,["modelValue","active-color"])])),_:1}),c(" 订单列表 "),i(x,{class:"order-list-wrapper"},{default:d((()=>[c(" 加载中 "),q.value&&0===H.value.length?(o(),s(x,{key:0,class:"loading-state"},{default:d((()=>[i(x,{class:"loading-content"},{default:d((()=>[i(w,{size:"80",mode:"flower",color:u(m).primaryColor},null,8,["color"]),i(j,{class:"loading-text"},{default:d((()=>[_("加载中...")])),_:1})])),_:1})])),_:1})):0===H.value.length?(o(),p(f,{key:1},[c(" 空状态 "),i(x,{class:"empty-state"},{default:d((()=>[i(x,{class:"empty-icon-wrapper"},{default:d((()=>[i(S,{name:"file-text",size:"200",color:"#E5E5E5"})])),_:1}),i(j,{class:"empty-title"},{default:d((()=>[_("暂无订单")])),_:1}),i(j,{class:"empty-subtitle"},{default:d((()=>[_("快去预约心仪的服务吧~")])),_:1}),i(x,{class:"empty-action-btn",style:n({background:`linear-gradient(135deg, ${u(m).primaryColor} 0%, ${u(m).primaryColor} 100%)`,color:u(m).btnColor}),onClick:re},{default:d((()=>[i(j,{class:"empty-action-text",style:n({color:u(m).btnColor})},{default:d((()=>[_("去预约")])),_:1},8,["style"])])),_:1},8,["style"])])),_:1})],2112)):(o(),p(f,{key:2},[c(" 订单列表 - 使用OrderCard组件 "),i(x,{class:"order-list"},{default:d((()=>[(o(!0),p(f,null,y(H.value,(e=>(o(),s(R,{key:e.id,order:e,onClick:a=>ae(e.id),onAction:te},null,8,["order","onClick"])))),128)),c(" 加载更多提示 "),K.value?(o(),s(x,{key:0,class:"load-more"},{default:d((()=>[q.value?(o(),s(x,{key:0,class:"load-more-loading"},{default:d((()=>[i(w,{size:"40",mode:"flower",color:u(m).primaryColor},null,8,["color"]),i(j,{class:"load-more-text"},{default:d((()=>[_("加载中...")])),_:1})])),_:1})):(o(),s(j,{key:1,class:"load-more-text load-more-clickable",style:n({color:u(m).primaryColor}),onClick:ee},{default:d((()=>[_(" 加载更多 ")])),_:1},8,["style"]))])),_:1})):H.value.length>0?(o(),s(x,{key:1,class:"load-more"},{default:d((()=>[i(j,{class:"load-more-text"},{default:d((()=>[_("没有更多了")])),_:1})])),_:1})):c("v-if",!0)])),_:1})],2112))])),_:1}),i(N)])),_:1})],64)}}}),[["__scopeId","data-v-e2b9d877"]]);export{q as default};
