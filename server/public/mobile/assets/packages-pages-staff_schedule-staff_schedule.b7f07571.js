import{d as e,s as a,c as t,P as l,o as s,h as u,e as r,w as n,j as o,t as i,f as d,F as m,i as p,r as c,a as v,m as x,bN as f,y as g,aD as b}from"./index-e3492752.js";import{_}from"./navigation-bar.2687311c.js";import{_ as y}from"./page-meta.a4be6114.js";import{_ as h}from"./button.c1dc664f.js";import{e as j,l as w,m as k}from"./staff-center.563e3f5c.js";import"./_plugin-vue_export-helper.1b428a4d.js";import"./icon.e613abcd.js";import"./index.f1be293a.js";import"./loading.2b80eb94.js";import"./index.89b6df5d.js";import"./debounce.096fb07a.js";const C=e({__name:"staff_schedule",setup(e){const C=a(`${(S=new Date).getFullYear()}-${String(S.getMonth()+1).padStart(2,"0")}-${String(S.getDate()).padStart(2,"0")}`);var S;const $=a(Number(C.value.split("-")[0])),N=a(Number(C.value.split("-")[1])),D=a({}),z=t((()=>String(N.value).padStart(2,"0"))),F=[{value:0,label:"全天"},{value:1,label:"早礼"},{value:2,label:"午宴"},{value:3,label:"晚宴"}],P={0:"不可用",1:"可预约",2:"已预约",3:"已锁定",4:"内部预留"},B=e=>{var a;return(null==(a=(D.value[C.value]||{})[e])?void 0:a.status)??null},M=e=>{const a=B(e);return null==a?"按规则":P[a]||"未知"},R=e=>{const a=B(e);return null===a||0===a||1===a},V=async()=>{const e=await w({year:$.value,month:N.value});D.value=(null==e?void 0:e.schedules)||{}},Y=async(e,a)=>{try{await k({date:C.value,time_slot:e,status:a}),D.value[C.value]||(D.value[C.value]={}),D.value[C.value][e]={status:a},b({title:"设置成功",icon:"success"})}catch(t){const e="string"==typeof t?t:(null==t?void 0:t.msg)||(null==t?void 0:t.message)||"设置失败";b({title:e,icon:"none"})}},q=e=>{C.value=e.detail.value;const[a,t]=C.value.split("-"),l=Number(a),s=Number(t);l===$.value&&s===N.value||($.value=l,N.value=s,V())};return l((async()=>{await j()&&await V()})),(e,a)=>{const t=c(v("navigation-bar"),_),l=c(v("page-meta"),y),b=x,j=f,w=c(v("tn-button"),h);return s(),u(m,null,[r(l,{"page-style":e.$theme.pageStyle},{default:n((()=>[r(t,{title:"档期管理","front-color":e.$theme.navColor,"background-color":e.$theme.navBgColor},null,8,["front-color","background-color"])])),_:1},8,["page-style"]),r(b,{class:"min-h-screen bg-[#f6f6f6] pb-[40rpx]"},{default:n((()=>[r(b,{class:"bg-white mx-[24rpx] mt-[24rpx] rounded-lg p-[24rpx]"},{default:n((()=>[r(b,{class:"flex items-center justify-between"},{default:n((()=>[r(b,{class:"text-sm font-medium"},{default:n((()=>[o("选择日期")])),_:1}),r(j,{mode:"date",value:C.value,onChange:q},{default:n((()=>[r(b,{class:"text-sm text-gray-500"},{default:n((()=>[o(i(C.value),1)])),_:1})])),_:1},8,["value"])])),_:1}),r(b,{class:"text-xs text-gray-400 mt-[12rpx]"},{default:n((()=>[o("当前月份："+i($.value)+"-"+i(d(z)),1)])),_:1})])),_:1}),r(b,{class:"mx-[24rpx] mt-[20rpx]"},{default:n((()=>[(s(),u(m,null,p(F,(e=>r(b,{key:e.value,class:"bg-white rounded-lg p-[20rpx] mb-[16rpx]"},{default:n((()=>[r(b,{class:"flex items-center justify-between"},{default:n((()=>{return[r(b,{class:"text-sm font-medium"},{default:n((()=>[o(i(e.label),1)])),_:2},1024),r(b,{class:g(["text-xs",(a=B(e.value),1===a?"text-green-600":0===a?"text-red-500":2===a?"text-orange-500":3===a?"text-purple-500":4===a?"text-blue-500":"text-gray-400")])},{default:n((()=>[o(i(M(e.value)),1)])),_:2},1032,["class"])];var a})),_:2},1024),r(b,{class:"flex gap-[16rpx] mt-[16rpx]"},{default:n((()=>[r(w,{size:"sm",type:"primary",shape:"round",plain:!0,disabled:!R(e.value),onClick:a=>Y(e.value,1)},{default:n((()=>[o(" 设为可预约 ")])),_:2},1032,["disabled","onClick"]),r(w,{size:"sm",type:"danger",shape:"round",plain:!0,disabled:!R(e.value),onClick:a=>Y(e.value,0)},{default:n((()=>[o(" 设为不可用 ")])),_:2},1032,["disabled","onClick"])])),_:2},1024)])),_:2},1024))),64))])),_:1}),r(b,{class:"mx-[24rpx] mt-[10rpx] text-xs text-gray-400"},{default:n((()=>[o(" 已预约/锁定/预留的档期不可调整。 ")])),_:1})])),_:1})],64)}}});export{C as default};
