import{d as a,s as e,aS as l,U as s,o as t,h as r,e as u,w as i,g as n,y as c,j as d,b as o,F as f,i as v,r as _,a as p,m,l as g,G as y,a_ as k,t as h,k as w,aJ as b}from"./index-e3492752.js";import{_ as j}from"./navigation-bar.2687311c.js";import{_ as C}from"./page-meta.a4be6114.js";import{_ as F}from"./empty.dfd7c9cf.js";import{g as $,a as x}from"./review.9e7ce973.js";import{_ as z}from"./_plugin-vue_export-helper.1b428a4d.js";const S=z(a({__name:"list",setup(a){const z=e("pending"),S=e(!1),B=e([]),G=e([]),I=e(1),J=e(1),U=e(!0),V=e(!0),X=async(a=!1)=>{if(!S.value&&(a||U.value)){a&&(I.value=1,U.value=!0),S.value=!0;try{const e=await $({page:I.value,limit:10});a?B.value=e.lists||[]:B.value.push(...e.lists||[]),U.value=e.has_more,I.value++}finally{S.value=!1}}},q=async(a=!1)=>{if(!S.value&&(a||V.value)){a&&(J.value=1,V.value=!0),S.value=!0;try{const e=await x({page:J.value,limit:10});a?G.value=e.lists||[]:G.value.push(...e.lists||[]),V.value=e.has_more,J.value++}finally{S.value=!1}}},A=a=>{z.value=a,"pending"===a&&0===B.value.length?X(!0):"reviewed"===a&&0===G.value.length&&q(!0)};return l((()=>{"pending"===z.value?X():q()})),s((()=>{X(!0)})),(a,e)=>{const l=_(p("navigation-bar"),j),s=_(p("page-meta"),C),$=m,x=g,I=y,J=b,U=k("uni-icons");return t(),r(f,null,[u(s,{"page-style":a.$theme.pageStyle},{default:i((()=>[u(l,{title:"我的评价","front-color":a.$theme.navColor,"background-color":a.$theme.navBgColor},null,8,["front-color","background-color"])])),_:1},8,["page-style"]),u($,{class:"my-reviews-page"},{default:i((()=>[n(" 标签页 "),u($,{class:"tabs"},{default:i((()=>[u($,{class:c(["tab-item",{active:"pending"===z.value}]),onClick:e[0]||(e[0]=a=>A("pending"))},{default:i((()=>[d(" 待评价 ")])),_:1},8,["class"]),u($,{class:c(["tab-item",{active:"reviewed"===z.value}]),onClick:e[1]||(e[1]=a=>A("reviewed"))},{default:i((()=>[d(" 已评价 ")])),_:1},8,["class"])])),_:1}),n(" 待评价列表 "),"pending"===z.value?(t(),o($,{key:0},{default:i((()=>[B.value.length?(t(),o($,{key:0,class:"list-wrap"},{default:i((()=>[(t(!0),r(f,null,v(B.value,(a=>(t(),o($,{key:a.id,class:"pending-card"},{default:i((()=>[u($,{class:"card-header"},{default:i((()=>[u(x,{class:"order-sn"},{default:i((()=>{var e;return[d("订单号: "+h(null==(e=a.order)?void 0:e.order_sn),1)]})),_:2},1024),u(x,{class:"service-date"},{default:i((()=>{var e;return[d(h(null==(e=a.order)?void 0:e.service_date),1)]})),_:2},1024)])),_:2},1024),u($,{class:"card-body"},{default:i((()=>{var e;return[u(I,{src:(null==(e=a.staff)?void 0:e.avatar)||"/static/images/default-avatar.png",class:"staff-avatar",mode:"aspectFill"},null,8,["src"]),u($,{class:"staff-info"},{default:i((()=>[u($,{class:"staff-name"},{default:i((()=>[d(h(a.staff_name),1)])),_:2},1024),u($,{class:"package-name"},{default:i((()=>[d(h(a.package_name),1)])),_:2},1024)])),_:2},1024),u(J,{class:"btn-review",onClick:e=>(a=>{w({url:`/pages/review/publish?order_item_id=${a.id}`})})(a)},{default:i((()=>[d("去评价")])),_:2},1032,["onClick"])]})),_:2},1024)])),_:2},1024)))),128))])),_:1})):(t(),o($,{key:1,class:"empty-tip"},{default:i((()=>[u(I,{src:F,class:"empty-icon",mode:"aspectFit"}),u(x,null,{default:i((()=>[d("暂无待评价订单")])),_:1})])),_:1}))])),_:1})):n("v-if",!0),n(" 已评价列表 "),"reviewed"===z.value?(t(),o($,{key:1},{default:i((()=>[G.value.length?(t(),o($,{key:0,class:"list-wrap"},{default:i((()=>[(t(!0),r(f,null,v(G.value,(a=>(t(),o($,{key:a.id,class:"review-card",onClick:e=>(a=>{w({url:`/pages/review/detail?id=${a.id}`})})(a)},{default:i((()=>[u($,{class:"card-header"},{default:i((()=>[u($,{class:"staff-info"},{default:i((()=>{var e;return[u(I,{src:(null==(e=a.staff)?void 0:e.avatar)||"/static/images/default-avatar.png",class:"staff-avatar-small",mode:"aspectFill"},null,8,["src"]),u(x,{class:"staff-name"},{default:i((()=>{var e;return[d(h(null==(e=a.staff)?void 0:e.name),1)]})),_:2},1024)]})),_:2},1024),u($,{class:"score"},{default:i((()=>[u(U,{type:"star-filled",size:"14",color:"#ff9800"}),u(x,null,{default:i((()=>[d(h(a.score),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),u($,{class:"card-body"},{default:i((()=>{var e;return[a.content?(t(),o($,{key:0,class:"content"},{default:i((()=>[d(h(a.content),1)])),_:2},1024)):n("v-if",!0),(null==(e=a.images)?void 0:e.length)?(t(),o($,{key:1,class:"images"},{default:i((()=>[(t(!0),r(f,null,v(a.images.slice(0,3),((a,e)=>(t(),o(I,{key:e,src:a,class:"review-image",mode:"aspectFill"},null,8,["src"])))),128)),a.images.length>3?(t(),o($,{key:0,class:"more-count"},{default:i((()=>[d(" +"+h(a.images.length-3),1)])),_:2},1024)):n("v-if",!0)])),_:2},1024)):n("v-if",!0)]})),_:2},1024),u($,{class:"card-footer"},{default:i((()=>{return[u($,{class:"time"},{default:i((()=>[d(h(a.create_time_text),1)])),_:2},1024),u($,{class:c(["status",(e=a.status,{0:"pending",1:"approved",2:"rejected"}[e]||"")])},{default:i((()=>[d(h(a.status_text),1)])),_:2},1032,["class"])];var e})),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):(t(),o($,{key:1,class:"empty-tip"},{default:i((()=>[u(I,{src:F,class:"empty-icon",mode:"aspectFit"}),u(x,null,{default:i((()=>[d("暂无评价记录")])),_:1})])),_:1}))])),_:1})):n("v-if",!0),n(" 加载更多 "),S.value?(t(),o($,{key:2,class:"loading-tip"},{default:i((()=>[u(U,{type:"spinner-cycle",size:"20",color:"#999"}),u(x,null,{default:i((()=>[d("加载中...")])),_:1})])),_:1})):n("v-if",!0)])),_:1})],64)}}}),[["__scopeId","data-v-27b87a11"]]);export{S as default};
