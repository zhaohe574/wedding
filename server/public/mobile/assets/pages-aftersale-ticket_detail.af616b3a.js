import{r as t,a as e,o as a,b as s,w as l,h as i,F as o,i as c,y as n,e as u,A as r,m as d,d as f,s as m,M as h,O as p,g as v,j as _,t as g,aD as y,aP as x,l as I,b0 as b,J as k,G as C}from"./index-e3492752.js";import{_ as j}from"./icon.e613abcd.js";import{_ as w}from"./button.c1dc664f.js";import{_ as S}from"./u-icon.c576501f.js";import{_ as V}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as A}from"./popup.b8b85cf1.js";import{b as B,d as M,e as E}from"./aftersale.1766d410.js";import"./index.f1be293a.js";import"./loading.2b80eb94.js";import"./index.89b6df5d.js";import"./debounce.096fb07a.js";import"./z-index.5f93cfb9.js";import"./is-boolean.00bf65dc.js";import"./_objectToString.c905654b.js";import"./is-empty.c0d66e4a.js";import"./event.5568c9d8.js";import"./install.8446dea8.js";const N=V({name:"u-rate",emits:["update:modelValue","input","change"],props:{value:{type:[Number,String],default:-1},modelValue:{type:[Number,String],default:-1},count:{type:[Number,String],default:5},current:{type:[Number,String],default:0},disabled:{type:Boolean,default:!1},size:{type:[Number,String],default:32},inactiveColor:{type:String,default:"#b2b2b2"},activeColor:{type:String,default:"#FA3534"},gutter:{type:[Number,String],default:10},minCount:{type:[Number,String],default:0},allowHalf:{type:Boolean,default:!1},activeIcon:{type:String,default:"star-fill"},inactiveIcon:{type:String,default:"star"},customPrefix:{type:String,default:"uicon"},colors:{type:Array,default:()=>[]},icons:{type:Array,default:()=>[]}},data(){return{elId:this.$u.guid(),elClass:this.$u.guid(),starBoxLeft:0,activeIndex:0,starWidth:0,starWidthArr:[]}},created(){this.activeIndex=-1!=this.valueCom?this.valueCom:this.current},watch:{current(t){this.activeIndex=t},valueCom(t){this.activeIndex=t}},computed:{valueCom(){return this.modelValue},decimal(){return this.disabled?100*this.activeIndex%100:this.allowHalf?50:void 0},elActiveIcon(){const t=this.icons.length;if(t&&t<=this.count){const e=Math.round(this.activeIndex/Math.round(this.count/t));return e<1?this.icons[0]:e>t?this.icons[t-1]:this.icons[e-1]}return this.activeIcon},elActiveColor(){const t=this.colors.length;if(t&&t<=this.count){const e=Math.round(this.activeIndex/Math.round(this.count/t));return e<1?this.colors[0]:e>t?this.colors[t-1]:this.colors[e-1]}return this.activeColor}},methods:{getElRectById(){this.$uGetRect("#"+this.elId).then((t=>{this.starBoxLeft=t.left}))},getElRectByClass(){this.$uGetRect("."+this.elClass).then((t=>{this.starWidth=t.width;for(let e=0;e<this.count;e++)this.starWidthArr[e]=(e+1)*this.starWidth}))},touchMove(t){if(this.disabled)return;if(!t.changedTouches[0])return;const e=t.changedTouches[0].pageX-this.starBoxLeft;e<=0&&(this.activeIndex=0);let a=Math.ceil(e/this.starWidth);this.activeIndex=a>this.count?this.count:a,this.activeIndex<this.minCount&&(this.activeIndex=this.minCount),this.emitEvent()},click(t,e){this.disabled||(this.allowHalf,1==t?1==this.activeIndex?this.activeIndex=0:this.activeIndex=1:this.activeIndex=t,this.activeIndex<this.minCount&&(this.activeIndex=this.minCount),this.emitEvent())},emitEvent(){this.$emit("change",this.activeIndex),-1!=this.valueCom&&(this.$emit("input",this.activeIndex),this.$emit("update:modelValue",this.activeIndex))},showDecimalIcon(t){return this.disabled&&parseInt(this.activeIndex)===t}},mounted(){this.getElRectById(),this.getElRectByClass()}},[["render",function(f,m,h,p,v,_){const g=t(e("u-icon"),S),y=d;return a(),s(y,{class:"u-rate",id:v.elId,onTouchmove:r(_.touchMove,["stop","prevent"])},{default:l((()=>[(a(!0),i(o,null,c(h.count,((t,e)=>(a(),s(y,{class:n(["u-star-wrap",[v.elClass]]),key:e},{default:l((()=>[u(g,{name:v.activeIndex>e?_.elActiveIcon:h.inactiveIcon,onClick:t=>_.click(e+1,t),color:v.activeIndex>e?_.elActiveColor:h.inactiveColor,"custom-style":{fontSize:h.size+"rpx",padding:"0 "+(h.gutter/2+"rpx")},"custom-prefix":h.customPrefix,"show-decimal-icon":_.showDecimalIcon(e),percent:_.decimal,"inactive-color":h.inactiveColor},null,8,["name","onClick","color","custom-style","custom-prefix","show-decimal-icon","percent","inactive-color"])])),_:2},1032,["class"])))),128))])),_:1},8,["id","onTouchmove"])}],["__scopeId","data-v-574b1f2e"]]),R=V(f({__name:"ticket_detail",setup(r){const f=m(0),S=m(null),V=m(!1),R=h({satisfaction:5,remark:""}),$=async()=>{try{const t=await B(f.value);S.value=(null==t?void 0:t.data)||t}catch(t){y({title:"获取详情失败",icon:"none"})}},W=t=>({0:"clock",1:"setting",2:"checkmark-circle",3:"close-circle"}[t]||"info-circle"),z=t=>({0:"待处理",1:"处理中",2:"已完成",3:"已关闭"}[t]||"未知"),T=async()=>{x({title:"确认取消",content:"确定要取消此工单吗？",success:async t=>{if(t.confirm)try{await M(f.value),y({title:"取消成功"}),$()}catch(e){y({title:"取消失败",icon:"none"})}}})},H=async()=>{try{await E({id:f.value,satisfaction:R.satisfaction,remark:R.remark}),V.value=!1,y({title:"确认成功"}),$()}catch(t){y({title:"操作失败",icon:"none"})}};return p((t=>{(null==t?void 0:t.id)&&(f.value=parseInt(t.id),$())})),(r,f)=>{const m=t(e("tn-icon"),j),h=d,p=I,y=C,x=t(e("tn-button"),w),B=t(e("u-rate"),N),M=b,E=t(e("tn-popup"),A);return a(),s(h,{class:"ticket-detail-page"},{default:l((()=>[S.value?(a(),s(h,{key:0,class:"detail-card"},{default:l((()=>[v(" 工单状态 "),u(h,{class:"status-section"},{default:l((()=>{return[u(h,{class:n(["status-icon",(t=S.value.status,{0:"status-pending",1:"status-processing",2:"status-completed",3:"status-closed"}[t]||"")])},{default:l((()=>[u(m,{name:W(S.value.status),size:"60",color:"#fff"},null,8,["name"])])),_:1},8,["class"]),u(h,{class:"status-info"},{default:l((()=>[u(p,{class:"status-text"},{default:l((()=>[_(g(S.value.status_desc||z(S.value.status)),1)])),_:1}),u(p,{class:"status-time"},{default:l((()=>[_(g(S.value.update_time||S.value.create_time),1)])),_:1})])),_:1})];var t})),_:1}),v(" 工单信息 "),u(h,{class:"info-section"},{default:l((()=>[u(h,{class:"info-item"},{default:l((()=>[u(p,{class:"info-label"},{default:l((()=>[_("工单编号")])),_:1}),u(p,{class:"info-value"},{default:l((()=>[_(g(S.value.ticket_sn),1)])),_:1})])),_:1}),u(h,{class:"info-item"},{default:l((()=>[u(p,{class:"info-label"},{default:l((()=>[_("工单类型")])),_:1}),u(p,{class:"info-value"},{default:l((()=>{return[_(g(S.value.type_desc||(t=S.value.type,{1:"服务咨询",2:"订单问题",3:"技术问题",4:"投诉建议",5:"其他"}[t]||"其他")),1)];var t})),_:1})])),_:1}),u(h,{class:"info-item"},{default:l((()=>[u(p,{class:"info-label"},{default:l((()=>[_("创建时间")])),_:1}),u(p,{class:"info-value"},{default:l((()=>[_(g(S.value.create_time),1)])),_:1})])),_:1})])),_:1}),v(" 工单内容 "),u(h,{class:"content-section"},{default:l((()=>[u(h,{class:"section-title"},{default:l((()=>[_("工单内容")])),_:1}),u(h,{class:"content-title"},{default:l((()=>[_(g(S.value.title),1)])),_:1}),S.value.content?(a(),s(h,{key:0,class:"content-text"},{default:l((()=>[_(g(S.value.content),1)])),_:1})):v("v-if",!0),S.value.images&&S.value.images.length?(a(),s(h,{key:1,class:"content-images"},{default:l((()=>[(a(!0),i(o,null,c(S.value.images,((t,e)=>(a(),s(y,{key:e,src:t,mode:"aspectFill",onClick:t=>((t,e)=>{k({urls:t,current:e})})(S.value.images,e)},null,8,["src","onClick"])))),128))])),_:1})):v("v-if",!0)])),_:1}),v(" 处理进度 "),S.value.logs&&S.value.logs.length?(a(),s(h,{key:0,class:"progress-section"},{default:l((()=>[u(h,{class:"section-title"},{default:l((()=>[_("处理进度")])),_:1}),u(h,{class:"progress-list"},{default:l((()=>[(a(!0),i(o,null,c(S.value.logs,((t,e)=>(a(),s(h,{class:"progress-item",key:e},{default:l((()=>[u(h,{class:n(["progress-dot",{active:0===e}])},null,8,["class"]),u(h,{class:"progress-content"},{default:l((()=>[u(p,{class:"progress-text"},{default:l((()=>[_(g(t.content),1)])),_:2},1024),u(p,{class:"progress-time"},{default:l((()=>[_(g(t.create_time),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):v("v-if",!0),v(" 处理结果 "),S.value.result?(a(),s(h,{key:1,class:"result-section"},{default:l((()=>[u(h,{class:"section-title"},{default:l((()=>[_("处理结果")])),_:1}),u(h,{class:"result-content"},{default:l((()=>[_(g(S.value.result),1)])),_:1})])),_:1})):v("v-if",!0)])),_:1})):v("v-if",!0),v(" 操作按钮 "),S.value?(a(),s(h,{key:1,class:"action-bar"},{default:l((()=>[0===S.value.status?(a(),s(x,{key:0,type:"default",onClick:T},{default:l((()=>[_("取消工单")])),_:1})):1===S.value.status?(a(),s(x,{key:1,type:"primary",onClick:f[0]||(f[0]=t=>V.value=!0)},{default:l((()=>[_("确认完成")])),_:1})):v("v-if",!0)])),_:1})):v("v-if",!0),v(" 确认完成弹窗 "),u(E,{modelValue:V.value,"onUpdate:modelValue":f[4]||(f[4]=t=>V.value=t),mode:"bottom","border-radius":24},{default:l((()=>[u(h,{class:"confirm-popup"},{default:l((()=>[u(h,{class:"popup-header"},{default:l((()=>[u(p,{class:"popup-title"},{default:l((()=>[_("确认完成")])),_:1})])),_:1}),u(h,{class:"popup-body"},{default:l((()=>[u(h,{class:"form-item"},{default:l((()=>[u(p,{class:"form-label"},{default:l((()=>[_("满意度评价")])),_:1}),u(h,{class:"rating-wrap"},{default:l((()=>[u(B,{modelValue:R.satisfaction,"onUpdate:modelValue":f[1]||(f[1]=t=>R.satisfaction=t),"min-count":1},null,8,["modelValue"])])),_:1})])),_:1}),u(h,{class:"form-item"},{default:l((()=>[u(p,{class:"form-label"},{default:l((()=>[_("备注")])),_:1}),u(M,{class:"form-textarea",modelValue:R.remark,"onUpdate:modelValue":f[2]||(f[2]=t=>R.remark=t),placeholder:"请输入备注（选填）"},null,8,["modelValue"])])),_:1})])),_:1}),u(h,{class:"popup-footer"},{default:l((()=>[u(x,{type:"default",onClick:f[3]||(f[3]=t=>V.value=!1)},{default:l((()=>[_("取消")])),_:1}),u(x,{type:"primary",onClick:H},{default:l((()=>[_("确认")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}}}),[["__scopeId","data-v-b4ed6434"]]);export{R as default};
