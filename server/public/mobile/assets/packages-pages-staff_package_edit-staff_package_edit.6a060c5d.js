import{d as e,s as t,M as a,c as l,O as r,o as s,h as o,e as i,w as p,j as n,t as c,f as u,au as d,y as m,b as _,F as g,i as x,g as b,aD as f,aq as y,r as k,a as v,m as h,V as w}from"./index-e3492752.js";import{_ as j}from"./navigation-bar.2687311c.js";import{_ as V}from"./page-meta.a4be6114.js";import{_ as C}from"./input.1776ceae.js";import{_ as N}from"./u-switch.863c6ebe.js";import{_ as S}from"./button.c1dc664f.js";import{e as U,h as O,k as $}from"./staff-center.563e3f5c.js";import"./_plugin-vue_export-helper.1b428a4d.js";import"./icon.e613abcd.js";import"./index.f1be293a.js";import"./is-number.7ef6fec2.js";import"./_objectToString.c905654b.js";import"./event.5568c9d8.js";import"./index.23c2867d.js";import"./install.8446dea8.js";import"./is-empty.c0d66e4a.js";import"./is-boolean.00bf65dc.js";import"./index.89b6df5d.js";import"./index.04c93aab.js";import"./debounce.096fb07a.js";import"./clone-deep.2124c060.js";import"./loading.2b80eb94.js";const A=e({__name:"staff_package_edit",setup(e){const A=t(!1),D=a({package_id:0,name:"",price:"",original_price:"",custom_price:"",booking_type:0,allowed_time_slots:[],status:1,package:null}),T=[{value:1,label:"早礼"},{value:2,label:"午宴"},{value:3,label:"晚宴"}],q=l((()=>{var e;return(null==(e=D.package)?void 0:e.price)??D.price??0})),z=l({get:()=>1===D.status,set:e=>{D.status=e?1:0}}),B=e=>{var t,a;D.package_id=Number(e.package_id||e.id||0),D.name=(null==(t=e.package)?void 0:t.name)||e.name||"",D.price=void 0!==e.price&&null!==e.price?String(e.price):"",D.original_price=void 0!==e.original_price&&null!==e.original_price?String(e.original_price):"",D.custom_price=void 0!==e.custom_price&&null!==e.custom_price?String(e.custom_price):"",D.booking_type=Number(e.booking_type??(null==(a=e.package)?void 0:a.booking_type)??0),D.allowed_time_slots=Array.isArray(e.allowed_time_slots)?e.allowed_time_slots:[],D.status=e.status?1:0,D.package=e.package||null},E=async()=>{if(!D.package_id)return void f({title:"套餐信息缺失",icon:"none"});const e={package_id:D.package_id,status:D.status,booking_type:D.booking_type};""!==D.price&&(e.price=Number(D.price)),""!==D.original_price&&(e.original_price=Number(D.original_price)),""!==D.custom_price&&(e.custom_price=Number(D.custom_price)),1===D.booking_type?e.allowed_time_slots=D.allowed_time_slots:e.allowed_time_slots=[],A.value=!0;try{await $(e),f({title:"保存成功",icon:"success"}),setTimeout((()=>y()),1200)}catch(t){const e="string"==typeof t?t:(null==t?void 0:t.msg)||(null==t?void 0:t.message)||"保存失败";f({title:e,icon:"none"})}finally{A.value=!1}};return r((async e=>{var t,a;if(!(await U()))return;const l=Number((null==e?void 0:e.package_id)||0),r=w(),s=null==(a=null==(t=null==r?void 0:r.proxy)?void 0:t.getOpenerEventChannel)?void 0:a.call(t);null==s||s.on("detail",(e=>{B(e)})),l&&!D.package_id&&await(async e=>{const t=await O(),a=((null==t?void 0:t.configured)||[]).find((t=>Number(t.package_id)===e));a&&B(a)})(l)})),(e,t)=>{const a=k(v("navigation-bar"),j),l=k(v("page-meta"),V),r=h,f=k(v("tn-input"),C),y=k(v("u-switch"),N),w=k(v("tn-button"),S);return s(),o(g,null,[i(l,{"page-style":e.$theme.pageStyle},{default:p((()=>[i(a,{title:"编辑套餐","front-color":e.$theme.navColor,"background-color":e.$theme.navBgColor},null,8,["front-color","background-color"])])),_:1},8,["page-style"]),i(r,{class:"min-h-screen bg-[#f6f6f6] pb-[40rpx]"},{default:p((()=>[i(r,{class:"bg-white mx-[24rpx] mt-[24rpx] rounded-lg p-[24rpx]"},{default:p((()=>[i(r,{class:"text-base font-semibold text-[#333]"},{default:p((()=>[n(c(D.name||"套餐信息"),1)])),_:1}),i(r,{class:"text-xs text-gray-400 mt-[8rpx]"},{default:p((()=>[n(" 基础价格：¥"+c(u(q)),1)])),_:1})])),_:1}),i(r,{class:"bg-white mx-[24rpx] mt-[20rpx] rounded-lg"},{default:p((()=>[i(r,{class:"flex items-center justify-between px-[24rpx] py-[26rpx] border-b border-solid border-0 border-light"},{default:p((()=>[i(r,{class:"text-sm text-[#333]"},{default:p((()=>[n("套餐价格")])),_:1}),i(f,{modelValue:D.price,"onUpdate:modelValue":t[0]||(t[0]=e=>D.price=e),type:"number",placeholder:"默认价格",class:"text-right"},null,8,["modelValue"])])),_:1}),i(r,{class:"flex items-center justify-between px-[24rpx] py-[26rpx] border-b border-solid border-0 border-light"},{default:p((()=>[i(r,{class:"text-sm text-[#333]"},{default:p((()=>[n("原价")])),_:1}),i(f,{modelValue:D.original_price,"onUpdate:modelValue":t[1]||(t[1]=e=>D.original_price=e),type:"number",placeholder:"可选",class:"text-right"},null,8,["modelValue"])])),_:1}),i(r,{class:"flex items-center justify-between px-[24rpx] py-[26rpx] border-b border-solid border-0 border-light"},{default:p((()=>[i(r,{class:"text-sm text-[#333]"},{default:p((()=>[n("个人统一价")])),_:1}),i(f,{modelValue:D.custom_price,"onUpdate:modelValue":t[2]||(t[2]=e=>D.custom_price=e),type:"number",placeholder:"可选",class:"text-right"},null,8,["modelValue"])])),_:1}),i(r,{class:"flex items-center justify-between px-[24rpx] py-[26rpx] border-b border-solid border-0 border-light"},{default:p((()=>[i(r,{class:"text-sm text-[#333]"},{default:p((()=>[n("启用状态")])),_:1}),i(y,{modelValue:u(z),"onUpdate:modelValue":t[3]||(t[3]=e=>d(z)?z.value=e:null),"active-color":"#16a34a","inactive-color":"#e5e7eb"},null,8,["modelValue"])])),_:1})])),_:1}),i(r,{class:"bg-white mx-[24rpx] mt-[20rpx] rounded-lg p-[24rpx]"},{default:p((()=>[i(r,{class:"text-sm font-medium mb-[16rpx]"},{default:p((()=>[n("预约类型")])),_:1}),i(r,{class:"flex gap-[16rpx]"},{default:p((()=>[i(r,{class:m(["px-[24rpx] py-[12rpx] rounded-full text-sm",0===D.booking_type?"bg-primary text-white":"bg-gray-100 text-gray-500"]),onClick:t[4]||(t[4]=e=>D.booking_type=0)},{default:p((()=>[n(" 全天 ")])),_:1},8,["class"]),i(r,{class:m(["px-[24rpx] py-[12rpx] rounded-full text-sm",1===D.booking_type?"bg-primary text-white":"bg-gray-100 text-gray-500"]),onClick:t[5]||(t[5]=e=>D.booking_type=1)},{default:p((()=>[n(" 分场次 ")])),_:1},8,["class"])])),_:1}),1===D.booking_type?(s(),_(r,{key:0,class:"mt-[20rpx]"},{default:p((()=>[i(r,{class:"text-sm font-medium mb-[12rpx]"},{default:p((()=>[n("允许场次")])),_:1}),i(r,{class:"flex flex-wrap gap-[12rpx]"},{default:p((()=>[(s(),o(g,null,x(T,(e=>i(r,{key:e.value,class:m(["px-[20rpx] py-[10rpx] rounded-full text-xs",D.allowed_time_slots.includes(e.value)?"bg-primary text-white":"bg-gray-100 text-gray-500"]),onClick:t=>(e=>{const t=D.allowed_time_slots.indexOf(e);t>=0?D.allowed_time_slots.splice(t,1):D.allowed_time_slots.push(e)})(e.value)},{default:p((()=>[n(c(e.label),1)])),_:2},1032,["class","onClick"]))),64))])),_:1})])),_:1})):b("v-if",!0)])),_:1}),i(r,{class:"mx-[24rpx] mt-[30rpx]"},{default:p((()=>[i(w,{type:"primary",shape:"round",size:"lg",loading:A.value,onClick:E},{default:p((()=>[n(" 保存 ")])),_:1},8,["loading"])])),_:1})])),_:1})],64)}}});export{A as default};
