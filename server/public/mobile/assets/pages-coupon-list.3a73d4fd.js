import{d as a,u as l,s as e,c as t,aS as s,bD as o,U as u,o as c,h as r,e as n,w as i,f as d,g as f,y as _,n as m,j as p,t as y,b as v,F as g,i as b,bn as k,k as C,r as h,a as x,m as $,l as F,aJ as j,aD as w,aT as z}from"./index-e3492752.js";import{_ as D}from"./navigation-bar.2687311c.js";import{_ as S}from"./page-meta.a4be6114.js";import{_ as N}from"./icon.e613abcd.js";import{_ as E}from"./loading.2b80eb94.js";import{g as M,a as q}from"./coupon.4848d9a7.js";import{_ as A}from"./_plugin-vue_export-helper.1b428a4d.js";import"./index.f1be293a.js";import"./index.89b6df5d.js";const B=A(a({__name:"list",setup(a){const A=l(),B=e(!1),I=e(""),J=e([]),R=e({}),T=e(1),U=e(!0),V=a=>{const l=Number(a.valid_type||0),e=Number(a.valid_days||0);if(2===l&&e)return`领取后${e}天有效`;const t=Number(a.valid_start_time||0),s=Number(a.valid_end_time||0);if(!t&&!s)return"长期有效";const o=a=>{if(!a)return"";const l=new Date(1e3*a);return`${l.getFullYear()}.${String(l.getMonth()+1).padStart(2,"0")}.${String(l.getDate()).padStart(2,"0")}`};return t&&s?`${o(t)}-${o(s)}`:t?`${o(t)}起`:`${o(s)}止`},Y=t((()=>({"":"暂无优惠券",0:"暂无可用优惠券",1:"暂无已使用优惠券",2:"暂无已过期优惠券"}[I.value]||"暂无优惠券"))),G=t((()=>"0"===I.value?"快去领券中心领取优惠券吧":"敬请期待更多优惠活动")),H=a=>{I.value!==a&&(I.value=a,L(!0))},K=async()=>{try{const a=await M();R.value=a||{}}catch(a){console.error(a)}},L=async(a=!1)=>{if(!B.value&&(a||U.value)){a&&(T.value=1,U.value=!0),B.value=!0;try{const l=await q({page:T.value,limit:10,status:I.value}),e=l.lists||[];J.value=a?e:[...J.value,...e],U.value=l.has_more,U.value&&T.value++}catch(l){console.error(l)}finally{B.value=!1,k()}}},O=a=>{if(0!==a.status)return!1;const l=Number(a.valid_start_time||0);return!!l&&l>Math.floor(Date.now()/1e3)},P=()=>{C({url:"/pages/coupon/center"})};return s((()=>{L()})),o((()=>{K(),L(!0)})),u((()=>{K(),L(!0)})),(a,l)=>{const e=h(x("navigation-bar"),D),t=h(x("page-meta"),S),s=$,o=F,u=h(x("tn-icon"),N),k=j,C=h(x("tn-loading"),E);return c(),r(g,null,[n(t,{"page-style":d(A).pageStyle},{default:i((()=>[n(e,{title:"我的优惠券","front-color":d(A).navColor,"background-color":d(A).navBgColor},null,8,["front-color","background-color"])])),_:1},8,["page-style"]),n(s,{class:"coupon-page"},{default:i((()=>[f(" 统计数字卡片 "),n(s,{class:"stats-card"},{default:i((()=>[n(s,{class:_(["stat-item",{active:""===I.value}]),onClick:l[0]||(l[0]=a=>H(""))},{default:i((()=>[n(s,{class:"stat-num",style:m(""===I.value?{color:d(A).primaryColor}:{})},{default:i((()=>[p(y(R.value.total||0),1)])),_:1},8,["style"]),n(s,{class:"stat-label"},{default:i((()=>[p("全部")])),_:1})])),_:1},8,["class"]),n(s,{class:_(["stat-item",{active:"0"===I.value}]),onClick:l[1]||(l[1]=a=>H("0"))},{default:i((()=>[n(s,{class:"stat-num highlight",style:m((I.value,{color:d(A).ctaColor}))},{default:i((()=>[p(y(R.value.unused||0),1)])),_:1},8,["style"]),n(s,{class:"stat-label"},{default:i((()=>[p("可使用")])),_:1})])),_:1},8,["class"]),n(s,{class:_(["stat-item",{active:"1"===I.value}]),onClick:l[2]||(l[2]=a=>H("1"))},{default:i((()=>[n(s,{class:"stat-num",style:m("1"===I.value?{color:d(A).primaryColor}:{})},{default:i((()=>[p(y(R.value.used||0),1)])),_:1},8,["style"]),n(s,{class:"stat-label"},{default:i((()=>[p("已使用")])),_:1})])),_:1},8,["class"]),n(s,{class:_(["stat-item",{active:"2"===I.value}]),onClick:l[3]||(l[3]=a=>H("2"))},{default:i((()=>[n(s,{class:"stat-num",style:m("2"===I.value?{color:d(A).primaryColor}:{})},{default:i((()=>[p(y(R.value.expired||0),1)])),_:1},8,["style"]),n(s,{class:"stat-label"},{default:i((()=>[p("已过期")])),_:1})])),_:1},8,["class"])])),_:1}),f(" 标签页 "),n(s,{class:"tabs-wrapper"},{default:i((()=>[n(s,{class:"tabs"},{default:i((()=>[n(s,{class:_(["tab-item",{active:""===I.value}]),onClick:l[4]||(l[4]=a=>H(""))},{default:i((()=>[n(o,null,{default:i((()=>[p("全部")])),_:1}),""===I.value?(c(),v(s,{key:0,class:"tab-indicator",style:m({background:d(A).primaryColor})},null,8,["style"])):f("v-if",!0)])),_:1},8,["class"]),n(s,{class:_(["tab-item",{active:"0"===I.value}]),onClick:l[5]||(l[5]=a=>H("0"))},{default:i((()=>[n(o,null,{default:i((()=>[p("可使用")])),_:1}),"0"===I.value?(c(),v(s,{key:0,class:"tab-indicator",style:m({background:d(A).primaryColor})},null,8,["style"])):f("v-if",!0)])),_:1},8,["class"]),n(s,{class:_(["tab-item",{active:"1"===I.value}]),onClick:l[6]||(l[6]=a=>H("1"))},{default:i((()=>[n(o,null,{default:i((()=>[p("已使用")])),_:1}),"1"===I.value?(c(),v(s,{key:0,class:"tab-indicator",style:m({background:d(A).primaryColor})},null,8,["style"])):f("v-if",!0)])),_:1},8,["class"]),n(s,{class:_(["tab-item",{active:"2"===I.value}]),onClick:l[7]||(l[7]=a=>H("2"))},{default:i((()=>[n(o,null,{default:i((()=>[p("已过期")])),_:1}),"2"===I.value?(c(),v(s,{key:0,class:"tab-indicator",style:m({background:d(A).primaryColor})},null,8,["style"])):f("v-if",!0)])),_:1},8,["class"])])),_:1})])),_:1}),f(" 优惠券列表 "),J.value.length?(c(),v(s,{key:0,class:"list-wrap"},{default:i((()=>[(c(!0),r(g,null,b(J.value,(a=>(c(),v(s,{key:a.id,class:_(["coupon-card",{disabled:0!==a.status}])},{default:i((()=>[f(" 左侧金额区 "),n(s,{class:"coupon-left",style:m(0===a.status?{background:`linear-gradient(135deg, ${d(A).ctaColor} 0%, ${d(A).ctaColor} 100%)`}:{})},{default:i((()=>[n(s,{class:"coupon-value"},{default:i((()=>[2===a.coupon_type?(c(),r(g,{key:0},[n(o,{class:"num"},{default:i((()=>[p(y((a.discount_amount/10).toFixed(1)),1)])),_:2},1024),n(o,{class:"unit"},{default:i((()=>[p("折")])),_:1})],64)):(c(),r(g,{key:1},[n(o,{class:"symbol"},{default:i((()=>[p("¥")])),_:1}),n(o,{class:"num"},{default:i((()=>[p(y(a.discount_amount),1)])),_:2},1024)],64))])),_:2},1024),n(s,{class:"coupon-threshold"},{default:i((()=>[p(y(a.threshold_amount>0?`满${a.threshold_amount}元`:"无门槛"),1)])),_:2},1024)])),_:2},1032,["style"]),f(" 右侧信息区 "),n(s,{class:"coupon-content"},{default:i((()=>[n(s,{class:"coupon-info"},{default:i((()=>[n(s,{class:"info-header"},{default:i((()=>[n(o,{class:"coupon-name"},{default:i((()=>[p(y(a.coupon_name),1)])),_:2},1024),n(s,{class:"coupon-tag",style:m({background:2===a.coupon_type?"rgba(249, 115, 22, 0.1)":"rgba(124, 58, 237, 0.1)",color:2===a.coupon_type?d(A).ctaColor:d(A).primaryColor})},{default:i((()=>[p(y(a.coupon_type_text),1)])),_:2},1032,["style"])])),_:2},1024),n(s,{class:"coupon-desc",style:m({color:d(A).ctaColor})},{default:i((()=>[n(u,{name:"discount",size:"24",color:d(A).ctaColor},null,8,["color"]),n(o,null,{default:i((()=>[p(y(a.discount_desc),1)])),_:2},1024)])),_:2},1032,["style"]),n(s,{class:"coupon-detail"},{default:i((()=>[n(s,{class:"detail-item"},{default:i((()=>[n(u,{name:"time",size:"24",color:"#999999"}),n(o,null,{default:i((()=>[p(y(V(a)),1)])),_:2},1024)])),_:2},1024),O(a)?(c(),v(s,{key:0,class:"detail-item not-started-item"},{default:i((()=>[n(u,{name:"time",size:"24",color:d(A).primaryColor},null,8,["color"]),n(o,{class:"not-started-text"},{default:i((()=>[p("未到使用时间")])),_:1})])),_:1})):f("v-if",!0),a.use_scope_text?(c(),v(s,{key:1,class:"detail-item"},{default:i((()=>[n(u,{name:"shop",size:"24",color:"#999999"}),n(o,null,{default:i((()=>[p(y(a.use_scope_text),1)])),_:2},1024)])),_:2},1024)):f("v-if",!0)])),_:2},1024)])),_:2},1024),f(" 状态/操作区 "),n(s,{class:"coupon-action"},{default:i((()=>[0===a.status?(c(),v(s,{key:0,class:"action-unused"},{default:i((()=>[a.is_expiring&&!O(a)?(c(),v(s,{key:0,class:"expiring-badge",style:m({background:"rgba(255, 77, 79, 0.1)",color:"#FF4D4F"})},{default:i((()=>[n(u,{name:"warning",size:"24",color:"#FF4D4F"}),n(o,null,{default:i((()=>[p("即将过期")])),_:1})])),_:1},8,["style"])):f("v-if",!0),n(k,{class:_(["btn-use",{disabled:O(a)}]),style:m(O(a)?{background:"#F5F5F5",color:"#999999"}:{background:`linear-gradient(135deg, ${d(A).primaryColor} 0%, ${d(A).primaryColor} 100%)`,color:d(A).btnColor}),disabled:O(a),onClick:l=>(a=>{O(a)?w({title:"优惠券未到使用时间",icon:"none"}):z({url:"/packages/pages/staff_list/staff_list"})})(a)},{default:i((()=>[n(o,null,{default:i((()=>[p(y(O(a)?"未生效":"去使用"),1)])),_:2},1024)])),_:2},1032,["class","style","disabled","onClick"])])),_:2},1024)):1===a.status?(c(),v(s,{key:1,class:"action-used"},{default:i((()=>[n(u,{name:"check-circle",size:"48",color:"#52C41A"}),n(o,{class:"status-text"},{default:i((()=>[p("已使用")])),_:1})])),_:1})):(c(),v(s,{key:2,class:"action-expired"},{default:i((()=>[n(u,{name:"close-circle",size:"48",color:"#CCCCCC"}),n(o,{class:"status-text"},{default:i((()=>[p("已过期")])),_:1})])),_:1}))])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1})):B.value?f("v-if",!0):(c(),r(g,{key:1},[f(" 空状态 "),n(s,{class:"empty-state"},{default:i((()=>[n(s,{class:"empty-icon-wrapper"},{default:i((()=>[n(u,{name:"coupon",size:"120",color:"#E5E5E5"})])),_:1}),n(o,{class:"empty-text"},{default:i((()=>[p(y(d(Y)),1)])),_:1}),n(o,{class:"empty-desc"},{default:i((()=>[p(y(d(G)),1)])),_:1}),n(k,{class:"btn-get",style:m({background:`linear-gradient(135deg, ${d(A).primaryColor} 0%, ${d(A).primaryColor} 100%)`,color:d(A).btnColor}),onClick:P},{default:i((()=>[n(u,{name:"gift",size:"32",color:d(A).btnColor},null,8,["color"]),n(o,null,{default:i((()=>[p("去领券")])),_:1})])),_:1},8,["style"])])),_:1})],2112)),f(" 加载状态 "),B.value&&1===T.value?(c(),v(s,{key:2,class:"loading-state"},{default:i((()=>[n(C,{mode:"flower",color:d(A).primaryColor},null,8,["color"]),n(o,{class:"loading-text"},{default:i((()=>[p("加载中...")])),_:1})])),_:1})):f("v-if",!0),f(" 加载更多 "),B.value&&T.value>1?(c(),v(s,{key:3,class:"loading-more"},{default:i((()=>[n(C,{mode:"circle",size:"small",color:d(A).primaryColor},null,8,["color"]),n(o,null,{default:i((()=>[p("加载更多...")])),_:1})])),_:1})):f("v-if",!0),f(" 没有更多 "),!B.value&&!U.value&&J.value.length>0?(c(),v(s,{key:4,class:"no-more"},{default:i((()=>[n(o,null,{default:i((()=>[p("没有更多了")])),_:1})])),_:1})):f("v-if",!0),f(" 底部安全区 "),n(s,{class:"safe-bottom"})])),_:1})],64)}}}),[["__scopeId","data-v-c6419578"]]);export{B as default};
