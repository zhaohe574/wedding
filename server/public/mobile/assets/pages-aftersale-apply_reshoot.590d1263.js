import{d as e,M as a,s as l,O as s,o as t,b as o,w as i,e as r,g as n,j as u,t as d,h as c,i as p,F as m,aV as f,aD as _,aq as v,m as y,l as b,r as g,a as j,b0 as k,y as h,G as x}from"./index-e3492752.js";import{_ as C}from"./icon.e613abcd.js";import{_ as V}from"./button.c1dc664f.js";import{T as z}from"./picker.b20888da.js";import{j as U}from"./aftersale.1766d410.js";import{g as w}from"./order.1e435880.js";import{_ as F}from"./_plugin-vue_export-helper.1b428a4d.js";import"./index.f1be293a.js";import"./loading.2b80eb94.js";import"./index.89b6df5d.js";import"./debounce.096fb07a.js";import"./popup.b8b85cf1.js";import"./z-index.5f93cfb9.js";import"./is-boolean.00bf65dc.js";import"./_objectToString.c905654b.js";import"./is-empty.c0d66e4a.js";import"./event.5568c9d8.js";import"./install.8446dea8.js";import"./is-number.7ef6fec2.js";import"./error.a3858cc2.js";import"./clone-deep.2124c060.js";const I=F(e({__name:"apply_reshoot",setup(e){const F=a({order_id:0,type:1,reason_type:1,reason:"",images:[],expect_date:""}),I=[{value:1,label:"全部重拍"},{value:2,label:"部分重拍"},{value:3,label:"补拍加片"}],T=[{value:1,label:"拍摄效果不满意"},{value:2,label:"照片质量问题"},{value:3,label:"服务态度问题"},{value:4,label:"天气原因"},{value:5,label:"其他原因"}],P=l(!1),q=l(!1),D=l(!1),E=l([]),G=l(null),H=e=>{var a;const l=(null==(a=e.detail)?void 0:a.value)||e[0],s=E.value[l];s&&(F.order_id=s.value,G.value=s)},J=e=>{var a;F.expect_date=(null==(a=e.detail)?void 0:a.value)||e},L=()=>{f({count:9-F.images.length,success:e=>{e.tempFilePaths.forEach((e=>{F.images.push(e)}))}})},M=async()=>{if(F.order_id){D.value=!0;try{await U(F),_({title:"申请提交成功"}),setTimeout((()=>{v()}),1500)}catch(e){_({title:e.message||"提交失败",icon:"none"})}finally{D.value=!1}}else _({title:"请选择关联订单",icon:"none"})};return s((e=>{(null==e?void 0:e.order_id)&&(F.order_id=parseInt(e.order_id)),(async()=>{var e;try{const a=await w({status:3}),l=(null==(e=null==a?void 0:a.data)?void 0:e.lists)||(null==a?void 0:a.lists)||[];E.value=l.map((e=>({value:e.id,label:e.order_sn,...e})))}catch(a){console.error("获取订单列表失败:",a)}})()})),(e,a)=>{const l=y,s=b,f=g(j("tn-icon"),C),_=k,v=x,U=g(j("tn-button"),V),w=g(j("tn-picker"),z);return t(),o(l,{class:"apply-reshoot-page"},{default:i((()=>[r(l,{class:"form-card"},{default:i((()=>[n(" 选择订单 "),r(l,{class:"form-section"},{default:i((()=>[r(l,{class:"section-title"},{default:i((()=>[u("选择订单")])),_:1}),r(l,{class:"order-select",onClick:a[0]||(a[0]=e=>P.value=!0)},{default:i((()=>[F.order_id?(t(),o(s,{key:0},{default:i((()=>{var e;return[u(d(null==(e=G.value)?void 0:e.order_sn),1)]})),_:1})):(t(),o(s,{key:1,class:"placeholder"},{default:i((()=>[u("请选择关联订单")])),_:1})),r(f,{name:"right",size:"28",color:"#999"})])),_:1})])),_:1}),n(" 补拍类型 "),r(l,{class:"form-section"},{default:i((()=>[r(l,{class:"section-title"},{default:i((()=>[u("补拍类型")])),_:1}),r(l,{class:"type-options"},{default:i((()=>[(t(),c(m,null,p(I,(e=>r(l,{class:h(["type-option",{active:F.type===e.value}]),key:e.value,onClick:a=>F.type=e.value},{default:i((()=>[u(d(e.label),1)])),_:2},1032,["class","onClick"]))),64))])),_:1})])),_:1}),n(" 申请原因 "),r(l,{class:"form-section"},{default:i((()=>[r(l,{class:"section-title"},{default:i((()=>[u("申请原因")])),_:1}),r(l,{class:"reason-options"},{default:i((()=>[(t(),c(m,null,p(T,(e=>r(l,{class:h(["reason-option",{active:F.reason_type===e.value}]),key:e.value,onClick:a=>F.reason_type=e.value},{default:i((()=>[u(d(e.label),1)])),_:2},1032,["class","onClick"]))),64))])),_:1})])),_:1}),n(" 详细说明 "),r(l,{class:"form-section"},{default:i((()=>[r(l,{class:"section-title"},{default:i((()=>[u("详细说明")])),_:1}),r(_,{class:"form-textarea",modelValue:F.reason,"onUpdate:modelValue":a[1]||(a[1]=e=>F.reason=e),placeholder:"请详细描述补拍原因（选填）",maxlength:"500"},null,8,["modelValue"])])),_:1}),n(" 上传图片 "),r(l,{class:"form-section"},{default:i((()=>[r(l,{class:"section-title"},{default:i((()=>[u("上传图片")])),_:1}),r(l,{class:"upload-area"},{default:i((()=>[r(l,{class:"image-list"},{default:i((()=>[(t(!0),c(m,null,p(F.images,((e,a)=>(t(),o(l,{class:"image-item",key:a},{default:i((()=>[r(v,{src:e,mode:"aspectFill"},null,8,["src"]),r(l,{class:"delete-btn",onClick:e=>(e=>{F.images.splice(e,1)})(a)},{default:i((()=>[r(f,{name:"close",size:"24",color:"#fff"})])),_:2},1032,["onClick"])])),_:2},1024)))),128)),F.images.length<9?(t(),o(l,{key:0,class:"upload-btn",onClick:L},{default:i((()=>[r(f,{name:"plus",size:"48",color:"#999"}),r(s,null,{default:i((()=>[u("上传图片")])),_:1})])),_:1})):n("v-if",!0)])),_:1}),r(s,{class:"upload-tip"},{default:i((()=>[u("最多上传9张图片")])),_:1})])),_:1})])),_:1}),n(" 期望日期 "),r(l,{class:"form-section"},{default:i((()=>[r(l,{class:"section-title"},{default:i((()=>[u("期望补拍日期")])),_:1}),r(l,{class:"date-picker",onClick:a[2]||(a[2]=e=>q.value=!0)},{default:i((()=>[F.expect_date?(t(),o(s,{key:0},{default:i((()=>[u(d(F.expect_date),1)])),_:1})):(t(),o(s,{key:1,class:"placeholder"},{default:i((()=>[u("请选择期望日期（选填）")])),_:1})),r(f,{name:"calendar",size:"32",color:"#999"})])),_:1})])),_:1})])),_:1}),n(" 提交按钮 "),r(l,{class:"submit-bar"},{default:i((()=>[r(U,{type:"primary",loading:D.value,onClick:M},{default:i((()=>[u("提交申请")])),_:1},8,["loading"])])),_:1}),n(" 订单选择器 "),r(w,{modelValue:P.value,"onUpdate:modelValue":a[3]||(a[3]=e=>P.value=e),mode:"selector",range:E.value,"range-key":"label",onConfirm:H},null,8,["modelValue","range"]),n(" 日期选择器 "),r(w,{modelValue:q.value,"onUpdate:modelValue":a[4]||(a[4]=e=>q.value=e),mode:"time",onConfirm:J},null,8,["modelValue"])])),_:1})}}}),[["__scopeId","data-v-f7d95eb2"]]);export{I as default};
