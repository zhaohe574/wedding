import{d as e,s as a,M as t,O as s,o as l,h as o,e as u,w as r,g as n,j as c,b as d,t as i,F as _,aP as f,aq as m,aD as p,b5 as g,r as v,a as b,a_ as h,l as x,m as y,G as w,a5 as V,b0 as j,aJ as $}from"./index-e3492752.js";import{_ as k}from"./navigation-bar.2687311c.js";import{_ as C}from"./page-meta.a4be6114.js";import{h as U,j as q}from"./orderChange.66dcaaa9.js";import{e as F}from"./order.1e435880.js";import{_ as z}from"./_plugin-vue_export-helper.1b428a4d.js";const B=z(e({__name:"apply_transfer",setup(e){const z=a(0),B=a(null),D=a(!1),G=t({to_user_name:"",to_user_mobile:"",reason:""}),I=async()=>{if(!G.to_user_name.trim())return void p({title:"请输入接收方姓名",icon:"none"});if(!G.to_user_mobile.trim())return void p({title:"请输入接收方手机号",icon:"none"});if(e=G.to_user_mobile,!/^1[3-9]\d{9}$/.test(e))return void p({title:"手机号格式不正确",icon:"none"});var e;if((await f({title:"确认转让",content:`确定将订单转让给 ${G.to_user_name}（${G.to_user_mobile}）吗？转让后订单将完全归属于对方。`})).confirm){D.value=!0;try{const e=await q({order_id:z.value,to_user_name:G.to_user_name,to_user_mobile:G.to_user_mobile,reason:G.reason});p({title:"申请已提交"}),setTimeout((()=>{g({url:`/pages/order_change/transfer_detail?id=${e.transfer_id}`})}),1500)}catch(a){p({title:a.message||"提交失败",icon:"none"})}finally{D.value=!1}}};return s((e=>{e.order_id&&(z.value=Number(e.order_id),(async()=>{try{const e=await F({id:z.value});B.value=e}catch(e){console.error(e)}})(),(async()=>{try{const e=await U({order_id:z.value});e.can_change||f({title:"提示",content:e.message,showCancel:!1,success:()=>{m()}})}catch(e){p({title:e.message||"检查失败",icon:"none"})}})())})),(e,a)=>{const t=v(b("navigation-bar"),k),s=v(b("page-meta"),C),f=h("uni-icons"),m=x,p=y,g=w,U=V,q=j,F=$;return l(),o(_,null,[u(s,{"page-style":e.$theme.pageStyle},{default:r((()=>[u(t,{title:"申请转让","front-color":e.$theme.navColor,"background-color":e.$theme.navBgColor},null,8,["front-color","background-color"])])),_:1},8,["page-style"]),u(p,{class:"apply-page"},{default:r((()=>[n(" 提示信息 "),u(p,{class:"tip-card"},{default:r((()=>[u(f,{type:"info-filled",size:"18",color:"#ff9500"}),u(m,{class:"tip-text"},{default:r((()=>[c("转让后，订单将完全归属于接收方，原订单服务及权益一并转移。")])),_:1})])),_:1}),n(" 订单信息 "),B.value?(l(),d(p,{key:0,class:"bg-white mt-3 p-4"},{default:r((()=>[u(p,{class:"section-title"},{default:r((()=>[c("转让订单")])),_:1}),u(p,{class:"order-card"},{default:r((()=>[u(p,{class:"text-sm text-gray-500"},{default:r((()=>[c("订单号: "+i(B.value.order_sn),1)])),_:1}),B.value.items&&B.value.items.length>0?(l(),d(p,{key:0,class:"flex items-center mt-2"},{default:r((()=>{var e;return[u(g,{src:(null==(e=B.value.items[0].staff)?void 0:e.avatar)||"/static/images/default-avatar.png",class:"w-12 h-12 rounded-lg mr-3",mode:"aspectFill"},null,8,["src"]),u(p,{class:"flex-1"},{default:r((()=>[u(p,{class:"text-sm font-medium"},{default:r((()=>[c(i(B.value.items[0].staff_name),1)])),_:1}),u(p,{class:"text-xs text-gray-400"},{default:r((()=>[c(i(B.value.items[0].package_name),1)])),_:1})])),_:1}),u(p,{class:"text-right"},{default:r((()=>[u(p,{class:"text-primary font-bold"},{default:r((()=>[c("¥"+i(B.value.pay_amount),1)])),_:1}),u(p,{class:"text-xs text-gray-400"},{default:r((()=>[c(i(B.value.service_date),1)])),_:1})])),_:1})]})),_:1})):n("v-if",!0)])),_:1})])),_:1})):n("v-if",!0),n(" 接收方信息 "),u(p,{class:"bg-white mt-3 p-4"},{default:r((()=>[u(p,{class:"section-title"},{default:r((()=>[c("接收方信息")])),_:1}),u(p,{class:"form-item"},{default:r((()=>[u(m,{class:"label required"},{default:r((()=>[c("接收方姓名")])),_:1}),u(U,{modelValue:G.to_user_name,"onUpdate:modelValue":a[0]||(a[0]=e=>G.to_user_name=e),class:"input",placeholder:"请输入接收方姓名",maxlength:"20"},null,8,["modelValue"])])),_:1}),u(p,{class:"form-item"},{default:r((()=>[u(m,{class:"label required"},{default:r((()=>[c("接收方手机号")])),_:1}),u(U,{modelValue:G.to_user_mobile,"onUpdate:modelValue":a[1]||(a[1]=e=>G.to_user_mobile=e),class:"input",type:"number",placeholder:"请输入接收方手机号",maxlength:"11"},null,8,["modelValue"])])),_:1})])),_:1}),n(" 转让原因 "),u(p,{class:"bg-white mt-3 p-4"},{default:r((()=>[u(p,{class:"section-title"},{default:r((()=>[c("转让原因")])),_:1}),u(q,{modelValue:G.reason,"onUpdate:modelValue":a[2]||(a[2]=e=>G.reason=e),class:"reason-input",placeholder:"请填写转让原因（选填）",maxlength:"200"},null,8,["modelValue"]),u(p,{class:"text-right text-xs text-gray-400"},{default:r((()=>[c(i(G.reason.length)+"/200",1)])),_:1})])),_:1}),n(" 转让流程说明 "),u(p,{class:"bg-white mt-3 p-4"},{default:r((()=>[u(p,{class:"section-title"},{default:r((()=>[c("转让流程")])),_:1}),u(p,{class:"flow-steps"},{default:r((()=>[u(p,{class:"flow-step"},{default:r((()=>[u(p,{class:"step-num"},{default:r((()=>[c("1")])),_:1}),u(p,{class:"step-content"},{default:r((()=>[u(p,{class:"step-title"},{default:r((()=>[c("提交申请")])),_:1}),u(p,{class:"step-desc"},{default:r((()=>[c("填写接收方信息并提交")])),_:1})])),_:1})])),_:1}),u(p,{class:"flow-step"},{default:r((()=>[u(p,{class:"step-num"},{default:r((()=>[c("2")])),_:1}),u(p,{class:"step-content"},{default:r((()=>[u(p,{class:"step-title"},{default:r((()=>[c("平台审核")])),_:1}),u(p,{class:"step-desc"},{default:r((()=>[c("等待平台审核通过")])),_:1})])),_:1})])),_:1}),u(p,{class:"flow-step"},{default:r((()=>[u(p,{class:"step-num"},{default:r((()=>[c("3")])),_:1}),u(p,{class:"step-content"},{default:r((()=>[u(p,{class:"step-title"},{default:r((()=>[c("接收方确认")])),_:1}),u(p,{class:"step-desc"},{default:r((()=>[c("接收方通过短信验证码确认")])),_:1})])),_:1})])),_:1}),u(p,{class:"flow-step"},{default:r((()=>[u(p,{class:"step-num"},{default:r((()=>[c("4")])),_:1}),u(p,{class:"step-content"},{default:r((()=>[u(p,{class:"step-title"},{default:r((()=>[c("转让完成")])),_:1}),u(p,{class:"step-desc"},{default:r((()=>[c("订单归属变更完成")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),n(" 提交按钮 "),u(p,{class:"bottom-actions"},{default:r((()=>[u(F,{class:"btn-submit",disabled:D.value,onClick:I},{default:r((()=>[c(i(D.value?"提交中...":"提交转让申请"),1)])),_:1},8,["disabled"])])),_:1})])),_:1})],64)}}}),[["__scopeId","data-v-85df25ec"]]);export{B as default};
