import{d as e,s as a,M as s,c as l,v as t,O as c,o,h as r,e as i,w as n,g as u,b as d,j as f,t as _,F as m,i as p,f as g,aV as v,aD as y,aP as h,aq as b,r as k,a as x,G as w,m as C,l as j,a_ as z,b0 as V,bC as $,aJ as F,y as O}from"./index-e3492752.js";import{_ as P}from"./navigation-bar.2687311c.js";import{_ as T}from"./page-meta.a4be6114.js";import{g as q,b as B,c as D,p as G}from"./review.9e7ce973.js";import{_ as I}from"./_plugin-vue_export-helper.1b428a4d.js";const J=I(e({__name:"publish",setup(e){const I=a(0),J=a(null),M=a(!1),N=a([]),S=a([]),U=a([]),A=s({score:5,score_service:5,score_professional:5,score_punctual:5,score_effect:5,content:"",images:[],video:"",is_anonymous:0}),E=["非常差","较差","一般","满意","非常满意"],H=[{key:"score_service",label:"服务态度"},{key:"score_professional",label:"专业水平"},{key:"score_punctual",label:"时间守约"},{key:"score_effect",label:"整体效果"}],K=l((()=>{if(!U.value.length)return 0;let e=1;A.images.length>0&&(e=2),A.video&&(e=3);const a=U.value.find((a=>a.reward_type===e));if(!a)return 0;let s=a.reward_points||0;return A.score>=4&&a.extra_points_for_good&&(s+=a.extra_points_for_good),s})),L=async()=>{try{const e=await B({score:A.score});N.value=e||[],S.value=[]}catch(e){console.error(e)}};t((()=>A.score),(()=>{L()}));const Q=()=>{v({count:9-A.images.length,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{A.images.push(...e.tempFilePaths)}})},R=async()=>{if(A.score<1)y({title:"请选择评分",icon:"none"});else{M.value=!0;try{const e={order_item_id:I.value,score:A.score,score_service:A.score_service,score_professional:A.score_professional,score_punctual:A.score_punctual,score_effect:A.score_effect,content:A.content,images:A.images,video:A.video,is_anonymous:A.is_anonymous,tag_ids:S.value},a=await G(e);h({title:"评价成功",content:a.reward_points>0?`获得${a.reward_points}积分奖励`:"感谢您的评价",showCancel:!1,success:()=>{b()}})}catch(e){y({title:e.message||"提交失败",icon:"none"})}finally{M.value=!1}}};return c((e=>{e.order_item_id&&(I.value=Number(e.order_item_id),(async()=>{var e;try{const a=null==(e=(await q({page:1,limit:100})).lists)?void 0:e.find((e=>e.id===I.value));a&&(J.value=a)}catch(a){console.error(a)}})()),L(),(async()=>{try{const e=await D();U.value=e||[]}catch(e){console.error(e)}})()})),(e,a)=>{const s=k(x("navigation-bar"),P),l=k(x("page-meta"),T),t=w,c=C,v=j,h=z("uni-icons"),b=V,q=$,B=F;return o(),r(m,null,[i(l,{"page-style":e.$theme.pageStyle},{default:n((()=>[i(s,{title:"发表评价","front-color":e.$theme.navColor,"background-color":e.$theme.navBgColor},null,8,["front-color","background-color"])])),_:1},8,["page-style"]),i(c,{class:"publish-page"},{default:n((()=>[u(" 订单信息 "),J.value?(o(),d(c,{key:0,class:"bg-white p-4"},{default:n((()=>[i(c,{class:"flex items-center"},{default:n((()=>{var e;return[i(t,{src:(null==(e=J.value.staff)?void 0:e.avatar)||"/static/images/default-avatar.png",class:"w-16 h-16 rounded-full mr-3",mode:"aspectFill"},null,8,["src"]),i(c,{class:"flex-1"},{default:n((()=>[i(c,{class:"text-base font-medium"},{default:n((()=>[f(_(J.value.staff_name),1)])),_:1}),i(c,{class:"text-sm text-gray-400 mt-1"},{default:n((()=>[f(_(J.value.package_name),1)])),_:1}),i(c,{class:"text-xs text-gray-400 mt-1"},{default:n((()=>{var e;return[f(" 服务日期: "+_(null==(e=J.value.order)?void 0:e.service_date),1)]})),_:1})])),_:1})]})),_:1})])),_:1})):u("v-if",!0),u(" 评分 "),i(c,{class:"bg-white mt-3 p-4"},{default:n((()=>[i(c,{class:"section-title"},{default:n((()=>[f("服务评分")])),_:1}),i(c,{class:"score-item"},{default:n((()=>[i(v,{class:"score-label"},{default:n((()=>[f("综合评分")])),_:1}),i(c,{class:"score-stars"},{default:n((()=>[(o(),r(m,null,p(5,(e=>i(h,{key:e,type:e<=A.score?"star-filled":"star",size:"28",color:e<=A.score?"#ff9800":"#ddd",onClick:a=>A.score=e},null,8,["type","color","onClick"]))),64))])),_:1}),i(v,{class:"score-text"},{default:n((()=>[f(_(E[A.score-1]),1)])),_:1})])),_:1}),i(c,{class:"divider"}),i(c,{class:"detail-scores"},{default:n((()=>[(o(),r(m,null,p(H,(e=>i(c,{class:"detail-score-item",key:e.key},{default:n((()=>[i(v,{class:"label"},{default:n((()=>[f(_(e.label),1)])),_:2},1024),i(c,{class:"stars"},{default:n((()=>[(o(),r(m,null,p(5,(a=>i(h,{key:a,type:a<=A[e.key]?"star-filled":"star",size:"20",color:a<=A[e.key]?"#ff9800":"#ddd",onClick:s=>A[e.key]=a},null,8,["type","color","onClick"]))),64))])),_:2},1024)])),_:2},1024))),64))])),_:1})])),_:1}),u(" 评价标签 "),N.value.length?(o(),d(c,{key:1,class:"bg-white mt-3 p-4"},{default:n((()=>[i(c,{class:"section-title"},{default:n((()=>[f("选择标签")])),_:1}),i(c,{class:"tag-list"},{default:n((()=>[(o(!0),r(m,null,p(N.value,(e=>(o(),d(c,{key:e.id,class:O(["tag-item",{active:S.value.includes(e.id)}]),onClick:a=>(e=>{const a=S.value.indexOf(e);a>-1?S.value.splice(a,1):S.value.length<5?S.value.push(e):y({title:"最多选择5个标签",icon:"none"})})(e.id)},{default:n((()=>[f(_(e.name),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})):u("v-if",!0),u(" 评价内容 "),i(c,{class:"bg-white mt-3 p-4"},{default:n((()=>[i(c,{class:"section-title"},{default:n((()=>[f("评价内容")])),_:1}),i(b,{modelValue:A.content,"onUpdate:modelValue":a[0]||(a[0]=e=>A.content=e),class:"content-input",placeholder:"分享您的服务体验，帮助更多人选择...",maxlength:"500"},null,8,["modelValue"]),i(c,{class:"text-right text-xs text-gray-400"},{default:n((()=>[f(_(A.content.length)+"/500",1)])),_:1})])),_:1}),u(" 上传图片/视频 "),i(c,{class:"bg-white mt-3 p-4"},{default:n((()=>[i(c,{class:"section-title"},{default:n((()=>[f("上传图片/视频（选填）")])),_:1}),i(c,{class:"media-uploader"},{default:n((()=>[(o(!0),r(m,null,p(A.images,((e,a)=>(o(),d(c,{key:a,class:"media-item"},{default:n((()=>[i(t,{src:e,class:"media-image",mode:"aspectFill"},null,8,["src"]),i(c,{class:"delete-btn",onClick:e=>(e=>{A.images.splice(e,1)})(a)},{default:n((()=>[i(h,{type:"close",size:"14",color:"#fff"})])),_:2},1032,["onClick"])])),_:2},1024)))),128)),A.images.length<9?(o(),d(c,{key:0,class:"add-media",onClick:Q},{default:n((()=>[i(h,{type:"camera",size:"40",color:"#ccc"}),i(v,{class:"text-xs text-gray-400 mt-1"},{default:n((()=>[f("添加图片")])),_:1})])),_:1})):u("v-if",!0)])),_:1}),i(c,{class:"text-xs text-gray-400 mt-2"},{default:n((()=>[f("最多上传9张图片")])),_:1})])),_:1}),u(" 匿名评价 "),i(c,{class:"bg-white mt-3 p-4"},{default:n((()=>[i(c,{class:"flex justify-between items-center"},{default:n((()=>[i(v,{class:"text-sm"},{default:n((()=>[f("匿名评价")])),_:1}),i(q,{checked:1===A.is_anonymous,onChange:a[1]||(a[1]=e=>A.is_anonymous=e.detail.value?1:0),color:"#ff6b35"},null,8,["checked"])])),_:1})])),_:1}),u(" 奖励提示 "),g(K)>0?(o(),d(c,{key:2,class:"reward-tip"},{default:n((()=>[i(h,{type:"gift",size:"18",color:"#ff6b35"}),i(v,null,{default:n((()=>[f("发布评价可获得 "),i(v,{class:"highlight"},{default:n((()=>[f(_(g(K)),1)])),_:1}),f(" 积分奖励")])),_:1})])),_:1})):u("v-if",!0),u(" 提交按钮 "),i(c,{class:"bottom-actions"},{default:n((()=>[i(B,{class:"btn-submit",disabled:M.value,onClick:R},{default:n((()=>[f(_(M.value?"提交中...":"发布评价"),1)])),_:1},8,["disabled"])])),_:1})])),_:1})],64)}}}),[["__scopeId","data-v-ac2664dd"]]);export{J as default};
