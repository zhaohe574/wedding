import{d as e,s as a,ac as s,a1 as t,C as l,u as o,M as n,c,v as i,O as r,ad as u,ae as d,af as p,ag as f,o as m,h as g,e as v,w as _,g as h,f as b,j as y,F as k,b as w,t as j,y as x,A as C,ah as V,ai as L,aj as $,ak as U,al as T,am as z,an as I,ao as F,r as G,a as M,m as O,G as S,l as q,p as A,ap as D}from"./index-e3492752.js";import{_ as N}from"./page-meta.a4be6114.js";import{_ as W}from"./icon.e613abcd.js";import{_ as B}from"./input.1776ceae.js";import{_ as E,a as H}from"./modal.cf421c49.js";import{u as J}from"./useLockFn.c836b103.js";import{_ as P}from"./_plugin-vue_export-helper.1b428a4d.js";import"./index.f1be293a.js";import"./is-number.7ef6fec2.js";import"./_objectToString.c905654b.js";import"./event.5568c9d8.js";import"./index.23c2867d.js";import"./install.8446dea8.js";import"./is-empty.c0d66e4a.js";import"./is-boolean.00bf65dc.js";import"./index.89b6df5d.js";import"./index.04c93aab.js";import"./debounce.096fb07a.js";import"./clone-deep.2124c060.js";import"./popup.b8b85cf1.js";import"./z-index.5f93cfb9.js";const R=P(e({__name:"login",setup(e){const P=a(!0);P.value=s();const R=V(),K=L(),Q=t(),X=l(),Y=o(),Z=a(),ee=a("获取验证码"),ae=a(!0);a(!1);const se=a(!1),te=n({scene:1,account:"",password:"",code:""}),le=a(!1),oe=a(),ne=c((()=>Y.primaryColor));c((()=>X.getWebsiteConfig));const ce=async()=>{te.account&&ae.value&&(await $({scene:U.LOGIN,mobile:te.account}),uni.$u.toast("发送成功"),(()=>{let e=60;ae.value=!1,ee.value=`${e}秒`;const a=setInterval((()=>{e--,e>0?ee.value=`${e}秒`:(clearInterval(a),ee.value="获取验证码",ae.value=!0)}),1e3)})())},ie=e=>{te.scene=e},re=e=>{var a;return null==(a=X.getLoginConfig.login_way)?void 0:a.includes(String(e))},ue=c((()=>X.getLoginConfig.wechat_auth)),de=c((()=>1==X.getLoginConfig.login_agreement)),pe=c((()=>1==X.getLoginConfig.third_auth)),fe=c((()=>1==X.getLoginConfig.coerce_mobile)),me=async()=>{if(se.value||!de.value){var e;if(1==te.scene){if(!te.account)return uni.$u.toast("请输入账号/手机号码");if(!te.password)return uni.$u.toast("请输入密码")}if(2==te.scene){if(!te.account)return uni.$u.toast("请输入手机号码");if(!te.code)return uni.$u.toast("请输入验证码")}p({title:"请稍后..."});try{const e=await D(te);ge(e)}catch(a){f(),uni.$u.toast(a)}}else null==(e=Z.value)||e.showModal({title:"温馨提示",content:"请先阅读并同意《服务协议》和《隐私协议》",showCancel:!0,confirmText:"同意",cancelText:"取消",confirmStyle:{color:ne.value},confirm:()=>{se.value=!0,me()}})},ge=async e=>{const{token:a,mobile:s}=e;if(!s&&fe.value)return Q.temToken=a,K.navigateTo("/pages/bind_mobile/bind_mobile"),void f();Q.login(e.token),await Q.getUser(),uni.$u.toast("登录成功"),f();const t=T();if(t.length>1){const e=t[t.length-2];await K.navigateBack();const{onLoad:a,options:s}=e;a&&a(s)}else if(z.get(I))try{K.redirectTo(z.get(I))}catch(l){K.switchTab(z.get(I))}else K.reLaunch("/pages/index/index");z.remove(I)},{lockFn:ve}=J(me),_e=async(e={getUrl:!0})=>{const{code:a,getUrl:s}=e;if(!s){return await F({code:a})}return await u.getUrl(d.LOGIN),Promise.reject()},he=async()=>{if(!se.value&&de.value)return showModel.value=!0,void console.log(showModel.value);P.value&&_e()};i((()=>X.getLoginConfig),(e=>{e.login_way&&(te.scene=e.login_way[0])}),{immediate:!0});const be=c((()=>!(1!=te.scene||!te.account||!te.password)||!(2!=te.scene||!te.account||!te.code)));return r((async()=>{const e=u.getAuthData();try{if(e.code&&e.scene===d.LOGIN){p({title:"请稍后..."});const a=await _e(e);a&&(oe.value=a,ge(oe.value))}}catch(a){(()=>{const e=R.query;e.code&&e.state&&(delete e.code,delete e.state,K.redirectTo({path:R.path,query:e}))})()}finally{f(),u.setAuthData()}})),(e,a)=>{const s=G(M("page-meta"),N),t=O,l=S,o=G(M("tn-icon"),W),n=q,c=G(M("tn-input"),B),i=A,r=G(M("tn-checkbox"),E),u=G(M("tn-modal"),H);return m(),g(k,null,[v(s,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),v(t,{class:"login-container"},{default:_((()=>[h(" 背景装饰 "),v(t,{class:"bg-decoration"},{default:_((()=>[v(t,{class:"circle circle-1"}),v(t,{class:"circle circle-2"}),v(t,{class:"circle circle-3"})])),_:1}),h(" 主内容区 "),v(t,{class:"login-content"},{default:_((()=>[h(" Logo 区域 "),v(t,{class:"logo-section"},{default:_((()=>[v(t,{class:"logo-wrapper"},{default:_((()=>[v(l,{src:b(X).getWebsiteConfig.shop_logo,mode:"aspectFit",class:"logo-image"},null,8,["src"])])),_:1}),v(t,{class:"welcome-text"},{default:_((()=>[y("欢迎回来")])),_:1}),v(t,{class:"subtitle-text"},{default:_((()=>[y("登录您的账号继续使用")])),_:1})])),_:1}),h(" 登录表单卡片 "),v(t,{class:"form-card glass-card"},{default:_((()=>[le.value?h("v-if",!0):(m(),g(k,{key:0},[h(" 快捷登录按钮 "),b(pe)&&P.value&&b(ue)?(m(),w(t,{key:0,class:"quick-login-section"},{default:_((()=>[v(t,{class:"btn-primary",onClick:he,"hover-class":"btn-hover"},{default:_((()=>[v(t,{class:"btn-content"},{default:_((()=>[v(o,{name:"wechat-fill",size:"40",color:"#ffffff"}),v(n,{class:"btn-text"},{default:_((()=>[y("微信一键登录")])),_:1})])),_:1})])),_:1})])),_:1})):h("v-if",!0),b(pe)&&P.value&&b(ue)?(m(),w(t,{key:1,class:"divider-section"},{default:_((()=>[v(t,{class:"divider-line"}),v(n,{class:"divider-text"},{default:_((()=>[y("或")])),_:1}),v(t,{class:"divider-line"})])),_:1})):h("v-if",!0),v(t,{class:"phone-login-btn",onClick:a[0]||(a[0]=e=>le.value=!le.value),"hover-class":"btn-hover"},{default:_((()=>[v(t,{class:"btn-content"},{default:_((()=>[v(o,{name:"phone",size:"40",color:b(ne)},null,8,["color"]),v(n,{class:"btn-text"},{default:_((()=>[y("手机号登录")])),_:1})])),_:1})])),_:1})],64)),le.value?(m(),g(k,{key:1},[h(" 登录方式标题 "),v(t,{class:"form-title"},{default:_((()=>[y(j(1==te.scene?"账号密码登录":"验证码登录"),1)])),_:1}),h(" 密码登录 "),1==te.scene&&re(1)?(m(),g(k,{key:0},[v(t,{class:"input-group"},{default:_((()=>[v(t,{class:"input-wrapper"},{default:_((()=>[v(o,{name:"user",size:"36",color:"#9ca3af",class:"input-icon"}),v(c,{class:"custom-input",modelValue:te.account,"onUpdate:modelValue":a[1]||(a[1]=e=>te.account=e),border:!1,placeholder:"请输入账号/手机号"},null,8,["modelValue"])])),_:1})])),_:1}),v(t,{class:"input-group"},{default:_((()=>[v(t,{class:"input-wrapper"},{default:_((()=>[v(o,{name:"lock",size:"36",color:"#9ca3af",class:"input-icon"}),v(c,{class:"custom-input",modelValue:te.password,"onUpdate:modelValue":a[2]||(a[2]=e=>te.password=e),type:"password",placeholder:"请输入密码",border:!1},null,8,["modelValue"]),v(i,{url:"/pages/forget_pwd/forget_pwd","hover-class":"none"},{default:_((()=>[v(t,{class:"forgot-link"},{default:_((()=>[y("忘记?")])),_:1})])),_:1})])),_:1})])),_:1})],64)):h("v-if",!0),h(" 验证码登录 "),2==te.scene&&re(2)?(m(),g(k,{key:1},[v(t,{class:"input-group"},{default:_((()=>[v(t,{class:"input-wrapper"},{default:_((()=>[v(o,{name:"phone",size:"36",color:"#9ca3af",class:"input-icon"}),v(c,{class:"custom-input",modelValue:te.account,"onUpdate:modelValue":a[3]||(a[3]=e=>te.account=e),border:!1,placeholder:"请输入手机号码"},null,8,["modelValue"])])),_:1})])),_:1}),v(t,{class:"input-group"},{default:_((()=>[v(t,{class:"input-wrapper"},{default:_((()=>[v(o,{name:"shield-check",size:"36",color:"#9ca3af",class:"input-icon"}),v(c,{class:"custom-input",modelValue:te.code,"onUpdate:modelValue":a[4]||(a[4]=e=>te.code=e),placeholder:"请输入验证码",border:!1},null,8,["modelValue"]),v(t,{class:x(["code-btn",{"code-btn-active":ae.value&&te.account}]),onClick:ce,"hover-class":"code-btn-hover"},{default:_((()=>[y(j(ee.value),1)])),_:1},8,["class"])])),_:1})])),_:1})],64)):h("v-if",!0),h(" 协议勾选 "),b(de)?(m(),w(t,{key:2,class:"agreement-section"},{default:_((()=>[v(r,{modelValue:se.value,"onUpdate:modelValue":a[7]||(a[7]=e=>se.value=e),shape:"round"},{default:_((()=>[v(t,{class:"agreement-text"},{default:_((()=>[y(" 已阅读并同意 "),v(i,{class:"agreement-link","hover-class":"none",url:"/pages/agreement/agreement?type=service",onClick:a[5]||(a[5]=C((()=>{}),["stop"]))},{default:_((()=>[y(" 《服务协议》 ")])),_:1}),y(" 和 "),v(i,{class:"agreement-link","hover-class":"none",url:"/pages/agreement/agreement?type=privacy",onClick:a[6]||(a[6]=C((()=>{}),["stop"]))},{default:_((()=>[y(" 《隐私协议》 ")])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})):h("v-if",!0),h(" 登录按钮 "),v(t,{class:"login-btn-wrapper"},{default:_((()=>[v(t,{class:x(["btn-primary btn-login",{"btn-disabled":!b(be)}]),onClick:a[8]||(a[8]=e=>b(ve)(te.scene)),"hover-class":"btn-hover"},{default:_((()=>[v(t,{class:"btn-text"},{default:_((()=>[y("立即登录")])),_:1})])),_:1},8,["class"])])),_:1}),h(" 底部操作 "),v(t,{class:"bottom-actions"},{default:_((()=>[v(t,{class:"action-item"},{default:_((()=>[2==te.scene&&re(1)?(m(),w(n,{key:0,class:"action-link",onClick:a[9]||(a[9]=e=>ie(1))},{default:_((()=>[y(" 密码登录 ")])),_:1})):h("v-if",!0),1==te.scene&&re(2)?(m(),w(n,{key:1,class:"action-link",onClick:a[10]||(a[10]=e=>ie(2))},{default:_((()=>[y(" 验证码登录 ")])),_:1})):h("v-if",!0)])),_:1}),v(i,{url:"/pages/register/register","hover-class":"none"},{default:_((()=>[v(t,{class:"action-link"},{default:_((()=>[y("注册账号")])),_:1})])),_:1})])),_:1})],64)):h("v-if",!0)])),_:1})])),_:1}),h(" 协议弹框 "),v(u,{ref_key:"modalRef",ref:Z},null,512)])),_:1})],64)}}}),[["__scopeId","data-v-bd962531"]]);export{R as default};
