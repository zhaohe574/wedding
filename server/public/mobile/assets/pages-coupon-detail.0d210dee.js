import{q as e,c as a,s as t,v as l,d as o,o as s,b as r,w as u,g as n,f as c,h as i,e as d,j as v,t as _,y as m,n as f,F as p,m as y,u as b,a1 as g,O as h,aD as w,bD as C,X as x,i as k,bn as S,k as M,r as $,a as D,l as N,aJ as z}from"./index-e3492752.js";import{_ as j}from"./navigation-bar.2687311c.js";import{_ as B}from"./page-meta.a4be6114.js";import{_ as I}from"./loading.2b80eb94.js";import{e as H,_ as q}from"./icon.e613abcd.js";import{c as F,r as T}from"./coupon.4848d9a7.js";import{b as J,u as L,a as O,f as R}from"./index.f1be293a.js";import"./index.89b6df5d.js";import{_ as V}from"./_plugin-vue_export-helper.1b428a4d.js";const X=(e,a=2,t=!0)=>{let l=0;if("string"==typeof e){if(""===e)return e;l=Number(e)}else"number"==typeof e&&(l=e);if(Number.isNaN(l)||0===l)return t?"00":"0";const o=Math.pow(10,a)-1;return l>o?`${o}+`:(l=String(l),t?`00${l}`.slice(Math.max(0,l.length>2?2:l.length)):l)},Y=J({time:{type:Number,required:!0,default:0},autoStart:{type:Boolean,default:!0},size:String,textColor:String,showDay:Boolean,showHour:{type:Boolean,default:!0},showMinute:{type:Boolean,default:!0},showSecond:{type:Boolean,default:!0},autoHideDay:{type:Boolean,default:!0},separatorMode:{type:String,values:["cn","en"],default:"en"},separatorColor:String,border:Boolean,borderColor:String}),A=3600,E=V(o({__name:"count-down",props:Y,emits:{start:()=>!0,end:()=>!0},setup(o,{expose:b,emit:g}){const h=o,{day:w,hour:C,minute:x,second:k,startCountDown:S,stopCountDown:M,resetCountDown:$}=((e,a)=>{let o=0;const s=t(""),r=t(""),u=t(""),n=t(""),c=()=>{const{showDay:a,showHour:t,showMinute:l,showSecond:c,autoHideDay:i}=e,d=Math.floor(o/86400),v=a?Math.floor(o%86400/A):Math.floor(o/A),_=Math.floor(o%A/60),m=Math.floor(o%60);s.value=!a||i&&0===d?"":X(d,4),r.value=t?X(v,4):"",u.value=l?X(_):"",n.value=c?X(m):""};let i=null;const d=()=>{o<=0?o=e.time:o--,v(),a("start"),i=setInterval((()=>{if(o<0)return v(),void a("end");c(),o--}),1e3)},v=()=>{i&&(clearInterval(i),i=null)},_=()=>{v(),o=e.time,c()};return l((()=>e.time),(a=>{_(),e.autoStart&&a>0&&d()}),{immediate:!0}),{day:s,hour:r,minute:u,second:n,startCountDown:d,stopCountDown:v,resetCountDown:_}})(h,g),{countDownClass:D,countDownStyle:N,textClass:z,textStyle:j,separatorClass:B,separatorStyle:I}=(t=>{const l=L("count-down"),[o,s]=O(e(t,"textColor"),"text"),[r,u]=O(e(t,"separatorColor"),"text"),[n,c]=O(e(t,"borderColor"),"border"),{sizeType:i}=H(t.size),d=a((()=>{const e=[l.b()];return t.size&&"inner"===i.value&&e.push(l.m(t.size)),e.join(" ")})),v=a((()=>{const e={};return t.size&&"custom"===i.value&&(e.fontSize=R(t.size)),e})),_=a((()=>{const e=[l.e("text")];return o.value&&e.push(o.value),t.border&&(e.push(l.is("border")),n.value&&e.push(n.value)),e.join(" ")})),m=a((()=>{const e={};return o.value||(e.color=s.value||"var(--tn-text-color-primary)"),t.border&&(n.value||(e.borderColor=c.value||"var(--tn-color-gray-disabled)")),e})),f=a((()=>{const e=[l.e("separator"),l.em("separator",t.separatorMode)];return r.value&&e.push(r.value),e.join(" ")})),p=a((()=>{const e={};return r.value||(e.color=u.value||"var(--tn-text-color-secondary)"),e}));return{ns:l,countDownClass:d,countDownStyle:v,textClass:_,textStyle:m,separatorClass:f,separatorStyle:p}})(h),{getSeparatorData:q}=(()=>{const e={cn:{day:"天",hour:"时",minute:"分",second:"秒"},en:{day:":",hour:":",minute:":",second:""}};return{getSeparatorData:(a,t)=>e[a][t]}})();return b({start:S,stop:M,reset:$}),(e,a)=>{const t=y;return s(),r(t,{class:m([c(D)]),style:f(c(N))},{default:u((()=>[n(" 日 "),c(w)?(s(),i(p,{key:0},[d(t,{class:m(["day",[c(z)]]),style:f(c(j))},{default:u((()=>[v(_(c(w)),1)])),_:1},8,["class","style"]),d(t,{class:m(["day",[c(B)]]),style:f(c(I))},{default:u((()=>[v(_(c(q)(e.separatorMode,"day")),1)])),_:1},8,["class","style"])],64)):n("v-if",!0),n(" 时 "),c(C)?(s(),i(p,{key:1},[d(t,{class:m(["hour",[c(z)]]),style:f(c(j))},{default:u((()=>[v(_(c(C)),1)])),_:1},8,["class","style"]),d(t,{class:m(["hour",[c(B)]]),style:f(c(I))},{default:u((()=>[v(_(c(q)(e.separatorMode,"hour")),1)])),_:1},8,["class","style"])],64)):n("v-if",!0),n(" 分 "),c(x)?(s(),i(p,{key:2},[d(t,{class:m(["minute",[c(z)]]),style:f(c(j))},{default:u((()=>[v(_(c(x)),1)])),_:1},8,["class","style"]),d(t,{class:m(["minute",[c(B)]]),style:f(c(I))},{default:u((()=>[v(_(c(q)(e.separatorMode,"minute")),1)])),_:1},8,["class","style"])],64)):n("v-if",!0),n(" 秒 "),c(k)?(s(),i(p,{key:3},[d(t,{class:m(["second",[c(z)]]),style:f(c(j))},{default:u((()=>[v(_(c(k)),1)])),_:1},8,["class","style"]),c(q)(e.separatorMode,"second")?(s(),r(t,{key:0,class:m(["minute",[c(B)]]),style:f(c(I))},{default:u((()=>[v(_(c(q)(e.separatorMode,"second")),1)])),_:1},8,["class","style"])):n("v-if",!0)],64)):n("v-if",!0)])),_:1},8,["class","style"])}}}),[["__scopeId","data-v-3cbbd0df"]]),G=V(o({__name:"detail",setup(e){const l=b(),o=g(),H=t({}),J=t(!1),L=t(!1),O=t(0);let R=null;const V=e=>String(e).padStart(2,"0"),X=e=>{if(!e)return"";const a=new Date(1e3*e);return`${a.getFullYear()}年${V(a.getMonth()+1)}月${V(a.getDate())}日 ${V(a.getHours())}:${V(a.getMinutes())}`},Y=()=>{R&&(clearInterval(R),R=null)},A=async(e=!0)=>{if(O.value){e&&(J.value=!0);try{const e=await F({id:O.value});H.value=e||{},Number(H.value.receive_countdown)>0?(e=>{Y();let a=Math.max(0,Number(e)||0);H.value.receive_countdown=a,a<=0||(R=setInterval((()=>{a=Math.max(0,a-1),H.value.receive_countdown=a,a<=0&&(Y(),A(!1))}),1e3))})(H.value.receive_countdown):Y()}catch(a){console.error(a)}finally{J.value=!1,S()}}},G=a((()=>{const e=Number(H.value.threshold_amount||0);return e>0?`满${e}元可用`:"无门槛"})),K=a((()=>{const e=Number(H.value.receive_start_time||0),a=Number(H.value.receive_end_time||0);return e||a?e&&a?[X(e),"至",X(a)]:e?[`${X(e)} 起`]:[`${X(a)} 止`]:["不限时间"]})),P=a((()=>{const e=Number(H.value.valid_type||0),a=Number(H.value.valid_days||0);if(2===e&&a)return[`领取后 ${a} 天内有效`];const t=Number(H.value.valid_start_time||0),l=Number(H.value.valid_end_time||0);return t||l?t&&l?[X(t),"至",X(l)]:t?[`${X(t)} 起`]:[`${X(l)} 止`]:["长期有效"]})),Q=a((()=>{if(-1===H.value.remain_count)return"不限";if(0===H.value.remain_count)return"0张";if(H.value.remain_count)return`${H.value.remain_count}张`;const e=Number(H.value.total_count||0);if(0===e)return"不限";return`${Math.max(0,e-Number(H.value.receive_count||0))}张`})),U=a((()=>{const e=Number(H.value.per_limit||0);return e>0?`${e}张`:"不限"})),W=a((()=>!1===H.value.can_receive&&Number(H.value.receive_countdown)>0)),Z=a((()=>H.value.is_received?"已领取":0===H.value.remain_count?"已领完":!1===H.value.can_receive?H.value.receive_status_text||"暂不可领":"立即领取")),ee=a((()=>H.value.is_received||0===H.value.remain_count||!1===H.value.can_receive)),ae=a((()=>!1!==H.value.can_receive||W.value?"":H.value.receive_status_text||"暂不可领取")),te=async()=>{if(!L.value)if(H.value.is_received)w({title:"已领取过该优惠券",icon:"none"});else if(0!==H.value.remain_count)if(!1!==H.value.can_receive){if(!o.isLogin)return w({title:"请先登录",icon:"none"}),void setTimeout((()=>{M({url:"/pages/login/login"})}),1200);L.value=!0;try{await T({coupon_id:O.value}),w({title:"领取成功",icon:"success"}),await A(!1)}catch(e){w({title:e.msg||"领取失败",icon:"none"})}finally{L.value=!1}}else w({title:H.value.receive_status_text||"暂不可领取",icon:"none"});else w({title:"优惠券已领完",icon:"none"})};return h((e=>{const a=Number((null==e?void 0:e.id)||0);a?(O.value=a,A(!0)):w({title:"优惠券不存在",icon:"none"})})),C((()=>{A(!1)})),x((()=>{Y()})),(e,a)=>{const t=$(D("navigation-bar"),j),o=$(D("page-meta"),B),b=$(D("tn-loading"),I),g=N,h=y,w=$(D("tn-icon"),q),C=z;return s(),i(p,null,[d(o,{"page-style":c(l).pageStyle},{default:u((()=>[d(t,{title:"优惠券详情","front-color":c(l).navColor,"background-color":c(l).navBgColor},null,8,["front-color","background-color"])])),_:1},8,["page-style"]),d(h,{class:"coupon-detail-page"},{default:u((()=>[n(" 加载状态 "),J.value?(s(),r(h,{key:0,class:"loading-state"},{default:u((()=>[d(b,{mode:"flower",color:c(l).primaryColor},null,8,["color"]),d(g,{class:"loading-text"},{default:u((()=>[v("加载中...")])),_:1})])),_:1})):(s(),r(h,{key:1,class:"content-wrapper"},{default:u((()=>[n(" 优惠券主卡片 - 玻璃态设计 "),d(h,{class:"coupon-main-card glass-card"},{default:u((()=>[n(" 金额区域 - 上方 "),d(h,{class:"amount-section",style:f({background:`linear-gradient(135deg, ${c(l).ctaColor} 0%, ${c(l).ctaColor} 100%)`})},{default:u((()=>[n(" 折扣券 "),2===H.value.coupon_type?(s(),r(h,{key:0,class:"amount-content"},{default:u((()=>[d(h,{class:"discount-wrapper"},{default:u((()=>[d(g,{class:"discount-num"},{default:u((()=>[v(_((H.value.discount_amount/10).toFixed(1)),1)])),_:1}),d(g,{class:"discount-unit"},{default:u((()=>[v("折")])),_:1})])),_:1}),d(g,{class:"threshold-text"},{default:u((()=>[v(_(c(G)),1)])),_:1})])),_:1})):(s(),i(p,{key:1},[n(" 满减券 "),d(h,{class:"amount-content"},{default:u((()=>[d(h,{class:"price-wrapper"},{default:u((()=>[d(g,{class:"price-symbol"},{default:u((()=>[v("¥")])),_:1}),d(g,{class:"price-num"},{default:u((()=>[v(_(H.value.discount_amount),1)])),_:1})])),_:1}),d(g,{class:"threshold-text"},{default:u((()=>[v(_(c(G)),1)])),_:1})])),_:1})],2112)),n(" 装饰圆点 "),d(h,{class:"deco-circle deco-circle-top"}),d(h,{class:"deco-circle deco-circle-bottom"})])),_:1},8,["style"]),n(" 信息区域 - 下方 "),d(h,{class:"info-section"},{default:u((()=>[d(h,{class:"title-row"},{default:u((()=>[d(g,{class:"coupon-title"},{default:u((()=>[v(_(H.value.name),1)])),_:1}),d(h,{class:"type-badge",style:f({background:2===H.value.coupon_type?"rgba(249, 115, 22, 0.1)":"rgba(124, 58, 237, 0.1)",color:2===H.value.coupon_type?c(l).ctaColor:c(l).primaryColor,borderColor:2===H.value.coupon_type?c(l).ctaColor:c(l).primaryColor})},{default:u((()=>[v(_(H.value.coupon_type_text),1)])),_:1},8,["style"])])),_:1}),d(h,{class:"desc-row"},{default:u((()=>[d(w,{name:"discount",size:"28",color:c(l).ctaColor},null,8,["color"]),d(g,{class:"desc-text",style:f({color:c(l).ctaColor})},{default:u((()=>[v(_(H.value.discount_desc),1)])),_:1},8,["style"])])),_:1}),d(h,{class:"scope-row"},{default:u((()=>[d(w,{name:"shop",size:"28",color:"#999999"}),d(g,{class:"scope-text"},{default:u((()=>[v(_(H.value.use_scope_text||"全部可用"),1)])),_:1})])),_:1})])),_:1})])),_:1}),n(" 使用规则卡片 "),d(h,{class:"rules-card"},{default:u((()=>[d(h,{class:"card-header"},{default:u((()=>[d(w,{name:"document",size:"32",color:c(l).primaryColor},null,8,["color"]),d(g,{class:"card-title"},{default:u((()=>[v("使用与领取规则")])),_:1})])),_:1}),d(h,{class:"rules-list"},{default:u((()=>[n(" 可领取时间 "),d(h,{class:"rule-item"},{default:u((()=>[d(h,{class:"rule-label"},{default:u((()=>[d(w,{name:"time",size:"32",color:c(l).primaryColor},null,8,["color"]),d(g,null,{default:u((()=>[v("可领取时间")])),_:1})])),_:1}),d(h,{class:"rule-value"},{default:u((()=>[(s(!0),i(p,null,k(c(K),((e,a)=>(s(),r(g,{key:a,class:"rule-value-line"},{default:u((()=>[v(_(e),1)])),_:2},1024)))),128))])),_:1})])),_:1}),n(" 可使用时间 "),d(h,{class:"rule-item"},{default:u((()=>[d(h,{class:"rule-label"},{default:u((()=>[d(w,{name:"calendar",size:"32",color:c(l).primaryColor},null,8,["color"]),d(g,null,{default:u((()=>[v("可使用时间")])),_:1})])),_:1}),d(h,{class:"rule-value"},{default:u((()=>[(s(!0),i(p,null,k(c(P),((e,a)=>(s(),r(g,{key:a,class:"rule-value-line"},{default:u((()=>[v(_(e),1)])),_:2},1024)))),128))])),_:1})])),_:1}),n(" 剩余数量 "),d(h,{class:"rule-item"},{default:u((()=>[d(h,{class:"rule-label"},{default:u((()=>[d(w,{name:"ticket",size:"32",color:c(l).primaryColor},null,8,["color"]),d(g,null,{default:u((()=>[v("剩余数量")])),_:1})])),_:1}),d(h,{class:"rule-value"},{default:u((()=>[d(g,{class:"rule-value-line"},{default:u((()=>[v(_(c(Q)),1)])),_:1})])),_:1})])),_:1}),n(" 每人限领 "),d(h,{class:"rule-item"},{default:u((()=>[d(h,{class:"rule-label"},{default:u((()=>[d(w,{name:"user",size:"32",color:c(l).primaryColor},null,8,["color"]),d(g,null,{default:u((()=>[v("每人限领")])),_:1})])),_:1}),d(h,{class:"rule-value"},{default:u((()=>[d(g,{class:"rule-value-line"},{default:u((()=>[v(_(c(U)),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})),n(" 底部操作栏 - 固定 "),d(h,{class:"action-bar"},{default:u((()=>[d(h,{class:"action-content"},{default:u((()=>[d(C,{class:m(["receive-button",{"receive-button-disabled":c(ee)}]),style:f(c(ee)?{}:{background:`linear-gradient(135deg, ${c(l).primaryColor} 0%, ${c(l).primaryColor} 100%)`,color:c(l).btnColor,boxShadow:`0 12rpx 32rpx ${c(l).primaryColor}40`}),disabled:c(ee),loading:L.value,onClick:te},{default:u((()=>[c(W)?(s(),i(p,{key:0},[d(w,{name:"time",size:"36",color:c(l).btnColor},null,8,["color"]),d(g,{class:"countdown-label"},{default:u((()=>[v("距开始：")])),_:1}),d(E,{time:Number(H.value.receive_countdown),"auto-start":!1,"show-hour":!0,"show-minute":!0,"show-second":!0,"separator-mode":"cn"},null,8,["time"])],64)):(s(),i(p,{key:1},[c(ee)?n("v-if",!0):(s(),r(w,{key:0,name:"gift",size:"36",color:c(l).btnColor},null,8,["color"])),d(g,null,{default:u((()=>[v(_(c(Z)),1)])),_:1})],64))])),_:1},8,["class","style","disabled","loading"]),c(ae)?(s(),r(g,{key:0,class:"status-hint"},{default:u((()=>[v(_(c(ae)),1)])),_:1})):n("v-if",!0)])),_:1}),d(h,{class:"safe-bottom"})])),_:1})])),_:1})],64)}}}),[["__scopeId","data-v-321d5335"]]);export{G as default};
