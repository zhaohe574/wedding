import{a4 as a,d as e,s as t,aS as l,bD as s,bn as c,U as i,o,h as r,e as n,w as u,g as f,y as d,j as _,t as y,b as v,F as p,i as g,aP as m,aD as k,r as h,a as b,a_ as w,m as C,l as x,G as z,k as j}from"./index-e3492752.js";import{_ as $}from"./navigation-bar.2687311c.js";import{_ as D}from"./page-meta.a4be6114.js";import{_ as F}from"./empty.dfd7c9cf.js";import{_ as S}from"./_plugin-vue_export-helper.1b428a4d.js";const A=S(e({__name:"index",setup(e){const S=t(!1),A=t(0),B=t([]),G=t({total:0,system:0,order:0,interact:0,activity:0}),I=t(1),P=t(!0),R=a=>{A.value=a,a>0&&V(!0)},U=async()=>{try{const e=await a.get({url:"/notification/unreadCount"});G.value=e||{}}catch(e){console.error(e)}},V=async(e=!1)=>{if(!S.value&&(e||P.value)){e&&(I.value=1,P.value=!0),S.value=!0;try{const l=await(t={page:I.value,limit:10,notify_type:A.value},a.get({url:"/notification/lists",params:t})),s=l.lists||[];B.value=e?s:[...B.value,...s],P.value=l.has_more,P.value&&I.value++}catch(l){console.error(l)}finally{S.value=!1,c()}var t}},X=async e=>{if(e.is_read||(e.is_read=1,e.is_read_text="已读",U()),e.target_type&&e.target_id)switch(e.target_type){case"order":j({url:`/pages/order/detail?id=${e.target_id}`});break;case"dynamic":j({url:`/pages/dynamic/detail?id=${e.target_id}`});break;case"review":j({url:`/pages/review/detail?id=${e.target_id}`});break;default:try{await(t={id:e.id},a.get({url:"/notification/detail",params:t}))}catch(l){console.error(l)}}var t},q=async()=>{m({title:"提示",content:"确定将所有消息标记为已读吗？",success:async e=>{if(e.confirm)try{await(t={notify_type:A.value},a.post({url:"/notification/markAllRead",params:t})),k({title:"标记成功",icon:"success"}),V(!0),U()}catch(l){console.error(l)}var t}})},E=async()=>{m({title:"提示",content:"确定清空所有消息吗？此操作不可恢复",success:async e=>{if(e.confirm)try{await(t={notify_type:A.value},a.post({url:"/notification/clear",params:t})),k({title:"清空成功",icon:"success"}),V(!0),U()}catch(l){console.error(l)}var t}})};return l((()=>{A.value>0&&V()})),s((()=>{U(),A.value>0?V(!0):c()})),i((()=>{U()})),(a,e)=>{const t=h(b("navigation-bar"),$),l=h(b("page-meta"),D),s=w("uni-icons"),c=C,i=x,m=z;return o(),r(p,null,[n(l,{"page-style":a.$theme.pageStyle},{default:u((()=>[n(t,{title:"消息中心","front-color":a.$theme.navColor,"background-color":a.$theme.navBgColor},null,8,["front-color","background-color"])])),_:1},8,["page-style"]),n(c,{class:"notification-page"},{default:u((()=>[f(" 消息分类入口 "),n(c,{class:"category-list"},{default:u((()=>[n(c,{class:d(["category-item",{active:0===A.value}]),onClick:e[0]||(e[0]=a=>R(0))},{default:u((()=>[n(c,{class:"icon-wrap all"},{default:u((()=>[n(s,{type:"chat",size:"24",color:"#fff"})])),_:1}),n(c,{class:"category-info"},{default:u((()=>[n(c,{class:"category-name"},{default:u((()=>[_("全部消息")])),_:1}),n(c,{class:"category-desc"},{default:u((()=>[_(y(G.value.total||0)+" 条未读",1)])),_:1})])),_:1}),G.value.total>0?(o(),v(c,{key:0,class:"badge"},{default:u((()=>[_(y(G.value.total),1)])),_:1})):f("v-if",!0)])),_:1},8,["class"]),n(c,{class:d(["category-item",{active:1===A.value}]),onClick:e[1]||(e[1]=a=>R(1))},{default:u((()=>[n(c,{class:"icon-wrap system"},{default:u((()=>[n(s,{type:"info",size:"24",color:"#fff"})])),_:1}),n(c,{class:"category-info"},{default:u((()=>[n(c,{class:"category-name"},{default:u((()=>[_("系统通知")])),_:1}),n(c,{class:"category-desc"},{default:u((()=>[_("公告、活动通知")])),_:1})])),_:1}),G.value.system>0?(o(),v(c,{key:0,class:"badge"},{default:u((()=>[_(y(G.value.system),1)])),_:1})):f("v-if",!0)])),_:1},8,["class"]),n(c,{class:d(["category-item",{active:2===A.value}]),onClick:e[2]||(e[2]=a=>R(2))},{default:u((()=>[n(c,{class:"icon-wrap order"},{default:u((()=>[n(s,{type:"shop",size:"24",color:"#fff"})])),_:1}),n(c,{class:"category-info"},{default:u((()=>[n(c,{class:"category-name"},{default:u((()=>[_("订单通知")])),_:1}),n(c,{class:"category-desc"},{default:u((()=>[_("订单状态、服务提醒")])),_:1})])),_:1}),G.value.order>0?(o(),v(c,{key:0,class:"badge"},{default:u((()=>[_(y(G.value.order),1)])),_:1})):f("v-if",!0)])),_:1},8,["class"]),n(c,{class:d(["category-item",{active:3===A.value}]),onClick:e[3]||(e[3]=a=>R(3))},{default:u((()=>[n(c,{class:"icon-wrap interact"},{default:u((()=>[n(s,{type:"heart",size:"24",color:"#fff"})])),_:1}),n(c,{class:"category-info"},{default:u((()=>[n(c,{class:"category-name"},{default:u((()=>[_("互动通知")])),_:1}),n(c,{class:"category-desc"},{default:u((()=>[_("点赞、评论、关注")])),_:1})])),_:1}),G.value.interact>0?(o(),v(c,{key:0,class:"badge"},{default:u((()=>[_(y(G.value.interact),1)])),_:1})):f("v-if",!0)])),_:1},8,["class"])])),_:1}),f(" 操作按钮 "),A.value>0?(o(),v(c,{key:0,class:"action-bar"},{default:u((()=>[n(c,{class:"action-btn",onClick:q},{default:u((()=>[n(s,{type:"checkbox",size:"16",color:"#666"}),n(i,null,{default:u((()=>[_("全部已读")])),_:1})])),_:1}),n(c,{class:"action-btn",onClick:E},{default:u((()=>[n(s,{type:"trash",size:"16",color:"#666"}),n(i,null,{default:u((()=>[_("清空消息")])),_:1})])),_:1})])),_:1})):f("v-if",!0),f(" 消息列表 "),A.value>0?(o(),v(c,{key:1,class:"list-wrap"},{default:u((()=>[B.value.length?(o(),v(c,{key:0},{default:u((()=>[(o(!0),r(p,null,g(B.value,(a=>(o(),v(c,{key:a.id,class:d(["notification-card",{unread:!a.is_read}]),onClick:e=>X(a)},{default:u((()=>[n(c,{class:"notification-header"},{default:u((()=>[n(c,{class:"notification-title"},{default:u((()=>[_(y(a.title),1)])),_:2},1024),n(c,{class:"notification-time"},{default:u((()=>[_(y(a.create_time_text),1)])),_:2},1024)])),_:2},1024),n(c,{class:"notification-content"},{default:u((()=>[_(y(a.content),1)])),_:2},1024),a.target_type?(o(),v(c,{key:0,class:"notification-footer"},{default:u((()=>[n(i,{class:"link-text"},{default:u((()=>[_("查看详情")])),_:1}),n(s,{type:"right",size:"12",color:"#999"})])),_:1})):f("v-if",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1})):(o(),v(c,{key:1,class:"empty-tip"},{default:u((()=>[n(m,{src:F,class:"empty-icon",mode:"aspectFit"}),n(i,null,{default:u((()=>[_("暂无消息")])),_:1})])),_:1}))])),_:1})):f("v-if",!0),f(" 加载状态 "),S.value?(o(),v(c,{key:2,class:"loading-tip"},{default:u((()=>[n(s,{type:"spinner-cycle",size:"20",color:"#999"}),n(i,null,{default:u((()=>[_("加载中...")])),_:1})])),_:1})):f("v-if",!0),f(" 加载更多提示 "),A.value>0&&!S.value&&B.value.length>0?(o(),v(c,{key:3,class:"load-more-tip"},{default:u((()=>[P.value?(o(),v(i,{key:0},{default:u((()=>[_("上拉加载更多")])),_:1})):(o(),v(i,{key:1},{default:u((()=>[_("没有更多了")])),_:1}))])),_:1})):f("v-if",!0),f(" 底部安全区 "),n(c,{class:"safe-bottom"})])),_:1})],64)}}}),[["__scopeId","data-v-865e5be9"]]);export{A as default};
