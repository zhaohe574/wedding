import{d as e,M as t,s as a,c as l,O as s,o as i,h as o,e as n,w as c,g as u,j as r,t as d,b as m,F as f,i as g,y as p,f as x,aV as y,af as _,aW as v,aD as b,ag as h,b3 as k,b4 as w,aq as j,r as C,a as V,b0 as z,m as T,l as F,a$ as q,aJ as S,a5 as U,G as $}from"./index-e3492752.js";import{_ as P}from"./navigation-bar.2687311c.js";import{_ as D}from"./page-meta.a4be6114.js";import{_ as J}from"./icon.e613abcd.js";import{_ as W}from"./popup.b8b85cf1.js";import{_ as B}from"./action-sheet.306657ea.js";import{h as G,p as H}from"./dynamic.b225a591.js";import{_ as I}from"./_plugin-vue_export-helper.1b428a4d.js";import"./index.f1be293a.js";import"./z-index.5f93cfb9.js";import"./is-boolean.00bf65dc.js";import"./_objectToString.c905654b.js";import"./is-empty.c0d66e4a.js";import"./index.89b6df5d.js";import"./event.5568c9d8.js";import"./install.8446dea8.js";const M=I(e({__name:"dynamic_publish",setup(e){const I=[{label:"图文",value:1},{label:"视频",value:2},{label:"案例",value:3},{label:"活动",value:4}],M=[{text:"公开",value:1},{text:"仅粉丝可见",value:2},{text:"仅自己可见",value:3}],O=t({content:"",images:[],video:"",video_cover:"",dynamic_type:1,tags:[],location:"",longitude:"",latitude:"",visible:1}),A=a([]),E=a(!1),K=a(""),L=a(!1),N=a(!1),Q=l((()=>O.content.trim().length>0||O.images.length>0||O.video)),R=()=>{const e=M.find((e=>e.value===O.visible));return(null==e?void 0:e.text)||"公开"},X=()=>{const e=9-O.images.length;y({count:e,sizeType:["compressed"],sourceType:["album","camera"],success:async e=>{_({title:"上传中..."});try{for(const t of e.tempFilePaths){const e=await v(t);e.url&&O.images.push(e.url)}2===O.dynamic_type&&(O.dynamic_type=1)}catch(t){b({title:t.message||"上传失败",icon:"none"})}finally{h()}}})},Y=()=>{k({sourceType:["album","camera"],maxDuration:60,compressed:!0,success:async e=>{_({title:"上传中..."});try{const t=await v(e.tempFilePath);t.url&&(O.video=t.url,O.video_cover=e.thumbTempFilePath||"",O.dynamic_type=2)}catch(t){b({title:t.message||"上传失败",icon:"none"})}finally{h()}}})},Z=()=>{O.video="",O.video_cover="",O.dynamic_type=1},ee=()=>{const e=K.value.trim();e?O.tags.length>=5?b({title:"最多添加5个话题",icon:"none"}):O.tags.includes(e)?b({title:"话题已存在",icon:"none"}):(O.tags.push(e),K.value="",E.value=!1):b({title:"请输入话题名称",icon:"none"})},te=()=>{w({success:e=>{O.location=e.name||e.address,O.longitude=String(e.longitude),O.latitude=String(e.latitude)}})},ae=e=>{O.visible=M[e].value},le=async()=>{if(Q.value&&!N.value){N.value=!0,_({title:"发布中..."});try{const e={content:O.content.trim(),dynamic_type:O.dynamic_type,visible:O.visible};O.images.length>0&&(e.images=O.images),O.video&&(e.video=O.video,e.video_cover=O.video_cover),O.tags.length>0&&(e.tags=O.tags),O.location&&(e.location=O.location,e.longitude=O.longitude,e.latitude=O.latitude),await H(e),b({title:"发布成功"}),setTimeout((()=>{j()}),1500)}catch(e){b({title:e.message||"发布失败",icon:"none"})}finally{N.value=!1,h()}}};return s((()=>{(async()=>{try{const e=await G();A.value=e||[]}catch(e){console.error(e)}})()})),(e,t)=>{const a=C(V("navigation-bar"),P),l=C(V("page-meta"),D),s=z,y=T,_=F,v=$,h=C(V("tn-icon"),J),k=q,w=S,j=U,G=C(V("tn-popup"),W),H=C(V("tn-action-sheet"),B);return i(),o(f,null,[n(l,{"page-style":e.$theme.pageStyle},{default:c((()=>[n(a,{title:"发布动态","front-color":e.$theme.navColor,"background-color":e.$theme.navBgColor},null,8,["front-color","background-color"])])),_:1},8,["page-style"]),n(y,{class:"publish-page"},{default:c((()=>[u(" 内容输入 "),n(y,{class:"bg-white p-4"},{default:c((()=>[n(s,{modelValue:O.content,"onUpdate:modelValue":t[0]||(t[0]=e=>O.content=e),class:"w-full text-base leading-7",placeholder:"分享你的婚礼故事、心得体验...",maxlength:2e3,"auto-height":!0,style:{"min-height":"300rpx"}},null,8,["modelValue"]),n(y,{class:"text-right text-xs text-gray-400 mt-2"},{default:c((()=>[r(d(O.content.length)+"/2000 ",1)])),_:1})])),_:1}),u(" 媒体上传 "),n(y,{class:"bg-white mt-2 p-4"},{default:c((()=>[n(y,{class:"flex items-center mb-3"},{default:c((()=>[n(_,{class:"text-sm font-medium"},{default:c((()=>[r("添加图片/视频")])),_:1}),n(_,{class:"text-xs text-gray-400 ml-2"},{default:c((()=>[r("(图片最多9张，或1个视频)")])),_:1})])),_:1}),u(" 图片上传 "),O.video?u("v-if",!0):(i(),m(y,{key:0,class:"flex flex-wrap gap-2"},{default:c((()=>[(i(!0),o(f,null,g(O.images,((e,t)=>(i(),m(y,{key:t,class:"w-[30%] aspect-square relative"},{default:c((()=>[n(v,{src:e,class:"w-full h-full rounded",mode:"aspectFill"},null,8,["src"]),n(y,{class:"absolute -top-2 -right-2 w-6 h-6 bg-black/50 rounded-full flex items-center justify-center",onClick:e=>(e=>{O.images.splice(e,1)})(t)},{default:c((()=>[n(h,{name:"close",color:"#fff",size:"24"})])),_:2},1032,["onClick"])])),_:2},1024)))),128)),O.images.length<9?(i(),m(y,{key:0,class:"w-[30%] aspect-square bg-gray-100 rounded flex flex-col items-center justify-center",onClick:X},{default:c((()=>[n(h,{name:"plus",size:"48",color:"#999"}),n(_,{class:"text-xs text-gray-400 mt-1"},{default:c((()=>[r("添加图片")])),_:1})])),_:1})):u("v-if",!0)])),_:1})),u(" 视频上传 "),0===O.images.length?(i(),m(y,{key:1,class:"mt-3"},{default:c((()=>[O.video?(i(),m(y,{key:0,class:"relative w-full aspect-video rounded overflow-hidden"},{default:c((()=>[n(k,{src:O.video,class:"w-full h-full","object-fit":"cover"},null,8,["src"]),n(y,{class:"absolute top-2 right-2 w-8 h-8 bg-black/50 rounded-full flex items-center justify-center",onClick:Z},{default:c((()=>[n(h,{name:"close",color:"#fff",size:"32"})])),_:1})])),_:1})):(i(),m(y,{key:1,class:"w-[30%] aspect-square bg-gray-100 rounded flex flex-col items-center justify-center",onClick:Y},{default:c((()=>[n(h,{name:"play-right",size:"48",color:"#999"}),n(_,{class:"text-xs text-gray-400 mt-1"},{default:c((()=>[r("添加视频")])),_:1})])),_:1}))])),_:1})):u("v-if",!0)])),_:1}),u(" 动态类型 "),n(y,{class:"bg-white mt-2 p-4"},{default:c((()=>[n(y,{class:"text-sm font-medium mb-3"},{default:c((()=>[r("选择类型")])),_:1}),n(y,{class:"flex flex-wrap gap-3"},{default:c((()=>[(i(),o(f,null,g(I,(e=>n(y,{key:e.value,class:p(["px-4 py-2 rounded-full text-sm",O.dynamic_type===e.value?"bg-primary text-white":"bg-gray-100 text-gray-600"]),onClick:t=>O.dynamic_type=e.value},{default:c((()=>[r(d(e.label),1)])),_:2},1032,["class","onClick"]))),64))])),_:1})])),_:1}),u(" 话题标签 "),n(y,{class:"bg-white mt-2 p-4"},{default:c((()=>[n(y,{class:"flex items-center justify-between mb-3"},{default:c((()=>[n(_,{class:"text-sm font-medium"},{default:c((()=>[r("添加话题")])),_:1}),n(_,{class:"text-xs text-gray-400"},{default:c((()=>[r("最多5个")])),_:1})])),_:1}),n(y,{class:"flex flex-wrap gap-2 mb-3"},{default:c((()=>[(i(!0),o(f,null,g(O.tags,((e,t)=>(i(),m(y,{key:t,class:"flex items-center bg-primary/10 text-primary px-3 py-1 rounded-full text-sm"},{default:c((()=>[n(_,null,{default:c((()=>[r("#"+d(e),1)])),_:2},1024),n(h,{name:"close",size:"24",class:"ml-1",onClick:e=>(e=>{O.tags.splice(e,1)})(t)},null,8,["onClick"])])),_:2},1024)))),128)),O.tags.length<5?(i(),m(y,{key:0,class:"flex items-center bg-gray-100 text-gray-500 px-3 py-1 rounded-full text-sm",onClick:t[1]||(t[1]=e=>E.value=!0)},{default:c((()=>[n(h,{name:"plus",size:"24",class:"mr-1"}),n(_,null,{default:c((()=>[r("添加话题")])),_:1})])),_:1})):u("v-if",!0)])),_:1}),u(" 热门话题推荐 "),A.value.length>0?(i(),m(y,{key:0},{default:c((()=>[n(_,{class:"text-xs text-gray-400"},{default:c((()=>[r("热门话题")])),_:1}),n(y,{class:"flex flex-wrap gap-2 mt-2"},{default:c((()=>[(i(!0),o(f,null,g(A.value,(e=>(i(),m(y,{key:e.id,class:"text-xs px-2 py-1 bg-gray-50 text-gray-500 rounded",onClick:t=>{return a=e.name,void(O.tags.length>=5?b({title:"最多添加5个话题",icon:"none"}):O.tags.includes(a)?b({title:"话题已存在",icon:"none"}):O.tags.push(a));var a}},{default:c((()=>[r(" #"+d(e.name),1)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):u("v-if",!0)])),_:1}),u(" 位置 "),n(y,{class:"bg-white mt-2"},{default:c((()=>[n(y,{class:"flex items-center justify-between p-4",onClick:te},{default:c((()=>[n(y,{class:"flex items-center"},{default:c((()=>[n(h,{name:"map",size:"36",class:"mr-2 text-gray-500"}),n(_,{class:"text-sm"},{default:c((()=>[r(d(O.location||"添加位置"),1)])),_:1})])),_:1}),n(h,{name:"right",size:"28",color:"#999"})])),_:1})])),_:1}),u(" 可见范围 "),n(y,{class:"bg-white mt-2"},{default:c((()=>[n(y,{class:"flex items-center justify-between p-4",onClick:t[2]||(t[2]=e=>L.value=!0)},{default:c((()=>[n(y,{class:"flex items-center"},{default:c((()=>[n(h,{name:"eye",size:"36",class:"mr-2 text-gray-500"}),n(_,{class:"text-sm"},{default:c((()=>[r("谁可以看")])),_:1})])),_:1}),n(y,{class:"flex items-center text-gray-400"},{default:c((()=>[n(_,{class:"text-sm mr-1"},{default:c((()=>[r(d(R()),1)])),_:1}),n(h,{name:"right",size:"28"})])),_:1})])),_:1})])),_:1}),u(" 底部按钮 "),n(y,{class:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 p-4",style:{"padding-bottom":"calc(16rpx + env(safe-area-inset-bottom))"}},{default:c((()=>[n(w,{class:p(["w-full py-3 bg-primary text-white text-base font-medium rounded-full",{"opacity-50":!x(Q)||N.value}]),disabled:!x(Q)||N.value,onClick:le},{default:c((()=>[r(d(N.value?"发布中...":"发布"),1)])),_:1},8,["disabled","class"])])),_:1}),u(" 添加话题弹窗 "),n(G,{modelValue:E.value,"onUpdate:modelValue":t[5]||(t[5]=e=>E.value=e),mode:"bottom","safe-area-inset-bottom":!0},{default:c((()=>[n(y,{class:"p-4"},{default:c((()=>[n(y,{class:"text-center font-medium mb-4"},{default:c((()=>[r("添加话题")])),_:1}),n(y,{class:"flex items-center bg-gray-100 rounded-lg px-3"},{default:c((()=>[n(_,{class:"text-primary text-lg"},{default:c((()=>[r("#")])),_:1}),n(j,{modelValue:K.value,"onUpdate:modelValue":t[3]||(t[3]=e=>K.value=e),class:"flex-1 py-3 px-2 text-sm",placeholder:"输入话题名称",maxlength:20,onConfirm:ee},null,8,["modelValue"])])),_:1}),n(y,{class:"flex gap-3 mt-4"},{default:c((()=>[n(w,{class:"flex-1 py-2 bg-gray-100 text-gray-600 rounded-lg",onClick:t[4]||(t[4]=e=>E.value=!1)},{default:c((()=>[r(" 取消 ")])),_:1}),n(w,{class:"flex-1 py-2 bg-primary text-white rounded-lg",onClick:ee},{default:c((()=>[r(" 确定 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),u(" 可见范围选择器 "),n(H,{modelValue:L.value,"onUpdate:modelValue":t[6]||(t[6]=e=>L.value=e),data:M,onClick:ae},null,8,["modelValue"])])),_:1})],64)}}}),[["__scopeId","data-v-ee7fc033"]]);export{M as default};
