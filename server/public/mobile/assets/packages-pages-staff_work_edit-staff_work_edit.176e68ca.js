import{d as e,s as t,M as l,c as s,O as a,o,h as r,e as i,w as n,f as d,j as c,b as u,F as m,i as p,g as f,t as x,au as g,aV as h,af as _,aW as b,aD as v,ag as y,b3 as w,aq as j,r as k,a as V,m as C,G as z,a$ as T,b0 as F,bN as U}from"./index-e3492752.js";import{_ as P}from"./navigation-bar.2687311c.js";import{_ as $}from"./page-meta.a4be6114.js";import{_ as D}from"./input.1776ceae.js";import{_ as N}from"./button.c1dc664f.js";import{_ as S}from"./icon.e613abcd.js";import{_ as A}from"./u-switch.863c6ebe.js";import{e as G,d as q,f as B,g as H}from"./staff-center.563e3f5c.js";import"./_plugin-vue_export-helper.1b428a4d.js";import"./index.f1be293a.js";import"./is-number.7ef6fec2.js";import"./_objectToString.c905654b.js";import"./event.5568c9d8.js";import"./index.23c2867d.js";import"./install.8446dea8.js";import"./is-empty.c0d66e4a.js";import"./is-boolean.00bf65dc.js";import"./index.89b6df5d.js";import"./index.04c93aab.js";import"./debounce.096fb07a.js";import"./clone-deep.2124c060.js";import"./loading.2b80eb94.js";const I=e({__name:"staff_work_edit",setup(e){const I=t(!1),M=l({id:0,title:"",cover:"",images:[],video:"",description:"",shoot_date:"",location:"",sort:"",is_show:1}),O=s((()=>M.id>0)),R=s((()=>O.value?"编辑作品":"新增作品")),W=s({get:()=>1===M.is_show,set:e=>{M.is_show=e?1:0}}),E=()=>{h({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:async e=>{_({title:"上传中..."});try{const t=await b(e.tempFilePaths[0]);(null==t?void 0:t.url)&&(M.cover=t.url)}catch(t){v({title:(null==t?void 0:t.message)||"上传失败",icon:"none"})}finally{y()}}})},J=()=>{const e=9-M.images.length;h({count:e,sizeType:["compressed"],sourceType:["album","camera"],success:async e=>{_({title:"上传中..."});try{for(const t of e.tempFilePaths){const e=await b(t);(null==e?void 0:e.url)&&M.images.push(e.url)}}catch(t){v({title:(null==t?void 0:t.message)||"上传失败",icon:"none"})}finally{y()}}})},K=()=>{w({sourceType:["album","camera"],maxDuration:60,compressed:!0,success:async e=>{_({title:"上传中..."});try{const t=await b(e.tempFilePath);(null==t?void 0:t.url)&&(M.video=t.url)}catch(t){v({title:(null==t?void 0:t.message)||"上传失败",icon:"none"})}finally{y()}}})},L=()=>{M.video=""},Q=e=>{M.shoot_date=e.detail.value},X=async()=>{if(!M.title.trim())return void v({title:"请输入作品标题",icon:"none"});if(!M.cover)return void v({title:"请上传封面图",icon:"none"});const e={title:M.title.trim(),cover:M.cover,images:M.images,video:M.video,description:M.description,shoot_date:M.shoot_date,location:M.location,sort:""===M.sort?0:Number(M.sort),is_show:M.is_show};I.value=!0;try{O.value?(await B({...e,id:M.id}),v({title:"保存成功",icon:"success"})):(await H(e),v({title:"提交成功",icon:"success"})),setTimeout((()=>j()),1200)}catch(t){const e="string"==typeof t?t:(null==t?void 0:t.msg)||(null==t?void 0:t.message)||"提交失败";v({title:e,icon:"none"})}finally{I.value=!1}};return a((async e=>{if(!(await G()))return;const t=Number((null==e?void 0:e.id)||0);t>0&&await(async e=>{const t=await q({id:e});M.id=t.id,M.title=t.title||"",M.cover=t.cover||"",M.images=Array.isArray(t.images)?t.images:[],M.video=t.video||"",M.description=t.description||"",M.shoot_date=t.shoot_date||"",M.location=t.location||"",M.sort=void 0!==t.sort&&null!==t.sort?String(t.sort):"",M.is_show=t.is_show?1:0})(t)})),(e,t)=>{const l=k(V("navigation-bar"),P),s=k(V("page-meta"),$),a=C,h=k(V("tn-input"),D),_=z,b=k(V("tn-button"),N),v=k(V("tn-icon"),S),y=T,w=F,j=U,G=k(V("u-switch"),A);return o(),r(m,null,[i(s,{"page-style":e.$theme.pageStyle},{default:n((()=>[i(l,{title:d(R),"front-color":e.$theme.navColor,"background-color":e.$theme.navBgColor},null,8,["title","front-color","background-color"])])),_:1},8,["page-style"]),i(a,{class:"min-h-screen bg-[#f6f6f6] pb-[40rpx]"},{default:n((()=>[i(a,{class:"bg-white mx-[24rpx] mt-[24rpx] rounded-lg p-[24rpx]"},{default:n((()=>[i(a,{class:"text-sm font-medium mb-[16rpx]"},{default:n((()=>[c("作品标题")])),_:1}),i(h,{modelValue:M.title,"onUpdate:modelValue":t[0]||(t[0]=e=>M.title=e),placeholder:"请输入作品标题"},null,8,["modelValue"])])),_:1}),i(a,{class:"bg-white mx-[24rpx] mt-[20rpx] rounded-lg p-[24rpx]"},{default:n((()=>[i(a,{class:"text-sm font-medium mb-[16rpx]"},{default:n((()=>[c("封面图")])),_:1}),i(a,{class:"flex items-center"},{default:n((()=>[i(a,{class:"w-[160rpx] h-[160rpx] rounded-lg bg-[#f2f2f2] overflow-hidden"},{default:n((()=>[M.cover?(o(),u(_,{key:0,src:M.cover,class:"w-full h-full",mode:"aspectFill"},null,8,["src"])):(o(),u(a,{key:1,class:"w-full h-full flex items-center justify-center text-gray-400"},{default:n((()=>[c("暂无封面")])),_:1}))])),_:1}),i(b,{class:"ml-[20rpx]",type:"primary",size:"sm",shape:"round",plain:!0,onClick:E},{default:n((()=>[c(" 选择封面 ")])),_:1})])),_:1})])),_:1}),i(a,{class:"bg-white mx-[24rpx] mt-[20rpx] rounded-lg p-[24rpx]"},{default:n((()=>[i(a,{class:"text-sm font-medium mb-[16rpx]"},{default:n((()=>[c("作品图片")])),_:1}),i(a,{class:"flex flex-wrap gap-[16rpx]"},{default:n((()=>[(o(!0),r(m,null,p(M.images,((e,t)=>(o(),u(a,{key:t,class:"w-[200rpx] h-[200rpx] relative"},{default:n((()=>[i(_,{src:e,class:"w-full h-full rounded-lg",mode:"aspectFill"},null,8,["src"]),i(a,{class:"absolute -top-[10rpx] -right-[10rpx] w-[40rpx] h-[40rpx] bg-black/50 rounded-full flex items-center justify-center",onClick:e=>{return l=t,void M.images.splice(l,1);var l}},{default:n((()=>[i(v,{name:"close",size:"24",color:"#fff"})])),_:2},1032,["onClick"])])),_:2},1024)))),128)),M.images.length<9?(o(),u(a,{key:0,class:"w-[200rpx] h-[200rpx] rounded-lg bg-[#f4f4f4] flex items-center justify-center",onClick:J},{default:n((()=>[i(v,{name:"plus",size:"40",color:"#999"})])),_:1})):f("v-if",!0)])),_:1})])),_:1}),i(a,{class:"bg-white mx-[24rpx] mt-[20rpx] rounded-lg p-[24rpx]"},{default:n((()=>[i(a,{class:"text-sm font-medium mb-[16rpx]"},{default:n((()=>[c("作品视频")])),_:1}),M.video?(o(),u(a,{key:0,class:"relative w-full aspect-video rounded-lg overflow-hidden"},{default:n((()=>[i(y,{src:M.video,class:"w-full h-full","object-fit":"cover"},null,8,["src"]),i(a,{class:"absolute top-[12rpx] right-[12rpx] w-[48rpx] h-[48rpx] bg-black/50 rounded-full flex items-center justify-center",onClick:L},{default:n((()=>[i(v,{name:"close",size:"28",color:"#fff"})])),_:1})])),_:1})):(o(),u(b,{key:1,type:"primary",size:"sm",shape:"round",plain:!0,onClick:K},{default:n((()=>[c(" 上传视频 ")])),_:1}))])),_:1}),i(a,{class:"bg-white mx-[24rpx] mt-[20rpx] rounded-lg p-[24rpx]"},{default:n((()=>[i(a,{class:"text-sm font-medium mb-[16rpx]"},{default:n((()=>[c("作品说明")])),_:1}),i(w,{modelValue:M.description,"onUpdate:modelValue":t[1]||(t[1]=e=>M.description=e),class:"w-full text-sm leading-6 text-[#333] bg-[#fafafa] rounded-lg p-[20rpx]",placeholder:"请描述作品亮点",maxlength:500},null,8,["modelValue"])])),_:1}),i(a,{class:"bg-white mx-[24rpx] mt-[20rpx] rounded-lg"},{default:n((()=>[i(a,{class:"flex items-center justify-between px-[24rpx] py-[26rpx] border-b border-solid border-0 border-light"},{default:n((()=>[i(a,{class:"text-sm text-[#333]"},{default:n((()=>[c("拍摄日期")])),_:1}),i(j,{mode:"date",value:M.shoot_date,onChange:Q},{default:n((()=>[i(a,{class:"text-sm text-gray-500"},{default:n((()=>[c(x(M.shoot_date||"请选择日期"),1)])),_:1})])),_:1},8,["value"])])),_:1}),i(a,{class:"flex items-center justify-between px-[24rpx] py-[26rpx] border-b border-solid border-0 border-light"},{default:n((()=>[i(a,{class:"text-sm text-[#333]"},{default:n((()=>[c("拍摄地点")])),_:1}),i(h,{modelValue:M.location,"onUpdate:modelValue":t[2]||(t[2]=e=>M.location=e),placeholder:"请输入地点",class:"text-right"},null,8,["modelValue"])])),_:1}),i(a,{class:"flex items-center justify-between px-[24rpx] py-[26rpx] border-b border-solid border-0 border-light"},{default:n((()=>[i(a,{class:"text-sm text-[#333]"},{default:n((()=>[c("排序值")])),_:1}),i(h,{modelValue:M.sort,"onUpdate:modelValue":t[3]||(t[3]=e=>M.sort=e),type:"number",placeholder:"数值越大越靠前",class:"text-right"},null,8,["modelValue"])])),_:1}),i(a,{class:"flex items-center justify-between px-[24rpx] py-[26rpx]"},{default:n((()=>[i(a,{class:"text-sm text-[#333]"},{default:n((()=>[c("是否展示")])),_:1}),i(G,{modelValue:d(W),"onUpdate:modelValue":t[4]||(t[4]=e=>g(W)?W.value=e:null),"active-color":"#16a34a","inactive-color":"#e5e7eb"},null,8,["modelValue"])])),_:1})])),_:1}),i(a,{class:"mx-[24rpx] mt-[30rpx]"},{default:n((()=>[i(b,{type:"primary",shape:"round",size:"lg",loading:I.value,onClick:X},{default:n((()=>[c(x(d(O)?"保存修改":"提交审核"),1)])),_:1},8,["loading"])])),_:1})])),_:1})],64)}}});export{I as default};
