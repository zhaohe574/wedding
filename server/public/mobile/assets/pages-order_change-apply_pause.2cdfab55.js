import{d as e,s as a,M as t,c as s,O as l,o,h as d,e as r,w as i,g as c,j as n,b as u,t as _,F as f,i as p,f as m,aP as g,aq as y,aD as v,aV as h,b5 as x,r as b,a as k,a_ as w,l as C,m as V,G as j,b0 as z,aJ as T,y as D}from"./index-e3492752.js";import{_ as F}from"./navigation-bar.2687311c.js";import{_ as U}from"./page-meta.a4be6114.js";import{h as $,k as q}from"./orderChange.66dcaaa9.js";import{e as S}from"./order.1e435880.js";import{_ as I}from"./_plugin-vue_export-helper.1b428a4d.js";const M=I(e({__name:"apply_pause",setup(e){const I=a(0),M=a(null),O=a(!1),P=a(!1),B=a(!1),G=(new Date).toISOString().split("T")[0],J=[{value:1,label:"疫情原因",icon:"medal"},{value:2,label:"突发事件",icon:"notification"},{value:3,label:"个人原因",icon:"person"},{value:4,label:"其他原因",icon:"more"}],N=t({pause_type:3,start_date:"",end_date:"",reason:"",proof_images:[]}),Y=s((()=>{if(!N.start_date||!N.end_date)return 0;const e=new Date(N.start_date),a=new Date(N.end_date),t=Math.ceil((a.getTime()-e.getTime())/864e5)+1;return t>0?t:0})),A=e=>{N.start_date=e,N.end_date&&N.end_date<N.start_date&&(N.end_date="")},E=e=>{N.end_date=e},H=()=>{h({count:10-N.proof_images.length,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{N.proof_images.push(...e.tempFilePaths)}})},K=async()=>{if(N.start_date)if(N.end_date)if(N.reason.trim())if(N.reason.length<10)v({title:"暂停原因至少10个字",icon:"none"});else{O.value=!0;try{const e=await q({order_id:I.value,pause_type:N.pause_type,reason:N.reason,start_date:N.start_date,end_date:N.end_date,proof_images:N.proof_images});v({title:"申请已提交"}),setTimeout((()=>{x({url:`/pages/order_change/pause_detail?id=${e.pause_id}`})}),1500)}catch(e){v({title:e.message||"提交失败",icon:"none"})}finally{O.value=!1}}else v({title:"请填写暂停原因",icon:"none"});else v({title:"请选择结束日期",icon:"none"});else v({title:"请选择开始日期",icon:"none"})};return l((e=>{e.order_id&&(I.value=Number(e.order_id),(async()=>{try{const e=await S({id:I.value});M.value=e}catch(e){console.error(e)}})(),(async()=>{try{const e=await $({order_id:I.value});e.can_change||g({title:"提示",content:e.message,showCancel:!1,success:()=>{y()}})}catch(e){v({title:e.message||"检查失败",icon:"none"})}})())})),(e,a)=>{const t=b(k("navigation-bar"),F),s=b(k("page-meta"),U),l=w("uni-icons"),g=C,y=V,v=j,h=z,x=T,$=w("uni-datetime-picker");return o(),d(f,null,[r(s,{"page-style":e.$theme.pageStyle},{default:i((()=>[r(t,{title:"申请暂停","front-color":e.$theme.navColor,"background-color":e.$theme.navBgColor},null,8,["front-color","background-color"])])),_:1},8,["page-style"]),r(y,{class:"apply-page"},{default:i((()=>[c(" 提示信息 "),r(y,{class:"tip-card"},{default:i((()=>[r(l,{type:"info-filled",size:"18",color:"#ff9500"}),r(g,{class:"tip-text"},{default:i((()=>[n("暂停期间订单将处于冻结状态，暂停到期后需主动申请恢复或重新选择服务日期。")])),_:1})])),_:1}),c(" 订单信息 "),M.value?(o(),u(y,{key:0,class:"bg-white mt-3 p-4"},{default:i((()=>[r(y,{class:"section-title"},{default:i((()=>[n("暂停订单")])),_:1}),r(y,{class:"order-card"},{default:i((()=>[r(y,{class:"text-sm text-gray-500"},{default:i((()=>[n("订单号: "+_(M.value.order_sn),1)])),_:1}),M.value.items&&M.value.items.length>0?(o(),u(y,{key:0,class:"flex items-center mt-2"},{default:i((()=>{var e;return[r(v,{src:(null==(e=M.value.items[0].staff)?void 0:e.avatar)||"/static/images/default-avatar.png",class:"w-12 h-12 rounded-lg mr-3",mode:"aspectFill"},null,8,["src"]),r(y,{class:"flex-1"},{default:i((()=>[r(y,{class:"text-sm font-medium"},{default:i((()=>[n(_(M.value.items[0].staff_name),1)])),_:1}),r(y,{class:"text-xs text-gray-400"},{default:i((()=>[n(_(M.value.items[0].package_name),1)])),_:1})])),_:1}),r(y,{class:"text-right"},{default:i((()=>[r(y,{class:"text-primary font-bold"},{default:i((()=>[n("¥"+_(M.value.pay_amount),1)])),_:1}),r(y,{class:"text-xs text-gray-400"},{default:i((()=>[n(_(M.value.service_date),1)])),_:1})])),_:1})]})),_:1})):c("v-if",!0)])),_:1})])),_:1})):c("v-if",!0),c(" 暂停类型 "),r(y,{class:"bg-white mt-3 p-4"},{default:i((()=>[r(y,{class:"section-title"},{default:i((()=>[n("暂停原因类型")])),_:1}),r(y,{class:"type-options"},{default:i((()=>[(o(),d(f,null,p(J,(e=>r(y,{key:e.value,class:D(["type-option",{active:N.pause_type===e.value}]),onClick:a=>N.pause_type=e.value},{default:i((()=>[r(l,{type:e.icon,size:"24",color:N.pause_type===e.value?"#ff6b35":"#999"},null,8,["type","color"]),r(g,{class:"type-label"},{default:i((()=>[n(_(e.label),1)])),_:2},1024)])),_:2},1032,["class","onClick"]))),64))])),_:1})])),_:1}),c(" 暂停时间 "),r(y,{class:"bg-white mt-3 p-4"},{default:i((()=>[r(y,{class:"section-title"},{default:i((()=>[n("暂停时间")])),_:1}),r(y,{class:"form-item",onClick:a[0]||(a[0]=e=>P.value=!0)},{default:i((()=>[r(g,{class:"label required"},{default:i((()=>[n("开始日期")])),_:1}),r(y,{class:"value-area"},{default:i((()=>[N.start_date?(o(),u(g,{key:0,class:"text-primary"},{default:i((()=>[n(_(N.start_date),1)])),_:1})):(o(),u(g,{key:1,class:"placeholder"},{default:i((()=>[n("请选择开始日期")])),_:1})),r(l,{type:"right",size:"16",color:"#999"})])),_:1})])),_:1}),r(y,{class:"form-item",onClick:a[1]||(a[1]=e=>B.value=!0)},{default:i((()=>[r(g,{class:"label required"},{default:i((()=>[n("结束日期")])),_:1}),r(y,{class:"value-area"},{default:i((()=>[N.end_date?(o(),u(g,{key:0,class:"text-primary"},{default:i((()=>[n(_(N.end_date),1)])),_:1})):(o(),u(g,{key:1,class:"placeholder"},{default:i((()=>[n("请选择结束日期")])),_:1})),r(l,{type:"right",size:"16",color:"#999"})])),_:1})])),_:1}),m(Y)>0?(o(),u(y,{key:0,class:"pause-days"},{default:i((()=>[r(g,{class:"text-gray-500"},{default:i((()=>[n("暂停天数: ")])),_:1}),r(g,{class:"text-primary font-bold"},{default:i((()=>[n(_(m(Y))+"天",1)])),_:1})])),_:1})):c("v-if",!0)])),_:1}),c(" 暂停原因 "),r(y,{class:"bg-white mt-3 p-4"},{default:i((()=>[r(y,{class:"section-title"},{default:i((()=>[n("详细说明")])),_:1}),r(h,{modelValue:N.reason,"onUpdate:modelValue":a[2]||(a[2]=e=>N.reason=e),class:"reason-input",placeholder:"请详细说明暂停原因（必填）",maxlength:"500"},null,8,["modelValue"]),r(y,{class:"text-right text-xs text-gray-400"},{default:i((()=>[n(_(N.reason.length)+"/500",1)])),_:1})])),_:1}),c(" 证明材料 "),r(y,{class:"bg-white mt-3 p-4"},{default:i((()=>[r(y,{class:"section-title"},{default:i((()=>[n("证明材料（选填）")])),_:1}),r(y,{class:"text-xs text-gray-400 mb-3"},{default:i((()=>[n("如有相关证明材料，请上传以加快审核")])),_:1}),r(y,{class:"image-uploader"},{default:i((()=>[(o(!0),d(f,null,p(N.proof_images,((e,a)=>(o(),u(y,{key:a,class:"image-item"},{default:i((()=>[r(v,{src:e,class:"upload-image",mode:"aspectFill"},null,8,["src"]),r(y,{class:"delete-btn",onClick:e=>(e=>{N.proof_images.splice(e,1)})(a)},{default:i((()=>[r(l,{type:"close",size:"14",color:"#fff"})])),_:2},1032,["onClick"])])),_:2},1024)))),128)),N.proof_images.length<10?(o(),u(y,{key:0,class:"add-image",onClick:H},{default:i((()=>[r(l,{type:"plusempty",size:"40",color:"#ccc"}),r(g,{class:"text-xs text-gray-400 mt-1"},{default:i((()=>[n("上传图片")])),_:1})])),_:1})):c("v-if",!0)])),_:1}),r(y,{class:"text-xs text-gray-400 mt-2"},{default:i((()=>[n("最多上传10张图片")])),_:1})])),_:1}),c(" 提交按钮 "),r(y,{class:"bottom-actions"},{default:i((()=>[r(x,{class:"btn-submit",disabled:O.value,onClick:K},{default:i((()=>[n(_(O.value?"提交中...":"提交暂停申请"),1)])),_:1},8,["disabled"])])),_:1}),c(" 日期选择器 "),r($,{type:"date",modelValue:N.start_date,"onUpdate:modelValue":a[3]||(a[3]=e=>N.start_date=e),start:m(G),onChange:A},null,8,["modelValue","start"]),r($,{type:"date",modelValue:N.end_date,"onUpdate:modelValue":a[4]||(a[4]=e=>N.end_date=e),start:N.start_date||m(G),onChange:E},null,8,["modelValue","start"])])),_:1})],64)}}}),[["__scopeId","data-v-2aca4ce5"]]);export{M as default};
