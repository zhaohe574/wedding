import{d as e,u as a,s as l,o as s,h as t,e as o,f as r,w as i,g as u,n,j as c,y as d,b as p,t as m,F as f,i as _,aD as y,k as v,r as g,a as h,m as F,l as b}from"./index-e3492752.js";import{_ as j}from"./page-meta.a4be6114.js";import{_ as k}from"./icon.e613abcd.js";import{_ as C}from"./input.1776ceae.js";import{_ as z}from"./popup.b8b85cf1.js";import{m as x,n as V}from"./cart.c9c79b39.js";import{_ as w}from"./_plugin-vue_export-helper.1b428a4d.js";import"./index.f1be293a.js";import"./is-number.7ef6fec2.js";import"./_objectToString.c905654b.js";import"./event.5568c9d8.js";import"./index.23c2867d.js";import"./install.8446dea8.js";import"./is-empty.c0d66e4a.js";import"./is-boolean.00bf65dc.js";import"./index.89b6df5d.js";import"./index.04c93aab.js";import"./debounce.096fb07a.js";import"./clone-deep.2124c060.js";import"./z-index.5f93cfb9.js";const $=w(e({__name:"share_plan",setup(e){const w=a(),$=e=>({"primary-light-9":"#F3E8FF","primary-light-7":"#D8B4FE"}[e]||"#F5F5F5"),A=l(""),D=l(!1),E=l(!1),I=l(!1),S=l(null),T=async()=>{if(A.value.trim()){if(!D.value){D.value=!0;try{const e=await x({share_code:A.value.trim()}),a=(Array.isArray(null==e?void 0:e.cart_items)?e.cart_items:Array.isArray(null==e?void 0:e.items)?e.items:[]).map((e=>{var a;return{...e,staff_name:e.staff_name||(null==(a=e.staff)?void 0:a.name)||"",date:e.date||e.schedule_date||""}}));S.value={...e,items:a},I.value=!0}catch(e){const a="string"==typeof e?e:e.msg||e.message||"分享码无效或已过期";y({title:a,icon:"none"})}finally{D.value=!1}}}else y({title:"请输入分享码",icon:"none"})},U=async()=>{if(!E.value){E.value=!0;try{const e=await V({share_code:A.value.trim()});y({title:`已复制${e.copied_count||0}项到购物车`,icon:"success"}),I.value=!1,setTimeout((()=>{v({url:"/packages/pages/cart/cart"})}),1500)}catch(e){const a="string"==typeof e?e:e.msg||e.message||"复制失败";y({title:a,icon:"none"})}finally{E.value=!1}}};return(e,a)=>{const l=g(h("page-meta"),j),y=g(h("tn-icon"),k),v=F,x=b,V=g(h("tn-input"),C),B=g(h("tn-popup"),z);return s(),t(f,null,[o(l,{"page-style":r(w).pageStyle},null,8,["page-style"]),o(v,{class:"share-plan-page"},{default:i((()=>[o(v,{class:"container"},{default:i((()=>[u(" 顶部图标 "),o(v,{class:"header-icon"},{default:i((()=>[o(v,{class:"icon-wrapper",style:n({backgroundColor:$("primary-light-9")})},{default:i((()=>[o(y,{name:"share",size:"96",color:r(w).primaryColor},null,8,["color"])])),_:1},8,["style"])])),_:1}),u(" 标题说明 "),o(v,{class:"header"},{default:i((()=>[o(x,{class:"title"},{default:i((()=>[c("输入分享码")])),_:1}),o(x,{class:"desc"},{default:i((()=>[c("输入好友分享的方案码，查看并复制方案到购物车")])),_:1})])),_:1}),u(" 输入区域 "),o(v,{class:"input-section"},{default:i((()=>[o(v,{class:"input-wrapper"},{default:i((()=>[o(v,{class:"input-icon"},{default:i((()=>[o(y,{name:"key",size:"40",color:r(w).primaryColor},null,8,["color"])])),_:1}),o(V,{modelValue:A.value,"onUpdate:modelValue":a[0]||(a[0]=e=>A.value=e),placeholder:"请输入16位分享码",border:!1,clearable:!0,maxlength:"32",height:"88",onConfirm:T},null,8,["modelValue"])])),_:1}),o(v,{class:"input-tip"},{default:i((()=>[o(y,{name:"info-circle",size:"28",color:"#999999"}),o(x,null,{default:i((()=>[c('分享码由好友在"我的方案"中生成')])),_:1})])),_:1})])),_:1}),u(" 提交按钮 "),o(v,{class:"submit-section"},{default:i((()=>[o(v,{class:d(["submit-btn",{disabled:!A.value.trim()||D.value}]),style:n(!A.value.trim()||D.value?{}:{background:`linear-gradient(135deg, ${r(w).primaryColor} 0%, ${r(w).primaryColor} 100%)`}),onClick:T},{default:i((()=>[D.value?(s(),p(y,{key:0,name:"loading",size:"32",color:"#FFFFFF"})):(s(),p(y,{key:1,name:"search",size:"32",color:"#FFFFFF"})),o(x,null,{default:i((()=>[c(m(D.value?"查询中...":"查看方案"),1)])),_:1})])),_:1},8,["class","style"])])),_:1})])),_:1}),u(" 方案详情弹窗 "),o(B,{modelValue:I.value,"onUpdate:modelValue":a[3]||(a[3]=e=>I.value=e),mode:"center","border-radius":32,"mask-close-able":!1},{default:i((()=>[o(v,{class:"plan-detail-popup"},{default:i((()=>[u(" 弹窗头部 "),o(v,{class:"popup-header",style:n({backgroundColor:$("primary-light-9")})},{default:i((()=>[o(v,{class:"header-content"},{default:i((()=>[o(v,{class:"header-icon"},{default:i((()=>[o(y,{name:"folder-open",size:"56",color:r(w).primaryColor},null,8,["color"])])),_:1}),o(v,{class:"header-text"},{default:i((()=>[o(x,{class:"popup-title"},{default:i((()=>{var e;return[c(m(null==(e=S.value)?void 0:e.plan_name),1)]})),_:1}),o(v,{class:"popup-meta"},{default:i((()=>[o(y,{name:"time",size:"24",color:"#999999"}),o(x,null,{default:i((()=>{var e,a;return[c(m((null==(a=null==(e=S.value)?void 0:e.items)?void 0:a.length)||0)+" 项服务",1)]})),_:1})])),_:1})])),_:1})])),_:1}),o(v,{class:"popup-close",onClick:a[1]||(a[1]=e=>I.value=!1)},{default:i((()=>[o(y,{name:"close",size:"32",color:"#999999"})])),_:1})])),_:1},8,["style"]),u(" 弹窗内容 "),o(v,{class:"popup-content"},{default:i((()=>{var e,a;return[u(" 价格区域 "),o(v,{class:"price-section"},{default:i((()=>[o(x,{class:"price-label"},{default:i((()=>[c("方案总价")])),_:1}),o(v,{class:"price-amount"},{default:i((()=>[o(x,{class:"price-symbol",style:n({color:r(w).ctaColor})},{default:i((()=>[c("¥")])),_:1},8,["style"]),o(x,{class:"price-value",style:n({color:r(w).ctaColor})},{default:i((()=>{var e;return[c(m((null==(e=S.value)?void 0:e.total_price)||0),1)]})),_:1},8,["style"])])),_:1})])),_:1}),u(" 服务项列表 "),(null==(a=null==(e=S.value)?void 0:e.items)?void 0:a.length)?(s(),p(v,{key:0,class:"items-list"},{default:i((()=>[o(v,{class:"list-header"},{default:i((()=>[o(x,{class:"list-title"},{default:i((()=>[c("包含服务")])),_:1}),o(x,{class:"list-count"},{default:i((()=>[c(m(S.value.items.length)+"项",1)])),_:1})])),_:1}),(s(!0),t(f,null,_(S.value.items,((e,a)=>(s(),p(v,{class:"item-card",key:a},{default:i((()=>[o(v,{class:"item-left"},{default:i((()=>[o(v,{class:"item-index",style:n({backgroundColor:$("primary-light-9")})},{default:i((()=>[o(x,{style:n({color:r(w).primaryColor})},{default:i((()=>[c(m(a+1),1)])),_:2},1032,["style"])])),_:2},1032,["style"]),o(v,{class:"item-info"},{default:i((()=>[o(x,{class:"item-name"},{default:i((()=>[c(m(e.staff_name),1)])),_:2},1024),o(v,{class:"item-date"},{default:i((()=>[o(y,{name:"calendar",size:"24",color:"#999999"}),o(x,null,{default:i((()=>[c(m(e.date),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),o(v,{class:"item-price",style:n({color:r(w).ctaColor})},{default:i((()=>[o(x,null,{default:i((()=>[c("¥"+m(e.price),1)])),_:2},1024)])),_:2},1032,["style"])])),_:2},1024)))),128))])),_:1})):u("v-if",!0)]})),_:1}),u(" 弹窗操作 "),o(v,{class:"popup-actions"},{default:i((()=>[o(v,{class:"action-btn secondary",onClick:a[2]||(a[2]=e=>I.value=!1)},{default:i((()=>[o(y,{name:"close",size:"32",color:"#666666"}),o(x,null,{default:i((()=>[c("取消")])),_:1})])),_:1}),o(v,{class:"action-btn primary",style:n({background:`linear-gradient(135deg, ${r(w).primaryColor} 0%, ${r(w).primaryColor} 100%)`}),onClick:U},{default:i((()=>[E.value?(s(),p(y,{key:0,name:"loading",size:"32",color:"#FFFFFF"})):(s(),p(y,{key:1,name:"shopping-cart",size:"32",color:"#FFFFFF"})),o(x,null,{default:i((()=>[c(m(E.value?"复制中...":"复制到购物车"),1)])),_:1})])),_:1},8,["style"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})],64)}}}),[["__scopeId","data-v-c4ef8a39"]]);export{$ as default};
