import{D as Q,B as X,J as Y,K as Z,i as ee,H as te,d as le,L as ae,M as se,N as ne,O as oe,C as ie,R as re}from"./element-plus-ChK2e5qA.js";import{_ as de}from"./index.vue_vue_type_script_setup_true_lang-CCtv5BMP.js";import{S as me}from"./@element-plus-C4Lf8veM.js";import{q as ue,r as _e,t as pe,u as ce,v as ge,w as fe}from"./crm-B_G7fTMr.js";import{u as ve}from"./usePaging-B2jDzebD.js";import{f as C}from"./index-D465kfFn.js";import{d as $,a0 as L,r as V,l as be,c as v,o as f,U as e,a as n,L as l,u as s,R as m,S as d,M as we,K as ye,O as xe,T as ke,i as U}from"./@vue-ygbFPFRc.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-DRRUpF4H.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DDSL_IW4.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";const he={class:"warning-lists"},Ce={class:"mt-4 grid grid-cols-4 gap-4"},Ve={class:"text-center"},Ee={class:"text-2xl font-bold mt-2 text-orange-500"},Se={class:"text-center"},Te={class:"text-2xl font-bold mt-2 text-red-500"},Be={class:"text-center"},Pe={class:"text-2xl font-bold mt-2 text-yellow-500"},Le={class:"text-center"},Ue={class:"text-2xl font-bold mt-2 text-green-500"},$e={class:"flex justify-between mb-4"},Ie={key:0},We={class:"font-medium"},Fe={class:"text-gray-400 text-xs"},De={key:1,class:"text-gray-400"},Ne={key:0},Re={key:1,class:"text-gray-400"},ze={key:1,class:"text-gray-400 text-sm"},Me={class:"flex justify-end mt-4"},Oe=$({name:"warningLists"}),Ct=$({...Oe,setup(je){const p=L({warning_type:"",warning_level:"",warning_status:""}),w=V({}),k=V([]),c=V(!1),g=V("handle"),o=L({id:0,warning_ids:[],remark:""}),{pager:y,getLists:h,resetPage:I,resetParams:W}=ve({fetchFun:ue,params:p}),F=i=>({1:"info",2:"warning",3:"danger"})[i]||"info",D=i=>({0:"warning",1:"success",2:"info"})[i]||"info",E=async()=>{w.value=await _e()},N=i=>{k.value=i.map(t=>t.id)},R=async()=>{await C.confirm("确定要生成流失预警吗？");const i=await pe();C.msgSuccess(i.msg||"预警生成成功"),h(),E()},z=i=>{g.value="handle",o.id=i.id,o.warning_ids=[],o.remark="",c.value=!0},M=i=>{g.value="ignore",o.id=i.id,o.warning_ids=[],o.remark="",c.value=!0},T=i=>{g.value=i,o.id=0,o.warning_ids=k.value,o.remark="",c.value=!0},O=async()=>{if(o.id)g.value==="handle"?await ce({id:o.id,remark:o.remark}):await ge({id:o.id,remark:o.remark}),C.msgSuccess("操作成功");else{const i=await fe({warning_ids:o.warning_ids,action:g.value,remark:o.remark});C.msgSuccess(`成功处理 ${i.success} 条预警`)}c.value=!1,h(),E()};return be(()=>{E()}),h(),(i,t)=>{const r=Z,S=Y,x=X,_=ee,B=Q,b=te,j=le,u=se,P=ne,q=ae,G=de,H=ie,K=re,A=oe;return f(),v("div",he,[e(b,{class:"!border-none",shadow:"never"},{default:l(()=>[e(B,{ref:"formRef",class:"mb-[-16px]",model:s(p),inline:!0},{default:l(()=>[e(x,{class:"w-[120px]",label:"预警类型"},{default:l(()=>[e(S,{modelValue:s(p).warning_type,"onUpdate:modelValue":t[0]||(t[0]=a=>s(p).warning_type=a),placeholder:"选择",clearable:""},{default:l(()=>[e(r,{label:"全部",value:""}),e(r,{label:"长期未跟进",value:1}),e(r,{label:"意向下降",value:2}),e(r,{label:"竞品流失",value:3}),e(r,{label:"预算不足",value:4}),e(r,{label:"其他",value:5})]),_:1},8,["modelValue"])]),_:1}),e(x,{class:"w-[120px]",label:"预警等级"},{default:l(()=>[e(S,{modelValue:s(p).warning_level,"onUpdate:modelValue":t[1]||(t[1]=a=>s(p).warning_level=a),placeholder:"选择",clearable:""},{default:l(()=>[e(r,{label:"全部",value:""}),e(r,{label:"高",value:3}),e(r,{label:"中",value:2}),e(r,{label:"低",value:1})]),_:1},8,["modelValue"])]),_:1}),e(x,{class:"w-[120px]",label:"处理状态"},{default:l(()=>[e(S,{modelValue:s(p).warning_status,"onUpdate:modelValue":t[2]||(t[2]=a=>s(p).warning_status=a),placeholder:"选择",clearable:""},{default:l(()=>[e(r,{label:"全部",value:""}),e(r,{label:"待处理",value:0}),e(r,{label:"已处理",value:1}),e(r,{label:"已忽略",value:2})]),_:1},8,["modelValue"])]),_:1}),e(x,null,{default:l(()=>[e(_,{type:"primary",onClick:s(I)},{default:l(()=>t[9]||(t[9]=[m("查询")])),_:1},8,["onClick"]),e(_,{onClick:s(W)},{default:l(()=>t[10]||(t[10]=[m("重置")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),n("div",Ce,[e(b,{class:"!border-none",shadow:"never"},{default:l(()=>[n("div",Ve,[t[11]||(t[11]=n("div",{class:"text-gray-500 text-sm"},"待处理",-1)),n("div",Ee,d(s(w).total_pending||0),1)])]),_:1}),e(b,{class:"!border-none",shadow:"never"},{default:l(()=>[n("div",Se,[t[12]||(t[12]=n("div",{class:"text-gray-500 text-sm"},"高级预警",-1)),n("div",Te,d(s(w).high_level||0),1)])]),_:1}),e(b,{class:"!border-none",shadow:"never"},{default:l(()=>[n("div",Be,[t[13]||(t[13]=n("div",{class:"text-gray-500 text-sm"},"中级预警",-1)),n("div",Pe,d(s(w).medium_level||0),1)])]),_:1}),e(b,{class:"!border-none",shadow:"never"},{default:l(()=>[n("div",Le,[t[14]||(t[14]=n("div",{class:"text-gray-500 text-sm"},"今日处理",-1)),n("div",Ue,d(s(w).today_handled||0),1)])]),_:1})]),e(b,{class:"!border-none mt-4",shadow:"never"},{default:l(()=>[n("div",$e,[n("div",null,[e(_,{type:"warning",onClick:R},{default:l(()=>[e(j,{class:"mr-1"},{default:l(()=>[e(s(me))]),_:1}),t[15]||(t[15]=m("生成预警 "))]),_:1}),e(_,{onClick:t[3]||(t[3]=a=>T("handle")),disabled:s(k).length===0},{default:l(()=>t[16]||(t[16]=[m(" 批量处理 ")])),_:1},8,["disabled"]),e(_,{onClick:t[4]||(t[4]=a=>T("ignore")),disabled:s(k).length===0},{default:l(()=>t[17]||(t[17]=[m(" 批量忽略 ")])),_:1},8,["disabled"])])]),we((f(),ye(q,{size:"large",data:s(y).lists,onSelectionChange:N},{default:l(()=>[e(u,{type:"selection",width:"50"}),e(u,{label:"客户信息","min-width":"180"},{default:l(({row:a})=>[a.customer?(f(),v("div",Ie,[n("div",We,d(a.customer.customer_name),1),n("div",Fe,d(a.customer.customer_mobile),1)])):(f(),v("span",De,"-"))]),_:1}),e(u,{label:"预警类型",width:"120"},{default:l(({row:a})=>[n("span",null,d(a.warning_type_desc),1)]),_:1}),e(u,{label:"预警等级",width:"100"},{default:l(({row:a})=>[e(P,{type:F(a.warning_level),size:"large"},{default:l(()=>[m(d(a.warning_level_desc),1)]),_:2},1032,["type"])]),_:1}),e(u,{label:"预警原因",prop:"warning_reason","min-width":"200"}),e(u,{label:"未跟进天数",width:"100"},{default:l(({row:a})=>[n("span",{class:xe(a.days_no_follow>14?"text-red-500 font-bold":"")},d(a.days_no_follow)+"天 ",3)]),_:1}),e(u,{label:"销售顾问",width:"100"},{default:l(({row:a})=>[a.advisor?(f(),v("span",Ne,d(a.advisor.advisor_name),1)):(f(),v("span",Re,"-"))]),_:1}),e(u,{label:"处理状态",width:"100"},{default:l(({row:a})=>[e(P,{type:D(a.warning_status)},{default:l(()=>[m(d(a.warning_status_desc),1)]),_:2},1032,["type"])]),_:1}),e(u,{label:"创建时间",prop:"create_time",width:"170"}),e(u,{label:"操作",width:"150",fixed:"right"},{default:l(({row:a})=>[a.warning_status===0?(f(),v(ke,{key:0},[e(_,{type:"success",link:"",onClick:J=>z(a)},{default:l(()=>t[18]||(t[18]=[m("处理")])),_:2},1032,["onClick"]),e(_,{type:"warning",link:"",onClick:J=>M(a)},{default:l(()=>t[19]||(t[19]=[m("忽略")])),_:2},1032,["onClick"])],64)):(f(),v("span",ze,d(a.handle_remark||"已处理"),1))]),_:1})]),_:1},8,["data"])),[[A,s(y).loading]]),n("div",Me,[e(G,{modelValue:s(y),"onUpdate:modelValue":t[5]||(t[5]=a=>U(y)?y.value=a:null),onChange:s(h)},null,8,["modelValue","onChange"])])]),_:1}),e(K,{modelValue:s(c),"onUpdate:modelValue":t[8]||(t[8]=a=>U(c)?c.value=a:null),title:s(g)==="handle"?"处理预警":"忽略预警",width:"500px"},{footer:l(()=>[e(_,{onClick:t[7]||(t[7]=a=>c.value=!1)},{default:l(()=>t[20]||(t[20]=[m("取消")])),_:1}),e(_,{type:s(g)==="handle"?"primary":"warning",onClick:O},{default:l(()=>[m(d(s(g)==="handle"?"确认处理":"确认忽略"),1)]),_:1},8,["type"])]),default:l(()=>[e(B,{model:s(o),"label-width":"100px"},{default:l(()=>[e(x,{label:"处理备注"},{default:l(()=>[e(H,{modelValue:s(o).remark,"onUpdate:modelValue":t[6]||(t[6]=a=>s(o).remark=a),type:"textarea",rows:3,placeholder:"请输入处理备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{Ct as default};
