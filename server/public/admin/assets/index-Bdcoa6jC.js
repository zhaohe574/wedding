import{D as ne,B as ie,C as re,J as de,K as ue,V as pe,i as ce,H as me,G as _e,d as fe,I as ve,L as ye,M as ge,N as xe,O as we,P as be,W as ke,X as he,R as Ce,E as b,a as D}from"./element-plus-ChK2e5qA.js";import{r as E,d as Ee}from"./index-D465kfFn.js";import{d as Ve,a0 as R,r as k,l as Be,ah as N,c as P,o as i,U as t,L as l,R as s,a as o,S as d,M as ze,K as u,P as j}from"./@vue-ygbFPFRc.js";import"./@element-plus-C4Lf8veM.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-DRRUpF4H.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DDSL_IW4.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";function Te(c){return E.get({url:"/schedule.waitlist/lists",params:c})}function De(c){return E.post({url:"/schedule.waitlist/batchNotify",params:c})}function Ne(c){return E.post({url:"/schedule.waitlist/notify",params:c})}function je(c){return E.post({url:"/schedule.waitlist/convert",params:c})}function Ie(c){return E.post({url:"/schedule.waitlist/invalidate",params:c})}const Ue={class:"schedule-waitlist"},Me={class:"flex items-center"},Re={class:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mr-4"},Se={class:"text-2xl font-bold"},Le={class:"flex items-center"},Pe={class:"w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center mr-4"},$e={class:"text-2xl font-bold text-orange-500"},Oe={class:"flex items-center"},Ye={class:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center mr-4"},We={class:"text-2xl font-bold text-green-500"},qe={class:"flex items-center"},Fe={class:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mr-4"},Ke={class:"text-2xl font-bold text-gray-500"},Ge={class:"flex justify-end mt-4"},He={key:0,class:"space-y-4"},Je=Ve({__name:"index",setup(c){const m=R({id:"",customer_name:"",status:""}),g=k([]),_=R({page_no:1,page_size:20,total:0}),h=R({total:0,waiting:0,converted:0,expired:0}),S=k([]),I=k(!1),V=k([]),U=k(!1),r=k(null),f=async()=>{I.value=!0;try{const n={page_no:_.page_no,page_size:_.page_size,...m};g.value&&g.value.length===2&&(n.start_date=g.value[0],n.end_date=g.value[1]);const e=await Te(n);S.value=e.lists||[],_.total=e.count||0,e.extend&&Object.assign(h,e.extend)}catch(n){b.error(n.message||"获取数据失败")}finally{I.value=!1}},$=()=>{Object.assign(m,{id:"",customer_name:"",status:""}),g.value=[],_.page_no=1,f()},O=n=>{V.value=n},Y=async()=>{if(V.value.length===0){b.warning("请先选择需要通知的候补记录");return}try{await D.confirm(`确认通知选中的 ${V.value.length} 条候补记录吗？`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await De({ids:V.value.map(n=>n.id)}),b.success("通知成功"),f()}catch{}},W=n=>{r.value=n,U.value=!0},q=async n=>{try{await D.confirm("确认通知该客户吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await Ne({id:n.id}),b.success("通知成功"),f()}catch{}},F=async n=>{try{await D.confirm("确认将该候补转为正式预约吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await je({id:n.id}),b.success("转正成功"),f()}catch{}},K=async n=>{try{await D.confirm("确认将该候补标记为失效吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await Ie({id:n.id}),b.success("操作成功"),f()}catch{}};return Be(()=>{f()}),(n,e)=>{const L=re,C=ie,B=ue,G=de,H=pe,x=ce,J=ne,w=me,Q=N("List"),z=fe,T=_e,X=N("Clock"),A=N("CircleCheck"),Z=N("Warning"),ee=ve,p=ge,y=xe,te=ye,le=be,v=he,ae=ke,se=Ce,oe=we;return i(),P("div",Ue,[t(w,{class:"!border-none mb-4",shadow:"never"},{default:l(()=>[t(J,{class:"mb-[-16px]",model:m,inline:!0},{default:l(()=>[t(C,{label:"候补编号"},{default:l(()=>[t(L,{modelValue:m.id,"onUpdate:modelValue":e[0]||(e[0]=a=>m.id=a),placeholder:"请输入候补编号",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(C,{label:"客户姓名"},{default:l(()=>[t(L,{modelValue:m.customer_name,"onUpdate:modelValue":e[1]||(e[1]=a=>m.customer_name=a),placeholder:"请输入客户姓名",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(C,{label:"候补状态"},{default:l(()=>[t(G,{modelValue:m.status,"onUpdate:modelValue":e[2]||(e[2]=a=>m.status=a),placeholder:"请选择",clearable:"",style:{width:"150px"}},{default:l(()=>[t(B,{label:"等待中",value:0}),t(B,{label:"已通知",value:1}),t(B,{label:"已转正",value:2}),t(B,{label:"已失效",value:3})]),_:1},8,["modelValue"])]),_:1}),t(C,{label:"候补日期"},{default:l(()=>[t(H,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=a=>g.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"280px"}},null,8,["modelValue"])]),_:1}),t(C,null,{default:l(()=>[t(x,{type:"primary",onClick:f},{default:l(()=>e[7]||(e[7]=[s("查询")])),_:1}),t(x,{onClick:$},{default:l(()=>e[8]||(e[8]=[s("重置")])),_:1}),t(x,{type:"success",onClick:Y},{default:l(()=>e[9]||(e[9]=[s("批量通知")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(ee,{gutter:16,class:"mb-4"},{default:l(()=>[t(T,{span:6},{default:l(()=>[t(w,{shadow:"never"},{default:l(()=>[o("div",Me,[o("div",Re,[t(z,{class:"text-blue-500 text-xl"},{default:l(()=>[t(Q)]),_:1})]),o("div",null,[e[10]||(e[10]=o("div",{class:"text-gray-500 text-sm"},"总候补",-1)),o("div",Se,d(h.total||0),1)])])]),_:1})]),_:1}),t(T,{span:6},{default:l(()=>[t(w,{shadow:"never"},{default:l(()=>[o("div",Le,[o("div",Pe,[t(z,{class:"text-orange-500 text-xl"},{default:l(()=>[t(X)]),_:1})]),o("div",null,[e[11]||(e[11]=o("div",{class:"text-gray-500 text-sm"},"等待中",-1)),o("div",$e,d(h.waiting||0),1)])])]),_:1})]),_:1}),t(T,{span:6},{default:l(()=>[t(w,{shadow:"never"},{default:l(()=>[o("div",Oe,[o("div",Ye,[t(z,{class:"text-green-500 text-xl"},{default:l(()=>[t(A)]),_:1})]),o("div",null,[e[12]||(e[12]=o("div",{class:"text-gray-500 text-sm"},"已下单",-1)),o("div",We,d(h.converted||0),1)])])]),_:1})]),_:1}),t(T,{span:6},{default:l(()=>[t(w,{shadow:"never"},{default:l(()=>[o("div",qe,[o("div",Fe,[t(z,{class:"text-gray-500 text-xl"},{default:l(()=>[t(Z)]),_:1})]),o("div",null,[e[13]||(e[13]=o("div",{class:"text-gray-500 text-sm"},"已过期",-1)),o("div",Ke,d(h.expired||0),1)])])]),_:1})]),_:1})]),_:1}),t(w,{class:"!border-none",shadow:"never"},{default:l(()=>[ze((i(),u(te,{data:S.value,style:{width:"100%"},onSelectionChange:O},{default:l(()=>[t(p,{type:"selection",width:"55"}),t(p,{prop:"id",label:"候补编号",width:"80"}),t(p,{prop:"customer_name",label:"客户姓名",width:"120"}),t(p,{prop:"customer_phone",label:"联系电话",width:"130"}),t(p,{prop:"schedule_date",label:"期望日期",width:"120"}),t(p,{prop:"time_slot_desc",label:"时间段",width:"100"}),t(p,{prop:"service_name",label:"候补服务","min-width":"150"}),t(p,{prop:"notify_status",label:"状态",width:"100"},{default:l(({row:a})=>[a.notify_status===0?(i(),u(y,{key:0,type:"warning"},{default:l(()=>e[14]||(e[14]=[s("等待中")])),_:1})):a.notify_status===1?(i(),u(y,{key:1,type:"primary"},{default:l(()=>e[15]||(e[15]=[s("已通知")])),_:1})):a.notify_status===2?(i(),u(y,{key:2,type:"success"},{default:l(()=>e[16]||(e[16]=[s("已下单")])),_:1})):(i(),u(y,{key:3,type:"info"},{default:l(()=>e[17]||(e[17]=[s("已过期")])),_:1}))]),_:1}),t(p,{prop:"remark",label:"备注","min-width":"150","show-overflow-tooltip":""}),t(p,{prop:"create_time",label:"申请时间",width:"160"}),t(p,{label:"操作",width:"200",fixed:"right"},{default:l(({row:a})=>[t(x,{link:"",type:"primary",size:"small",onClick:M=>W(a)},{default:l(()=>e[18]||(e[18]=[s("查看")])),_:2},1032,["onClick"]),a.notify_status===0?(i(),u(x,{key:0,link:"",type:"success",size:"small",onClick:M=>q(a)},{default:l(()=>e[19]||(e[19]=[s(" 通知 ")])),_:2},1032,["onClick"])):j("",!0),a.notify_status===0||a.notify_status===1?(i(),u(x,{key:1,link:"",type:"warning",size:"small",onClick:M=>F(a)},{default:l(()=>e[20]||(e[20]=[s(" 转正 ")])),_:2},1032,["onClick"])):j("",!0),a.notify_status===0?(i(),u(x,{key:2,link:"",type:"danger",size:"small",onClick:M=>K(a)},{default:l(()=>e[21]||(e[21]=[s(" 失效 ")])),_:2},1032,["onClick"])):j("",!0)]),_:1})]),_:1},8,["data"])),[[oe,I.value]]),o("div",Ge,[t(le,{"current-page":_.page_no,"onUpdate:currentPage":e[4]||(e[4]=a=>_.page_no=a),"page-size":_.page_size,"onUpdate:pageSize":e[5]||(e[5]=a=>_.page_size=a),"page-sizes":[10,20,50,100],total:_.total,background:"",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:f,onCurrentChange:f},null,8,["current-page","page-size","total"])])]),_:1}),t(se,{modelValue:U.value,"onUpdate:modelValue":e[6]||(e[6]=a=>U.value=a),title:"候补详情",width:"600px"},{default:l(()=>[r.value?(i(),P("div",He,[t(ae,{column:2,border:""},{default:l(()=>[t(v,{label:"候补编号"},{default:l(()=>[s(d(r.value.id),1)]),_:1}),t(v,{label:"候补状态"},{default:l(()=>[r.value.notify_status===0?(i(),u(y,{key:0,type:"warning"},{default:l(()=>e[22]||(e[22]=[s("等待中")])),_:1})):r.value.notify_status===1?(i(),u(y,{key:1,type:"primary"},{default:l(()=>e[23]||(e[23]=[s("已通知")])),_:1})):r.value.notify_status===2?(i(),u(y,{key:2,type:"success"},{default:l(()=>e[24]||(e[24]=[s("已下单")])),_:1})):(i(),u(y,{key:3,type:"info"},{default:l(()=>e[25]||(e[25]=[s("已过期")])),_:1}))]),_:1}),t(v,{label:"客户姓名"},{default:l(()=>[s(d(r.value.customer_name),1)]),_:1}),t(v,{label:"联系电话"},{default:l(()=>[s(d(r.value.customer_phone),1)]),_:1}),t(v,{label:"期望日期"},{default:l(()=>[s(d(r.value.schedule_date),1)]),_:1}),t(v,{label:"时间段"},{default:l(()=>[s(d(r.value.time_slot_desc),1)]),_:1}),t(v,{label:"候补服务",span:2},{default:l(()=>[s(d(r.value.service_name),1)]),_:1}),t(v,{label:"备注",span:2},{default:l(()=>[s(d(r.value.remark||"-"),1)]),_:1}),t(v,{label:"申请时间",span:2},{default:l(()=>[s(d(r.value.create_time),1)]),_:1})]),_:1})])):j("",!0)]),_:1},8,["modelValue"])])}}}),Bt=Ee(Je,[["__scopeId","data-v-a5f34df1"]]);export{Bt as default};
