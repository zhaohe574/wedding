import{D as de,B as ie,J as ue,K as re,V as pe,i as me,H as _e,G as ce,I as fe,L as ve,M as be,N as ge,O as ye,P as Ve,C as Ce,h as we,R as ke,E as D,a as B}from"./element-plus-ChK2e5qA.js";import{g as Ee,a as xe,b as De,e as he,c as Ue,d as Se,f as qe,h as ze}from"./financial-BtVBj2RS.js";import{d as Me,r as b,a0 as j,l as Be,c as N,o as _,U as e,L as l,T as F,ab as R,K as E,R as i,a as n,S as u,M as Ne,P as O}from"./@vue-ygbFPFRc.js";import{d as Oe}from"./index-D465kfFn.js";import"./@element-plus-C4Lf8veM.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-DRRUpF4H.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DDSL_IW4.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";const Te={class:"cost-management"},Ye={class:"stat-value"},Le={class:"stat-value"},Pe={class:"stat-value"},$e={class:"stat-value"},Ie={class:"stat-value"},je={class:"stat-value"},Fe={class:"flex justify-between"},Re={class:"text-primary font-bold"},Ke={class:"flex justify-end mt-4"},Ae=Me({__name:"index",setup(Ge){const h=b(!1),T=b([]),Y=b(0),U=b([]),V=b([]),g=b({}),S=b([]),C=b(!1),d=j({page_no:1,page_size:15,cost_type:"",status:"",start_date:"",end_date:""}),o=j({id:0,cost_type:1,cost_name:"",unit_price:0,quantity:1,cost_amount:0,service_date:"",remark:""}),c=s=>(Number(s)||0).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}),K=s=>({0:"warning",1:"success",2:"info"})[s]||"",A=s=>{d.start_date=(s==null?void 0:s[0])||"",d.end_date=(s==null?void 0:s[1])||""},G=s=>{V.value=s.map(t=>t.id)},q=()=>{d.page_no=1,y(),w()},H=()=>{Object.assign(d,{cost_type:"",status:"",start_date:"",end_date:""}),U.value=[],q()},y=async()=>{h.value=!0;try{const s=await Ee(d);T.value=s.lists||[],Y.value=s.count||0}finally{h.value=!1}},w=async()=>{const s=await xe({start_date:d.start_date,end_date:d.end_date});g.value=s||{}},J=async()=>{const s=await De();S.value=s||[]},Q=()=>{Object.assign(o,{id:0,cost_type:1,cost_name:"",unit_price:0,quantity:1,cost_amount:0,service_date:"",remark:""}),C.value=!0},W=s=>{Object.assign(o,s),C.value=!0},X=async()=>{if(!o.cost_name||!o.cost_amount){D.warning("请填写完整信息");return}o.id?await he(o):await Ue(o),D.success("保存成功"),C.value=!1,y(),w()},Z=async s=>{await B.confirm("确定确认该成本记录？","确认"),await Se({id:s.id}),D.success("确认成功"),y(),w()},ee=async()=>{await B.confirm(`确定批量确认选中的 ${V.value.length} 条记录？`,"批量确认");const s=await qe({ids:V.value});D.success(`成功 ${s.success_count} 条，失败 ${s.fail_count} 条`),V.value=[],y(),w()},te=async s=>{await B.confirm("确定删除该成本记录？","删除确认"),await ze({id:s.id}),D.success("删除成功"),y(),w()};return Be(()=>{J(),y(),w()}),(s,t)=>{const x=re,z=ue,p=ie,L=pe,m=me,P=de,f=_e,k=ce,ae=fe,r=be,$=ge,le=ve,se=Ve,I=Ce,M=we,oe=ke,ne=ye;return _(),N("div",Te,[e(f,{class:"!border-none mb-4",shadow:"never"},{default:l(()=>[e(P,{model:d,inline:""},{default:l(()=>[e(p,{label:"成本类型"},{default:l(()=>[e(z,{modelValue:d.cost_type,"onUpdate:modelValue":t[0]||(t[0]=a=>d.cost_type=a),placeholder:"全部",clearable:""},{default:l(()=>[(_(!0),N(F,null,R(S.value,a=>(_(),E(x,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"状态"},{default:l(()=>[e(z,{modelValue:d.status,"onUpdate:modelValue":t[1]||(t[1]=a=>d.status=a),placeholder:"全部",clearable:""},{default:l(()=>[e(x,{label:"待确认",value:0}),e(x,{label:"已确认",value:1}),e(x,{label:"已取消",value:2})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"服务日期"},{default:l(()=>[e(L,{modelValue:U.value,"onUpdate:modelValue":t[2]||(t[2]=a=>U.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始","end-placeholder":"结束","value-format":"YYYY-MM-DD",onChange:A},null,8,["modelValue"])]),_:1}),e(p,null,{default:l(()=>[e(m,{type:"primary",onClick:q},{default:l(()=>t[14]||(t[14]=[i("查询")])),_:1}),e(m,{onClick:H},{default:l(()=>t[15]||(t[15]=[i("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(ae,{gutter:16,class:"mb-4"},{default:l(()=>[e(k,{span:4},{default:l(()=>[e(f,{class:"stat-card",shadow:"never"},{default:l(()=>[t[16]||(t[16]=n("div",{class:"stat-label"},"总成本",-1)),n("div",Ye,"¥"+u(c(g.value.total)),1)]),_:1})]),_:1}),e(k,{span:4},{default:l(()=>[e(f,{class:"stat-card",shadow:"never"},{default:l(()=>[t[17]||(t[17]=n("div",{class:"stat-label"},"人工成本",-1)),n("div",Le,"¥"+u(c(g.value.labor)),1)]),_:1})]),_:1}),e(k,{span:4},{default:l(()=>[e(f,{class:"stat-card",shadow:"never"},{default:l(()=>[t[18]||(t[18]=n("div",{class:"stat-label"},"物料成本",-1)),n("div",Pe,"¥"+u(c(g.value.material)),1)]),_:1})]),_:1}),e(k,{span:4},{default:l(()=>[e(f,{class:"stat-card",shadow:"never"},{default:l(()=>[t[19]||(t[19]=n("div",{class:"stat-label"},"交通成本",-1)),n("div",$e,"¥"+u(c(g.value.transport)),1)]),_:1})]),_:1}),e(k,{span:4},{default:l(()=>[e(f,{class:"stat-card",shadow:"never"},{default:l(()=>[t[20]||(t[20]=n("div",{class:"stat-label"},"设备成本",-1)),n("div",Ie,"¥"+u(c(g.value.equipment)),1)]),_:1})]),_:1}),e(k,{span:4},{default:l(()=>[e(f,{class:"stat-card",shadow:"never"},{default:l(()=>[t[21]||(t[21]=n("div",{class:"stat-label"},"其他成本",-1)),n("div",je,"¥"+u(c(g.value.other)),1)]),_:1})]),_:1})]),_:1}),e(f,{class:"!border-none",shadow:"never"},{header:l(()=>[n("div",Fe,[t[23]||(t[23]=n("span",null,"成本记录",-1)),n("div",null,[e(m,{type:"primary",disabled:!V.value.length,onClick:ee},{default:l(()=>[i(" 批量确认 ("+u(V.value.length)+") ",1)]),_:1},8,["disabled"]),e(m,{type:"primary",onClick:Q},{default:l(()=>t[22]||(t[22]=[i("添加成本")])),_:1})])])]),default:l(()=>[Ne((_(),E(le,{data:T.value,onSelectionChange:G},{default:l(()=>[e(r,{type:"selection",width:"50",selectable:a=>a.status===0},null,8,["selectable"]),e(r,{prop:"cost_sn",label:"成本编号","min-width":"150"}),e(r,{prop:"cost_type_text",label:"成本类型",width:"100"},{default:l(({row:a})=>[e($,null,{default:l(()=>[i(u(a.cost_type_text),1)]),_:2},1024)]),_:1}),e(r,{prop:"cost_name",label:"成本名称","min-width":"150"}),e(r,{label:"订单",width:"140"},{default:l(({row:a})=>{var v;return[i(u(((v=a.order)==null?void 0:v.order_sn)||"-"),1)]}),_:1}),e(r,{label:"服务人员",width:"100"},{default:l(({row:a})=>{var v;return[i(u(((v=a.staff)==null?void 0:v.name)||"-"),1)]}),_:1}),e(r,{prop:"unit_price",label:"单价",width:"90",align:"right"},{default:l(({row:a})=>[i("¥"+u(c(a.unit_price)),1)]),_:1}),e(r,{prop:"quantity",label:"数量",width:"70",align:"center"}),e(r,{prop:"cost_amount",label:"金额",width:"100",align:"right"},{default:l(({row:a})=>[n("span",Re,"¥"+u(c(a.cost_amount)),1)]),_:1}),e(r,{prop:"service_date",label:"服务日期",width:"110"}),e(r,{prop:"status",label:"状态",width:"80"},{default:l(({row:a})=>[e($,{type:K(a.status)},{default:l(()=>[i(u(a.status_text),1)]),_:2},1032,["type"])]),_:1}),e(r,{label:"操作",width:"150",fixed:"right"},{default:l(({row:a})=>[a.status===0?(_(),E(m,{key:0,type:"primary",link:"",onClick:v=>W(a)},{default:l(()=>t[24]||(t[24]=[i("编辑")])),_:2},1032,["onClick"])):O("",!0),a.status===0?(_(),E(m,{key:1,type:"success",link:"",onClick:v=>Z(a)},{default:l(()=>t[25]||(t[25]=[i("确认")])),_:2},1032,["onClick"])):O("",!0),a.status===0?(_(),E(m,{key:2,type:"danger",link:"",onClick:v=>te(a)},{default:l(()=>t[26]||(t[26]=[i("删除")])),_:2},1032,["onClick"])):O("",!0)]),_:1})]),_:1},8,["data"])),[[ne,h.value]]),n("div",Ke,[e(se,{"current-page":d.page_no,"onUpdate:currentPage":t[3]||(t[3]=a=>d.page_no=a),"page-size":d.page_size,"onUpdate:pageSize":t[4]||(t[4]=a=>d.page_size=a),total:Y.value,"page-sizes":[15,30,50],layout:"total, sizes, prev, pager, next",onSizeChange:q,onCurrentChange:y},null,8,["current-page","page-size","total"])])]),_:1}),e(oe,{modelValue:C.value,"onUpdate:modelValue":t[13]||(t[13]=a=>C.value=a),title:o.id?"编辑成本":"添加成本",width:"500px"},{footer:l(()=>[e(m,{onClick:t[12]||(t[12]=a=>C.value=!1)},{default:l(()=>t[27]||(t[27]=[i("取消")])),_:1}),e(m,{type:"primary",onClick:X},{default:l(()=>t[28]||(t[28]=[i("保存")])),_:1})]),default:l(()=>[e(P,{model:o,"label-width":"100px"},{default:l(()=>[e(p,{label:"成本类型",required:""},{default:l(()=>[e(z,{modelValue:o.cost_type,"onUpdate:modelValue":t[5]||(t[5]=a=>o.cost_type=a),placeholder:"请选择"},{default:l(()=>[(_(!0),N(F,null,R(S.value,a=>(_(),E(x,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"成本名称",required:""},{default:l(()=>[e(I,{modelValue:o.cost_name,"onUpdate:modelValue":t[6]||(t[6]=a=>o.cost_name=a),placeholder:"请输入成本名称"},null,8,["modelValue"])]),_:1}),e(p,{label:"单价"},{default:l(()=>[e(M,{modelValue:o.unit_price,"onUpdate:modelValue":t[7]||(t[7]=a=>o.unit_price=a),min:0,precision:2},null,8,["modelValue"])]),_:1}),e(p,{label:"数量"},{default:l(()=>[e(M,{modelValue:o.quantity,"onUpdate:modelValue":t[8]||(t[8]=a=>o.quantity=a),min:.01,precision:2},null,8,["modelValue"])]),_:1}),e(p,{label:"成本金额",required:""},{default:l(()=>[e(M,{modelValue:o.cost_amount,"onUpdate:modelValue":t[9]||(t[9]=a=>o.cost_amount=a),min:0,precision:2},null,8,["modelValue"])]),_:1}),e(p,{label:"服务日期"},{default:l(()=>[e(L,{modelValue:o.service_date,"onUpdate:modelValue":t[10]||(t[10]=a=>o.service_date=a),type:"date","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(p,{label:"备注"},{default:l(()=>[e(I,{modelValue:o.remark,"onUpdate:modelValue":t[11]||(t[11]=a=>o.remark=a),type:"textarea",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Dt=Oe(Ae,[["__scopeId","data-v-b7e56e0d"]]);export{Dt as default};
