import{D as ie,B as _e,C as ue,J as ce,K as pe,V as me,i as fe,H as ge,L as ye,M as ve,q as be,N as he,d as xe,O as ke,W as Ce,X as Ve,v as we,R as Ee}from"./element-plus-ChK2e5qA.js";import{_ as De}from"./index.vue_vue_type_script_setup_true_lang-CCtv5BMP.js";import{d as X,a0 as Y,r as K,a1 as Ue,c as m,o as i,U as e,a as r,L as a,u as t,a9 as H,R as d,S as n,M as je,K as b,P as p,O as J,i as P,T as $,ab as Te}from"./@vue-ygbFPFRc.js";import{a2 as W}from"./@element-plus-C4Lf8veM.js";import{r as j,f as B,d as Se}from"./index-D465kfFn.js";import{u as ze}from"./usePaging-B2jDzebD.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-DRRUpF4H.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DDSL_IW4.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";function Ke(g){return j.get({url:"/order.orderChange/lists",params:g})}function $e(g){return j.get({url:"/order.orderChange/detail",params:g})}function Be(g){return j.post({url:"/order.orderChange/audit",params:g})}function Ie(g){return j.post({url:"/order.orderChange/execute",params:g})}function Le(g){return j.get({url:"/order.orderChange/statistics",params:g})}const Pe={class:"order-change-lists"},Ae={class:"mt-4 grid grid-cols-5 gap-4"},Fe={class:"text-center"},Ne={class:"text-2xl font-bold mt-2 text-orange-500"},qe={class:"text-center"},Me={class:"text-2xl font-bold mt-2 text-blue-500"},Oe={class:"text-center"},Re={class:"text-2xl font-bold mt-2 text-green-500"},Ye={class:"text-center"},He={class:"text-2xl font-bold mt-2 text-red-500"},Je={class:"text-center"},We={class:"text-2xl font-bold mt-2 text-gray-500"},Xe=["onClick"],Ge={key:0,class:"flex items-center"},Qe={class:"ml-2"},Ze={key:1},et={key:0},tt={class:"text-gray-400"},at={class:"text-primary"},lt={key:1},st={class:"text-gray-400"},nt={class:"text-primary"},ot={key:2},rt={class:"text-primary"},dt={class:"text-gray-400 ml-1"},it={class:"text-red-500 ml-2"},_t={class:"flex justify-end mt-4"},ut={key:0,class:"change-detail"},ct={class:"text-red-500"},pt={class:"text-red-500"},mt={key:0,class:"mt-4"},ft=X({name:"orderChange"}),gt=X({...ft,setup(g){const f=Y({change_sn:"",order_sn:"",change_type:"",change_status:"",create_time:[]}),I=K({}),T=K(!1),o=K(null),V=K(!1),u=Y({id:0,approved:!0,remark:"",reject_reason:""}),{pager:E,getLists:D,resetPage:L,resetParams:G}=ze({fetchFun:Ke,params:f}),S=async()=>{const c=await Le({});I.value=c},U=c=>{if(!I.value.status_counts)return 0;const l=I.value.status_counts.find(w=>w.status===c);return l?l.count:0},A=c=>({1:"primary",2:"warning",3:"success"})[c]||"info",F=c=>({0:"warning",1:"primary",2:"danger",3:"success",4:"info"})[c]||"info",Q=c=>{console.log("View order:",c)},Z=async c=>{const l=await $e({id:c.id});o.value=l,T.value=!0},N=(c,l)=>{u.id=c.id,u.approved=l,u.remark="",u.reject_reason="",V.value=!0},ee=async()=>{if(!u.approved&&!u.reject_reason){B.msgError("请填写拒绝原因");return}await Be({id:u.id,approved:u.approved?1:0,remark:u.remark,reject_reason:u.reject_reason}),B.msgSuccess("操作成功"),V.value=!1,D(),S()},te=async c=>{await B.confirm("确定要执行此变更吗？执行后订单信息将被更新。"),await Ie({id:c.id}),B.msgSuccess("执行成功"),D(),S()};return Ue(()=>{D(),S()}),D(),S(),(c,l)=>{const w=ue,h=_e,y=pe,q=ce,ae=me,x=fe,M=ie,k=ge,v=ve,le=be,z=he,O=xe,se=ye,ne=De,_=Ve,oe=Ce,re=we,R=Ee,de=ke;return i(),m("div",Pe,[e(k,{class:"!border-none",shadow:"never"},{default:a(()=>[e(M,{ref:"formRef",class:"mb-[-16px]",model:t(f),inline:!0},{default:a(()=>[e(h,{class:"w-[180px]",label:"变更单号"},{default:a(()=>[e(w,{modelValue:t(f).change_sn,"onUpdate:modelValue":l[0]||(l[0]=s=>t(f).change_sn=s),placeholder:"输入变更单号",clearable:"",onKeyup:H(t(L),["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(h,{class:"w-[180px]",label:"订单编号"},{default:a(()=>[e(w,{modelValue:t(f).order_sn,"onUpdate:modelValue":l[1]||(l[1]=s=>t(f).order_sn=s),placeholder:"输入订单编号",clearable:"",onKeyup:H(t(L),["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(h,{class:"w-[120px]",label:"变更类型"},{default:a(()=>[e(q,{modelValue:t(f).change_type,"onUpdate:modelValue":l[2]||(l[2]=s=>t(f).change_type=s),placeholder:"选择类型",clearable:""},{default:a(()=>[e(y,{label:"全部",value:""}),e(y,{label:"改期",value:1}),e(y,{label:"换人",value:2}),e(y,{label:"加项",value:3})]),_:1},8,["modelValue"])]),_:1}),e(h,{class:"w-[120px]",label:"变更状态"},{default:a(()=>[e(q,{modelValue:t(f).change_status,"onUpdate:modelValue":l[3]||(l[3]=s=>t(f).change_status=s),placeholder:"选择状态",clearable:""},{default:a(()=>[e(y,{label:"全部",value:""}),e(y,{label:"待审核",value:0}),e(y,{label:"审核通过",value:1}),e(y,{label:"审核拒绝",value:2}),e(y,{label:"已执行",value:3}),e(y,{label:"已取消",value:4})]),_:1},8,["modelValue"])]),_:1}),e(h,{class:"w-[320px]",label:"申请时间"},{default:a(()=>[e(ae,{modelValue:t(f).create_time,"onUpdate:modelValue":l[4]||(l[4]=s=>t(f).create_time=s),type:"daterange","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",clearable:""},null,8,["modelValue"])]),_:1}),e(h,null,{default:a(()=>[e(x,{type:"primary",onClick:t(L)},{default:a(()=>l[11]||(l[11]=[d("查询")])),_:1},8,["onClick"]),e(x,{onClick:t(G)},{default:a(()=>l[12]||(l[12]=[d("重置")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),r("div",Ae,[e(k,{class:"!border-none",shadow:"never"},{default:a(()=>[r("div",Fe,[l[13]||(l[13]=r("div",{class:"text-gray-500 text-sm"},"待审核",-1)),r("div",Ne,n(U(0)),1)])]),_:1}),e(k,{class:"!border-none",shadow:"never"},{default:a(()=>[r("div",qe,[l[14]||(l[14]=r("div",{class:"text-gray-500 text-sm"},"待执行",-1)),r("div",Me,n(U(1)),1)])]),_:1}),e(k,{class:"!border-none",shadow:"never"},{default:a(()=>[r("div",Oe,[l[15]||(l[15]=r("div",{class:"text-gray-500 text-sm"},"已执行",-1)),r("div",Re,n(U(3)),1)])]),_:1}),e(k,{class:"!border-none",shadow:"never"},{default:a(()=>[r("div",Ye,[l[16]||(l[16]=r("div",{class:"text-gray-500 text-sm"},"已拒绝",-1)),r("div",He,n(U(2)),1)])]),_:1}),e(k,{class:"!border-none",shadow:"never"},{default:a(()=>[r("div",Je,[l[17]||(l[17]=r("div",{class:"text-gray-500 text-sm"},"已取消",-1)),r("div",We,n(U(4)),1)])]),_:1})]),e(k,{class:"!border-none mt-4",shadow:"never"},{default:a(()=>[je((i(),b(se,{size:"large",data:t(E).lists},{default:a(()=>[e(v,{label:"变更单号",prop:"change_sn","min-width":"160"}),e(v,{label:"订单编号",prop:"order_sn","min-width":"160"},{default:a(({row:s})=>[r("span",{class:"text-primary cursor-pointer",onClick:C=>Q(s.order_id)},n(s.order_sn),9,Xe)]),_:1}),e(v,{label:"用户信息","min-width":"140"},{default:a(({row:s})=>[s.user?(i(),m("div",Ge,[e(le,{src:s.user.avatar,size:28},null,8,["src"]),r("span",Qe,n(s.user.nickname),1)])):(i(),m("span",Ze,"-"))]),_:1}),e(v,{label:"变更类型",width:"90"},{default:a(({row:s})=>[e(z,{type:A(s.change_type),size:"small"},{default:a(()=>[d(n(s.change_type_desc),1)]),_:2},1032,["type"])]),_:1}),e(v,{label:"变更内容","min-width":"200"},{default:a(({row:s})=>[s.change_type===1?(i(),m("div",et,[r("span",tt,n(s.old_service_date),1),e(O,{class:"mx-1"},{default:a(()=>[e(t(W))]),_:1}),r("span",at,n(s.new_service_date),1)])):s.change_type===2?(i(),m("div",lt,[r("span",st,n(s.old_staff_name),1),e(O,{class:"mx-1"},{default:a(()=>[e(t(W))]),_:1}),r("span",nt,n(s.new_staff_name),1),s.price_diff!==0?(i(),m("span",{key:0,class:J([s.price_diff>0?"text-red-500":"text-green-500","ml-2"])},n(s.price_diff>0?"+":"")+n(s.price_diff)+"元 ",3)):p("",!0)])):s.change_type===3?(i(),m("div",ot,[r("span",rt,n(s.add_staff_name),1),r("span",dt,"("+n(s.add_package_name)+")",1),r("span",it,"+"+n(s.add_price)+"元",1)])):p("",!0)]),_:1}),e(v,{label:"状态",width:"100"},{default:a(({row:s})=>[e(z,{type:F(s.change_status),size:"small"},{default:a(()=>[d(n(s.change_status_desc),1)]),_:2},1032,["type"])]),_:1}),e(v,{label:"申请原因",prop:"apply_reason","min-width":"120","show-overflow-tooltip":""}),e(v,{label:"申请时间",prop:"create_time",width:"160"}),e(v,{label:"操作",width:"180",fixed:"right"},{default:a(({row:s})=>[e(x,{type:"primary",link:"",onClick:C=>Z(s)},{default:a(()=>l[18]||(l[18]=[d("详情")])),_:2},1032,["onClick"]),s.change_status===0?(i(),b(x,{key:0,type:"success",link:"",onClick:C=>N(s,!0)},{default:a(()=>l[19]||(l[19]=[d("通过")])),_:2},1032,["onClick"])):p("",!0),s.change_status===0?(i(),b(x,{key:1,type:"danger",link:"",onClick:C=>N(s,!1)},{default:a(()=>l[20]||(l[20]=[d("拒绝")])),_:2},1032,["onClick"])):p("",!0),s.change_status===1?(i(),b(x,{key:2,type:"warning",link:"",onClick:C=>te(s)},{default:a(()=>l[21]||(l[21]=[d("执行")])),_:2},1032,["onClick"])):p("",!0)]),_:1})]),_:1},8,["data"])),[[de,t(E).loading]]),r("div",_t,[e(ne,{modelValue:t(E),"onUpdate:modelValue":l[5]||(l[5]=s=>P(E)?E.value=s:null),onChange:t(D)},null,8,["modelValue","onChange"])])]),_:1}),e(R,{modelValue:t(T),"onUpdate:modelValue":l[6]||(l[6]=s=>P(T)?T.value=s:null),title:"变更详情",width:"700px"},{default:a(()=>[t(o)?(i(),m("div",ut,[e(oe,{column:2,border:""},{default:a(()=>[e(_,{label:"变更单号"},{default:a(()=>[d(n(t(o).change_sn),1)]),_:1}),e(_,{label:"变更类型"},{default:a(()=>[e(z,{type:A(t(o).change_type),size:"small"},{default:a(()=>[d(n(t(o).change_type_desc),1)]),_:1},8,["type"])]),_:1}),e(_,{label:"订单编号"},{default:a(()=>[d(n(t(o).order_sn),1)]),_:1}),e(_,{label:"变更状态"},{default:a(()=>[e(z,{type:F(t(o).change_status),size:"small"},{default:a(()=>[d(n(t(o).change_status_desc),1)]),_:1},8,["type"])]),_:1}),t(o).user?(i(),b(_,{key:0,label:"申请用户"},{default:a(()=>[d(n(t(o).user.nickname)+" ("+n(t(o).user.mobile)+") ",1)]),_:1})):p("",!0),e(_,{label:"申请时间"},{default:a(()=>[d(n(t(o).create_time),1)]),_:1}),t(o).change_type===1?(i(),m($,{key:1},[e(_,{label:"原服务日期"},{default:a(()=>[d(n(t(o).old_service_date),1)]),_:1}),e(_,{label:"新服务日期"},{default:a(()=>[d(n(t(o).new_service_date),1)]),_:1})],64)):p("",!0),t(o).change_type===2?(i(),m($,{key:2},[e(_,{label:"原工作人员"},{default:a(()=>[d(n(t(o).old_staff_name),1)]),_:1}),e(_,{label:"新工作人员"},{default:a(()=>[d(n(t(o).new_staff_name),1)]),_:1}),e(_,{label:"原价格"},{default:a(()=>[d("¥"+n(t(o).old_price),1)]),_:1}),e(_,{label:"新价格"},{default:a(()=>[d("¥"+n(t(o).new_price),1)]),_:1}),e(_,{label:"差价"},{default:a(()=>[r("span",{class:J(t(o).price_diff>0?"text-red-500":"text-green-500")},n(t(o).price_diff>0?"+":"")+n(t(o).price_diff)+"元 ",3)]),_:1})],64)):p("",!0),t(o).change_type===3?(i(),m($,{key:3},[e(_,{label:"新增人员"},{default:a(()=>[d(n(t(o).add_staff_name),1)]),_:1}),e(_,{label:"套餐"},{default:a(()=>[d(n(t(o).add_package_name),1)]),_:1}),e(_,{label:"服务日期"},{default:a(()=>[d(n(t(o).add_service_date),1)]),_:1}),e(_,{label:"增加金额"},{default:a(()=>[r("span",ct,"+¥"+n(t(o).add_price),1)]),_:1})],64)):p("",!0),e(_,{label:"申请原因",span:2},{default:a(()=>[d(n(t(o).apply_reason||"-"),1)]),_:1}),t(o).audit_remark?(i(),b(_,{key:4,label:"审核备注",span:2},{default:a(()=>[d(n(t(o).audit_remark),1)]),_:1})):p("",!0),t(o).reject_reason?(i(),b(_,{key:5,label:"拒绝原因",span:2},{default:a(()=>[r("span",pt,n(t(o).reject_reason),1)]),_:1})):p("",!0)]),_:1}),t(o).attach_images&&t(o).attach_images.length>0?(i(),m("div",mt,[l[22]||(l[22]=r("h4",{class:"font-bold mb-2"},"附件图片",-1)),(i(!0),m($,null,Te(t(o).attach_images,(s,C)=>(i(),b(re,{key:C,src:s,"preview-src-list":t(o).attach_images,"initial-index":C,fit:"cover",class:"w-20 h-20 mr-2 rounded"},null,8,["src","preview-src-list","initial-index"]))),128))])):p("",!0)])):p("",!0)]),_:1},8,["modelValue"]),e(R,{modelValue:t(V),"onUpdate:modelValue":l[10]||(l[10]=s=>P(V)?V.value=s:null),title:t(u).approved?"审核通过":"审核拒绝",width:"500px"},{footer:a(()=>[e(x,{onClick:l[9]||(l[9]=s=>V.value=!1)},{default:a(()=>l[23]||(l[23]=[d("取消")])),_:1}),e(x,{type:t(u).approved?"success":"danger",onClick:ee},{default:a(()=>l[24]||(l[24]=[d("确认")])),_:1},8,["type"])]),default:a(()=>[e(M,{model:t(u),"label-width":"100px"},{default:a(()=>[e(h,{label:"审核备注"},{default:a(()=>[e(w,{modelValue:t(u).remark,"onUpdate:modelValue":l[7]||(l[7]=s=>t(u).remark=s),type:"textarea",rows:3,placeholder:"请输入审核备注（选填）"},null,8,["modelValue"])]),_:1}),t(u).approved?p("",!0):(i(),b(h,{key:0,label:"拒绝原因",required:""},{default:a(()=>[e(w,{modelValue:t(u).reject_reason,"onUpdate:modelValue":l[8]||(l[8]=s=>t(u).reject_reason=s),type:"textarea",rows:3,placeholder:"请输入拒绝原因"},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Xt=Se(gt,[["__scopeId","data-v-279ed8a0"]]);export{Xt as default};
