import{G as ge,H as be,d as we,I as he,D as Ve,B as xe,J as ke,K as De,C as Ce,V as Ee,i as ze,L as Se,M as Ue,q as Ie,N as Ne,O as Te,P as Re,T as Be,U as Me,R as Le,W as qe,X as Fe,E as C,a as W}from"./element-plus-ChK2e5qA.js";import{_ as Pe,f as Ae,$ as $e,Q as Ye,a0 as Ge,a1 as Ke,I as Oe}from"./@element-plus-C4Lf8veM.js";import{r as b,d as je}from"./index-D465kfFn.js";import{d as He,r as _,a0 as X,w as Je,l as Qe,c as L,o as g,U as e,L as l,a as u,S as r,u as k,R as s,M as We,K as S,P as Y,T as Xe,ab as Ze}from"./@vue-ygbFPFRc.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-DRRUpF4H.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DDSL_IW4.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";function et(d){return b.get({url:"/notification.notification/lists",params:d})}function tt(d){return b.get({url:"/notification.notification/detail",params:d})}function lt(d){return b.post({url:"/notification.notification/send",params:d})}function at(d){return b.post({url:"/notification.notification/batchSend",params:d})}function ot(d){return b.post({url:"/notification.notification/sendToAll",params:d})}function nt(d){return b.post({url:"/notification.notification/delete",params:d})}function st(d){return b.post({url:"/notification.notification/batchDelete",params:d})}function it(d){return b.get({url:"/notification.notification/statistics",params:d})}function dt(){return b.get({url:"/notification.notification/templates"})}const rt={class:"notification-container"},ut={class:"stat-content"},pt={class:"stat-value"},_t={class:"stat-content"},ct={class:"stat-value"},ft={class:"stat-content"},mt={class:"stat-value"},yt={class:"stat-content"},vt={class:"stat-value"},gt={key:0,class:"user-info"},bt={class:"ml-2"},wt={key:1},ht={class:"pagination-container"},Vt=He({__name:"index",setup(d){const q=_(!1),G=_([]),K=_(0),E=_({}),U=_([]),I=_([]),i=X({page_no:1,page_size:10,notify_type:"",is_read:"",keyword:"",start_date:"",end_date:""});Je(I,n=>{n&&n.length===2?(i.start_date=n[0],i.end_date=n[1]):(i.start_date="",i.end_date="")});const D=_(!1),F=_(!1),P=_(),o=X({send_type:"single",user_id:"",user_ids_text:"",notify_type:1,title:"",content:""}),Z={notify_type:[{required:!0,message:"请选择通知类型",trigger:"change"}],title:[{required:!0,message:"请输入标题",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]},A=_([]),N=_(null),$=_(!1),f=_({}),w=async()=>{q.value=!0;try{const n=await et(i);G.value=n.lists||[],K.value=n.count||0}catch(n){console.error(n)}finally{q.value=!1}},T=async()=>{try{const n=await it();E.value=n||{}}catch(n){console.error(n)}},ee=async()=>{try{const n=await dt();A.value=n||[]}catch(n){console.error(n)}},O=()=>{i.page_no=1,w()},te=()=>{i.notify_type="",i.is_read="",i.keyword="",I.value=[],O()},le=n=>{U.value=n.map(t=>t.id)},ae=()=>{o.send_type="single",o.user_id="",o.user_ids_text="",o.notify_type=1,o.title="",o.content="",N.value=null,D.value=!0},oe=()=>{o.send_type="all",o.notify_type=1,o.title="",o.content="",N.value=null,D.value=!0},ne=n=>{if(n){const t=A.value.find(p=>p.id===n);t&&(o.notify_type=t.type,o.title=t.title,o.content=t.content)}},se=async()=>{if(P.value){await P.value.validate(),F.value=!0;try{const n={notify_type:o.notify_type,title:o.title,content:o.content};if(o.send_type==="single"){if(!o.user_id){C.warning("请输入用户ID");return}n.user_id=o.user_id,await lt(n)}else if(o.send_type==="batch"){if(!o.user_ids_text){C.warning("请输入用户ID列表");return}const t=o.user_ids_text.split(",").map(p=>parseInt(p.trim())).filter(p=>!isNaN(p));if(!t.length){C.warning("请输入有效的用户ID");return}n.user_ids=t,await at(n)}else o.send_type==="all"&&await ot(n);C.success("发送成功"),D.value=!1,w(),T()}catch(n){console.error(n)}finally{F.value=!1}}},ie=async n=>{try{const t=await tt({id:n.id});f.value=t,$.value=!0}catch(t){console.error(t)}},de=n=>{W.confirm("确定要删除该通知吗？","提示",{type:"warning"}).then(async()=>{await nt({id:n.id}),C.success("删除成功"),w(),T()}).catch(()=>{})},re=()=>{W.confirm(`确定要删除选中的 ${U.value.length} 条通知吗？`,"提示",{type:"warning"}).then(async()=>{await st({ids:U.value}),C.success("批量删除成功"),w(),T()}).catch(()=>{})},j=n=>({1:"",2:"success",3:"warning",4:"danger"})[n]||"info";return Qe(()=>{w(),T(),ee()}),(n,t)=>{const p=we,h=be,R=ge,ue=he,m=De,B=ke,c=xe,z=Ce,pe=Ee,y=ze,H=Ve,v=Ue,_e=Ie,M=Ne,ce=Se,fe=Re,J=Me,me=Be,Q=Le,V=Fe,ye=qe,ve=Te;return g(),L("div",rt,[e(ue,{gutter:16,class:"mb-4"},{default:l(()=>[e(R,{span:6},{default:l(()=>[e(h,{shadow:"hover",class:"stat-card"},{default:l(()=>[u("div",ut,[t[16]||(t[16]=u("div",{class:"stat-label"},"总通知数",-1)),u("div",pt,r(E.value.total_count||0),1)]),e(p,{class:"stat-icon",size:40},{default:l(()=>[e(k(Pe))]),_:1})]),_:1})]),_:1}),e(R,{span:6},{default:l(()=>[e(h,{shadow:"hover",class:"stat-card success"},{default:l(()=>[u("div",_t,[t[17]||(t[17]=u("div",{class:"stat-label"},"已读",-1)),u("div",ct,r(E.value.read_count||0),1)]),e(p,{class:"stat-icon",size:40},{default:l(()=>[e(k(Ae))]),_:1})]),_:1})]),_:1}),e(R,{span:6},{default:l(()=>[e(h,{shadow:"hover",class:"stat-card warning"},{default:l(()=>[u("div",ft,[t[18]||(t[18]=u("div",{class:"stat-label"},"未读",-1)),u("div",mt,r(E.value.unread_count||0),1)]),e(p,{class:"stat-icon",size:40},{default:l(()=>[e(k($e))]),_:1})]),_:1})]),_:1}),e(R,{span:6},{default:l(()=>[e(h,{shadow:"hover",class:"stat-card info"},{default:l(()=>[u("div",yt,[t[19]||(t[19]=u("div",{class:"stat-label"},"阅读率",-1)),u("div",vt,r(E.value.read_rate||"0%"),1)]),e(p,{class:"stat-icon",size:40},{default:l(()=>[e(k(Ye))]),_:1})]),_:1})]),_:1})]),_:1}),e(h,{shadow:"never",class:"mb-4"},{default:l(()=>[e(H,{model:i,inline:""},{default:l(()=>[e(c,{label:"通知类型"},{default:l(()=>[e(B,{modelValue:i.notify_type,"onUpdate:modelValue":t[0]||(t[0]=a=>i.notify_type=a),placeholder:"请选择",clearable:"",style:{width:"140px"}},{default:l(()=>[e(m,{label:"系统通知",value:1}),e(m,{label:"订单通知",value:2}),e(m,{label:"互动通知",value:3}),e(m,{label:"活动通知",value:4})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"阅读状态"},{default:l(()=>[e(B,{modelValue:i.is_read,"onUpdate:modelValue":t[1]||(t[1]=a=>i.is_read=a),placeholder:"请选择",clearable:"",style:{width:"120px"}},{default:l(()=>[e(m,{label:"未读",value:0}),e(m,{label:"已读",value:1})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"用户"},{default:l(()=>[e(z,{modelValue:i.keyword,"onUpdate:modelValue":t[2]||(t[2]=a=>i.keyword=a),placeholder:"昵称/手机号",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),e(c,{label:"日期范围"},{default:l(()=>[e(pe,{modelValue:I.value,"onUpdate:modelValue":t[3]||(t[3]=a=>I.value=a),type:"daterange","value-format":"YYYY-MM-DD","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),e(c,null,{default:l(()=>[e(y,{type:"primary",onClick:O},{default:l(()=>t[20]||(t[20]=[s("搜索")])),_:1}),e(y,{onClick:te},{default:l(()=>t[21]||(t[21]=[s("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(h,{shadow:"never",class:"mb-4"},{default:l(()=>[e(y,{type:"primary",onClick:ae},{default:l(()=>[e(p,null,{default:l(()=>[e(k(Ge))]),_:1}),t[22]||(t[22]=s(" 发送通知 "))]),_:1}),e(y,{type:"success",onClick:oe},{default:l(()=>[e(p,null,{default:l(()=>[e(k(Ke))]),_:1}),t[23]||(t[23]=s(" 全员通知 "))]),_:1}),e(y,{type:"danger",disabled:!U.value.length,onClick:re},{default:l(()=>[e(p,null,{default:l(()=>[e(k(Oe))]),_:1}),t[24]||(t[24]=s(" 批量删除 "))]),_:1},8,["disabled"])]),_:1}),e(h,{shadow:"never"},{default:l(()=>[We((g(),S(ce,{data:G.value,onSelectionChange:le,"row-key":"id"},{default:l(()=>[e(v,{type:"selection",width:"50"}),e(v,{label:"接收用户",width:"150"},{default:l(({row:a})=>[a.user?(g(),L("div",gt,[e(_e,{size:28,src:a.user.avatar},{default:l(()=>{var x;return[s(r((x=a.user.nickname)==null?void 0:x.charAt(0)),1)]}),_:2},1032,["src"]),u("span",bt,r(a.user.nickname||"-"),1)])):(g(),L("span",wt,"-"))]),_:1}),e(v,{label:"通知类型",width:"100"},{default:l(({row:a})=>[e(M,{type:j(a.notify_type),size:"small"},{default:l(()=>[s(r(a.notify_type_text),1)]),_:2},1032,["type"])]),_:1}),e(v,{label:"标题","min-width":"150",prop:"title","show-overflow-tooltip":""}),e(v,{label:"内容","min-width":"200",prop:"content","show-overflow-tooltip":""}),e(v,{label:"阅读状态",width:"100",align:"center"},{default:l(({row:a})=>[e(M,{type:a.is_read?"success":"danger",size:"small"},{default:l(()=>[s(r(a.is_read_text),1)]),_:2},1032,["type"])]),_:1}),e(v,{label:"发送时间",width:"160",prop:"create_time_text"}),e(v,{label:"阅读时间",width:"160",prop:"read_time_text"}),e(v,{label:"操作",width:"120",fixed:"right"},{default:l(({row:a})=>[e(y,{link:"",type:"primary",onClick:x=>ie(a)},{default:l(()=>t[25]||(t[25]=[s("详情")])),_:2},1032,["onClick"]),e(y,{link:"",type:"danger",onClick:x=>de(a)},{default:l(()=>t[26]||(t[26]=[s("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ve,q.value]]),u("div",ht,[e(fe,{"current-page":i.page_no,"onUpdate:currentPage":t[4]||(t[4]=a=>i.page_no=a),"page-size":i.page_size,"onUpdate:pageSize":t[5]||(t[5]=a=>i.page_size=a),"page-sizes":[10,20,50,100],total:K.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:w,onCurrentChange:w},null,8,["current-page","page-size","total"])])]),_:1}),e(Q,{modelValue:D.value,"onUpdate:modelValue":t[14]||(t[14]=a=>D.value=a),title:o.send_type==="all"?"全员通知":"发送通知",width:"600px","destroy-on-close":""},{footer:l(()=>[e(y,{onClick:t[13]||(t[13]=a=>D.value=!1)},{default:l(()=>t[29]||(t[29]=[s("取消")])),_:1}),e(y,{type:"primary",loading:F.value,onClick:se},{default:l(()=>t[30]||(t[30]=[s("发送")])),_:1},8,["loading"])]),default:l(()=>[e(H,{ref_key:"sendFormRef",ref:P,model:o,rules:Z,"label-width":"100px"},{default:l(()=>[o.send_type!=="all"?(g(),S(c,{key:0,label:"发送方式"},{default:l(()=>[e(me,{modelValue:o.send_type,"onUpdate:modelValue":t[6]||(t[6]=a=>o.send_type=a)},{default:l(()=>[e(J,{label:"single"},{default:l(()=>t[27]||(t[27]=[s("指定用户")])),_:1}),e(J,{label:"batch"},{default:l(()=>t[28]||(t[28]=[s("批量发送")])),_:1})]),_:1},8,["modelValue"])]),_:1})):Y("",!0),o.send_type==="single"?(g(),S(c,{key:1,label:"用户ID",prop:"user_id"},{default:l(()=>[e(z,{modelValue:o.user_id,"onUpdate:modelValue":t[7]||(t[7]=a=>o.user_id=a),modelModifiers:{number:!0},placeholder:"请输入用户ID"},null,8,["modelValue"])]),_:1})):Y("",!0),o.send_type==="batch"?(g(),S(c,{key:2,label:"用户ID列表",prop:"user_ids_text"},{default:l(()=>[e(z,{modelValue:o.user_ids_text,"onUpdate:modelValue":t[8]||(t[8]=a=>o.user_ids_text=a),type:"textarea",rows:3,placeholder:"请输入用户ID，多个用英文逗号分隔"},null,8,["modelValue"])]),_:1})):Y("",!0),e(c,{label:"通知类型",prop:"notify_type"},{default:l(()=>[e(B,{modelValue:o.notify_type,"onUpdate:modelValue":t[9]||(t[9]=a=>o.notify_type=a),placeholder:"请选择",style:{width:"100%"}},{default:l(()=>[e(m,{label:"系统通知",value:1}),e(m,{label:"订单通知",value:2}),e(m,{label:"互动通知",value:3}),e(m,{label:"活动通知",value:4})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"选择模板"},{default:l(()=>[e(B,{modelValue:N.value,"onUpdate:modelValue":t[10]||(t[10]=a=>N.value=a),placeholder:"选择模板快速填充",clearable:"",style:{width:"100%"},onChange:ne},{default:l(()=>[(g(!0),L(Xe,null,Ze(A.value,a=>(g(),S(m,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"标题",prop:"title"},{default:l(()=>[e(z,{modelValue:o.title,"onUpdate:modelValue":t[11]||(t[11]=a=>o.title=a),placeholder:"请输入标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(c,{label:"内容",prop:"content"},{default:l(()=>[e(z,{modelValue:o.content,"onUpdate:modelValue":t[12]||(t[12]=a=>o.content=a),type:"textarea",rows:4,placeholder:"请输入内容",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(Q,{modelValue:$.value,"onUpdate:modelValue":t[15]||(t[15]=a=>$.value=a),title:"通知详情",width:"500px"},{default:l(()=>[e(ye,{column:1,border:""},{default:l(()=>[e(V,{label:"接收用户"},{default:l(()=>{var a,x;return[s(r(((a=f.value.user)==null?void 0:a.nickname)||"-")+" ("+r(((x=f.value.user)==null?void 0:x.mobile)||"-")+") ",1)]}),_:1}),e(V,{label:"通知类型"},{default:l(()=>[e(M,{type:j(f.value.notify_type),size:"small"},{default:l(()=>[s(r(f.value.notify_type_text),1)]),_:1},8,["type"])]),_:1}),e(V,{label:"标题"},{default:l(()=>[s(r(f.value.title),1)]),_:1}),e(V,{label:"内容"},{default:l(()=>[s(r(f.value.content),1)]),_:1}),e(V,{label:"阅读状态"},{default:l(()=>[e(M,{type:f.value.is_read?"success":"danger",size:"small"},{default:l(()=>[s(r(f.value.is_read_text),1)]),_:1},8,["type"])]),_:1}),e(V,{label:"发送时间"},{default:l(()=>[s(r(f.value.create_time_text),1)]),_:1}),e(V,{label:"阅读时间"},{default:l(()=>[s(r(f.value.read_time_text),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),el=je(Vt,[["__scopeId","data-v-90851dc5"]]);export{el as default};
