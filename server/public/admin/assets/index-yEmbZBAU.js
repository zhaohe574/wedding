import{D as _e,B as pe,C as ce,J as fe,K as ve,i as be,H as Ve,d as ye,L as ge,M as xe,q as ke,a1 as Ce,N as Ee,O as Ue,h as we,T as Ae,U as $e,R as Se,$ as Te,W as De,X as Re}from"./element-plus-ChK2e5qA.js";import{_ as Fe}from"./index.vue_vue_type_script_setup_true_lang-CCtv5BMP.js";import{d as H,a0 as K,r as E,c as B,o as b,U as t,L as a,u as o,a9 as G,R as s,a as _,M as Le,K as U,S as i,O as Ke,P as $,i as T,T as Be,ab as Ne}from"./@vue-ygbFPFRc.js";import{A as Pe}from"./@element-plus-C4Lf8veM.js";import{s as Ie,a as Oe,b as je,c as qe,d as ze,e as Me,f as Ge,g as He}from"./crm-B_G7fTMr.js";import{u as Je}from"./usePaging-B2jDzebD.js";import{f as y}from"./index-D465kfFn.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-DRRUpF4H.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DDSL_IW4.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";const We={class:"advisor-lists"},Xe={class:"flex justify-between mb-4"},Qe={class:"flex items-center"},Ye={class:"ml-3"},Ze={class:"font-medium"},he={class:"text-gray-400 text-xs"},et={class:"text-xs"},tt={class:"text-green-500 font-bold"},lt={class:"flex justify-end mt-4"},at={key:0},ot=H({name:"advisorLists"}),Ot=H({...ot,setup(st){const V=K({advisor_name:"",mobile:"",status:""}),g=E(!1),N=E(),d=K({id:0,advisor_name:"",mobile:"",wechat:"",email:"",max_customer_count:100,status:1,sort:0}),J={advisor_name:[{required:!0,message:"请输入顾问姓名",trigger:"blur"}]},k=E(!1),c=K({from_advisor_id:0,to_advisor_id:"",reason:""}),S=E(!1),u=E(null),P=E([]),{pager:w,getLists:C,resetPage:D,resetParams:W}=Je({fetchFun:Ie,params:V}),I=n=>({0:"danger",1:"success",2:"warning"})[n]||"info",X=async()=>{P.value=await He()},Q=()=>{Object.assign(d,{id:0,advisor_name:"",mobile:"",wechat:"",email:"",max_customer_count:100,status:1,sort:0}),g.value=!0},Y=n=>{Object.assign(d,{id:n.id,advisor_name:n.advisor_name,mobile:n.mobile,wechat:n.wechat,email:n.email,max_customer_count:n.max_customer_count,status:n.status,sort:n.sort||0}),g.value=!0},Z=async()=>{var n;await((n=N.value)==null?void 0:n.validate()),d.id?(await Oe(d),y.msgSuccess("编辑成功")):(await je(d),y.msgSuccess("添加成功")),g.value=!1,C()},h=async n=>{u.value=await qe({id:n.id}),S.value=!0},O=async(n,l)=>{const v=l===1?"恢复正常":"设为休假";await y.confirm(`确定要${v}吗？`),await ze({id:n.id,status:l}),y.msgSuccess("操作成功"),C()},ee=async n=>{await X(),u.value=n,c.from_advisor_id=n.id,c.to_advisor_id="",c.reason="",k.value=!0},te=async()=>{if(!c.to_advisor_id){y.msgError("请选择目标顾问");return}const n=await Me(c);y.msgSuccess(`成功转移 ${n.success} 个客户`),k.value=!1,C()},le=async n=>{await y.confirm("确定要删除该顾问吗？"),await Ge({id:n.id}),y.msgSuccess("删除成功"),C()};return C(),(n,l)=>{const v=ce,r=pe,A=ve,j=fe,m=be,R=_e,q=Ve,ae=ye,oe=ke,x=xe,se=Ce,z=Ee,ne=ge,de=Fe,M=we,F=$e,ie=Ae,L=Se,ue=Te,f=Re,re=De,me=Ue;return b(),B("div",We,[t(q,{class:"!border-none",shadow:"never"},{default:a(()=>[t(R,{ref:"formRef",class:"mb-[-16px]",model:o(V),inline:!0},{default:a(()=>[t(r,{class:"w-[150px]",label:"顾问姓名"},{default:a(()=>[t(v,{modelValue:o(V).advisor_name,"onUpdate:modelValue":l[0]||(l[0]=e=>o(V).advisor_name=e),placeholder:"输入姓名",clearable:"",onKeyup:G(o(D),["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(r,{class:"w-[150px]",label:"手机号"},{default:a(()=>[t(v,{modelValue:o(V).mobile,"onUpdate:modelValue":l[1]||(l[1]=e=>o(V).mobile=e),placeholder:"输入手机号",clearable:"",onKeyup:G(o(D),["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(r,{class:"w-[120px]",label:"状态"},{default:a(()=>[t(j,{modelValue:o(V).status,"onUpdate:modelValue":l[2]||(l[2]=e=>o(V).status=e),placeholder:"选择状态",clearable:""},{default:a(()=>[t(A,{label:"全部",value:""}),t(A,{label:"正常",value:1}),t(A,{label:"休假",value:2}),t(A,{label:"离职",value:0})]),_:1},8,["modelValue"])]),_:1}),t(r,null,{default:a(()=>[t(m,{type:"primary",onClick:o(D)},{default:a(()=>l[18]||(l[18]=[s("查询")])),_:1},8,["onClick"]),t(m,{onClick:o(W)},{default:a(()=>l[19]||(l[19]=[s("重置")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),t(q,{class:"!border-none mt-4",shadow:"never"},{default:a(()=>[_("div",Xe,[t(m,{type:"primary",onClick:Q},{default:a(()=>[t(ae,{class:"mr-1"},{default:a(()=>[t(o(Pe))]),_:1}),l[20]||(l[20]=s("添加顾问 "))]),_:1})]),Le((b(),U(ne,{size:"large",data:o(w).lists},{default:a(()=>[t(x,{label:"顾问信息","min-width":"180"},{default:a(({row:e})=>[_("div",Qe,[t(oe,{src:e.avatar,size:40},{default:a(()=>{var p;return[s(i((p=e.advisor_name)==null?void 0:p.charAt(0)),1)]}),_:2},1032,["src"]),_("div",Ye,[_("div",Ze,i(e.advisor_name),1),_("div",he,i(e.mobile),1)])])]),_:1}),t(x,{label:"企业微信",prop:"wechat",width:"120"}),t(x,{label:"客户数",width:"120"},{default:a(({row:e})=>[_("div",null,[_("span",{class:Ke(e.current_customer_count>=e.max_customer_count?"text-red-500":"")},i(e.current_customer_count),3),s(" / "+i(e.max_customer_count),1)]),t(se,{percentage:Math.min(100,e.current_customer_count/e.max_customer_count*100),"stroke-width":4,"show-text":!1,status:e.current_customer_count>=e.max_customer_count?"exception":""},null,8,["percentage","status"])]),_:1}),t(x,{label:"成交统计",width:"140"},{default:a(({row:e})=>[_("div",et,[_("div",null,"订单: "+i(e.total_order_count),1),_("div",null,"金额: ¥"+i(e.total_order_amount),1)])]),_:1}),t(x,{label:"转化率",width:"100"},{default:a(({row:e})=>[_("span",tt,i(e.conversion_rate)+"%",1)]),_:1}),t(x,{label:"状态",width:"100"},{default:a(({row:e})=>[t(z,{type:I(e.status)},{default:a(()=>[s(i(e.status_desc),1)]),_:2},1032,["type"])]),_:1}),t(x,{label:"操作",width:"200",fixed:"right"},{default:a(({row:e})=>[t(m,{type:"primary",link:"",onClick:p=>h(e)},{default:a(()=>l[21]||(l[21]=[s("详情")])),_:2},1032,["onClick"]),t(m,{type:"primary",link:"",onClick:p=>Y(e)},{default:a(()=>l[22]||(l[22]=[s("编辑")])),_:2},1032,["onClick"]),e.status===1?(b(),U(m,{key:0,type:"warning",link:"",onClick:p=>O(e,2)},{default:a(()=>l[23]||(l[23]=[s("设为休假")])),_:2},1032,["onClick"])):$("",!0),e.status===2?(b(),U(m,{key:1,type:"success",link:"",onClick:p=>O(e,1)},{default:a(()=>l[24]||(l[24]=[s("恢复正常")])),_:2},1032,["onClick"])):$("",!0),e.current_customer_count>0?(b(),U(m,{key:2,type:"warning",link:"",onClick:p=>ee(e)},{default:a(()=>l[25]||(l[25]=[s("转移客户")])),_:2},1032,["onClick"])):$("",!0),e.current_customer_count===0?(b(),U(m,{key:3,type:"danger",link:"",onClick:p=>le(e)},{default:a(()=>l[26]||(l[26]=[s("删除")])),_:2},1032,["onClick"])):$("",!0)]),_:1})]),_:1},8,["data"])),[[me,o(w).loading]]),_("div",lt,[t(de,{modelValue:o(w),"onUpdate:modelValue":l[3]||(l[3]=e=>T(w)?w.value=e:null),onChange:o(C)},null,8,["modelValue","onChange"])])]),_:1}),t(L,{modelValue:o(g),"onUpdate:modelValue":l[12]||(l[12]=e=>T(g)?g.value=e:null),title:o(d).id?"编辑顾问":"添加顾问",width:"600px"},{footer:a(()=>[t(m,{onClick:l[11]||(l[11]=e=>g.value=!1)},{default:a(()=>l[30]||(l[30]=[s("取消")])),_:1}),t(m,{type:"primary",onClick:Z},{default:a(()=>l[31]||(l[31]=[s("确定")])),_:1})]),default:a(()=>[t(R,{model:o(d),"label-width":"100px",rules:J,ref_key:"editFormRef",ref:N},{default:a(()=>[t(r,{label:"顾问姓名",prop:"advisor_name"},{default:a(()=>[t(v,{modelValue:o(d).advisor_name,"onUpdate:modelValue":l[4]||(l[4]=e=>o(d).advisor_name=e),placeholder:"输入姓名"},null,8,["modelValue"])]),_:1}),t(r,{label:"手机号",prop:"mobile"},{default:a(()=>[t(v,{modelValue:o(d).mobile,"onUpdate:modelValue":l[5]||(l[5]=e=>o(d).mobile=e),placeholder:"输入手机号"},null,8,["modelValue"])]),_:1}),t(r,{label:"企业微信"},{default:a(()=>[t(v,{modelValue:o(d).wechat,"onUpdate:modelValue":l[6]||(l[6]=e=>o(d).wechat=e),placeholder:"输入企业微信号"},null,8,["modelValue"])]),_:1}),t(r,{label:"邮箱"},{default:a(()=>[t(v,{modelValue:o(d).email,"onUpdate:modelValue":l[7]||(l[7]=e=>o(d).email=e),placeholder:"输入邮箱"},null,8,["modelValue"])]),_:1}),t(r,{label:"最大客户数"},{default:a(()=>[t(M,{modelValue:o(d).max_customer_count,"onUpdate:modelValue":l[8]||(l[8]=e=>o(d).max_customer_count=e),min:1,max:1e3},null,8,["modelValue"])]),_:1}),t(r,{label:"状态"},{default:a(()=>[t(ie,{modelValue:o(d).status,"onUpdate:modelValue":l[9]||(l[9]=e=>o(d).status=e)},{default:a(()=>[t(F,{label:1},{default:a(()=>l[27]||(l[27]=[s("正常")])),_:1}),t(F,{label:2},{default:a(()=>l[28]||(l[28]=[s("休假")])),_:1}),t(F,{label:0},{default:a(()=>l[29]||(l[29]=[s("离职")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"排序"},{default:a(()=>[t(M,{modelValue:o(d).sort,"onUpdate:modelValue":l[10]||(l[10]=e=>o(d).sort=e),min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(L,{modelValue:o(k),"onUpdate:modelValue":l[16]||(l[16]=e=>T(k)?k.value=e:null),title:"转移客户",width:"500px"},{footer:a(()=>[t(m,{onClick:l[15]||(l[15]=e=>k.value=!1)},{default:a(()=>l[32]||(l[32]=[s("取消")])),_:1}),t(m,{type:"primary",onClick:te},{default:a(()=>l[33]||(l[33]=[s("确定转移")])),_:1})]),default:a(()=>[t(ue,{type:"warning",closable:!1,class:"mb-4"},{default:a(()=>{var e;return[s(" 将 "+i((e=o(u))==null?void 0:e.advisor_name)+" 的所有客户转移给其他顾问 ",1)]}),_:1}),t(R,{model:o(c),"label-width":"100px"},{default:a(()=>[t(r,{label:"目标顾问"},{default:a(()=>[t(j,{modelValue:o(c).to_advisor_id,"onUpdate:modelValue":l[13]||(l[13]=e=>o(c).to_advisor_id=e),placeholder:"选择接收顾问",style:{width:"100%"}},{default:a(()=>[(b(!0),B(Be,null,Ne(o(P),e=>{var p;return b(),U(A,{key:e.id,label:`${e.advisor_name} (${e.current_customer_count}/${e.max_customer_count})`,value:e.id,disabled:e.id===((p=o(u))==null?void 0:p.id)},null,8,["label","value","disabled"])}),128))]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"转移原因"},{default:a(()=>[t(v,{modelValue:o(c).reason,"onUpdate:modelValue":l[14]||(l[14]=e=>o(c).reason=e),type:"textarea",rows:2,placeholder:"输入转移原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(L,{modelValue:o(S),"onUpdate:modelValue":l[17]||(l[17]=e=>T(S)?S.value=e:null),title:"顾问详情",width:"600px"},{default:a(()=>[o(u)?(b(),B("div",at,[t(re,{column:2,border:""},{default:a(()=>[t(f,{label:"顾问姓名"},{default:a(()=>[s(i(o(u).advisor_name),1)]),_:1}),t(f,{label:"手机号"},{default:a(()=>[s(i(o(u).mobile),1)]),_:1}),t(f,{label:"企业微信"},{default:a(()=>[s(i(o(u).wechat||"-"),1)]),_:1}),t(f,{label:"邮箱"},{default:a(()=>[s(i(o(u).email||"-"),1)]),_:1}),t(f,{label:"状态"},{default:a(()=>[t(z,{type:I(o(u).status)},{default:a(()=>[s(i(o(u).status_desc),1)]),_:1},8,["type"])]),_:1}),t(f,{label:"客户数"},{default:a(()=>[s(i(o(u).current_customer_count)+" / "+i(o(u).max_customer_count),1)]),_:1}),t(f,{label:"成交订单"},{default:a(()=>[s(i(o(u).total_order_count),1)]),_:1}),t(f,{label:"成交金额"},{default:a(()=>[s("¥"+i(o(u).total_order_amount),1)]),_:1}),t(f,{label:"转化率"},{default:a(()=>[s(i(o(u).conversion_rate)+"%",1)]),_:1}),t(f,{label:"创建时间"},{default:a(()=>[s(i(o(u).create_time),1)]),_:1})]),_:1})])):$("",!0)]),_:1},8,["modelValue"])])}}});export{Ot as default};
