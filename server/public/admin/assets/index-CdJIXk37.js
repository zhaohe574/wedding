import{G as Re,H as Te,d as Le,I as Me,D as Fe,B as Ne,C as Oe,J as Pe,K as Ye,i as qe,L as Ae,M as Be,N as he,a1 as He,g as je,O as Ge,P as Ke,T as Qe,U as Je,h as We,V as Xe,q as Ze,R as et,E as k,a as ie}from"./element-plus-ChK2e5qA.js";import{O as tt,P as lt,f as at,Q as ot,A as st,R as nt,j as dt}from"./@element-plus-C4Lf8veM.js";import{g as ut,a as it,b as rt,e as pt,c as mt,d as _t,t as ct,s as vt,f as ft,h as gt,r as yt}from"./coupon-Bb8ktR8y.js";import{c as bt}from"./service-CD4Egw8G.js";import{s as Vt}from"./staff-C0LmdmFi.js";import{d as xt,r as m,a0 as P,l as wt,c as Q,o as c,U as t,L as a,a as n,S as i,u as z,R as u,M as re,K as V,P as C,T as pe,ab as me}from"./@vue-ygbFPFRc.js";import{d as kt}from"./index-D465kfFn.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-DRRUpF4H.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DDSL_IW4.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";const Ct={class:"coupon-container"},Ut={class:"stat-content"},Et={class:"stat-value"},zt={class:"stat-content"},Dt={class:"stat-value"},St={class:"stat-content"},$t={class:"stat-value"},It={class:"stat-content"},Rt={class:"stat-value"},Tt={class:"coupon-info"},Lt={class:"coupon-name"},Mt={class:"name"},Ft={class:"discount-desc"},Nt={class:"valid-period"},Ot={class:"text-gray text-xs"},Pt={class:"text-xs"},Yt={class:"pagination-container"},qt={class:"ml-2 text-gray"},At={class:"flex items-center"},Bt={class:"ml-2"},ht={class:"ml-2 text-gray text-xs"},Ht={class:"user-info"},jt={class:"ml-2"},Gt={class:"pagination-container mt-4"},Kt=xt({__name:"index",setup(Qt){const Y=m(!1),J=m([]),W=m(0),I=m({}),X=m([]),Z=m([]),r=P({page_no:1,page_size:10,name:"",coupon_type:"",status:"",valid_type:""}),D=m(!1),q=m(!1),A=m(),o=P({id:"",name:"",coupon_type:1,threshold_amount:0,discount_amount:10,max_discount:0,total_count:0,per_limit:1,receive_time:[],valid_type:1,valid_time:[],valid_days:7,use_scope:1,scope_ids:[],status:1,remark:"",receive_count:0}),_e={name:[{required:!0,message:"请输入优惠券名称",trigger:"blur"}],coupon_type:[{required:!0,message:"请选择优惠券类型",trigger:"change"}],discount_amount:[{required:!0,message:"请输入优惠内容",trigger:"blur"}],valid_type:[{required:!0,message:"请选择有效期类型",trigger:"change"}]},R=m(!1),B=m(!1),ce=m(),T=m(null),p=P({send_type:1,user_id:"",user_ids_text:""}),ve={user_id:[{required:!0,message:"请输入用户ID",trigger:"blur"}]},h=m(!1),H=m(!1),ee=m([]),te=m(0),g=P({page_no:1,page_size:10,keyword:"",coupon_name:"",status:""}),U=async()=>{Y.value=!0;try{const s=await ut(r);J.value=s.lists||[],W.value=s.count||0}catch(s){console.error(s)}finally{Y.value=!1}},j=async()=>{try{const s=await it();I.value=s||{}}catch(s){console.error(s)}},le=()=>{r.page_no=1,U()},fe=()=>{r.name="",r.coupon_type="",r.status="",r.valid_type="",le()},ge=()=>{Object.assign(o,{id:"",name:"",coupon_type:1,threshold_amount:0,discount_amount:10,max_discount:0,total_count:0,per_limit:1,receive_time:[],valid_type:1,valid_time:[],valid_days:7,use_scope:1,scope_ids:[],status:1,remark:"",receive_count:0}),D.value=!0},ye=async s=>{try{const e=await rt({id:s.id});Object.assign(o,e),e.receive_start_time&&e.receive_end_time?o.receive_time=[M(e.receive_start_time),M(e.receive_end_time)]:o.receive_time=[],e.valid_type===1&&e.valid_start_time&&e.valid_end_time&&(o.valid_time=[M(e.valid_start_time),M(e.valid_end_time)]),D.value=!0}catch(e){console.error(e)}},be=async()=>{var e,_;if(!A.value)return;await A.value.validate();const s={...o};((e=s.receive_time)==null?void 0:e.length)===2?(s.receive_start_time=s.receive_time[0],s.receive_end_time=s.receive_time[1]):(s.receive_start_time="",s.receive_end_time=""),delete s.receive_time,s.valid_type===1&&((_=s.valid_time)==null?void 0:_.length)===2&&(s.valid_start_time=s.valid_time[0],s.valid_end_time=s.valid_time[1]),delete s.valid_time,q.value=!0;try{s.id?(await pt(s),k.success("编辑成功")):(await mt(s),k.success("添加成功")),D.value=!1,U(),j()}catch(x){console.error(x)}finally{q.value=!1}},Ve=s=>{ie.confirm("确定要删除该优惠券吗？","提示",{type:"warning"}).then(async()=>{await _t({id:s.id}),k.success("删除成功"),U(),j()}).catch(()=>{})},xe=async s=>{try{await ct({id:s.id}),k.success("操作成功")}catch{s.status=s.status===1?0:1}},we=s=>{T.value=s,p.send_type=1,p.user_id="",p.user_ids_text="",R.value=!0},ke=async()=>{if(T.value){B.value=!0;try{if(p.send_type===1){if(!p.user_id){k.warning("请输入用户ID");return}await vt({coupon_id:T.value.id,user_id:p.user_id})}else{if(!p.user_ids_text){k.warning("请输入用户ID列表");return}const s=p.user_ids_text.split(",").map(e=>parseInt(e.trim())).filter(e=>!isNaN(e));if(!s.length){k.warning("请输入有效的用户ID");return}await ft({coupon_id:T.value.id,user_ids:s})}k.success("发放成功"),R.value=!1,U()}catch(s){console.error(s)}finally{B.value=!1}}},L=async()=>{H.value=!0;try{const s=await gt(g);ee.value=s.lists||[],te.value=s.count||0}catch(s){console.error(s)}finally{H.value=!1}},Ce=s=>{ie.confirm("确定要撤回该优惠券吗？","提示",{type:"warning"}).then(async()=>{await yt({user_coupon_id:s.id}),k.success("撤回成功"),L()}).catch(()=>{})},Ue=s=>({1:"danger",2:"warning",3:"success"})[s]||"info",Ee=s=>({1:"",2:"warning",3:"info"})[s]||"",ze=s=>({0:"success",1:"info",2:"danger"})[s]||"",De=async()=>{try{const s=await bt();X.value=s||[]}catch(s){console.error(s)}},Se=async()=>{try{const s=await Vt({status:1});Z.value=s||[]}catch(s){console.error(s)}},M=s=>{const e=new Date(s*1e3),_=x=>String(x).padStart(2,"0");return`${e.getFullYear()}-${_(e.getMonth()+1)}-${_(e.getDate())} ${_(e.getHours())}:${_(e.getMinutes())}:${_(e.getSeconds())}`};return wt(()=>{U(),j(),De(),Se()}),(s,e)=>{const _=Le,x=Te,F=Re,$e=Me,E=Oe,d=Ne,y=Ye,S=Pe,f=qe,N=Fe,G=he,v=Be,Ie=He,ae=je,oe=Ae,se=Ke,w=Je,O=Qe,$=We,ne=Xe,de=Ze,K=et,ue=Ge;return c(),Q("div",Ct,[t($e,{gutter:16,class:"mb-4"},{default:a(()=>[t(F,{span:6},{default:a(()=>[t(x,{shadow:"hover",class:"stat-card"},{default:a(()=>[n("div",Ut,[e[36]||(e[36]=n("div",{class:"stat-label"},"优惠券总数",-1)),n("div",Et,i(I.value.total_count||0),1)]),t(_,{class:"stat-icon",size:40},{default:a(()=>[t(z(tt))]),_:1})]),_:1})]),_:1}),t(F,{span:6},{default:a(()=>[t(x,{shadow:"hover",class:"stat-card success"},{default:a(()=>[n("div",zt,[e[37]||(e[37]=n("div",{class:"stat-label"},"已发放",-1)),n("div",Dt,i(I.value.total_receive||0),1)]),t(_,{class:"stat-icon",size:40},{default:a(()=>[t(z(lt))]),_:1})]),_:1})]),_:1}),t(F,{span:6},{default:a(()=>[t(x,{shadow:"hover",class:"stat-card warning"},{default:a(()=>[n("div",St,[e[38]||(e[38]=n("div",{class:"stat-label"},"已使用",-1)),n("div",$t,i(I.value.total_used||0),1)]),t(_,{class:"stat-icon",size:40},{default:a(()=>[t(z(at))]),_:1})]),_:1})]),_:1}),t(F,{span:6},{default:a(()=>[t(x,{shadow:"hover",class:"stat-card info"},{default:a(()=>[n("div",It,[e[39]||(e[39]=n("div",{class:"stat-label"},"使用率",-1)),n("div",Rt,i(I.value.use_rate||"0%"),1)]),t(_,{class:"stat-icon",size:40},{default:a(()=>[t(z(ot))]),_:1})]),_:1})]),_:1})]),_:1}),t(x,{shadow:"never",class:"mb-4"},{default:a(()=>[t(N,{model:r,inline:""},{default:a(()=>[t(d,{label:"优惠券名称"},{default:a(()=>[t(E,{modelValue:r.name,"onUpdate:modelValue":e[0]||(e[0]=l=>r.name=l),placeholder:"请输入",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),t(d,{label:"类型"},{default:a(()=>[t(S,{modelValue:r.coupon_type,"onUpdate:modelValue":e[1]||(e[1]=l=>r.coupon_type=l),placeholder:"请选择",clearable:"",style:{width:"120px"}},{default:a(()=>[t(y,{label:"满减券",value:1}),t(y,{label:"折扣券",value:2}),t(y,{label:"立减券",value:3})]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"状态"},{default:a(()=>[t(S,{modelValue:r.status,"onUpdate:modelValue":e[2]||(e[2]=l=>r.status=l),placeholder:"请选择",clearable:"",style:{width:"120px"}},{default:a(()=>[t(y,{label:"启用",value:1}),t(y,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"有效期类型"},{default:a(()=>[t(S,{modelValue:r.valid_type,"onUpdate:modelValue":e[3]||(e[3]=l=>r.valid_type=l),placeholder:"请选择",clearable:"",style:{width:"140px"}},{default:a(()=>[t(y,{label:"固定日期",value:1}),t(y,{label:"领取后N天",value:2})]),_:1},8,["modelValue"])]),_:1}),t(d,null,{default:a(()=>[t(f,{type:"primary",onClick:le},{default:a(()=>e[40]||(e[40]=[u("搜索")])),_:1}),t(f,{onClick:fe},{default:a(()=>e[41]||(e[41]=[u("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(x,{shadow:"never",class:"mb-4"},{default:a(()=>[t(f,{type:"primary",onClick:ge},{default:a(()=>[t(_,null,{default:a(()=>[t(z(st))]),_:1}),e[42]||(e[42]=u(" 新建优惠券 "))]),_:1}),t(f,{onClick:e[4]||(e[4]=l=>h.value=!0)},{default:a(()=>[t(_,null,{default:a(()=>[t(z(nt))]),_:1}),e[43]||(e[43]=u(" 用户优惠券 "))]),_:1})]),_:1}),t(x,{shadow:"never"},{default:a(()=>[re((c(),V(oe,{data:J.value,"row-key":"id"},{default:a(()=>[t(v,{label:"优惠券信息","min-width":"280"},{default:a(({row:l})=>[n("div",Tt,[n("div",Lt,[n("span",Mt,i(l.name),1),t(G,{type:Ue(l.coupon_type),size:"small"},{default:a(()=>[u(i(l.coupon_type_text),1)]),_:2},1032,["type"])]),n("div",Ft,i(l.discount_desc),1),n("div",Nt,[t(_,null,{default:a(()=>[t(z(dt))]),_:1}),u(" "+i(l.valid_period),1)])])]),_:1}),t(v,{label:"使用范围",width:"120"},{default:a(({row:l})=>[t(G,{type:Ee(l.use_scope),size:"small"},{default:a(()=>[u(i(l.use_scope_text),1)]),_:2},1032,["type"])]),_:1}),t(v,{label:"发放/领取",width:"120",align:"center"},{default:a(({row:l})=>[n("div",null,i(l.receive_count)+" / "+i(l.total_count||"不限"),1),n("div",Ot,"剩余: "+i(l.remain_count),1)]),_:1}),t(v,{label:"已使用",width:"80",align:"center",prop:"used_count"}),t(v,{label:"使用率",width:"100",align:"center"},{default:a(({row:l})=>[t(Ie,{percentage:parseFloat(l.use_rate)||0,"stroke-width":6,"show-text":!1},null,8,["percentage"]),n("span",Pt,i(l.use_rate),1)]),_:1}),t(v,{label:"状态",width:"100",align:"center"},{default:a(({row:l})=>[t(ae,{modelValue:l.status,"onUpdate:modelValue":b=>l.status=b,"active-value":1,"inactive-value":0,onChange:b=>xe(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(v,{label:"创建时间",width:"160",prop:"create_time_text"}),t(v,{label:"操作",width:"180",fixed:"right"},{default:a(({row:l})=>[t(f,{link:"",type:"primary",onClick:b=>ye(l)},{default:a(()=>e[44]||(e[44]=[u("编辑")])),_:2},1032,["onClick"]),t(f,{link:"",type:"success",onClick:b=>we(l)},{default:a(()=>e[45]||(e[45]=[u("发放")])),_:2},1032,["onClick"]),t(f,{link:"",type:"danger",onClick:b=>Ve(l)},{default:a(()=>e[46]||(e[46]=[u("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ue,Y.value]]),n("div",Yt,[t(se,{"current-page":r.page_no,"onUpdate:currentPage":e[5]||(e[5]=l=>r.page_no=l),"page-size":r.page_size,"onUpdate:pageSize":e[6]||(e[6]=l=>r.page_size=l),"page-sizes":[10,20,50,100],total:W.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:U,onCurrentChange:U},null,8,["current-page","page-size","total"])])]),_:1}),t(K,{modelValue:D.value,"onUpdate:modelValue":e[24]||(e[24]=l=>D.value=l),title:o.id?"编辑优惠券":"新建优惠券",width:"650px","destroy-on-close":""},{footer:a(()=>[t(f,{onClick:e[23]||(e[23]=l=>D.value=!1)},{default:a(()=>e[63]||(e[63]=[u("取消")])),_:1}),t(f,{type:"primary",loading:q.value,onClick:be},{default:a(()=>e[64]||(e[64]=[u("确定")])),_:1},8,["loading"])]),default:a(()=>[t(N,{ref_key:"editFormRef",ref:A,model:o,rules:_e,"label-width":"100px"},{default:a(()=>[t(d,{label:"优惠券名称",prop:"name"},{default:a(()=>[t(E,{modelValue:o.name,"onUpdate:modelValue":e[7]||(e[7]=l=>o.name=l),placeholder:"请输入优惠券名称",maxlength:"100"},null,8,["modelValue"])]),_:1}),t(d,{label:"优惠券类型",prop:"coupon_type"},{default:a(()=>[t(O,{modelValue:o.coupon_type,"onUpdate:modelValue":e[8]||(e[8]=l=>o.coupon_type=l),disabled:!!o.id&&o.receive_count>0},{default:a(()=>[t(w,{label:1},{default:a(()=>e[47]||(e[47]=[u("满减券")])),_:1}),t(w,{label:2},{default:a(()=>e[48]||(e[48]=[u("折扣券")])),_:1}),t(w,{label:3},{default:a(()=>e[49]||(e[49]=[u("立减券")])),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),t(d,{label:"使用门槛",prop:"threshold_amount"},{default:a(()=>[t($,{modelValue:o.threshold_amount,"onUpdate:modelValue":e[9]||(e[9]=l=>o.threshold_amount=l),min:0,precision:2,disabled:!!o.id&&o.receive_count>0},null,8,["modelValue","disabled"]),e[50]||(e[50]=n("span",{class:"ml-2 text-gray"},"元（0表示无门槛）",-1))]),_:1}),t(d,{label:"优惠内容",prop:"discount_amount"},{default:a(()=>[t($,{modelValue:o.discount_amount,"onUpdate:modelValue":e[10]||(e[10]=l=>o.discount_amount=l),min:.01,precision:2,disabled:!!o.id&&o.receive_count>0},null,8,["modelValue","disabled"]),n("span",qt,i(o.coupon_type===2?"折（如90表示9折）":"元"),1)]),_:1}),o.coupon_type===2?(c(),V(d,{key:0,label:"最大优惠",prop:"max_discount"},{default:a(()=>[t($,{modelValue:o.max_discount,"onUpdate:modelValue":e[11]||(e[11]=l=>o.max_discount=l),min:0,precision:2,disabled:!!o.id&&o.receive_count>0},null,8,["modelValue","disabled"]),e[51]||(e[51]=n("span",{class:"ml-2 text-gray"},"元（0表示不限）",-1))]),_:1})):C("",!0),t(d,{label:"发放总量",prop:"total_count"},{default:a(()=>[t($,{modelValue:o.total_count,"onUpdate:modelValue":e[12]||(e[12]=l=>o.total_count=l),min:0},null,8,["modelValue"]),e[52]||(e[52]=n("span",{class:"ml-2 text-gray"},"张（0表示不限）",-1))]),_:1}),t(d,{label:"每人限领",prop:"per_limit"},{default:a(()=>[t($,{modelValue:o.per_limit,"onUpdate:modelValue":e[13]||(e[13]=l=>o.per_limit=l),min:0},null,8,["modelValue"]),e[53]||(e[53]=n("span",{class:"ml-2 text-gray"},"张（0表示不限）",-1))]),_:1}),t(d,{label:"领取时间",prop:"receive_time"},{default:a(()=>[t(ne,{modelValue:o.receive_time,"onUpdate:modelValue":e[14]||(e[14]=l=>o.receive_time=l),type:"datetimerange","value-format":"YYYY-MM-DD HH:mm:ss","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"]),e[54]||(e[54]=n("div",{class:"text-gray text-xs mt-1"},"不填写表示不限制领取时间",-1))]),_:1}),t(d,{label:"有效期类型",prop:"valid_type"},{default:a(()=>[t(O,{modelValue:o.valid_type,"onUpdate:modelValue":e[15]||(e[15]=l=>o.valid_type=l),disabled:!!o.id&&o.receive_count>0},{default:a(()=>[t(w,{label:1},{default:a(()=>e[55]||(e[55]=[u("固定日期")])),_:1}),t(w,{label:2},{default:a(()=>e[56]||(e[56]=[u("领取后N天")])),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),o.valid_type===1?(c(),V(d,{key:1,label:"有效期",prop:"valid_time"},{default:a(()=>[t(ne,{modelValue:o.valid_time,"onUpdate:modelValue":e[16]||(e[16]=l=>o.valid_time=l),type:"datetimerange","value-format":"YYYY-MM-DD HH:mm:ss","start-placeholder":"开始日期","end-placeholder":"结束日期",disabled:!!o.id&&o.receive_count>0},null,8,["modelValue","disabled"])]),_:1})):C("",!0),o.valid_type===2?(c(),V(d,{key:2,label:"有效天数",prop:"valid_days"},{default:a(()=>[t($,{modelValue:o.valid_days,"onUpdate:modelValue":e[17]||(e[17]=l=>o.valid_days=l),min:1,disabled:!!o.id&&o.receive_count>0},null,8,["modelValue","disabled"]),e[57]||(e[57]=n("span",{class:"ml-2 text-gray"},"天",-1))]),_:1})):C("",!0),t(d,{label:"使用范围",prop:"use_scope"},{default:a(()=>[t(O,{modelValue:o.use_scope,"onUpdate:modelValue":e[18]||(e[18]=l=>o.use_scope=l),disabled:!!o.id&&o.receive_count>0},{default:a(()=>[t(w,{label:1},{default:a(()=>e[58]||(e[58]=[u("全部可用")])),_:1}),t(w,{label:2},{default:a(()=>e[59]||(e[59]=[u("指定分类")])),_:1}),t(w,{label:3},{default:a(()=>e[60]||(e[60]=[u("指定人员")])),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),o.use_scope===2?(c(),V(d,{key:3,label:"选择分类",prop:"scope_ids"},{default:a(()=>[t(S,{modelValue:o.scope_ids,"onUpdate:modelValue":e[19]||(e[19]=l=>o.scope_ids=l),multiple:"",placeholder:"请选择服务分类",style:{width:"100%"},disabled:!!o.id&&o.receive_count>0},{default:a(()=>[(c(!0),Q(pe,null,me(X.value,l=>(c(),V(y,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e[61]||(e[61]=n("div",{class:"text-gray text-xs mt-1"},"选择后，优惠券仅可用于所选分类下的服务",-1))]),_:1})):C("",!0),o.use_scope===3?(c(),V(d,{key:4,label:"选择人员",prop:"scope_ids"},{default:a(()=>[t(S,{modelValue:o.scope_ids,"onUpdate:modelValue":e[20]||(e[20]=l=>o.scope_ids=l),multiple:"",filterable:"",placeholder:"请选择工作人员",style:{width:"100%"},disabled:!!o.id&&o.receive_count>0},{default:a(()=>[(c(!0),Q(pe,null,me(Z.value,l=>(c(),V(y,{key:l.id,label:`${l.name} - ${l.category_name}`,value:l.id},{default:a(()=>[n("div",At,[t(de,{size:24,src:l.avatar},{default:a(()=>{var b;return[u(i((b=l.name)==null?void 0:b.charAt(0)),1)]}),_:2},1032,["src"]),n("span",Bt,i(l.name),1),n("span",ht,i(l.category_name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e[62]||(e[62]=n("div",{class:"text-gray text-xs mt-1"},"选择后，优惠券仅可用于所选工作人员的服务",-1))]),_:1})):C("",!0),t(d,{label:"状态",prop:"status"},{default:a(()=>[t(ae,{modelValue:o.status,"onUpdate:modelValue":e[21]||(e[21]=l=>o.status=l),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),t(d,{label:"备注",prop:"remark"},{default:a(()=>[t(E,{modelValue:o.remark,"onUpdate:modelValue":e[22]||(e[22]=l=>o.remark=l),type:"textarea",rows:2,placeholder:"请输入备注",maxlength:"255"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(K,{modelValue:R.value,"onUpdate:modelValue":e[29]||(e[29]=l=>R.value=l),title:"发放优惠券",width:"500px","destroy-on-close":""},{footer:a(()=>[t(f,{onClick:e[28]||(e[28]=l=>R.value=!1)},{default:a(()=>e[67]||(e[67]=[u("取消")])),_:1}),t(f,{type:"primary",loading:B.value,onClick:ke},{default:a(()=>e[68]||(e[68]=[u("发放")])),_:1},8,["loading"])]),default:a(()=>[t(N,{ref_key:"sendFormRef",ref:ce,model:p,rules:ve,"label-width":"100px"},{default:a(()=>[t(d,{label:"优惠券"},{default:a(()=>{var l;return[n("span",null,i((l=T.value)==null?void 0:l.name),1)]}),_:1}),t(d,{label:"发放方式"},{default:a(()=>[t(O,{modelValue:p.send_type,"onUpdate:modelValue":e[25]||(e[25]=l=>p.send_type=l)},{default:a(()=>[t(w,{label:1},{default:a(()=>e[65]||(e[65]=[u("指定用户")])),_:1}),t(w,{label:2},{default:a(()=>e[66]||(e[66]=[u("批量发放")])),_:1})]),_:1},8,["modelValue"])]),_:1}),p.send_type===1?(c(),V(d,{key:0,label:"用户ID",prop:"user_id"},{default:a(()=>[t(E,{modelValue:p.user_id,"onUpdate:modelValue":e[26]||(e[26]=l=>p.user_id=l),modelModifiers:{number:!0},placeholder:"请输入用户ID"},null,8,["modelValue"])]),_:1})):C("",!0),p.send_type===2?(c(),V(d,{key:1,label:"用户ID列表",prop:"user_ids"},{default:a(()=>[t(E,{modelValue:p.user_ids_text,"onUpdate:modelValue":e[27]||(e[27]=l=>p.user_ids_text=l),type:"textarea",rows:4,placeholder:"请输入用户ID，多个用英文逗号分隔"},null,8,["modelValue"])]),_:1})):C("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(K,{modelValue:h.value,"onUpdate:modelValue":e[35]||(e[35]=l=>h.value=l),title:"用户优惠券",width:"900px","destroy-on-close":""},{default:a(()=>[t(N,{model:g,inline:"",class:"mb-4"},{default:a(()=>[t(d,{label:"用户"},{default:a(()=>[t(E,{modelValue:g.keyword,"onUpdate:modelValue":e[30]||(e[30]=l=>g.keyword=l),placeholder:"昵称/手机号",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),t(d,{label:"优惠券"},{default:a(()=>[t(E,{modelValue:g.coupon_name,"onUpdate:modelValue":e[31]||(e[31]=l=>g.coupon_name=l),placeholder:"优惠券名称",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),t(d,{label:"状态"},{default:a(()=>[t(S,{modelValue:g.status,"onUpdate:modelValue":e[32]||(e[32]=l=>g.status=l),placeholder:"请选择",clearable:"",style:{width:"100px"}},{default:a(()=>[t(y,{label:"未使用",value:0}),t(y,{label:"已使用",value:1}),t(y,{label:"已过期",value:2})]),_:1},8,["modelValue"])]),_:1}),t(d,null,{default:a(()=>[t(f,{type:"primary",onClick:L},{default:a(()=>e[69]||(e[69]=[u("搜索")])),_:1})]),_:1})]),_:1},8,["model"]),re((c(),V(oe,{data:ee.value,"max-height":"400"},{default:a(()=>[t(v,{label:"用户",width:"150"},{default:a(({row:l})=>[n("div",Ht,[t(de,{size:28,src:l.user_avatar},{default:a(()=>{var b;return[u(i((b=l.user_nickname)==null?void 0:b.charAt(0)),1)]}),_:2},1032,["src"]),n("span",jt,i(l.user_nickname||"-"),1)])]),_:1}),t(v,{label:"优惠券","min-width":"150",prop:"coupon_name"}),t(v,{label:"优惠券码",width:"180",prop:"coupon_sn"}),t(v,{label:"状态",width:"80"},{default:a(({row:l})=>[t(G,{type:ze(l.status),size:"small"},{default:a(()=>[u(i(l.status_text),1)]),_:2},1032,["type"])]),_:1}),t(v,{label:"有效期",width:"180",prop:"valid_period"}),t(v,{label:"操作",width:"80"},{default:a(({row:l})=>[l.status===0?(c(),V(f,{key:0,link:"",type:"danger",onClick:b=>Ce(l)},{default:a(()=>e[70]||(e[70]=[u(" 撤回 ")])),_:2},1032,["onClick"])):C("",!0)]),_:1})]),_:1},8,["data"])),[[ue,H.value]]),n("div",Gt,[t(se,{"current-page":g.page_no,"onUpdate:currentPage":e[33]||(e[33]=l=>g.page_no=l),"page-size":g.page_size,"onUpdate:pageSize":e[34]||(e[34]=l=>g.page_size=l),"page-sizes":[10,20,50],total:te.value,layout:"total, sizes, prev, pager, next",onSizeChange:L,onCurrentChange:L},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue"])])}}}),$l=kt(Kt,[["__scopeId","data-v-bc9d1b8e"]]);export{$l as default};
