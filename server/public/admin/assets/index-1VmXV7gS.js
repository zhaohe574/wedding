import{D as U,B as q,V as H,i as K,H as Q,G as J,d as X,I as Z,T as $,aa as tt}from"./element-plus-ChK2e5qA.js";import{t as et,u as at,w as st}from"./financial-BtVBj2RS.js";import{i as V}from"./echarts-DRRUpF4H.js";import{d as ot,r as f,a0 as nt,l as lt,ah as g,c as rt,o as C,U as e,L as a,R as _,a as o,S as r,O as S,K as k,Q as B}from"./@vue-ygbFPFRc.js";import{d as it}from"./index-D465kfFn.js";import"./@element-plus-C4Lf8veM.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DDSL_IW4.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";const dt={class:"financial-overview"},ut={class:"stat-value text-primary"},ct={class:"stat-footer"},mt={class:"stat-value text-warning"},pt={class:"stat-footer"},_t={class:"stat-value text-success"},ft={class:"stat-footer"},vt={class:"text-muted"},yt={class:"flex justify-between items-center"},gt={class:"stat-value-mini"},wt={class:"flex justify-between items-center"},ht={class:"stat-value-mini"},xt={class:"flex justify-between items-center"},bt={class:"stat-value-mini"},Dt={class:"flex justify-between items-center"},Ct={class:"stat-value-mini"},St={class:"flex justify-between items-center"},Tt=ot({__name:"index",setup(Et){const v=f([]),d=nt({start_date:"",end_date:""}),n=f({}),y=f("daily"),w=f(null),h=f(null);let x=null,b=null;const O=[{text:"今天",value:()=>[new Date,new Date]},{text:"本周",value:()=>{const s=new Date,t=new Date;return t.setTime(t.getTime()-(t.getDay()-1)*24*60*60*1e3),[t,s]}},{text:"本月",value:()=>{const s=new Date;return[new Date(s.getFullYear(),s.getMonth(),1),s]}},{text:"近30天",value:()=>{const s=new Date,t=new Date;return t.setTime(t.getTime()-29*24*60*60*1e3),[t,s]}}],c=s=>(Number(s)||0).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}),T=s=>{s?(d.start_date=s[0],d.end_date=s[1]):(d.start_date="",d.end_date="")},E=async()=>{try{const s=await et(d);n.value=s||{},F(),z()}catch(s){console.error(s)}},F=async()=>{try{const s={type:y.value};y.value==="daily"?(s.start_date=d.start_date,s.end_date=d.end_date):s.year=new Date().getFullYear();const t=await at(s);W(t.data||{})}catch(s){console.error(s)}},z=async()=>{try{const s=await st(d);j(s.list||[])}catch(s){console.error(s)}},W=s=>{if(!w.value)return;x||(x=V(w.value));const t=Object.keys(s),u=Object.values(s);x.setOption({tooltip:{trigger:"axis"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:t,boundaryGap:!1},yAxis:{type:"value",axisLabel:{formatter:"¥{value}"}},series:[{name:"收入",type:"line",smooth:!0,data:u,areaStyle:{opacity:.3},itemStyle:{color:"#409EFF"}}]})},j=s=>{if(!h.value)return;b||(b=V(h.value));const t=s.filter(u=>u.amount>0).map(u=>({name:u.label,value:u.amount}));b.setOption({tooltip:{trigger:"item",formatter:"{b}: ¥{c} ({d}%)"},legend:{orient:"vertical",left:"left"},series:[{type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1},emphasis:{label:{show:!0,fontSize:14,fontWeight:"bold"}},data:t}]})};return lt(()=>{const s=new Date,t=new Date(s.getFullYear(),s.getMonth(),1);v.value=[t.toISOString().split("T")[0],s.toISOString().split("T")[0]],T(v.value),E()}),(s,t)=>{const u=H,M=q,I=K,Y=U,l=Q,m=X,i=J,D=Z,L=g("Money"),N=g("Document"),P=g("ShoppingCart"),A=g("Calendar"),R=tt,G=$;return C(),rt("div",dt,[e(l,{class:"!border-none mb-4",shadow:"never"},{default:a(()=>[e(Y,{model:d,inline:""},{default:a(()=>[e(M,{label:"统计周期"},{default:a(()=>[e(u,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=p=>v.value=p),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",shortcuts:O,onChange:T},null,8,["modelValue"])]),_:1}),e(M,null,{default:a(()=>[e(I,{type:"primary",onClick:E},{default:a(()=>t[2]||(t[2]=[_("查询")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(D,{gutter:16,class:"mb-4"},{default:a(()=>[e(i,{span:6},{default:a(()=>[e(l,{class:"stat-card",shadow:"never"},{default:a(()=>[t[4]||(t[4]=o("div",{class:"stat-title"},"总收入",-1)),o("div",ut,"¥"+r(c(n.value.total_income)),1),o("div",ct,[o("span",{class:S(n.value.income_growth>=0?"text-success":"text-danger")},[e(m,null,{default:a(()=>[(C(),k(B(n.value.income_growth>=0?"Top":"Bottom")))]),_:1}),_(" "+r(Math.abs(n.value.income_growth))+"% ",1)],2),t[3]||(t[3]=o("span",{class:"text-muted"},"环比",-1))])]),_:1})]),_:1}),e(i,{span:6},{default:a(()=>[e(l,{class:"stat-card",shadow:"never"},{default:a(()=>[t[6]||(t[6]=o("div",{class:"stat-title"},"总退款",-1)),o("div",mt,"¥"+r(c(n.value.total_refund)),1),o("div",pt,[o("span",{class:S(n.value.refund_growth>=0?"text-danger":"text-success")},[e(m,null,{default:a(()=>[(C(),k(B(n.value.refund_growth>=0?"Top":"Bottom")))]),_:1}),_(" "+r(Math.abs(n.value.refund_growth))+"% ",1)],2),t[5]||(t[5]=o("span",{class:"text-muted"},"环比",-1))])]),_:1})]),_:1}),e(i,{span:6},{default:a(()=>[e(l,{class:"stat-card",shadow:"never"},{default:a(()=>[t[7]||(t[7]=o("div",{class:"stat-title"},"净收入",-1)),o("div",_t,"¥"+r(c(n.value.net_income)),1),t[8]||(t[8]=o("div",{class:"stat-footer"},[o("span",{class:"text-muted"},"收入 - 退款")],-1))]),_:1})]),_:1}),e(i,{span:6},{default:a(()=>[e(l,{class:"stat-card",shadow:"never"},{default:a(()=>[t[9]||(t[9]=o("div",{class:"stat-title"},"毛利润",-1)),o("div",{class:S(["stat-value",n.value.gross_profit>=0?"text-success":"text-danger"])}," ¥"+r(c(n.value.gross_profit)),3),o("div",ft,[o("span",vt,"利润率 "+r(n.value.profit_rate)+"%",1)])]),_:1})]),_:1})]),_:1}),e(D,{gutter:16,class:"mb-4"},{default:a(()=>[e(i,{span:6},{default:a(()=>[e(l,{class:"stat-card-mini",shadow:"never"},{default:a(()=>[o("div",yt,[o("div",null,[t[10]||(t[10]=o("div",{class:"stat-title-mini"},"总成本",-1)),o("div",gt,"¥"+r(c(n.value.total_cost)),1)]),e(m,{class:"stat-icon",size:40},{default:a(()=>[e(L)]),_:1})])]),_:1})]),_:1}),e(i,{span:6},{default:a(()=>[e(l,{class:"stat-card-mini",shadow:"never"},{default:a(()=>[o("div",wt,[o("div",null,[t[11]||(t[11]=o("div",{class:"stat-title-mini"},"订单数",-1)),o("div",ht,r(n.value.order_count),1)]),e(m,{class:"stat-icon",size:40},{default:a(()=>[e(N)]),_:1})])]),_:1})]),_:1}),e(i,{span:6},{default:a(()=>[e(l,{class:"stat-card-mini",shadow:"never"},{default:a(()=>[o("div",xt,[o("div",null,[t[12]||(t[12]=o("div",{class:"stat-title-mini"},"客单价",-1)),o("div",bt,"¥"+r(c(n.value.avg_order_amount)),1)]),e(m,{class:"stat-icon",size:40},{default:a(()=>[e(P)]),_:1})])]),_:1})]),_:1}),e(i,{span:6},{default:a(()=>[e(l,{class:"stat-card-mini",shadow:"never"},{default:a(()=>{var p;return[o("div",Dt,[o("div",null,[t[13]||(t[13]=o("div",{class:"stat-title-mini"},"统计天数",-1)),o("div",Ct,r(((p=n.value.period)==null?void 0:p.days)||0)+" 天",1)]),e(m,{class:"stat-icon",size:40},{default:a(()=>[e(A)]),_:1})])]}),_:1})]),_:1})]),_:1}),e(D,{gutter:16},{default:a(()=>[e(i,{span:16},{default:a(()=>[e(l,{class:"!border-none",shadow:"never"},{header:a(()=>[o("div",St,[t[16]||(t[16]=o("span",null,"收入趋势",-1)),e(G,{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=p=>y.value=p),size:"small",onChange:F},{default:a(()=>[e(R,{label:"daily"},{default:a(()=>t[14]||(t[14]=[_("日")])),_:1}),e(R,{label:"monthly"},{default:a(()=>t[15]||(t[15]=[_("月")])),_:1})]),_:1},8,["modelValue"])])]),default:a(()=>[o("div",{ref_key:"trendChartRef",ref:w,style:{height:"300px"}},null,512)]),_:1})]),_:1}),e(i,{span:8},{default:a(()=>[e(l,{class:"!border-none",shadow:"never"},{header:a(()=>t[17]||(t[17]=[_("支付方式分布")])),default:a(()=>[o("div",{ref_key:"payWayChartRef",ref:h,style:{height:"300px"}},null,512)]),_:1})]),_:1})]),_:1})])}}}),le=it(Tt,[["__scopeId","data-v-5feebc52"]]);export{le as default};
