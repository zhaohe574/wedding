import{H as Q,B as W,C as X,h as Z,g as tt,T as et,U as at,J as ot,K as lt,i as nt,D as st,E as k}from"./element-plus-ChK2e5qA.js";import{b as it,d as rt}from"./index-D465kfFn.js";import{_ as dt}from"./picker-mSew3b7I.js";import{I as ut}from"./@element-plus-C4Lf8veM.js";import{D as mt}from"./vuedraggable-RHgmLr3o.js";import{i as pt,b as $}from"./coupon-Bb8ktR8y.js";import{d as ct,b as _t,r as C,l as ft,c as p,o as u,U as l,L as i,a as s,K as E,P as g,u as n,R as h,S as f,T as N,ab as R,i as vt}from"./@vue-ygbFPFRc.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-DRRUpF4H.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DDSL_IW4.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";import"./index-n-Jqn6Y-.js";import"./index.vue_vue_type_script_setup_true_lang-CCtv5BMP.js";import"./article-Be81dFL2.js";import"./usePaging-B2jDzebD.js";import"./vue-CQyKTslw.js";import"./sortablejs-BvvSZPRv.js";const yt={class:"coupon-list"},xt={class:"coupon-item mb-4 p-4 bg-gray-50 rounded-lg"},bt={class:"flex items-start"},gt={class:"drag-handle cursor-move mr-3 mt-2"},ht={class:"flex-1 min-w-0"},Vt={class:"flex items-center gap-2 flex-wrap mb-2"},wt={class:"font-medium text-gray-900"},kt={key:0,class:"px-2 py-0.5 bg-orange-100 rounded text-xs text-orange-600"},Ct={key:0,class:"text-xs text-gray-500 mb-2"},Et={key:0},At={class:"ml-4 flex flex-col gap-2 flex-shrink-0"},Dt={class:"mt-2"},Ut=ct({__name:"attr",props:{content:{type:Object,default:()=>({})},styles:{type:Object,default:()=>({})}},emits:["update:content"],setup(F,{emit:I}){const V=I,v=F,o=_t({get:()=>v.content,set:e=>{V("update:content",e)}});function O(){var e;Array.isArray((e=v.content)==null?void 0:e.data)||V("update:content",{...v.content,data:[]})}const c=C([]),y=C(""),x=C(!1);ft(()=>{O(),L()});async function L(){try{const e=await pt();c.value=Array.isArray(e)?e:(e==null?void 0:e.lists)??(e==null?void 0:e.data)??[]}catch(e){console.error("加载优惠券列表失败",e),c.value=[]}}function M(e){const t=c.value.find(r=>r.id===e);return(t==null?void 0:t.name)||""}function T(e){if(!e)return"";const t=new Date(e*1e3);return`${t.getFullYear()}.${String(t.getMonth()+1).padStart(2,"0")}.${String(t.getDate()).padStart(2,"0")}`}function j(e){return e.valid_type==2&&e.valid_days?`领取后${e.valid_days}天内有效`:e.valid_end_time?`${T(e.valid_end_time)} 到期`:"长期有效"}function A(e,t){return{coupon_id:e.id,is_show:t??"1",sort:0,name:e.name,coupon_type:e.coupon_type,discount_amount:e.discount_amount,threshold_amount:e.threshold_amount,valid_type:e.valid_type,valid_days:e.valid_days,valid_start_time:e.valid_start_time,valid_end_time:e.valid_end_time,total_count:e.total_count,receive_count:e.receive_count}}async function K(e,t){if(t){x.value=!0;try{const r=await $({id:t});if(!r||!r.id)return;const d=Array.isArray(o.value.data)?[...o.value.data]:[],_=d[e];d[e]=A(r,(_==null?void 0:_.is_show)??"1"),o.value={...o.value,data:d}}catch(r){console.error("获取优惠券详情失败",r),k.error("获取优惠券详情失败")}finally{x.value=!1}}}async function P(e){if(e){x.value=!0,y.value="";try{const t=await $({id:e});if(!t||!t.id)return;const r=Array.isArray(o.value.data)?[...o.value.data]:[];r.push(A(t)),o.value={...o.value,data:r},k.success("添加成功")}catch(t){console.error("获取优惠券详情失败",t),k.error("获取优惠券详情失败")}finally{x.value=!1}}}function z(e){const t=Array.isArray(o.value.data)?[...o.value.data]:[];t.splice(e,1),o.value={...o.value,data:t}}return(e,t)=>{const r=X,d=W,_=Z,D=tt,G=dt,w=Q,U=at,H=et,J=it,S=lt,B=ot,Y=nt,q=st;return u(),p("div",null,[l(q,{"label-width":"80px"},{default:i(()=>[l(w,{shadow:"never",class:"!border-none flex mt-2"},{default:i(()=>[t[7]||(t[7]=s("div",{class:"flex items-end mb-4"},[s("div",{class:"text-base text-[#101010] font-medium"},"基础设置")],-1)),l(d,{label:"组件标题"},{default:i(()=>[l(r,{modelValue:n(o).title,"onUpdate:modelValue":t[0]||(t[0]=a=>n(o).title=a),placeholder:"请输入标题",style:{width:"300px"}},null,8,["modelValue"])]),_:1}),l(d,{label:"显示数量"},{default:i(()=>[l(_,{modelValue:n(o).show_count,"onUpdate:modelValue":t[1]||(t[1]=a=>n(o).show_count=a),min:1,max:20,style:{width:"300px"}},null,8,["modelValue"])]),_:1}),l(d,{label:"查看更多"},{default:i(()=>[l(D,{modelValue:n(o).show_more,"onUpdate:modelValue":t[2]||(t[2]=a=>n(o).show_more=a),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),n(o).show_more?(u(),E(d,{key:0,label:"更多链接"},{default:i(()=>[l(G,{modelValue:n(o).more_link,"onUpdate:modelValue":t[3]||(t[3]=a=>n(o).more_link=a)},null,8,["modelValue"])]),_:1})):g("",!0)]),_:1}),l(w,{shadow:"never",class:"!border-none flex mt-2"},{default:i(()=>[t[10]||(t[10]=s("div",{class:"flex items-end mb-4"},[s("div",{class:"text-base text-[#101010] font-medium"},"展示样式")],-1)),l(H,{modelValue:n(o).style,"onUpdate:modelValue":t[4]||(t[4]=a=>n(o).style=a)},{default:i(()=>[l(U,{value:1},{default:i(()=>t[8]||(t[8]=[h("横向滑动")])),_:1}),l(U,{value:2},{default:i(()=>t[9]||(t[9]=[h("纵向列表")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(w,{shadow:"never",class:"!border-none flex mt-2"},{default:i(()=>[t[13]||(t[13]=s("div",{class:"flex items-end mb-4"},[s("div",{class:"text-base text-[#101010] font-medium"},"优惠券列表"),s("div",{class:"text-xs text-tx-secondary ml-2"},"从已存在的优惠券中选择，无需手动录入")],-1)),s("div",yt,[l(n(mt),{"model-value":Array.isArray(n(o).data)?n(o).data:[],"onUpdate:modelValue":t[5]||(t[5]=a=>V("update:content",{...v.content,data:a})),"item-key":(a,b)=>a&&a.coupon_id?a.coupon_id:"i"+b,animation:"300",handle:".drag-handle"},{item:i(({element:a,index:b})=>[s("div",xt,[s("div",bt,[s("div",gt,[l(J,{name:"el-icon-Rank",size:18,color:"#999"})]),s("div",ht,[s("div",Vt,[s("span",wt,f(M(a.coupon_id)||"未选择"),1),a.name?(u(),p("span",kt," ¥"+f(a.discount_amount)+" 满"+f(a.threshold_amount)+"元可用 ",1)):g("",!0)]),a.name?(u(),p("div",Ct,[h(" 有效期："+f(j(a))+" ",1),a.total_count?(u(),p("span",Et," · 总量"+f(a.total_count)+"张",1)):g("",!0)])):g("",!0),l(d,{label:"更换优惠券",class:"!mb-0","label-width":"80px"},{default:i(()=>[l(B,{"model-value":a.coupon_id||"",placeholder:"选择优惠券",filterable:"",clearable:"",style:{width:"280px"},onChange:m=>K(b,m)},{default:i(()=>[(u(!0),p(N,null,R(n(c),m=>(u(),E(S,{key:m.id,label:m.name,value:m.id},null,8,["label","value"]))),128))]),_:2},1032,["model-value","onChange"])]),_:2},1024)]),s("div",At,[l(D,{modelValue:a.is_show,"onUpdate:modelValue":m=>a.is_show=m,"active-value":"1","inactive-value":"0","active-text":"显示"},null,8,["modelValue","onUpdate:modelValue"]),l(Y,{type:"danger",text:"",icon:n(ut),onClick:m=>z(b)},{default:i(()=>t[11]||(t[11]=[h(" 删除 ")])),_:2},1032,["icon","onClick"])])])])]),_:1},8,["model-value","item-key"]),s("div",Dt,[t[12]||(t[12]=s("span",{class:"text-sm text-gray-500 mr-2"},"添加优惠券：",-1)),l(B,{modelValue:n(y),"onUpdate:modelValue":t[6]||(t[6]=a=>vt(y)?y.value=a:null),placeholder:"请选择要展示的优惠券",filterable:"",clearable:"",style:{width:"280px"},onChange:P},{default:i(()=>[(u(!0),p(N,null,R(n(c),a=>(u(),E(S,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),_:1})]),_:1})])}}}),ve=rt(Ut,[["__scopeId","data-v-9e0b4612"]]);export{ve as default};
