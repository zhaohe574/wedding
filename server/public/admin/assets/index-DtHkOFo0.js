import{G as Ee,H as Re,d as Ue,I as he,D as ze,B as De,J as Se,K as je,C as Ie,V as Me,i as Te,L as $e,M as Be,q as Le,N as Ae,Q as Pe,v as Fe,p as Ne,n as Ye,o as qe,O as Oe,P as Ke,W as Qe,X as Ge,R as He,a as H,E as k}from"./element-plus-ChK2e5qA.js";import{a3 as Je,j as We,F as Xe,Q as Ze,a4 as et}from"./@element-plus-C4Lf8veM.js";import{c as tt,d as lt,e as at,f as oe,i as st,r as ot,j as nt,t as dt,k as it}from"./review-BZd6SHk0.js";import{d as ut,r as f,a0 as ne,l as rt,c as g,o as m,U as t,L as l,a as o,S as u,u as L,R as n,M as mt,K as C,P as _,T as J,ab as W}from"./@vue-ygbFPFRc.js";import{d as pt}from"./index-D465kfFn.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-DRRUpF4H.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DDSL_IW4.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";const ct={class:"review-container"},_t={class:"stat-content"},vt={class:"stat-value"},ft={class:"stat-content"},gt={class:"stat-value"},yt={class:"stat-content"},bt={class:"stat-value"},Vt={class:"stat-content"},wt={class:"stat-value"},kt={class:"review-info"},Ct={class:"user-info"},xt={class:"nickname"},Et={class:"score-info"},Rt={key:0,class:"content"},Ut={key:1,class:"images"},ht={key:0,class:"more-images"},zt={class:"staff-info"},Dt={class:"pagination-wrap"},St={key:0,class:"review-detail"},jt={class:"flex items-center"},It={class:"ml-2"},Mt={key:0,class:"detail-images mt-4"},Tt={class:"images"},$t={key:1,class:"detail-video mt-4"},Bt=["src"],Lt={key:2,class:"detail-replies mt-4"},At={class:"reply-header"},Pt={class:"time"},Ft={class:"reply-content"},Nt=ut({__name:"index",setup(Yt){const N=f(!1),X=f([]),Z=f(0),h=f([]),M=f({}),z=f([]),r=ne({page:1,limit:10,status:void 0,score_level:"",review_type:void 0,nickname:"",staff_name:"",start_date:"",end_date:""}),Y=f(!1),d=f(null),T=f(!1),E=ne({id:0,content:""}),D=f(!1),S=f(""),q=f(null),de=i=>({0:"warning",1:"success",2:"danger"})[i]||"info",ee=i=>i>=4?"success":i===3?"warning":"danger",ie=i=>new Date(i*1e3).toLocaleString(),v=async()=>{var i;N.value=!0;try{((i=z.value)==null?void 0:i.length)===2?(r.start_date=z.value[0],r.end_date=z.value[1]):(r.start_date="",r.end_date="");const e=await tt(r);X.value=e.lists||[],Z.value=e.count||0}finally{N.value=!1}},$=async()=>{const i=await lt();M.value=i},ue=()=>{r.page=1,v()},re=()=>{Object.assign(r,{page:1,status:void 0,score_level:"",review_type:void 0,nickname:"",staff_name:"",start_date:"",end_date:""}),z.value=[],v()},me=i=>{h.value=i.map(e=>e.id)},pe=async i=>{const e=await at({id:i.id});d.value=e,Y.value=!0},te=async(i,e)=>{if(e===2){q.value={id:i.id,status:e},S.value="",D.value=!0;return}await H.confirm("确定通过该评价吗？","提示"),await oe({id:i.id,status:e}),k.success("操作成功"),v(),$()},ce=async()=>{if(!S.value){k.warning("请输入拒绝原因");return}await oe({...q.value,reject_reason:S.value}),k.success("操作成功"),D.value=!1,v(),$()},le=async i=>{if(i===2){q.value={ids:h.value,status:i},S.value="",D.value=!0;return}await H.confirm(`确定批量通过选中的 ${h.value.length} 条评价吗？`,"提示"),await st({ids:h.value,status:i}),k.success("操作成功"),v(),$()},_e=i=>{E.id=i.id,E.content="",T.value=!0},ve=async()=>{if(!E.content){k.warning("请输入回复内容");return}await ot(E),k.success("回复成功"),T.value=!1,v()},fe=async(i,e)=>{switch(i){case"top":await it({id:e.id}),k.success("操作成功"),v();break;case"show":await dt({id:e.id}),k.success("操作成功"),v();break;case"delete":await H.confirm("确定删除该评价吗？删除后不可恢复","警告",{type:"warning"}),await nt({id:e.id}),k.success("删除成功"),v(),$();break}};return rt(()=>{v(),$()}),(i,e)=>{const B=Ue,R=Re,A=Ee,ge=he,V=je,O=Se,x=De,P=Ie,ye=Me,c=Te,ae=ze,U=Be,K=Le,j=Ae,I=Pe,se=Fe,Q=qe,be=Ye,Ve=Ne,we=$e,ke=Ke,y=Ge,Ce=Qe,G=He,xe=Oe;return m(),g("div",ct,[t(ge,{gutter:16,class:"mb-4"},{default:l(()=>[t(A,{span:6},{default:l(()=>[t(R,{shadow:"hover",class:"stat-card"},{default:l(()=>[o("div",_t,[e[22]||(e[22]=o("div",{class:"stat-label"},"总评价数",-1)),o("div",vt,u(M.value.total_count||0),1)]),t(B,{class:"stat-icon",size:40},{default:l(()=>[t(L(Je))]),_:1})]),_:1})]),_:1}),t(A,{span:6},{default:l(()=>[t(R,{shadow:"hover",class:"stat-card pending"},{default:l(()=>[o("div",ft,[e[23]||(e[23]=o("div",{class:"stat-label"},"待审核",-1)),o("div",gt,u(M.value.pending_count||0),1)]),t(B,{class:"stat-icon",size:40},{default:l(()=>[t(L(We))]),_:1})]),_:1})]),_:1}),t(A,{span:6},{default:l(()=>[t(R,{shadow:"hover",class:"stat-card success"},{default:l(()=>[o("div",yt,[e[24]||(e[24]=o("div",{class:"stat-label"},"好评数",-1)),o("div",bt,u(M.value.good_count||0),1)]),t(B,{class:"stat-icon",size:40},{default:l(()=>[t(L(Xe))]),_:1})]),_:1})]),_:1}),t(A,{span:6},{default:l(()=>[t(R,{shadow:"hover",class:"stat-card info"},{default:l(()=>[o("div",Vt,[e[25]||(e[25]=o("div",{class:"stat-label"},"好评率",-1)),o("div",wt,u(M.value.good_rate||0)+"%",1)]),t(B,{class:"stat-icon",size:40},{default:l(()=>[t(L(Ze))]),_:1})]),_:1})]),_:1})]),_:1}),t(R,{shadow:"never",class:"mb-4"},{default:l(()=>[t(ae,{model:r,inline:""},{default:l(()=>[t(x,{label:"状态"},{default:l(()=>[t(O,{modelValue:r.status,"onUpdate:modelValue":e[0]||(e[0]=a=>r.status=a),placeholder:"请选择",clearable:"",style:{width:"120px"}},{default:l(()=>[t(V,{label:"待审核",value:0}),t(V,{label:"已通过",value:1}),t(V,{label:"已拒绝",value:2})]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"评分"},{default:l(()=>[t(O,{modelValue:r.score_level,"onUpdate:modelValue":e[1]||(e[1]=a=>r.score_level=a),placeholder:"请选择",clearable:"",style:{width:"120px"}},{default:l(()=>[t(V,{label:"好评",value:"good"}),t(V,{label:"中评",value:"medium"}),t(V,{label:"差评",value:"bad"})]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"类型"},{default:l(()=>[t(O,{modelValue:r.review_type,"onUpdate:modelValue":e[2]||(e[2]=a=>r.review_type=a),placeholder:"请选择",clearable:"",style:{width:"120px"}},{default:l(()=>[t(V,{label:"文字",value:1}),t(V,{label:"图文",value:2}),t(V,{label:"视频",value:3})]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"用户昵称"},{default:l(()=>[t(P,{modelValue:r.nickname,"onUpdate:modelValue":e[3]||(e[3]=a=>r.nickname=a),placeholder:"请输入",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),t(x,{label:"人员姓名"},{default:l(()=>[t(P,{modelValue:r.staff_name,"onUpdate:modelValue":e[4]||(e[4]=a=>r.staff_name=a),placeholder:"请输入",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),t(x,{label:"日期范围"},{default:l(()=>[t(ye,{modelValue:z.value,"onUpdate:modelValue":e[5]||(e[5]=a=>z.value=a),type:"daterange","value-format":"YYYY-MM-DD","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),t(x,null,{default:l(()=>[t(c,{type:"primary",onClick:ue},{default:l(()=>e[26]||(e[26]=[n("搜索")])),_:1}),t(c,{onClick:re},{default:l(()=>e[27]||(e[27]=[n("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(R,{shadow:"never",class:"mb-4"},{default:l(()=>[t(c,{type:"success",disabled:!h.value.length,onClick:e[6]||(e[6]=a=>le(1))},{default:l(()=>e[28]||(e[28]=[n(" 批量通过 ")])),_:1},8,["disabled"]),t(c,{type:"danger",disabled:!h.value.length,onClick:e[7]||(e[7]=a=>le(2))},{default:l(()=>e[29]||(e[29]=[n(" 批量拒绝 ")])),_:1},8,["disabled"])]),_:1}),t(R,{shadow:"never"},{default:l(()=>[mt((m(),C(we,{data:X.value,onSelectionChange:me,"row-key":"id"},{default:l(()=>[t(U,{type:"selection",width:"50"}),t(U,{label:"评价信息","min-width":"300"},{default:l(({row:a})=>{var p,s,b;return[o("div",kt,[o("div",Ct,[t(K,{size:36,src:(p=a.user)==null?void 0:p.avatar},{default:l(()=>{var w,F;return[n(u((F=(w=a.user)==null?void 0:w.nickname)==null?void 0:F.charAt(0)),1)]}),_:2},1032,["src"]),o("span",xt,u(((s=a.user)==null?void 0:s.nickname)||"匿名用户"),1),a.is_anonymous?(m(),C(j,{key:0,size:"small",type:"info"},{default:l(()=>e[30]||(e[30]=[n("匿名")])),_:1})):_("",!0)]),o("div",Et,[t(I,{modelValue:a.score,"onUpdate:modelValue":w=>a.score=w,disabled:"",max:5},null,8,["modelValue","onUpdate:modelValue"]),t(j,{type:ee(a.score),size:"small"},{default:l(()=>[n(u(a.score_level),1)]),_:2},1032,["type"])]),a.content?(m(),g("div",Rt,u(a.content),1)):_("",!0),(b=a.images)!=null&&b.length?(m(),g("div",Ut,[(m(!0),g(J,null,W(a.images.slice(0,3),(w,F)=>(m(),C(se,{key:F,src:w,"preview-src-list":a.images,fit:"cover",class:"review-image"},null,8,["src","preview-src-list"]))),128)),a.images.length>3?(m(),g("span",ht," +"+u(a.images.length-3),1)):_("",!0)])):_("",!0),a.video?(m(),C(j,{key:2,type:"warning",size:"small"},{default:l(()=>e[31]||(e[31]=[n("有视频")])),_:1})):_("",!0)])]}),_:1}),t(U,{label:"服务人员",width:"120"},{default:l(({row:a})=>{var p,s;return[o("div",zt,[t(K,{size:28,src:(p=a.staff)==null?void 0:p.avatar},{default:l(()=>{var b,w;return[n(u((w=(b=a.staff)==null?void 0:b.name)==null?void 0:w.charAt(0)),1)]}),_:2},1032,["src"]),o("span",null,u((s=a.staff)==null?void 0:s.name),1)])]}),_:1}),t(U,{label:"订单号",width:"150"},{default:l(({row:a})=>{var p;return[n(u(((p=a.order)==null?void 0:p.order_sn)||"-"),1)]}),_:1}),t(U,{label:"状态",width:"100"},{default:l(({row:a})=>[t(j,{type:de(a.status)},{default:l(()=>[n(u(a.status_text),1)]),_:2},1032,["type"]),a.is_top?(m(),C(B,{key:0,color:"#ff9800",class:"ml-1"},{default:l(()=>[t(L(et))]),_:1})):_("",!0)]),_:1}),t(U,{label:"评价时间",width:"160",prop:"create_time_text"}),t(U,{label:"操作",width:"200",fixed:"right"},{default:l(({row:a})=>[t(c,{link:"",type:"primary",onClick:p=>pe(a)},{default:l(()=>e[32]||(e[32]=[n("详情")])),_:2},1032,["onClick"]),a.status===0?(m(),C(c,{key:0,link:"",type:"success",onClick:p=>te(a,1)},{default:l(()=>e[33]||(e[33]=[n(" 通过 ")])),_:2},1032,["onClick"])):_("",!0),a.status===0?(m(),C(c,{key:1,link:"",type:"danger",onClick:p=>te(a,2)},{default:l(()=>e[34]||(e[34]=[n(" 拒绝 ")])),_:2},1032,["onClick"])):_("",!0),a.status===1?(m(),C(c,{key:2,link:"",type:"warning",onClick:p=>_e(a)},{default:l(()=>e[35]||(e[35]=[n(" 回复 ")])),_:2},1032,["onClick"])):_("",!0),t(Ve,{onCommand:p=>fe(p,a)},{dropdown:l(()=>[t(be,null,{default:l(()=>[t(Q,{command:"top"},{default:l(()=>[n(u(a.is_top?"取消置顶":"置顶"),1)]),_:2},1024),t(Q,{command:"show"},{default:l(()=>[n(u(a.is_show?"隐藏":"显示"),1)]),_:2},1024),t(Q,{command:"delete",divided:""},{default:l(()=>e[37]||(e[37]=[n("删除")])),_:1})]),_:2},1024)]),default:l(()=>[t(c,{link:"",type:"primary"},{default:l(()=>e[36]||(e[36]=[n("更多")])),_:1})]),_:2},1032,["onCommand"])]),_:1})]),_:1},8,["data"])),[[xe,N.value]]),o("div",Dt,[t(ke,{"current-page":r.page,"onUpdate:currentPage":e[8]||(e[8]=a=>r.page=a),"page-size":r.limit,"onUpdate:pageSize":e[9]||(e[9]=a=>r.limit=a),total:Z.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","total"])])]),_:1}),t(G,{modelValue:Y.value,"onUpdate:modelValue":e[15]||(e[15]=a=>Y.value=a),title:"评价详情",width:"700px"},{default:l(()=>{var a,p;return[d.value?(m(),g("div",St,[t(Ce,{column:2,border:""},{default:l(()=>[t(y,{label:"用户"},{default:l(()=>{var s,b;return[o("div",jt,[t(K,{size:24,src:(s=d.value.user)==null?void 0:s.avatar},null,8,["src"]),o("span",It,u((b=d.value.user)==null?void 0:b.nickname),1)])]}),_:1}),t(y,{label:"服务人员"},{default:l(()=>{var s;return[n(u((s=d.value.staff)==null?void 0:s.name),1)]}),_:1}),t(y,{label:"订单号"},{default:l(()=>{var s;return[n(u((s=d.value.order)==null?void 0:s.order_sn),1)]}),_:1}),t(y,{label:"服务日期"},{default:l(()=>[n(u(d.value.service_date),1)]),_:1}),t(y,{label:"综合评分"},{default:l(()=>[t(I,{modelValue:d.value.score,"onUpdate:modelValue":e[10]||(e[10]=s=>d.value.score=s),disabled:""},null,8,["modelValue"])]),_:1}),t(y,{label:"评分等级"},{default:l(()=>[t(j,{type:ee(d.value.score)},{default:l(()=>[n(u(d.value.score_level),1)]),_:1},8,["type"])]),_:1}),t(y,{label:"服务态度",span:1},{default:l(()=>[t(I,{modelValue:d.value.score_service,"onUpdate:modelValue":e[11]||(e[11]=s=>d.value.score_service=s),disabled:""},null,8,["modelValue"])]),_:1}),t(y,{label:"专业水平",span:1},{default:l(()=>[t(I,{modelValue:d.value.score_professional,"onUpdate:modelValue":e[12]||(e[12]=s=>d.value.score_professional=s),disabled:""},null,8,["modelValue"])]),_:1}),t(y,{label:"时间守约",span:1},{default:l(()=>[t(I,{modelValue:d.value.score_punctual,"onUpdate:modelValue":e[13]||(e[13]=s=>d.value.score_punctual=s),disabled:""},null,8,["modelValue"])]),_:1}),t(y,{label:"整体效果",span:1},{default:l(()=>[t(I,{modelValue:d.value.score_effect,"onUpdate:modelValue":e[14]||(e[14]=s=>d.value.score_effect=s),disabled:""},null,8,["modelValue"])]),_:1}),t(y,{label:"评价内容",span:2},{default:l(()=>[n(u(d.value.content||"无"),1)]),_:1})]),_:1}),(a=d.value.images)!=null&&a.length?(m(),g("div",Mt,[e[38]||(e[38]=o("div",{class:"label"},"评价图片",-1)),o("div",Tt,[(m(!0),g(J,null,W(d.value.images,(s,b)=>(m(),C(se,{key:b,src:s,"preview-src-list":d.value.images,fit:"cover",class:"detail-image"},null,8,["src","preview-src-list"]))),128))])])):_("",!0),d.value.video?(m(),g("div",$t,[e[39]||(e[39]=o("div",{class:"label"},"评价视频",-1)),o("video",{src:d.value.video,controls:"",class:"video-player"},null,8,Bt)])):_("",!0),(p=d.value.replies)!=null&&p.length?(m(),g("div",Lt,[e[40]||(e[40]=o("div",{class:"label"},"回复记录",-1)),(m(!0),g(J,null,W(d.value.replies,s=>(m(),g("div",{key:s.id,class:"reply-item"},[o("div",At,[t(j,{size:"small",type:s.reply_type===1?"info":"primary"},{default:l(()=>[n(u(s.reply_type===1?"用户追评":"商家回复"),1)]),_:2},1032,["type"]),o("span",Pt,u(ie(s.create_time)),1)]),o("div",Ft,u(s.content),1)]))),128))])):_("",!0)])):_("",!0)]}),_:1},8,["modelValue"]),t(G,{modelValue:T.value,"onUpdate:modelValue":e[18]||(e[18]=a=>T.value=a),title:"回复评价",width:"500px"},{footer:l(()=>[t(c,{onClick:e[17]||(e[17]=a=>T.value=!1)},{default:l(()=>e[41]||(e[41]=[n("取消")])),_:1}),t(c,{type:"primary",onClick:ve},{default:l(()=>e[42]||(e[42]=[n("确定")])),_:1})]),default:l(()=>[t(ae,{model:E,"label-width":"80px"},{default:l(()=>[t(x,{label:"回复内容",required:""},{default:l(()=>[t(P,{modelValue:E.content,"onUpdate:modelValue":e[16]||(e[16]=a=>E.content=a),type:"textarea",rows:4,placeholder:"请输入回复内容",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(G,{modelValue:D.value,"onUpdate:modelValue":e[21]||(e[21]=a=>D.value=a),title:"拒绝原因",width:"400px"},{footer:l(()=>[t(c,{onClick:e[20]||(e[20]=a=>D.value=!1)},{default:l(()=>e[43]||(e[43]=[n("取消")])),_:1}),t(c,{type:"primary",onClick:ce},{default:l(()=>e[44]||(e[44]=[n("确定")])),_:1})]),default:l(()=>[t(P,{modelValue:S.value,"onUpdate:modelValue":e[19]||(e[19]=a=>S.value=a),type:"textarea",rows:3,placeholder:"请输入拒绝原因",maxlength:"255"},null,8,["modelValue"])]),_:1},8,["modelValue"])])}}}),kl=pt(Nt,[["__scopeId","data-v-d0c7ab10"]]);export{kl as default};
