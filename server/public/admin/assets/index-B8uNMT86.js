import{D as ne,B as se,C as ie,J as ue,K as de,i as re,H as pe,G as _e,I as me,L as ve,M as ce,N as fe,O as be,P as ge,W as ye,X as we,a4 as Ve,R as ke,E as U,a as xe}from"./element-plus-ChK2e5qA.js";import{n as Ce,o as Ee,p as Ie,q as Ue,r as De,s as ze,v as Se}from"./financial-BtVBj2RS.js";import{d as Te,r as c,a0 as P,l as Be,c as K,o as v,U as e,L as t,T as Le,ab as Fe,K as b,R as o,a as p,S as s,M as Me,P as C}from"./@vue-ygbFPFRc.js";import{d as Ne}from"./index-D465kfFn.js";import"./@element-plus-C4Lf8veM.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-DRRUpF4H.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DDSL_IW4.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";const Pe={class:"invoice-management"},Oe={class:"stat-value"},Re={class:"stat-value text-warning"},$e={class:"stat-value text-success"},qe={class:"stat-value text-primary"},he={class:"flex justify-end mt-4"},je={class:"text-danger"},Ke={class:"text-danger"},Ge=Te({__name:"index",setup(He){const T=c(!1),O=c([]),R=c(0),E=c({}),$=c([]),B=c(!1),w=c(!1),I=c(!1),n=c({}),d=P({page_no:1,page_size:15,invoice_sn:"",invoice_type:"",status:""}),r=P({id:0,invoice_no:"",invoice_url:""}),g=P({id:0,void_reason:""}),L=i=>(Number(i)||0).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}),q=i=>({0:"warning",1:"info",2:"success",3:"danger",4:""})[i]||"",F=()=>{d.page_no=1,V(),D()},G=()=>{Object.assign(d,{invoice_sn:"",invoice_type:"",status:""}),F()},V=async()=>{T.value=!0;try{const i=await Ce(d);O.value=i.lists||[],R.value=i.count||0}finally{T.value=!1}},D=async()=>{const i=await Ee({});E.value=i||{}},H=async()=>{const i=await Ie();$.value=i||[]},J=async i=>{try{const l=await Ue({id:i.id});n.value=l||i}catch{n.value=i}B.value=!0},W=i=>{r.id=i.id,r.invoice_no="",r.invoice_url="",w.value=!0},X=async()=>{if(!r.invoice_no){U.warning("请输入发票号码");return}await De(r),U.success("开票成功"),w.value=!1,V(),D()},A=async()=>{const{value:i}=await xe.prompt("请输入开票失败原因","开票失败",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"原因不能为空"});await ze({id:r.id,fail_reason:i}),U.success("操作成功"),w.value=!1,V()},Q=i=>{g.id=i.id,g.void_reason="",I.value=!0},Y=async()=>{if(!g.void_reason){U.warning("请输入作废原因");return}await Se(g),U.success("作废成功"),I.value=!1,V(),D()};return Be(()=>{H(),V(),D()}),(i,l)=>{const z=ie,y=se,k=de,h=ue,_=re,M=ne,x=pe,S=_e,Z=me,m=ce,j=fe,ee=ve,te=ge,u=we,le=Ve,ae=ye,N=ke,oe=be;return v(),K("div",Pe,[e(x,{class:"!border-none mb-4",shadow:"never"},{default:t(()=>[e(M,{model:d,inline:""},{default:t(()=>[e(y,{label:"发票编号"},{default:t(()=>[e(z,{modelValue:d.invoice_sn,"onUpdate:modelValue":l[0]||(l[0]=a=>d.invoice_sn=a),placeholder:"发票编号",clearable:""},null,8,["modelValue"])]),_:1}),e(y,{label:"发票类型"},{default:t(()=>[e(h,{modelValue:d.invoice_type,"onUpdate:modelValue":l[1]||(l[1]=a=>d.invoice_type=a),placeholder:"全部",clearable:""},{default:t(()=>[(v(!0),K(Le,null,Fe($.value,a=>(v(),b(k,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(y,{label:"状态"},{default:t(()=>[e(h,{modelValue:d.status,"onUpdate:modelValue":l[2]||(l[2]=a=>d.status=a),placeholder:"全部",clearable:""},{default:t(()=>[e(k,{label:"待开票",value:0}),e(k,{label:"开票中",value:1}),e(k,{label:"已开票",value:2}),e(k,{label:"开票失败",value:3}),e(k,{label:"已作废",value:4})]),_:1},8,["modelValue"])]),_:1}),e(y,null,{default:t(()=>[e(_,{type:"primary",onClick:F},{default:t(()=>l[13]||(l[13]=[o("查询")])),_:1}),e(_,{onClick:G},{default:t(()=>l[14]||(l[14]=[o("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(Z,{gutter:16,class:"mb-4"},{default:t(()=>[e(S,{span:6},{default:t(()=>[e(x,{class:"stat-card",shadow:"never"},{default:t(()=>[l[15]||(l[15]=p("div",{class:"stat-label"},"总申请",-1)),p("div",Oe,s(E.value.total_count),1)]),_:1})]),_:1}),e(S,{span:6},{default:t(()=>[e(x,{class:"stat-card",shadow:"never"},{default:t(()=>[l[16]||(l[16]=p("div",{class:"stat-label"},"待开票",-1)),p("div",Re,s(E.value.pending_count),1)]),_:1})]),_:1}),e(S,{span:6},{default:t(()=>[e(x,{class:"stat-card",shadow:"never"},{default:t(()=>[l[17]||(l[17]=p("div",{class:"stat-label"},"已开票",-1)),p("div",$e,s(E.value.issued_count),1)]),_:1})]),_:1}),e(S,{span:6},{default:t(()=>[e(x,{class:"stat-card",shadow:"never"},{default:t(()=>[l[18]||(l[18]=p("div",{class:"stat-label"},"开票金额",-1)),p("div",qe,"¥"+s(L(E.value.total_amount)),1)]),_:1})]),_:1})]),_:1}),e(x,{class:"!border-none",shadow:"never"},{default:t(()=>[Me((v(),b(ee,{data:O.value,stripe:""},{default:t(()=>[e(m,{prop:"invoice_sn",label:"发票编号","min-width":"150"}),e(m,{prop:"invoice_type_text",label:"发票类型",width:"100"}),e(m,{prop:"invoice_title",label:"发票抬头","min-width":"150","show-overflow-tooltip":""}),e(m,{prop:"title_type_text",label:"抬头类型",width:"80"}),e(m,{label:"订单编号",width:"140"},{default:t(({row:a})=>{var f;return[o(s(((f=a.order)==null?void 0:f.order_sn)||"-"),1)]}),_:1}),e(m,{label:"申请用户",width:"100"},{default:t(({row:a})=>{var f;return[o(s(((f=a.user)==null?void 0:f.nickname)||"-"),1)]}),_:1}),e(m,{prop:"amount",label:"金额",width:"100",align:"right"},{default:t(({row:a})=>[o("¥"+s(L(a.amount)),1)]),_:1}),e(m,{prop:"status",label:"状态",width:"90"},{default:t(({row:a})=>[e(j,{type:q(a.status)},{default:t(()=>[o(s(a.status_text),1)]),_:2},1032,["type"])]),_:1}),e(m,{prop:"create_time",label:"申请时间",width:"170"}),e(m,{label:"操作",width:"150",fixed:"right"},{default:t(({row:a})=>[e(_,{type:"primary",link:"",onClick:f=>J(a)},{default:t(()=>l[19]||(l[19]=[o("详情")])),_:2},1032,["onClick"]),[0,1].includes(a.status)?(v(),b(_,{key:0,type:"success",link:"",onClick:f=>W(a)},{default:t(()=>l[20]||(l[20]=[o("开票")])),_:2},1032,["onClick"])):C("",!0),a.status===2?(v(),b(_,{key:1,type:"danger",link:"",onClick:f=>Q(a)},{default:t(()=>l[21]||(l[21]=[o("作废")])),_:2},1032,["onClick"])):C("",!0)]),_:1})]),_:1},8,["data"])),[[oe,T.value]]),p("div",he,[e(te,{"current-page":d.page_no,"onUpdate:currentPage":l[3]||(l[3]=a=>d.page_no=a),"page-size":d.page_size,"onUpdate:pageSize":l[4]||(l[4]=a=>d.page_size=a),total:R.value,"page-sizes":[15,30,50],layout:"total, sizes, prev, pager, next",onSizeChange:F,onCurrentChange:V},null,8,["current-page","page-size","total"])])]),_:1}),e(N,{modelValue:B.value,"onUpdate:modelValue":l[5]||(l[5]=a=>B.value=a),title:"发票详情",width:"650px"},{default:t(()=>[e(ae,{column:2,border:""},{default:t(()=>[e(u,{label:"发票编号"},{default:t(()=>[o(s(n.value.invoice_sn),1)]),_:1}),e(u,{label:"发票号码"},{default:t(()=>[o(s(n.value.invoice_no||"-"),1)]),_:1}),e(u,{label:"发票类型"},{default:t(()=>[o(s(n.value.invoice_type_text),1)]),_:1}),e(u,{label:"抬头类型"},{default:t(()=>[o(s(n.value.title_type_text),1)]),_:1}),e(u,{label:"发票抬头",span:2},{default:t(()=>[o(s(n.value.invoice_title),1)]),_:1}),e(u,{label:"税号",span:2},{default:t(()=>[o(s(n.value.tax_no||"-"),1)]),_:1}),e(u,{label:"开户行"},{default:t(()=>[o(s(n.value.bank_name||"-"),1)]),_:1}),e(u,{label:"银行账号"},{default:t(()=>[o(s(n.value.bank_account||"-"),1)]),_:1}),e(u,{label:"企业地址",span:2},{default:t(()=>[o(s(n.value.company_address||"-"),1)]),_:1}),e(u,{label:"企业电话"},{default:t(()=>[o(s(n.value.company_phone||"-"),1)]),_:1}),e(u,{label:"金额"},{default:t(()=>[o("¥"+s(L(n.value.amount)),1)]),_:1}),e(u,{label:"接收邮箱",span:2},{default:t(()=>[o(s(n.value.email||"-"),1)]),_:1}),e(u,{label:"状态"},{default:t(()=>[e(j,{type:q(n.value.status)},{default:t(()=>[o(s(n.value.status_text),1)]),_:1},8,["type"])]),_:1}),e(u,{label:"申请时间"},{default:t(()=>[o(s(n.value.create_time),1)]),_:1}),n.value.issue_time?(v(),b(u,{key:0,label:"开票时间"},{default:t(()=>[o(s(n.value.issue_time),1)]),_:1})):C("",!0),n.value.invoice_url?(v(),b(u,{key:1,label:"发票地址",span:2},{default:t(()=>[e(le,{href:n.value.invoice_url,target:"_blank",type:"primary"},{default:t(()=>l[22]||(l[22]=[o("下载发票")])),_:1},8,["href"])]),_:1})):C("",!0),n.value.fail_reason?(v(),b(u,{key:2,label:"失败原因",span:2},{default:t(()=>[p("span",je,s(n.value.fail_reason),1)]),_:1})):C("",!0),n.value.void_reason?(v(),b(u,{key:3,label:"作废原因",span:2},{default:t(()=>[p("span",Ke,s(n.value.void_reason),1)]),_:1})):C("",!0)]),_:1})]),_:1},8,["modelValue"]),e(N,{modelValue:w.value,"onUpdate:modelValue":l[9]||(l[9]=a=>w.value=a),title:"开票",width:"450px"},{footer:t(()=>[e(_,{onClick:l[8]||(l[8]=a=>w.value=!1)},{default:t(()=>l[23]||(l[23]=[o("取消")])),_:1}),e(_,{type:"danger",onClick:A},{default:t(()=>l[24]||(l[24]=[o("开票失败")])),_:1}),e(_,{type:"primary",onClick:X},{default:t(()=>l[25]||(l[25]=[o("确认开票")])),_:1})]),default:t(()=>[e(M,{model:r,"label-width":"100px"},{default:t(()=>[e(y,{label:"发票号码",required:""},{default:t(()=>[e(z,{modelValue:r.invoice_no,"onUpdate:modelValue":l[6]||(l[6]=a=>r.invoice_no=a),placeholder:"请输入发票号码"},null,8,["modelValue"])]),_:1}),e(y,{label:"电子发票URL"},{default:t(()=>[e(z,{modelValue:r.invoice_url,"onUpdate:modelValue":l[7]||(l[7]=a=>r.invoice_url=a),placeholder:"电子发票下载地址"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(N,{modelValue:I.value,"onUpdate:modelValue":l[12]||(l[12]=a=>I.value=a),title:"作废发票",width:"450px"},{footer:t(()=>[e(_,{onClick:l[11]||(l[11]=a=>I.value=!1)},{default:t(()=>l[26]||(l[26]=[o("取消")])),_:1}),e(_,{type:"danger",onClick:Y},{default:t(()=>l[27]||(l[27]=[o("确认作废")])),_:1})]),default:t(()=>[e(M,{model:g,"label-width":"100px"},{default:t(()=>[e(y,{label:"作废原因",required:""},{default:t(()=>[e(z,{modelValue:g.void_reason,"onUpdate:modelValue":l[10]||(l[10]=a=>g.void_reason=a),type:"textarea",rows:"3",placeholder:"请输入作废原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Et=Ne(Ge,[["__scopeId","data-v-494052ae"]]);export{Et as default};
