import{L as J,M as P,N as Q,g as W,i as X,O as Y,d as Z,H as ee,D as le,B as ae,J as te,K as se,h as oe,ad as de,a8 as ne,F as ie,R as re,a as ue,E as w}from"./element-plus-ChK2e5qA.js";import{A as me}from"./@element-plus-C4Lf8veM.js";import{i as _e,j as pe,k as fe,l as ve,m as be}from"./schedule-C1467ANE.js";import{s as ye}from"./staff-C0LmdmFi.js";import{d as xe,r as i,l as Ve,c as D,o as b,U as l,L as t,M as ke,K as g,R as d,S as y,P as ce,a as f,u as we,T as ge,ab as Ee}from"./@vue-ygbFPFRc.js";import{d as Ce}from"./index-D465kfFn.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-DRRUpF4H.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DDSL_IW4.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";const Ue={class:"schedule-rule"},Re={class:"flex items-center justify-between"},Le={class:"flex items-center gap-2 w-full"},Se=xe({__name:"index",setup(De){const x=i(!1),E=i([]),C=i([]),_=i(!1),p=i(!1),V=i(!1),U=i(),s=i({id:0,staff_id:0,advance_days:1,max_orders_per_day:1,interval_hours:0,work_start_time:"09:00",work_end_time:"18:00",rest_days:[],is_enabled:1}),B={max_orders_per_day:[{required:!0,message:"请输入单日最大接单数",trigger:"blur"}]},k=async()=>{x.value=!0;try{const o=await _e();E.value=o.lists||[]}finally{x.value=!1}},N=async()=>{const o=await ye();C.value=o||[]},T=()=>{p.value=!1,s.value={id:0,staff_id:0,advance_days:1,max_orders_per_day:1,interval_hours:0,work_start_time:"09:00",work_end_time:"18:00",rest_days:[],is_enabled:1},_.value=!0},h=o=>{p.value=!0,s.value={id:o.id,staff_id:o.staff_id,advance_days:1,max_orders_per_day:o.max_orders_per_day,interval_hours:o.interval_hours,work_start_time:o.work_start_time,work_end_time:o.work_end_time,rest_days:o.rest_days_arr||[],is_enabled:o.is_enabled},_.value=!0},I=async o=>{await ue.confirm("确定要删除该规则吗?","提示"),await pe({id:o.id}),w.success("删除成功"),k()},M=async o=>{await fe({id:o.id}),w.success("操作成功")},A=async()=>{var o;await((o=U.value)==null?void 0:o.validate()),V.value=!0;try{p.value?await ve(s.value):await be(s.value),w.success(p.value?"编辑成功":"添加成功"),_.value=!1,k()}finally{V.value=!1}};return Ve(()=>{k(),N()}),(o,e)=>{const F=Z,v=X,n=P,$=Q,R=W,j=J,z=ee,L=se,K=te,r=ae,c=oe,S=de,u=ie,O=ne,q=le,G=re,H=Y;return b(),D("div",Ue,[l(z,{class:"!border-none",shadow:"never"},{header:t(()=>[f("div",Re,[e[11]||(e[11]=f("span",{class:"text-lg font-bold"},"档期规则管理",-1)),l(v,{type:"primary",onClick:T},{default:t(()=>[l(F,{class:"mr-1"},{default:t(()=>[l(we(me))]),_:1}),e[10]||(e[10]=d("添加规则 "))]),_:1})])]),default:t(()=>[ke((b(),g(j,{data:E.value},{default:t(()=>[l(n,{prop:"id",label:"ID",width:"80"}),l(n,{label:"类型",width:"100"},{default:t(({row:a})=>[l($,{type:a.staff_id===0?"danger":"primary"},{default:t(()=>[d(y(a.type_desc),1)]),_:2},1032,["type"])]),_:1}),l(n,{label:"工作人员","min-width":"120"},{default:t(({row:a})=>{var m;return[d(y(a.staff_id===0?"全局默认":((m=a.staff)==null?void 0:m.name)||"-"),1)]}),_:1}),l(n,{label:"预约限制",width:"140"},{default:t(()=>e[12]||(e[12]=[d(" 当日不可预约 ")])),_:1}),l(n,{prop:"max_orders_per_day",label:"单日最大接单",width:"120"}),l(n,{label:"工作时间",width:"140"},{default:t(({row:a})=>[d(y(a.work_start_time)+" - "+y(a.work_end_time),1)]),_:1}),l(n,{prop:"rest_days_desc",label:"休息日","min-width":"150"}),l(n,{label:"状态",width:"80"},{default:t(({row:a})=>[l(R,{modelValue:a.is_enabled,"onUpdate:modelValue":m=>a.is_enabled=m,"active-value":1,"inactive-value":0,onChange:m=>M(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(n,{label:"操作",width:"150",fixed:"right"},{default:t(({row:a})=>[l(v,{type:"primary",size:"small",link:"",onClick:m=>h(a)},{default:t(()=>e[13]||(e[13]=[d("编辑")])),_:2},1032,["onClick"]),a.staff_id!==0?(b(),g(v,{key:0,type:"danger",size:"small",link:"",onClick:m=>I(a)},{default:t(()=>e[14]||(e[14]=[d(" 删除 ")])),_:2},1032,["onClick"])):ce("",!0)]),_:1})]),_:1},8,["data"])),[[H,x.value]])]),_:1}),l(G,{modelValue:_.value,"onUpdate:modelValue":e[9]||(e[9]=a=>_.value=a),title:p.value?"编辑规则":"添加规则",width:"600px"},{footer:t(()=>[l(v,{onClick:e[8]||(e[8]=a=>_.value=!1)},{default:t(()=>e[25]||(e[25]=[d("取消")])),_:1}),l(v,{type:"primary",loading:V.value,onClick:A},{default:t(()=>e[26]||(e[26]=[d("确定")])),_:1},8,["loading"])]),default:t(()=>[l(q,{model:s.value,rules:B,ref_key:"formRef",ref:U,"label-width":"120px"},{default:t(()=>[l(r,{label:"适用对象",prop:"staff_id"},{default:t(()=>[l(K,{modelValue:s.value.staff_id,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.staff_id=a),disabled:p.value,style:{width:"100%"}},{default:t(()=>[l(L,{label:"全局默认",value:0}),(b(!0),D(ge,null,Ee(C.value,a=>(b(),g(L,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(r,{label:"预约限制"},{default:t(()=>[l(c,{modelValue:s.value.advance_days,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.advance_days=a),min:1,max:1,disabled:"",style:{width:"100%"}},null,8,["modelValue"]),e[15]||(e[15]=f("div",{class:"text-gray-400 text-xs mt-1"},"仅限制当天不可预约",-1))]),_:1}),l(r,{label:"单日最大接单",prop:"max_orders_per_day"},{default:t(()=>[l(c,{modelValue:s.value.max_orders_per_day,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.max_orders_per_day=a),min:1,max:10,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(r,{label:"订单间隔时间",prop:"interval_hours"},{default:t(()=>[l(c,{modelValue:s.value.interval_hours,"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.interval_hours=a),min:0,max:24,style:{width:"100%"}},null,8,["modelValue"]),e[16]||(e[16]=f("div",{class:"text-gray-400 text-xs mt-1"},"两个订单之间的最小间隔(小时)",-1))]),_:1}),l(r,{label:"工作时间"},{default:t(()=>[f("div",Le,[l(S,{modelValue:s.value.work_start_time,"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.work_start_time=a),start:"06:00",end:"23:00",step:"00:30",placeholder:"开始时间",style:{width:"45%"}},null,8,["modelValue"]),e[17]||(e[17]=f("span",null,"至",-1)),l(S,{modelValue:s.value.work_end_time,"onUpdate:modelValue":e[5]||(e[5]=a=>s.value.work_end_time=a),start:"06:00",end:"23:00",step:"00:30",placeholder:"结束时间",style:{width:"45%"}},null,8,["modelValue"])])]),_:1}),l(r,{label:"休息日"},{default:t(()=>[l(O,{modelValue:s.value.rest_days,"onUpdate:modelValue":e[6]||(e[6]=a=>s.value.rest_days=a)},{default:t(()=>[l(u,{label:0},{default:t(()=>e[18]||(e[18]=[d("周日")])),_:1}),l(u,{label:1},{default:t(()=>e[19]||(e[19]=[d("周一")])),_:1}),l(u,{label:2},{default:t(()=>e[20]||(e[20]=[d("周二")])),_:1}),l(u,{label:3},{default:t(()=>e[21]||(e[21]=[d("周三")])),_:1}),l(u,{label:4},{default:t(()=>e[22]||(e[22]=[d("周四")])),_:1}),l(u,{label:5},{default:t(()=>e[23]||(e[23]=[d("周五")])),_:1}),l(u,{label:6},{default:t(()=>e[24]||(e[24]=[d("周六")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"是否启用"},{default:t(()=>[l(R,{modelValue:s.value.is_enabled,"onUpdate:modelValue":e[7]||(e[7]=a=>s.value.is_enabled=a),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),ul=Ce(Se,[["__scopeId","data-v-e135ff04"]]);export{ul as default};
