import{D as me,B as pe,C as _e,J as fe,K as ce,V as ge,i as ye,H as be,d as ke,L as ve,M as Ve,N as xe,O as Ce,h as we,R as De,W as Ee,X as Ue}from"./element-plus-ChK2e5qA.js";import{_ as Se}from"./index.vue_vue_type_script_setup_true_lang-CCtv5BMP.js";import{d as H,a0 as P,r as I,w as Te,c as F,o as b,U as e,a as r,L as l,u as s,a9 as j,R as i,S as n,M as Ie,K as C,P as v,i as q}from"./@vue-ygbFPFRc.js";import{A as Ye}from"./@element-plus-C4Lf8veM.js";import{r as D,f as w}from"./index-D465kfFn.js";import{u as $e}from"./usePaging-B2jDzebD.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-DRRUpF4H.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DDSL_IW4.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";function Fe(_){return D.get({url:"/timeline.timeline/lists",params:_})}function Ke(_){return D.get({url:"/timeline.timeline/detail",params:_})}function Re(_){return D.post({url:"/timeline.timeline/add",params:_})}function qe(_){return D.post({url:"/timeline.timeline/edit",params:_})}function Be(_){return D.post({url:"/timeline.timeline/delete",params:_})}function Le(_){return D.post({url:"/timeline.timeline/complete",params:_})}function Me(_){return D.post({url:"/timeline.timeline/uncomplete",params:_})}const Ne={class:"timeline-lists"},Pe={class:"mt-4 grid grid-cols-4 gap-4"},ze={class:"text-center"},Ae={class:"text-2xl font-bold mt-2 text-blue-500"},Oe={class:"text-center"},he={class:"text-2xl font-bold mt-2 text-orange-500"},je={class:"text-center"},He={class:"text-2xl font-bold mt-2 text-red-500"},Je={class:"text-center"},We={class:"text-2xl font-bold mt-2 text-green-500"},Xe={class:"flex justify-between mb-4"},Ge={class:"font-medium"},Qe={key:0,class:"text-gray-400 text-xs mt-1"},Ze={key:0},et={class:"text-gray-400 text-xs"},tt={key:1,class:"text-gray-400"},lt={class:"flex justify-end mt-4"},at={key:0},st=H({name:"timelineLists"}),Lt=H({...st,setup(_){const c=P({order_id:"",task_title:"",task_type:"",status:"",trigger_date:[]}),Y=I({today:0,pending:0,overdue:0,completed:0}),V=I(!1),z=I(),o=P({id:0,order_id:"",task_title:"",task_desc:"",task_type:1,trigger_date:"",days_before:7,sort:0}),J={order_id:[{required:!0,message:"请输入订单ID",trigger:"blur"}],task_title:[{required:!0,message:"请输入任务标题",trigger:"blur"}],task_type:[{required:!0,message:"请选择任务类型",trigger:"change"}],trigger_date:[{required:!0,message:"请选择触发日期",trigger:"change"}]},K=I(!1),u=I(null),E=I(!1),U=P({id:0,complete_remark:""}),{pager:x,getLists:S,resetPage:B,resetParams:W}=$e({fetchFun:Fe,params:c}),X=d=>({1:"primary",2:"success",3:"warning",4:"danger",5:"info"})[d]||"info",A=d=>({completed:"success",pending:"primary",overdue:"danger",today:"warning"})[d]||"info",G=()=>{o.id=0,o.order_id="",o.task_title="",o.task_desc="",o.task_type=1,o.trigger_date="",o.days_before=7,o.sort=0,V.value=!0},Q=d=>{o.id=d.id,o.order_id=d.order_id,o.task_title=d.task_title,o.task_desc=d.task_desc,o.task_type=d.task_type,o.trigger_date=d.trigger_date,o.sort=d.sort||0,V.value=!0},Z=async()=>{var d;await((d=z.value)==null?void 0:d.validate()),o.id?(await qe(o),w.msgSuccess("编辑成功")):(await Re(o),w.msgSuccess("添加成功")),V.value=!1,S()},ee=async d=>{const t=await Ke({id:d.id});u.value=t,K.value=!0},te=d=>{U.id=d.id,U.complete_remark="",E.value=!0},le=async()=>{await Le(U),w.msgSuccess("任务已完成"),E.value=!1,S()},ae=async d=>{await w.confirm("确定要取消完成状态吗？"),await Me({id:d.id}),w.msgSuccess("已取消完成状态"),S()},se=async d=>{await w.confirm("确定要删除该任务吗？"),await Be({id:d.id}),w.msgSuccess("删除成功"),S()},oe=()=>{const d=x.lists||[],t=new Date().toISOString().split("T")[0];Y.value={today:d.filter(m=>m.trigger_date===t&&!m.is_completed).length,pending:d.filter(m=>!m.is_completed&&m.trigger_date>=t).length,overdue:d.filter(m=>!m.is_completed&&m.trigger_date<t).length,completed:d.filter(m=>m.is_completed).length}};return Te(()=>x.lists,()=>{oe()},{deep:!0}),S(),(d,t)=>{const m=_e,f=pe,p=ce,L=fe,O=ge,g=ye,M=me,T=be,de=ke,k=Ve,$=xe,ie=ve,ne=Se,h=we,N=De,y=Ue,re=Ee,ue=Ce;return b(),F("div",Ne,[e(T,{class:"!border-none",shadow:"never"},{default:l(()=>[e(M,{ref:"formRef",class:"mb-[-16px]",model:s(c),inline:!0},{default:l(()=>[e(f,{class:"w-[180px]",label:"订单ID"},{default:l(()=>[e(m,{modelValue:s(c).order_id,"onUpdate:modelValue":t[0]||(t[0]=a=>s(c).order_id=a),placeholder:"输入订单ID",clearable:"",onKeyup:j(s(B),["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(f,{class:"w-[180px]",label:"任务标题"},{default:l(()=>[e(m,{modelValue:s(c).task_title,"onUpdate:modelValue":t[1]||(t[1]=a=>s(c).task_title=a),placeholder:"输入任务标题",clearable:"",onKeyup:j(s(B),["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(f,{class:"w-[150px]",label:"任务类型"},{default:l(()=>[e(L,{modelValue:s(c).task_type,"onUpdate:modelValue":t[2]||(t[2]=a=>s(c).task_type=a),placeholder:"选择类型",clearable:""},{default:l(()=>[e(p,{label:"全部",value:""}),e(p,{label:"准备物料",value:1}),e(p,{label:"确认事项",value:2}),e(p,{label:"沟通联系",value:3}),e(p,{label:"现场安排",value:4}),e(p,{label:"其他",value:5})]),_:1},8,["modelValue"])]),_:1}),e(f,{class:"w-[150px]",label:"任务状态"},{default:l(()=>[e(L,{modelValue:s(c).status,"onUpdate:modelValue":t[3]||(t[3]=a=>s(c).status=a),placeholder:"选择状态",clearable:""},{default:l(()=>[e(p,{label:"全部",value:""}),e(p,{label:"已完成",value:"completed"}),e(p,{label:"待完成",value:"pending"}),e(p,{label:"已逾期",value:"overdue"}),e(p,{label:"今日任务",value:"today"})]),_:1},8,["modelValue"])]),_:1}),e(f,{class:"w-[320px]",label:"触发日期"},{default:l(()=>[e(O,{modelValue:s(c).trigger_date,"onUpdate:modelValue":t[4]||(t[4]=a=>s(c).trigger_date=a),type:"daterange","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",clearable:""},null,8,["modelValue"])]),_:1}),e(f,null,{default:l(()=>[e(g,{type:"primary",onClick:s(B)},{default:l(()=>t[19]||(t[19]=[i("查询")])),_:1},8,["onClick"]),e(g,{onClick:s(W)},{default:l(()=>t[20]||(t[20]=[i("重置")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),r("div",Pe,[e(T,{class:"!border-none",shadow:"never"},{default:l(()=>[r("div",ze,[t[21]||(t[21]=r("div",{class:"text-gray-500 text-sm"},"今日任务",-1)),r("div",Ae,n(s(Y).today||0),1)])]),_:1}),e(T,{class:"!border-none",shadow:"never"},{default:l(()=>[r("div",Oe,[t[22]||(t[22]=r("div",{class:"text-gray-500 text-sm"},"待完成",-1)),r("div",he,n(s(Y).pending||0),1)])]),_:1}),e(T,{class:"!border-none",shadow:"never"},{default:l(()=>[r("div",je,[t[23]||(t[23]=r("div",{class:"text-gray-500 text-sm"},"已逾期",-1)),r("div",He,n(s(Y).overdue||0),1)])]),_:1}),e(T,{class:"!border-none",shadow:"never"},{default:l(()=>[r("div",Je,[t[24]||(t[24]=r("div",{class:"text-gray-500 text-sm"},"已完成",-1)),r("div",We,n(s(Y).completed||0),1)])]),_:1})]),e(T,{class:"!border-none mt-4",shadow:"never"},{default:l(()=>[r("div",Xe,[r("div",null,[e(g,{type:"primary",onClick:G},{default:l(()=>[e(de,{class:"mr-1"},{default:l(()=>[e(s(Ye))]),_:1}),t[25]||(t[25]=i("添加任务 "))]),_:1})])]),Ie((b(),C(ie,{size:"large",data:s(x).lists},{default:l(()=>[e(k,{label:"任务标题",prop:"task_title","min-width":"180"},{default:l(({row:a})=>[r("div",Ge,n(a.task_title),1),a.task_desc?(b(),F("div",Qe,n(a.task_desc.substring(0,50))+n(a.task_desc.length>50?"...":""),1)):v("",!0)]),_:1}),e(k,{label:"订单信息","min-width":"150"},{default:l(({row:a})=>[a.order?(b(),F("div",Ze,[r("div",null,n(a.order.order_sn),1),r("div",et,n(a.order.contact_name),1)])):(b(),F("span",tt,"-"))]),_:1}),e(k,{label:"任务类型",width:"100"},{default:l(({row:a})=>[e($,{size:"small",type:X(a.task_type)},{default:l(()=>[i(n(a.task_type_desc),1)]),_:2},1032,["type"])]),_:1}),e(k,{label:"触发日期",prop:"trigger_date",width:"110"}),e(k,{label:"婚礼日期",prop:"wedding_date",width:"110"}),e(k,{label:"任务状态",width:"100"},{default:l(({row:a})=>[e($,{type:A(a.status)},{default:l(()=>[i(n(a.status_desc),1)]),_:2},1032,["type"])]),_:1}),e(k,{label:"来源",width:"80"},{default:l(({row:a})=>[e($,{size:"small",type:a.is_system?"info":""},{default:l(()=>[i(n(a.is_system?"系统":"手动"),1)]),_:2},1032,["type"])]),_:1}),e(k,{label:"操作",width:"200",fixed:"right"},{default:l(({row:a})=>[e(g,{type:"primary",link:"",onClick:R=>ee(a)},{default:l(()=>t[26]||(t[26]=[i("详情")])),_:2},1032,["onClick"]),a.is_completed?v("",!0):(b(),C(g,{key:0,type:"success",link:"",onClick:R=>te(a)},{default:l(()=>t[27]||(t[27]=[i("完成")])),_:2},1032,["onClick"])),a.is_completed?(b(),C(g,{key:1,type:"warning",link:"",onClick:R=>ae(a)},{default:l(()=>t[28]||(t[28]=[i("取消完成")])),_:2},1032,["onClick"])):v("",!0),e(g,{type:"primary",link:"",onClick:R=>Q(a)},{default:l(()=>t[29]||(t[29]=[i("编辑")])),_:2},1032,["onClick"]),e(g,{type:"danger",link:"",onClick:R=>se(a)},{default:l(()=>t[30]||(t[30]=[i("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ue,s(x).loading]]),r("div",lt,[e(ne,{modelValue:s(x),"onUpdate:modelValue":t[5]||(t[5]=a=>q(x)?x.value=a:null),onChange:s(S)},null,8,["modelValue","onChange"])])]),_:1}),e(N,{modelValue:s(V),"onUpdate:modelValue":t[14]||(t[14]=a=>q(V)?V.value=a:null),title:s(o).id?"编辑任务":"添加任务",width:"600px"},{footer:l(()=>[e(g,{onClick:t[13]||(t[13]=a=>V.value=!1)},{default:l(()=>t[32]||(t[32]=[i("取消")])),_:1}),e(g,{type:"primary",onClick:Z},{default:l(()=>t[33]||(t[33]=[i("确定")])),_:1})]),default:l(()=>[e(M,{model:s(o),"label-width":"100px",rules:J,ref_key:"editFormRef",ref:z},{default:l(()=>[s(o).id?v("",!0):(b(),C(f,{key:0,label:"订单",prop:"order_id"},{default:l(()=>[e(m,{modelValue:s(o).order_id,"onUpdate:modelValue":t[6]||(t[6]=a=>s(o).order_id=a),placeholder:"输入订单ID"},null,8,["modelValue"])]),_:1})),e(f,{label:"任务标题",prop:"task_title"},{default:l(()=>[e(m,{modelValue:s(o).task_title,"onUpdate:modelValue":t[7]||(t[7]=a=>s(o).task_title=a),placeholder:"输入任务标题",maxlength:"100"},null,8,["modelValue"])]),_:1}),e(f,{label:"任务描述",prop:"task_desc"},{default:l(()=>[e(m,{modelValue:s(o).task_desc,"onUpdate:modelValue":t[8]||(t[8]=a=>s(o).task_desc=a),type:"textarea",rows:3,placeholder:"输入任务描述",maxlength:"500"},null,8,["modelValue"])]),_:1}),e(f,{label:"任务类型",prop:"task_type"},{default:l(()=>[e(L,{modelValue:s(o).task_type,"onUpdate:modelValue":t[9]||(t[9]=a=>s(o).task_type=a),placeholder:"选择任务类型"},{default:l(()=>[e(p,{label:"准备物料",value:1}),e(p,{label:"确认事项",value:2}),e(p,{label:"沟通联系",value:3}),e(p,{label:"现场安排",value:4}),e(p,{label:"其他",value:5})]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"触发日期",prop:"trigger_date"},{default:l(()=>[e(O,{modelValue:s(o).trigger_date,"onUpdate:modelValue":t[10]||(t[10]=a=>s(o).trigger_date=a),type:"date",placeholder:"选择触发日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),s(o).id?v("",!0):(b(),C(f,{key:1,label:"提前天数",prop:"days_before"},{default:l(()=>[e(h,{modelValue:s(o).days_before,"onUpdate:modelValue":t[11]||(t[11]=a=>s(o).days_before=a),min:0,max:365},null,8,["modelValue"]),t[31]||(t[31]=r("span",{class:"ml-2 text-gray-400 text-sm"},"相对婚期提前的天数",-1))]),_:1})),e(f,{label:"排序",prop:"sort"},{default:l(()=>[e(h,{modelValue:s(o).sort,"onUpdate:modelValue":t[12]||(t[12]=a=>s(o).sort=a),min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(N,{modelValue:s(K),"onUpdate:modelValue":t[15]||(t[15]=a=>q(K)?K.value=a:null),title:"任务详情",width:"600px"},{default:l(()=>[s(u)?(b(),F("div",at,[e(re,{column:2,border:""},{default:l(()=>[e(y,{label:"任务标题",span:2},{default:l(()=>[i(n(s(u).task_title),1)]),_:1}),e(y,{label:"任务描述",span:2},{default:l(()=>[i(n(s(u).task_desc||"-"),1)]),_:1}),e(y,{label:"任务类型"},{default:l(()=>[i(n(s(u).task_type_desc),1)]),_:1}),e(y,{label:"任务状态"},{default:l(()=>[e($,{type:A(s(u).status)},{default:l(()=>[i(n(s(u).status_desc),1)]),_:1},8,["type"])]),_:1}),e(y,{label:"触发日期"},{default:l(()=>[i(n(s(u).trigger_date),1)]),_:1}),e(y,{label:"婚礼日期"},{default:l(()=>[i(n(s(u).wedding_date||"-"),1)]),_:1}),e(y,{label:"订单编号"},{default:l(()=>{var a;return[i(n(((a=s(u).order)==null?void 0:a.order_sn)||"-"),1)]}),_:1}),e(y,{label:"联系人"},{default:l(()=>{var a;return[i(n(((a=s(u).order)==null?void 0:a.contact_name)||"-"),1)]}),_:1}),e(y,{label:"完成状态"},{default:l(()=>[e($,{type:s(u).is_completed?"success":"warning"},{default:l(()=>[i(n(s(u).is_completed?"已完成":"未完成"),1)]),_:1},8,["type"])]),_:1}),e(y,{label:"任务来源"},{default:l(()=>[i(n(s(u).is_system?"系统生成":"手动添加"),1)]),_:1}),s(u).is_completed?(b(),C(y,{key:0,label:"完成时间"},{default:l(()=>[i(n(s(u).complete_time_format||"-"),1)]),_:1})):v("",!0),s(u).is_completed?(b(),C(y,{key:1,label:"完成备注"},{default:l(()=>[i(n(s(u).complete_remark||"-"),1)]),_:1})):v("",!0)]),_:1})])):v("",!0)]),_:1},8,["modelValue"]),e(N,{modelValue:s(E),"onUpdate:modelValue":t[18]||(t[18]=a=>q(E)?E.value=a:null),title:"完成任务",width:"500px"},{footer:l(()=>[e(g,{onClick:t[17]||(t[17]=a=>E.value=!1)},{default:l(()=>t[34]||(t[34]=[i("取消")])),_:1}),e(g,{type:"primary",onClick:le},{default:l(()=>t[35]||(t[35]=[i("确认完成")])),_:1})]),default:l(()=>[e(M,{model:s(U),"label-width":"100px"},{default:l(()=>[e(f,{label:"完成备注"},{default:l(()=>[e(m,{modelValue:s(U).complete_remark,"onUpdate:modelValue":t[16]||(t[16]=a=>s(U).complete_remark=a),type:"textarea",rows:3,placeholder:"请输入完成备注（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{Lt as default};
