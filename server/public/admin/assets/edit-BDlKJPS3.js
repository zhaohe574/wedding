import{D as $,B as H,T as J,U as M,C as Q,N as X,i as Y,g as Z}from"./element-plus-ChK2e5qA.js";import{_ as h}from"./picker-COC_GcuI.js";import{d as D,s as I,r as g,b as ee,a0 as te,c as B,o as d,U as a,u as o,L as i,K as r,P as v,R as p,a as y,T as oe,ab as le,S as ae,a9 as ie,i as se,n as me}from"./@vue-ygbFPFRc.js";import{P as ne}from"./index-n-Jqn6Y-.js";import{k as de,l as pe,m as re}from"./dynamic-CEF9d1CA.js";import{f as w,d as ue}from"./index-D465kfFn.js";import"./@element-plus-C4Lf8veM.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./index-dAc1fhtT.js";import"./index.vue_vue_type_script_setup_true_lang-CCtv5BMP.js";import"./index-DlQH-CEM.js";import"./index-DFyja3d3.js";import"./index.vue_vue_type_script_setup_true_lang-T0yi5BSL.js";import"./@vueuse-yz9uDhpq.js";import"./usePaging-B2jDzebD.js";import"./vuedraggable-RHgmLr3o.js";import"./vue-CQyKTslw.js";import"./sortablejs-BvvSZPRv.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-DRRUpF4H.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DDSL_IW4.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";const fe={class:"edit-popup"},_e={class:"flex flex-wrap gap-2 mb-2"},ce=D({name:"dynamicEdit"}),ge=D({...ce,emits:["success","close"],setup(ve,{expose:S,emit:N}){const k=N,x=I(),V=I(),f=g("add"),F=ee(()=>f.value==="edit"?"编辑动态":"发布动态"),_=g(!1),u=g(""),R=g(),t=te({id:0,dynamic_type:1,title:"",content:"",images:[],video:"",video_cover:"",location:"",tags:[],allow_comment:1,status:1}),P={dynamic_type:[{required:!0,message:"请选择动态类型",trigger:"change"}],content:[{required:!0,message:"请输入动态内容",trigger:"blur"}]},K=l=>{t.tags.splice(l,1)},q=()=>{_.value=!0,me(()=>{var l;(l=R.value)==null||l.focus()})},E=()=>{const l=u.value.trim();if(l&&!t.tags.includes(l)){if(t.tags.length>=5){w.msgWarning("最多添加5个标签"),u.value="",_.value=!1;return}t.tags.push(l)}u.value="",_.value=!1},z=async()=>{var e,m;await((e=x.value)==null?void 0:e.validate());const l={...t,images:t.dynamic_type===2?[]:t.images,video:t.dynamic_type===2?t.video:"",video_cover:t.dynamic_type===2?t.video_cover:""};f.value==="edit"?(await de(l),w.msgSuccess("编辑成功")):(await pe(l),w.msgSuccess("发布成功")),(m=V.value)==null||m.close(),k("success")},A=()=>{k("close")},L=(l="add")=>{var e;f.value=l,l==="add"&&Object.assign(t,{id:0,dynamic_type:1,title:"",content:"",images:[],video:"",video_cover:"",location:"",tags:[],allow_comment:1,status:1}),(e=V.value)==null||e.open()},U=async l=>{for(const e in t)l[e]!=null&&l[e]!=null&&(t[e]=l[e]);l.tags&&typeof l.tags=="string"&&(t.tags=l.tags.split(",").filter(e=>e.trim())),(l.allow_comment===void 0||l.allow_comment===null)&&(t.allow_comment=1)};return S({open:L,setFormData:U,getDetail:async l=>{const e=await re({id:l.id});U(e)}}),(l,e)=>{const m=M,C=J,n=H,c=Q,b=h,j=X,G=Y,O=Z,W=$;return d(),B("div",fe,[a(ne,{ref_key:"popupRef",ref:V,title:o(F),async:!0,width:"800px",onConfirm:z,onClose:A},{default:i(()=>[a(W,{ref_key:"formRef",ref:x,model:o(t),rules:P,"label-width":"100px"},{default:i(()=>[a(n,{label:"动态类型",prop:"dynamic_type"},{default:i(()=>[a(C,{modelValue:o(t).dynamic_type,"onUpdate:modelValue":e[0]||(e[0]=s=>o(t).dynamic_type=s)},{default:i(()=>[a(m,{label:1},{default:i(()=>e[10]||(e[10]=[p("图文")])),_:1}),a(m,{label:2},{default:i(()=>e[11]||(e[11]=[p("视频")])),_:1}),a(m,{label:3},{default:i(()=>e[12]||(e[12]=[p("案例")])),_:1}),a(m,{label:4},{default:i(()=>e[13]||(e[13]=[p("活动")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"标题",prop:"title"},{default:i(()=>[a(c,{modelValue:o(t).title,"onUpdate:modelValue":e[1]||(e[1]=s=>o(t).title=s),placeholder:"请输入标题（可选）",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(n,{label:"内容",prop:"content"},{default:i(()=>[a(c,{modelValue:o(t).content,"onUpdate:modelValue":e[2]||(e[2]=s=>o(t).content=s),type:"textarea",rows:6,placeholder:"请输入动态内容",maxlength:"2000","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(t).dynamic_type!==2?(d(),r(n,{key:0,label:"图片",prop:"images"},{default:i(()=>[a(b,{modelValue:o(t).images,"onUpdate:modelValue":e[3]||(e[3]=s=>o(t).images=s),limit:9,type:"image"},null,8,["modelValue"]),e[14]||(e[14]=y("div",{class:"form-tips"},"最多上传9张图片",-1))]),_:1})):v("",!0),o(t).dynamic_type===2?(d(),r(n,{key:1,label:"视频",prop:"video"},{default:i(()=>[a(b,{modelValue:o(t).video,"onUpdate:modelValue":e[4]||(e[4]=s=>o(t).video=s),limit:1,type:"video"},null,8,["modelValue"])]),_:1})):v("",!0),o(t).dynamic_type===2&&o(t).video?(d(),r(n,{key:2,label:"视频封面",prop:"video_cover"},{default:i(()=>[a(b,{modelValue:o(t).video_cover,"onUpdate:modelValue":e[5]||(e[5]=s=>o(t).video_cover=s),limit:1,type:"image"},null,8,["modelValue"])]),_:1})):v("",!0),a(n,{label:"位置",prop:"location"},{default:i(()=>[a(c,{modelValue:o(t).location,"onUpdate:modelValue":e[6]||(e[6]=s=>o(t).location=s),placeholder:"请输入位置（可选）",maxlength:"100"},null,8,["modelValue"])]),_:1}),a(n,{label:"标签",prop:"tags"},{default:i(()=>[y("div",_e,[(d(!0),B(oe,null,le(o(t).tags,(s,T)=>(d(),r(j,{key:T,closable:"",onClose:Ve=>K(T)},{default:i(()=>[p(ae(s),1)]),_:2},1032,["onClose"]))),128)),o(_)?(d(),r(c,{key:0,ref_key:"tagInputRef",ref:R,modelValue:o(u),"onUpdate:modelValue":e[7]||(e[7]=s=>se(u)?u.value=s:null),size:"small",style:{width:"100px"},onKeyup:ie(E,["enter"]),onBlur:E},null,8,["modelValue"])):(d(),r(G,{key:1,size:"small",onClick:q},{default:i(()=>e[15]||(e[15]=[p(" + 添加标签 ")])),_:1}))]),e[16]||(e[16]=y("div",{class:"form-tips"},"最多添加5个标签",-1))]),_:1}),a(n,{label:"允许评论",prop:"allow_comment"},{default:i(()=>[a(O,{modelValue:o(t).allow_comment,"onUpdate:modelValue":e[8]||(e[8]=s=>o(t).allow_comment=s),"active-value":1,"inactive-value":0,"active-text":"允许","inactive-text":"禁止"},null,8,["modelValue"]),e[17]||(e[17]=y("div",{class:"form-tips"},"关闭后用户将无法对该动态发表新评论",-1))]),_:1}),o(f)==="edit"?(d(),r(n,{key:3,label:"状态",prop:"status"},{default:i(()=>[a(C,{modelValue:o(t).status,"onUpdate:modelValue":e[9]||(e[9]=s=>o(t).status=s)},{default:i(()=>[a(m,{label:0},{default:i(()=>e[18]||(e[18]=[p("待审核")])),_:1}),a(m,{label:1},{default:i(()=>e[19]||(e[19]=[p("已发布")])),_:1}),a(m,{label:2},{default:i(()=>e[20]||(e[20]=[p("已下架")])),_:1})]),_:1},8,["modelValue"])]),_:1})):v("",!0)]),_:1},8,["model"])]),_:1},8,["title"])])}}}),dt=ue(ge,[["__scopeId","data-v-8808c869"]]);export{dt as default};
