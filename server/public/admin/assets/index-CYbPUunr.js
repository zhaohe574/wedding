import{D as _e,B as pe,C as ce,J as fe,K as be,V as ve,i as ye,H as xe,L as ge,M as ke,q as Ve,N as Ce,O as we,W as he,X as Ee,v as Se,Z as De,_ as Ue,R as $e}from"./element-plus-ChK2e5qA.js";import{_ as Ke}from"./index.vue_vue_type_script_setup_true_lang-CCtv5BMP.js";import{d as j,a0 as M,r as K,a1 as Ne,c as g,o as m,U as e,a as d,L as l,u as s,a9 as z,R as i,S as n,M as Te,K as V,P as C,i as B,T as Ae,ab as Be}from"./@vue-ygbFPFRc.js";import{o as Fe,a as Le,b as Pe,c as Ie,d as Me,e as ze,f as Re}from"./order-B04ZaiMZ.js";import{u as Ye}from"./usePaging-B2jDzebD.js";import{f as U,d as qe}from"./index-D465kfFn.js";import"./@element-plus-C4Lf8veM.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-DRRUpF4H.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DDSL_IW4.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";const Oe={class:"order-lists"},je={class:"mt-4 grid grid-cols-6 gap-4"},He={class:"text-center"},Je={class:"text-2xl font-bold mt-2 text-yellow-500"},We={class:"text-center"},Xe={class:"text-2xl font-bold mt-2 text-orange-500"},Ze={class:"text-center"},Ge={class:"text-2xl font-bold mt-2 text-blue-500"},Qe={class:"text-center"},et={class:"text-2xl font-bold mt-2 text-purple-500"},tt={class:"text-center"},lt={class:"text-2xl font-bold mt-2 text-green-500"},at={class:"text-center"},st={class:"text-2xl font-bold mt-2 text-emerald-500"},ot={class:"text-center"},nt={class:"text-2xl font-bold mt-2 text-gray-500"},dt={class:"text-center"},it={class:"text-2xl font-bold mt-2 text-amber-500"},rt={class:"text-center"},ut={class:"text-2xl font-bold mt-2 text-red-500"},mt={key:0,class:"flex items-center"},_t={class:"ml-2"},pt={key:1},ct={class:"text-gray-400 text-xs"},ft={class:"text-red-500 font-bold"},bt={key:0,class:"text-gray-400 text-xs"},vt={class:"flex justify-end mt-4"},yt={key:0,class:"order-detail"},xt={class:"text-red-500 font-bold"},gt={key:1},kt={key:0,class:"mt-4"},Vt={key:1,class:"mt-4"},Ct={class:"text-gray-500"},wt={key:1},ht=j({name:"orderLists"}),Et=j({...ht,setup(St){const c=M({order_sn:"",contact_name:"",contact_mobile:"",order_status:"",create_time:[]}),F=K({}),N=K(!1),r=K(null),h=K(!1),p=M({id:0,order_sn:"",pay_amount:0,voucher:"",remark:""}),E=K(!1),S=M({id:0,reason:""}),{pager:$,getLists:w,resetPage:T,resetParams:H}=Ye({fetchFun:Fe,params:c}),D=async()=>{const o=await Le();F.value=o},k=o=>{if(!F.value.status_counts)return 0;const t=F.value.status_counts.find(y=>y.status===o);return t?t.count:0},R=o=>({0:"warning",1:"warning",2:"primary",3:"info",4:"success",5:"success",6:"info",7:"warning",8:"danger"})[o]||"info",J=o=>{var t;return(o==null?void 0:o.contact_name)||((t=o==null?void 0:o.user)==null?void 0:t.nickname)||"-"},W=o=>{var t;return(o==null?void 0:o.contact_mobile)||((t=o==null?void 0:o.user)==null?void 0:t.mobile)||"-"},X=o=>{if(o!=null&&o.service_date)return o.service_date;const t=((o==null?void 0:o.items)||[]).map(y=>y.service_date||y.schedule_date).filter(Boolean);return t.length?Array.from(new Set(t)).join("、"):"-"},Z=o=>Number((o==null?void 0:o.paid_amount)??0).toFixed(2),G=async o=>{const t=await Pe({id:o.id});r.value=t,N.value=!0},Q=o=>{p.id=o.id,p.order_sn=o.order_sn||"",p.pay_amount=o.pay_amount||0,p.voucher=o.pay_voucher||"",p.remark="",h.value=!0},Y=async o=>{await Ie({id:p.id,approved:o,remark:p.remark}),U.msgSuccess("操作成功"),h.value=!1,w(),D()},ee=async o=>{await U.confirm("确定要开始服务吗？"),await Me({id:o.id}),U.msgSuccess("操作成功"),w(),D()},te=async o=>{await U.confirm("确定要完成订单吗？"),await ze({id:o.id}),U.msgSuccess("操作成功"),w(),D()},le=o=>{S.id=o.id,S.reason="",E.value=!0},ae=async()=>{await Re(S),U.msgSuccess("订单已取消"),E.value=!1,w(),D()};return Ne(()=>{w(),D()}),w(),D(),(o,t)=>{const y=ce,b=pe,x=be,se=fe,oe=ve,f=ye,L=_e,v=xe,_=ke,ne=Ve,P=Ce,q=ge,de=Ke,u=Ee,O=Se,ie=he,re=Ue,ue=De,I=$e,me=we;return m(),g("div",Oe,[e(v,{class:"!border-none",shadow:"never"},{default:l(()=>[e(L,{ref:"formRef",class:"mb-[-16px]",model:s(c),inline:!0},{default:l(()=>[e(b,{class:"w-[180px]",label:"订单编号"},{default:l(()=>[e(y,{modelValue:s(c).order_sn,"onUpdate:modelValue":t[0]||(t[0]=a=>s(c).order_sn=a),placeholder:"输入订单编号",clearable:"",onKeyup:z(s(T),["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(b,{class:"w-[150px]",label:"联系人"},{default:l(()=>[e(y,{modelValue:s(c).contact_name,"onUpdate:modelValue":t[1]||(t[1]=a=>s(c).contact_name=a),placeholder:"输入联系人",clearable:"",onKeyup:z(s(T),["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(b,{class:"w-[150px]",label:"联系电话"},{default:l(()=>[e(y,{modelValue:s(c).contact_mobile,"onUpdate:modelValue":t[2]||(t[2]=a=>s(c).contact_mobile=a),placeholder:"输入联系电话",clearable:"",onKeyup:z(s(T),["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(b,{class:"w-[150px]",label:"订单状态"},{default:l(()=>[e(se,{modelValue:s(c).order_status,"onUpdate:modelValue":t[3]||(t[3]=a=>s(c).order_status=a),placeholder:"选择状态",clearable:""},{default:l(()=>[e(x,{label:"全部",value:""}),e(x,{label:"待确认",value:0}),e(x,{label:"待支付",value:1}),e(x,{label:"已支付",value:2}),e(x,{label:"服务中",value:3}),e(x,{label:"已完成",value:4}),e(x,{label:"已评价",value:5}),e(x,{label:"已取消",value:6}),e(x,{label:"已暂停",value:7}),e(x,{label:"已退款",value:8})]),_:1},8,["modelValue"])]),_:1}),e(b,{class:"w-[320px]",label:"创建时间"},{default:l(()=>[e(oe,{modelValue:s(c).create_time,"onUpdate:modelValue":t[4]||(t[4]=a=>s(c).create_time=a),type:"daterange","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",clearable:""},null,8,["modelValue"])]),_:1}),e(b,null,{default:l(()=>[e(f,{type:"primary",onClick:s(T)},{default:l(()=>t[15]||(t[15]=[i("查询")])),_:1},8,["onClick"]),e(f,{onClick:s(H)},{default:l(()=>t[16]||(t[16]=[i("重置")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),d("div",je,[e(v,{class:"!border-none",shadow:"never"},{default:l(()=>[d("div",He,[t[17]||(t[17]=d("div",{class:"text-gray-500 text-sm"},"待确认",-1)),d("div",Je,n(k(0)),1)])]),_:1}),e(v,{class:"!border-none",shadow:"never"},{default:l(()=>[d("div",We,[t[18]||(t[18]=d("div",{class:"text-gray-500 text-sm"},"待支付",-1)),d("div",Xe,n(k(1)),1)])]),_:1}),e(v,{class:"!border-none",shadow:"never"},{default:l(()=>[d("div",Ze,[t[19]||(t[19]=d("div",{class:"text-gray-500 text-sm"},"已支付",-1)),d("div",Ge,n(k(2)),1)])]),_:1}),e(v,{class:"!border-none",shadow:"never"},{default:l(()=>[d("div",Qe,[t[20]||(t[20]=d("div",{class:"text-gray-500 text-sm"},"服务中",-1)),d("div",et,n(k(3)),1)])]),_:1}),e(v,{class:"!border-none",shadow:"never"},{default:l(()=>[d("div",tt,[t[21]||(t[21]=d("div",{class:"text-gray-500 text-sm"},"已完成",-1)),d("div",lt,n(k(4)),1)])]),_:1}),e(v,{class:"!border-none",shadow:"never"},{default:l(()=>[d("div",at,[t[22]||(t[22]=d("div",{class:"text-gray-500 text-sm"},"已评价",-1)),d("div",st,n(k(5)),1)])]),_:1}),e(v,{class:"!border-none",shadow:"never"},{default:l(()=>[d("div",ot,[t[23]||(t[23]=d("div",{class:"text-gray-500 text-sm"},"已取消",-1)),d("div",nt,n(k(6)),1)])]),_:1}),e(v,{class:"!border-none",shadow:"never"},{default:l(()=>[d("div",dt,[t[24]||(t[24]=d("div",{class:"text-gray-500 text-sm"},"已暂停",-1)),d("div",it,n(k(7)),1)])]),_:1}),e(v,{class:"!border-none",shadow:"never"},{default:l(()=>[d("div",rt,[t[25]||(t[25]=d("div",{class:"text-gray-500 text-sm"},"已退款",-1)),d("div",ut,n(k(8)),1)])]),_:1})]),e(v,{class:"!border-none mt-4",shadow:"never"},{default:l(()=>[Te((m(),V(q,{size:"large",data:s($).lists},{default:l(()=>[e(_,{label:"订单编号",prop:"order_sn","min-width":"180"}),e(_,{label:"用户信息","min-width":"150"},{default:l(({row:a})=>[a.user?(m(),g("div",mt,[e(ne,{src:a.user.avatar,size:32},null,8,["src"]),d("span",_t,n(a.user.nickname),1)])):(m(),g("span",pt,"-"))]),_:1}),e(_,{label:"联系信息","min-width":"140"},{default:l(({row:a})=>[d("div",null,n(a.contact_name),1),d("div",ct,n(a.contact_mobile),1)]),_:1}),e(_,{label:"订单金额",width:"120"},{default:l(({row:a})=>[d("div",ft,"¥"+n(a.pay_amount),1),a.discount_amount>0?(m(),g("div",bt," 优惠: ¥"+n(a.discount_amount),1)):C("",!0)]),_:1}),e(_,{label:"订单状态",width:"100"},{default:l(({row:a})=>[e(P,{type:R(a.order_status)},{default:l(()=>[i(n(a.order_status_desc),1)]),_:2},1032,["type"])]),_:1}),e(_,{label:"支付状态",width:"100"},{default:l(({row:a})=>[e(P,{type:a.pay_status===1?"success":"info",size:"small"},{default:l(()=>[i(n(a.pay_status_desc),1)]),_:2},1032,["type"])]),_:1}),e(_,{label:"服务日期",prop:"service_date",width:"110"}),e(_,{label:"来源",width:"80"},{default:l(({row:a})=>[d("span",null,n(a.source_desc),1)]),_:1}),e(_,{label:"创建时间",prop:"create_time",width:"170"}),e(_,{label:"操作",width:"200",fixed:"right"},{default:l(({row:a})=>[e(f,{type:"primary",link:"",onClick:A=>G(a)},{default:l(()=>t[26]||(t[26]=[i("详情")])),_:2},1032,["onClick"]),a.order_status===1&&a.pay_type===4&&a.pay_voucher&&a.pay_voucher_status===0?(m(),V(f,{key:0,type:"warning",link:"",onClick:A=>Q(a)},{default:l(()=>t[27]||(t[27]=[i("审核凭证")])),_:2},1032,["onClick"])):C("",!0),a.order_status===2?(m(),V(f,{key:1,type:"warning",link:"",onClick:A=>ee(a)},{default:l(()=>t[28]||(t[28]=[i("开始服务")])),_:2},1032,["onClick"])):C("",!0),a.order_status===3?(m(),V(f,{key:2,type:"success",link:"",onClick:A=>te(a)},{default:l(()=>t[29]||(t[29]=[i("完成")])),_:2},1032,["onClick"])):C("",!0),a.order_status<=1?(m(),V(f,{key:3,type:"danger",link:"",onClick:A=>le(a)},{default:l(()=>t[30]||(t[30]=[i("取消")])),_:2},1032,["onClick"])):C("",!0)]),_:1})]),_:1},8,["data"])),[[me,s($).loading]]),d("div",vt,[e(de,{modelValue:s($),"onUpdate:modelValue":t[5]||(t[5]=a=>B($)?$.value=a:null),onChange:s(w)},null,8,["modelValue","onChange"])])]),_:1}),e(I,{modelValue:s(N),"onUpdate:modelValue":t[6]||(t[6]=a=>B(N)?N.value=a:null),title:"订单详情",width:"800px"},{default:l(()=>[s(r)?(m(),g("div",yt,[e(ie,{column:2,border:""},{default:l(()=>[e(u,{label:"订单编号"},{default:l(()=>[i(n(s(r).order_sn),1)]),_:1}),e(u,{label:"订单状态"},{default:l(()=>[e(P,{type:R(s(r).order_status)},{default:l(()=>[i(n(s(r).order_status_desc),1)]),_:1},8,["type"])]),_:1}),e(u,{label:"联系人"},{default:l(()=>[i(n(J(s(r))),1)]),_:1}),e(u,{label:"联系电话"},{default:l(()=>[i(n(W(s(r))),1)]),_:1}),e(u,{label:"服务日期"},{default:l(()=>[i(n(X(s(r))),1)]),_:1}),e(u,{label:"婚礼日期"},{default:l(()=>[i(n(s(r).wedding_date||"-"),1)]),_:1}),e(u,{label:"服务地址",span:2},{default:l(()=>[i(n(s(r).service_address||"-"),1)]),_:1}),e(u,{label:"订单总额"},{default:l(()=>[i("¥"+n(s(r).total_amount),1)]),_:1}),e(u,{label:"优惠金额"},{default:l(()=>[i("¥"+n(s(r).discount_amount),1)]),_:1}),Number(s(r).coupon_amount||0)>0?(m(),V(u,{key:0,label:"优惠券金额"},{default:l(()=>[i(" ¥"+n(s(r).coupon_amount),1)]),_:1})):C("",!0),e(u,{label:"应付金额"},{default:l(()=>[i("¥"+n(s(r).pay_amount),1)]),_:1}),e(u,{label:"已付金额"},{default:l(()=>[d("span",xt,"¥"+n(Z(s(r))),1)]),_:1}),e(u,{label:"支付方式"},{default:l(()=>[i(n(s(r).pay_type_desc||"-"),1)]),_:1}),e(u,{label:"支付状态"},{default:l(()=>[i(n(s(r).pay_status_desc||"-"),1)]),_:1}),e(u,{label:"线下凭证",span:2},{default:l(()=>[s(r).pay_voucher?(m(),V(O,{key:0,src:s(r).pay_voucher,fit:"contain",style:{width:"100%","max-height":"260px"}},null,8,["src"])):(m(),g("span",gt,"-"))]),_:1}),e(u,{label:"凭证状态"},{default:l(()=>[i(n(s(r).pay_voucher_status_desc||"-"),1)]),_:1}),e(u,{label:"审核备注"},{default:l(()=>[i(n(s(r).pay_voucher_audit_remark||"-"),1)]),_:1}),e(u,{label:"用户备注",span:2},{default:l(()=>[i(n(s(r).user_remark||"-"),1)]),_:1}),e(u,{label:"管理备注",span:2},{default:l(()=>[i(n(s(r).admin_remark||"-"),1)]),_:1})]),_:1}),s(r).items&&s(r).items.length>0?(m(),g("div",kt,[t[31]||(t[31]=d("h4",{class:"font-bold mb-2"},"服务项目",-1)),e(q,{data:s(r).items,border:"",size:"small"},{default:l(()=>[e(_,{label:"工作人员",prop:"staff_name"}),e(_,{label:"套餐",prop:"package_name"}),e(_,{label:"服务日期",prop:"service_date"}),e(_,{label:"单价",prop:"price"},{default:l(({row:a})=>[i("¥"+n(a.price),1)]),_:1}),e(_,{label:"数量",prop:"quantity"}),e(_,{label:"小计",prop:"subtotal"},{default:l(({row:a})=>[i("¥"+n(a.subtotal),1)]),_:1})]),_:1},8,["data"])])):C("",!0),s(r).logs&&s(r).logs.length>0?(m(),g("div",Vt,[t[32]||(t[32]=d("h4",{class:"font-bold mb-2"},"操作日志",-1)),e(ue,null,{default:l(()=>[(m(!0),g(Ae,null,Be(s(r).logs,a=>(m(),V(re,{key:a.id,timestamp:a.create_time,placement:"top"},{default:l(()=>[d("span",Ct,"["+n(a.operator_type_desc)+"]",1),i(" "+n(a.content),1)]),_:2},1032,["timestamp"]))),128))]),_:1})])):C("",!0)])):C("",!0)]),_:1},8,["modelValue"]),e(I,{modelValue:s(h),"onUpdate:modelValue":t[11]||(t[11]=a=>B(h)?h.value=a:null),title:"线下凭证审核",width:"520px"},{footer:l(()=>[e(f,{onClick:t[8]||(t[8]=a=>h.value=!1)},{default:l(()=>t[33]||(t[33]=[i("取消")])),_:1}),e(f,{type:"danger",onClick:t[9]||(t[9]=a=>Y(0))},{default:l(()=>t[34]||(t[34]=[i("拒绝")])),_:1}),e(f,{type:"primary",onClick:t[10]||(t[10]=a=>Y(1))},{default:l(()=>t[35]||(t[35]=[i("通过")])),_:1})]),default:l(()=>[e(L,{model:s(p),"label-width":"100px"},{default:l(()=>[e(b,{label:"订单编号"},{default:l(()=>[d("span",null,n(s(p).order_sn||"-"),1)]),_:1}),e(b,{label:"支付金额"},{default:l(()=>[d("span",null,"¥"+n(s(p).pay_amount),1)]),_:1}),e(b,{label:"支付凭证"},{default:l(()=>[s(p).voucher?(m(),V(O,{key:0,src:s(p).voucher,fit:"contain",style:{width:"100%","max-height":"260px"}},null,8,["src"])):(m(),g("span",wt,"未上传"))]),_:1}),e(b,{label:"审核备注"},{default:l(()=>[e(y,{modelValue:s(p).remark,"onUpdate:modelValue":t[7]||(t[7]=a=>s(p).remark=a),type:"textarea",rows:3,placeholder:"可填写拒绝原因或备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(I,{modelValue:s(E),"onUpdate:modelValue":t[14]||(t[14]=a=>B(E)?E.value=a:null),title:"取消订单",width:"500px"},{footer:l(()=>[e(f,{onClick:t[13]||(t[13]=a=>E.value=!1)},{default:l(()=>t[36]||(t[36]=[i("取消")])),_:1}),e(f,{type:"danger",onClick:ae},{default:l(()=>t[37]||(t[37]=[i("确认取消")])),_:1})]),default:l(()=>[e(L,{model:s(S),"label-width":"100px"},{default:l(()=>[e(b,{label:"取消原因"},{default:l(()=>[e(y,{modelValue:s(S).reason,"onUpdate:modelValue":t[12]||(t[12]=a=>s(S).reason=a),type:"textarea",rows:3,placeholder:"请输入取消原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),il=qe(Et,[["__scopeId","data-v-9db4b130"]]);export{il as default};
