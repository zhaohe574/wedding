import{D as le,B as ae,J as se,K as ne,C as oe,i as ie,H as de,L as re,M as me,q as ce,N as ue,O as _e,R as pe,W as fe,X as ye,v as ve}from"./element-plus-ChK2e5qA.js";import{_ as be}from"./index.vue_vue_type_script_setup_true_lang-CCtv5BMP.js";import{d as F,r as R,a0 as z,a1 as ge,c as _,o as i,U as t,L as l,u as e,a9 as ke,R as d,a as r,M as he,K as v,P as p,S as o,i as U,T as we,ab as xe}from"./@vue-ygbFPFRc.js";import{a as Ce,b as Ve,c as De,d as Ee,e as Be,f as Ie,g as Re,h as $e}from"./dynamic-CEF9d1CA.js";import{u as Se}from"./usePaging-B2jDzebD.js";import{f as g}from"./index-D465kfFn.js";import"./@element-plus-C4Lf8veM.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-DRRUpF4H.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DDSL_IW4.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";const je={class:"comment-review-page"},Ue={class:"mb-4 flex items-center justify-between"},Ae={class:"flex gap-2"},Le={key:0,class:"flex items-center"},Te={class:"ml-2"},ze={key:1},Fe={key:0},Ke={key:0,class:"font-bold"},Ne={class:"text-gray-500 text-sm"},Pe={key:1},qe={class:"mt-4 flex justify-end"},Ge={key:0},Me={class:"mb-6"},Oe={key:0,class:"flex items-center"},We={class:"ml-2"},He={class:"text-gray-400 text-xs"},Je={key:1},Xe={class:"whitespace-pre-wrap"},Qe={key:0,class:"mb-6"},Ye={class:"flex items-start"},Ze={class:"ml-3 flex-1"},et={class:"font-bold"},tt={class:"mt-1 text-gray-600"},lt={key:1},at={key:0,class:"flex items-center"},st={class:"ml-2"},nt={key:1},ot={class:"whitespace-pre-wrap max-h-32 overflow-y-auto"},it={key:0,class:"mt-4"},dt={class:"flex flex-wrap gap-2"},rt={key:1,class:"mt-4"},mt=["src"],ct={class:"mt-4"},ut=F({name:"commentReview"}),Ht=F({...ut,setup(_t){const f=R([]),x=R(!1),D=R(!1),s=R(null),u=z({id:0,ids:[],remark:"",isBatch:!1}),k=z({review_status:0,dynamic_id:"",user_id:"",content:""}),{pager:V,getLists:h,resetPage:A,resetParams:K}=Se({fetchFun:Ce,params:k}),N=c=>({0:"warning",1:"success",2:"danger"})[c]||"info",P=c=>{f.value=c.map(a=>a.id)},q=async c=>{const a=await Ve({id:c.id});s.value=a,D.value=!0},G=async c=>{await g.confirm("确认通过该评论？"),await De({id:c}),g.msgSuccess("审核通过"),h()},M=c=>{u.id=c,u.ids=[],u.remark="",u.isBatch=!1,x.value=!0},O=async()=>{if(!u.remark.trim()){g.msgWarning("请输入拒绝原因");return}try{u.isBatch?await Ee({ids:u.ids,remark:u.remark}):await Be({id:u.id,remark:u.remark}),g.msgSuccess("已拒绝"),x.value=!1,h()}catch{g.msgError("操作失败")}},W=async()=>{await g.confirm(`确认通过选中的 ${f.value.length} 条评论？`);const c=await Ie({ids:f.value});g.msgSuccess(`批量审核完成：成功 ${c.success_count} 条，失败 ${c.fail_count} 条`),h()},H=()=>{u.id=0,u.ids=f.value,u.remark="",u.isBatch=!0,x.value=!0},J=async c=>{await g.confirm("确定要删除该评论吗？删除后不可恢复"),await Re({id:c.id}),g.msgSuccess("删除成功"),h()},X=async()=>{await g.confirm(`确定要删除选中的 ${f.value.length} 条评论吗？删除后不可恢复`);const c=await $e({ids:f.value});g.msgSuccess(`批量删除完成：成功 ${c.success_count} 条，失败 ${c.fail_count} 条`),h()};return ge(()=>{h()}),h(),(c,a)=>{const E=ne,Q=se,C=ae,B=oe,b=ie,L=le,$=de,w=me,I=ce,S=ue,Y=re,Z=be,T=pe,m=ye,j=fe,ee=ve,te=_e;return i(),_("div",je,[t($,{class:"!border-none",shadow:"never"},{default:l(()=>[t(L,{ref:"formRef",class:"mb-[-16px]",model:e(k),inline:!0},{default:l(()=>[t(C,{class:"w-[150px]",label:"审核状态"},{default:l(()=>[t(Q,{modelValue:e(k).review_status,"onUpdate:modelValue":a[0]||(a[0]=n=>e(k).review_status=n),placeholder:"选择状态",clearable:""},{default:l(()=>[t(E,{label:"全部",value:""}),t(E,{label:"待审核",value:0}),t(E,{label:"已通过",value:1}),t(E,{label:"已拒绝",value:2})]),_:1},8,["modelValue"])]),_:1}),t(C,{class:"w-[150px]",label:"动态ID"},{default:l(()=>[t(B,{modelValue:e(k).dynamic_id,"onUpdate:modelValue":a[1]||(a[1]=n=>e(k).dynamic_id=n),placeholder:"输入动态ID",clearable:""},null,8,["modelValue"])]),_:1}),t(C,{class:"w-[150px]",label:"用户ID"},{default:l(()=>[t(B,{modelValue:e(k).user_id,"onUpdate:modelValue":a[2]||(a[2]=n=>e(k).user_id=n),placeholder:"输入用户ID",clearable:""},null,8,["modelValue"])]),_:1}),t(C,{class:"w-[200px]",label:"内容"},{default:l(()=>[t(B,{modelValue:e(k).content,"onUpdate:modelValue":a[3]||(a[3]=n=>e(k).content=n),placeholder:"搜索评论内容",clearable:"",onKeyup:ke(e(A),["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(C,null,{default:l(()=>[t(b,{type:"primary",onClick:e(A)},{default:l(()=>a[9]||(a[9]=[d("查询")])),_:1},8,["onClick"]),t(b,{onClick:e(K)},{default:l(()=>a[10]||(a[10]=[d("重置")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),t($,{class:"!border-none mt-4",shadow:"never"},{default:l(()=>[r("div",Ue,[a[11]||(a[11]=r("div",{class:"text-lg font-medium"},"评论管理",-1)),r("div",Ae,[e(f).length>0?(i(),v(b,{key:0,type:"success",onClick:W},{default:l(()=>[d(" 批量通过 ("+o(e(f).length)+") ",1)]),_:1})):p("",!0),e(f).length>0?(i(),v(b,{key:1,type:"danger",onClick:H},{default:l(()=>[d(" 批量拒绝 ("+o(e(f).length)+") ",1)]),_:1})):p("",!0),e(f).length>0?(i(),v(b,{key:2,type:"danger",plain:"",onClick:X},{default:l(()=>[d(" 批量删除 ("+o(e(f).length)+") ",1)]),_:1})):p("",!0)])]),he((i(),v(Y,{data:e(V).lists,onSelectionChange:P},{default:l(()=>[t(w,{type:"selection",width:"55"}),t(w,{label:"ID",prop:"id",width:"80"}),t(w,{label:"评论内容",prop:"content","min-width":"200","show-overflow-tooltip":""}),t(w,{label:"发表用户",width:"150"},{default:l(({row:n})=>[n.user?(i(),_("div",Le,[t(I,{src:n.user.avatar,size:32},null,8,["src"]),r("span",Te,o(n.user.nickname),1)])):(i(),_("span",ze,"未知用户"))]),_:1}),t(w,{label:"所属动态","min-width":"180","show-overflow-tooltip":""},{default:l(({row:n})=>{var y;return[n.dynamic?(i(),_("div",Fe,[n.dynamic.title?(i(),_("div",Ke,o(n.dynamic.title),1)):p("",!0),r("div",Ne,o((y=n.dynamic.content)==null?void 0:y.substring(0,30))+"...",1)])):(i(),_("span",Pe,"-"))]}),_:1}),t(w,{label:"审核状态",width:"100"},{default:l(({row:n})=>[t(S,{type:N(n.review_status)},{default:l(()=>[d(o(n.review_status_desc),1)]),_:2},1032,["type"])]),_:1}),t(w,{label:"发表时间",prop:"create_time",width:"170"}),t(w,{label:"操作",width:"220",fixed:"right"},{default:l(({row:n})=>[t(b,{type:"primary",link:"",onClick:y=>q(n)},{default:l(()=>a[12]||(a[12]=[d(" 详情 ")])),_:2},1032,["onClick"]),n.review_status===0?(i(),v(b,{key:0,type:"success",link:"",onClick:y=>G(n.id)},{default:l(()=>a[13]||(a[13]=[d(" 通过 ")])),_:2},1032,["onClick"])):p("",!0),n.review_status===0?(i(),v(b,{key:1,type:"danger",link:"",onClick:y=>M(n.id)},{default:l(()=>a[14]||(a[14]=[d(" 拒绝 ")])),_:2},1032,["onClick"])):p("",!0),t(b,{type:"danger",link:"",onClick:y=>J(n)},{default:l(()=>a[15]||(a[15]=[d(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[te,e(V).loading]]),r("div",qe,[t(Z,{modelValue:e(V),"onUpdate:modelValue":a[4]||(a[4]=n=>U(V)?V.value=n:null),onChange:e(h)},null,8,["modelValue","onChange"])])]),_:1}),t(T,{modelValue:e(x),"onUpdate:modelValue":a[7]||(a[7]=n=>U(x)?x.value=n:null),title:"拒绝原因",width:"500px"},{footer:l(()=>[t(b,{onClick:a[6]||(a[6]=n=>x.value=!1)},{default:l(()=>a[16]||(a[16]=[d("取消")])),_:1}),t(b,{type:"primary",onClick:O},{default:l(()=>a[17]||(a[17]=[d("确定")])),_:1})]),default:l(()=>[t(L,{model:e(u),"label-width":"80px"},{default:l(()=>[t(C,{label:"拒绝原因"},{default:l(()=>[t(B,{modelValue:e(u).remark,"onUpdate:modelValue":a[5]||(a[5]=n=>e(u).remark=n),type:"textarea",rows:4,placeholder:"请输入拒绝原因",maxlength:"255","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(T,{modelValue:e(D),"onUpdate:modelValue":a[8]||(a[8]=n=>U(D)?D.value=n:null),title:"评论详情",width:"800px"},{default:l(()=>[e(s)?(i(),_("div",Ge,[r("div",Me,[a[18]||(a[18]=r("h3",{class:"text-lg font-bold mb-3"},"评论信息",-1)),t(j,{column:2,border:""},{default:l(()=>[t(m,{label:"评论ID"},{default:l(()=>[d(o(e(s).id),1)]),_:1}),t(m,{label:"审核状态"},{default:l(()=>[t(S,{type:e(s).review_status===0?"warning":e(s).review_status===1?"success":"danger"},{default:l(()=>[d(o(e(s).review_status_desc),1)]),_:1},8,["type"])]),_:1}),t(m,{label:"评论用户",span:2},{default:l(()=>[e(s).user?(i(),_("div",Oe,[t(I,{src:e(s).user.avatar,size:32},null,8,["src"]),r("div",We,[r("div",null,o(e(s).user.nickname),1),r("div",He,o(e(s).user.mobile||"-"),1)])])):(i(),_("span",Je,"未知用户"))]),_:1}),t(m,{label:"评论内容",span:2},{default:l(()=>[r("div",Xe,o(e(s).content),1)]),_:1}),t(m,{label:"点赞数"},{default:l(()=>[d(o(e(s).like_count),1)]),_:1}),t(m,{label:"回复数"},{default:l(()=>[d(o(e(s).reply_count),1)]),_:1}),t(m,{label:"发表时间",span:2},{default:l(()=>[d(o(e(s).create_time),1)]),_:1}),e(s).review_time?(i(),v(m,{key:0,label:"审核时间",span:2},{default:l(()=>[d(o(e(s).review_time),1)]),_:1})):p("",!0),e(s).review_remark?(i(),v(m,{key:1,label:"审核备注",span:2},{default:l(()=>[d(o(e(s).review_remark),1)]),_:1})):p("",!0)]),_:1})]),e(s).parent_comment?(i(),_("div",Qe,[a[19]||(a[19]=r("h3",{class:"text-lg font-bold mb-3"},"回复的评论",-1)),t($,{class:"bg-gray-50"},{default:l(()=>{var n,y;return[r("div",Ye,[t(I,{src:(n=e(s).parent_comment.user)==null?void 0:n.avatar,size:32},null,8,["src"]),r("div",Ze,[r("div",et,o(((y=e(s).parent_comment.user)==null?void 0:y.nickname)||"未知用户"),1),r("div",tt,o(e(s).parent_comment.content),1)])])]}),_:1})])):p("",!0),e(s).dynamic?(i(),_("div",lt,[a[23]||(a[23]=r("h3",{class:"text-lg font-bold mb-3"},"关联动态",-1)),t(j,{column:2,border:""},{default:l(()=>[t(m,{label:"动态ID"},{default:l(()=>[d(o(e(s).dynamic.id),1)]),_:1}),t(m,{label:"动态类型"},{default:l(()=>[t(S,{size:"small"},{default:l(()=>[d(o(e(s).dynamic.type_desc),1)]),_:1})]),_:1}),t(m,{label:"发布者",span:2},{default:l(()=>[e(s).dynamic.publisher?(i(),_("div",at,[t(I,{src:e(s).dynamic.publisher.avatar,size:32},null,8,["src"]),r("span",st,o(e(s).dynamic.publisher.nickname),1)])):(i(),_("span",nt,"-"))]),_:1}),e(s).dynamic.title?(i(),v(m,{key:0,label:"标题",span:2},{default:l(()=>[d(o(e(s).dynamic.title),1)]),_:1})):p("",!0),t(m,{label:"内容",span:2},{default:l(()=>[r("div",ot,o(e(s).dynamic.content),1)]),_:1}),e(s).dynamic.location?(i(),v(m,{key:1,label:"位置",span:2},{default:l(()=>[d(o(e(s).dynamic.location),1)]),_:1})):p("",!0),e(s).dynamic.tags?(i(),v(m,{key:2,label:"标签",span:2},{default:l(()=>[d(o(e(s).dynamic.tags),1)]),_:1})):p("",!0)]),_:1}),e(s).dynamic.images&&e(s).dynamic.images.length>0?(i(),_("div",it,[a[20]||(a[20]=r("h4",{class:"font-bold mb-2"},"动态图片",-1)),r("div",dt,[(i(!0),_(we,null,xe(e(s).dynamic.images,(n,y)=>(i(),v(ee,{key:y,src:n,style:{width:"100px",height:"100px"},fit:"cover","preview-src-list":e(s).dynamic.images,"initial-index":y},null,8,["src","preview-src-list","initial-index"]))),128))])])):p("",!0),e(s).dynamic.video_url?(i(),_("div",rt,[a[21]||(a[21]=r("h4",{class:"font-bold mb-2"},"动态视频",-1)),r("video",{src:e(s).dynamic.video_url,controls:"",style:{"max-width":"400px"}},null,8,mt)])):p("",!0),r("div",ct,[a[22]||(a[22]=r("h4",{class:"font-bold mb-2"},"互动数据",-1)),t(j,{column:5},{default:l(()=>[t(m,{label:"浏览"},{default:l(()=>[d(o(e(s).dynamic.view_count),1)]),_:1}),t(m,{label:"点赞"},{default:l(()=>[d(o(e(s).dynamic.like_count),1)]),_:1}),t(m,{label:"评论"},{default:l(()=>[d(o(e(s).dynamic.comment_count),1)]),_:1}),t(m,{label:"收藏"},{default:l(()=>[d(o(e(s).dynamic.collect_count),1)]),_:1})]),_:1})])])):p("",!0)])):p("",!0)]),_:1},8,["modelValue"])])}}});export{Ht as default};
