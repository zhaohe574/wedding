import{D as Ve,B as Ce,J as Se,K as he,V as Ee,i as De,H as Me,G as Ue,d as Re,I as Ye,N as Be,ac as Te,C as Ie,L as Ne,M as $e,R as Oe,a8 as je,F as ze,h as Fe,E as M,a as Le}from"./element-plus-ChK2e5qA.js";import{k as qe,a as Ge,O as Pe,a5 as Ke,o as Ae,e as He}from"./@element-plus-C4Lf8veM.js";import{s as Je,a as Qe,b as We,c as Xe,d as Ze}from"./schedule-C1467ANE.js";import{s as et}from"./staff-C0LmdmFi.js";import{d as tt,r as y,b as ee,l as lt,c as r,o as u,U as t,L as l,T as V,ab as U,K as C,R as o,a as s,u as S,S as m,O as F,P as _}from"./@vue-ygbFPFRc.js";import{d as at}from"./index-D465kfFn.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-DRRUpF4H.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DDSL_IW4.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";const st={class:"schedule-calendar"},ot={class:"flex items-center"},nt={class:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mr-4"},ut={class:"text-2xl font-bold"},dt={class:"flex items-center"},rt={class:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center mr-4"},it={class:"text-2xl font-bold text-green-500"},mt={class:"flex items-center"},ft={class:"w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center mr-4"},_t={class:"text-2xl font-bold text-orange-500"},pt={class:"flex items-center"},vt={class:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center mr-4"},ct={class:"text-2xl font-bold text-red-500"},bt={class:"flex items-center justify-between"},gt={class:"flex items-center"},yt={class:"grid grid-cols-7 gap-1 mb-2"},xt={class:"grid grid-cols-7 gap-1"},kt=["onClick"],wt={class:"flex justify-between items-start"},Vt={key:0,class:"text-xs text-gray-400"},Ct={class:"mt-1 space-y-1"},St={key:0,class:"text-xs text-gray-400"},ht={class:"flex gap-1 flex-wrap"},Et={key:0},Dt={key:0,class:"mb-4 p-3 bg-gray-50 rounded"},Mt={class:"flex gap-4"},Ut={key:0},Rt={key:0,class:"mt-2 text-sm"},Yt={key:1,class:"mt-1 text-sm"},Bt={key:1,class:"mt-4"},Tt=tt({__name:"index",setup(It){const te=["日","一","二","三","四","五","六"],le=new Date().toISOString().split("T")[0],x=y({staff_id:""}),p=y(new Date().toISOString().slice(0,7)),N=y([]),L=y({}),h=y({}),R=y(!1),i=y(null),k=y({time_slot:0,status:1,remark:""}),Y=y(!1),$=y(!1),d=y({staff_ids:[],dateRange:[],time_slots:[0],status:1,price:0,skip_rest_days:[]}),ae=ee(()=>{const[n,e]=p.value.split("-").map(Number);return new Date(n,e-1,1).getDay()}),se=ee(()=>{const n=L.value.days||{};return Object.values(n)}),oe=async()=>{const n=await et();N.value=n||[]},c=async()=>{const[n,e]=p.value.split("-").map(Number),f=await Je({staff_id:x.value.staff_id,year:n,month:e});L.value=f;const w=await Qe({staff_id:x.value.staff_id,year:n,month:e});h.value=w},ne=()=>{c()},ue=()=>{const[n,e]=p.value.split("-").map(Number);e===1?p.value=`${n-1}-12`:p.value=`${n}-${String(e-1).padStart(2,"0")}`,c()},de=()=>{const[n,e]=p.value.split("-").map(Number);e===12?p.value=`${n+1}-01`:p.value=`${n}-${String(e+1).padStart(2,"0")}`,c()},re=()=>{p.value=new Date().toISOString().slice(0,7),c()},ie=()=>{x.value.staff_id="",p.value=new Date().toISOString().slice(0,7),c()},me=n=>{if(!x.value.staff_id){M.warning("请先选择工作人员");return}i.value=n,k.value={time_slot:0,status:1,remark:""},R.value=!0},fe=async()=>{!x.value.staff_id||!i.value||(await We({staff_id:x.value.staff_id,date:i.value.date,...k.value}),M.success("设置成功"),R.value=!1,c())},_e=async n=>{await Le.confirm("确定要释放该档期的锁定吗?","提示"),await Xe({id:n.id}),M.success("释放成功"),c()},pe=()=>{d.value={staff_ids:[],dateRange:[],time_slots:[0],status:1,price:0,skip_rest_days:[]},Y.value=!0},ve=async()=>{if(d.value.staff_ids.length===0){M.warning("请选择工作人员");return}if(!d.value.dateRange||d.value.dateRange.length!==2){M.warning("请选择日期范围");return}$.value=!0;try{await Ze({staff_ids:d.value.staff_ids,start_date:d.value.dateRange[0],end_date:d.value.dateRange[1],time_slots:d.value.time_slots,status:d.value.status,price:d.value.price,skip_rest_days:d.value.skip_rest_days}),M.success("批量设置成功"),Y.value=!1,c()}finally{$.value=!1}},q=n=>({0:"全天",1:"早礼",2:"午宴",3:"晚宴"})[n]||"未知",G=n=>({0:"不可用",1:"可预约",2:"已预约",3:"已锁定",4:"内部预留"})[n]||"未知",ce=n=>({0:"info",1:"success",2:"warning",3:"danger",4:"danger"})[n]||"info",be=n=>({0:"bg-gray-200 text-gray-600",1:"bg-green-100 text-green-600",2:"bg-orange-100 text-orange-600",3:"bg-red-100 text-red-600",4:"bg-purple-100 text-purple-600"})[n]||"";return lt(()=>{oe(),c()}),(n,e)=>{var H;const f=he,w=Se,v=Ce,P=Ee,b=De,O=Ve,E=Me,D=Re,I=Ue,ge=Ye,ye=Te,B=Be,xe=Ie,j=$e,ke=Ne,K=Oe,g=ze,A=je,we=Fe;return u(),r("div",st,[t(E,{class:"!border-none mb-4",shadow:"never"},{default:l(()=>[t(O,{class:"mb-[-16px]",model:x.value,inline:!0},{default:l(()=>[t(v,{label:"工作人员"},{default:l(()=>[t(w,{modelValue:x.value.staff_id,"onUpdate:modelValue":e[0]||(e[0]=a=>x.value.staff_id=a),placeholder:"请选择",clearable:"",style:{width:"200px"},onChange:c},{default:l(()=>[(u(!0),r(V,null,U(N.value,a=>(u(),C(f,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"年月"},{default:l(()=>[t(P,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=a=>p.value=a),type:"month",placeholder:"选择月份",format:"YYYY年MM月","value-format":"YYYY-MM",onChange:ne},null,8,["modelValue"])]),_:1}),t(v,null,{default:l(()=>[t(b,{type:"primary",onClick:c},{default:l(()=>e[15]||(e[15]=[o("查询")])),_:1}),t(b,{onClick:ie},{default:l(()=>e[16]||(e[16]=[o("重置")])),_:1}),t(b,{type:"success",onClick:pe},{default:l(()=>e[17]||(e[17]=[o("批量设置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(ge,{gutter:16,class:"mb-4"},{default:l(()=>[t(I,{span:6},{default:l(()=>[t(E,{shadow:"never"},{default:l(()=>[s("div",ot,[s("div",nt,[t(D,{class:"text-blue-500 text-xl"},{default:l(()=>[t(S(qe))]),_:1})]),s("div",null,[e[18]||(e[18]=s("div",{class:"text-gray-500 text-sm"},"总档期",-1)),s("div",ut,m(h.value.total||0),1)])])]),_:1})]),_:1}),t(I,{span:6},{default:l(()=>[t(E,{shadow:"never"},{default:l(()=>[s("div",dt,[s("div",rt,[t(D,{class:"text-green-500 text-xl"},{default:l(()=>[t(S(Ge))]),_:1})]),s("div",null,[e[19]||(e[19]=s("div",{class:"text-gray-500 text-sm"},"可预约",-1)),s("div",it,m(h.value.available||0),1)])])]),_:1})]),_:1}),t(I,{span:6},{default:l(()=>[t(E,{shadow:"never"},{default:l(()=>[s("div",mt,[s("div",ft,[t(D,{class:"text-orange-500 text-xl"},{default:l(()=>[t(S(Pe))]),_:1})]),s("div",null,[e[20]||(e[20]=s("div",{class:"text-gray-500 text-sm"},"已预约",-1)),s("div",_t,m(h.value.booked||0),1)])])]),_:1})]),_:1}),t(I,{span:6},{default:l(()=>[t(E,{shadow:"never"},{default:l(()=>[s("div",pt,[s("div",vt,[t(D,{class:"text-red-500 text-xl"},{default:l(()=>[t(S(Ke))]),_:1})]),s("div",null,[e[21]||(e[21]=s("div",{class:"text-gray-500 text-sm"},"已锁定/预留",-1)),s("div",ct,m((h.value.locked||0)+(h.value.reserved||0)),1)])])]),_:1})]),_:1})]),_:1}),t(E,{class:"!border-none",shadow:"never"},{header:l(()=>[s("div",bt,[e[23]||(e[23]=s("span",{class:"text-lg font-bold"},"档期日历",-1)),s("div",gt,[t(ye,null,{default:l(()=>[t(b,{onClick:ue},{default:l(()=>[t(D,null,{default:l(()=>[t(S(Ae))]),_:1})]),_:1}),t(b,{onClick:re},{default:l(()=>e[22]||(e[22]=[o("今天")])),_:1}),t(b,{onClick:de},{default:l(()=>[t(D,null,{default:l(()=>[t(S(He))]),_:1})]),_:1})]),_:1})])])]),default:l(()=>[s("div",yt,[(u(),r(V,null,U(te,a=>s("div",{key:a,class:"text-center py-2 bg-gray-100 font-bold"},m(a),1)),64))]),s("div",xt,[(u(!0),r(V,null,U(ae.value,a=>(u(),r("div",{key:"empty-"+a,class:"h-24 bg-gray-50"}))),128)),(u(!0),r(V,null,U(se.value,a=>{var z,J,Q,W,X,Z;return u(),r("div",{key:a.date,class:F(["h-24 border p-1 cursor-pointer hover:bg-blue-50 transition-colors",{"bg-blue-50":a.date===S(le),"bg-red-50":(z=a.calendar)==null?void 0:z.is_lucky_day,"bg-yellow-50":(J=a.calendar)==null?void 0:J.is_holiday}]),onClick:T=>me(a)},[s("div",wt,[s("span",{class:F(["font-bold",{"text-red-500":(Q=a.calendar)==null?void 0:Q.is_lucky_day}])},m(a.date.split("-")[2]),3),(W=a.calendar)!=null&&W.lunar_date?(u(),r("span",Vt,m(a.calendar.lunar_date),1)):_("",!0)]),s("div",Ct,[a.schedules&&a.schedules.length>0?(u(),r(V,{key:0},[(u(!0),r(V,null,U(a.schedules.slice(0,2),T=>(u(),r("div",{key:T.id,class:F(["text-xs px-1 py-0.5 rounded truncate",be(T.status)])},m(q(T.time_slot))+": "+m(G(T.status)),3))),128)),a.schedules.length>2?(u(),r("div",St," +"+m(a.schedules.length-2)+" 更多 ",1)):_("",!0)],64)):_("",!0),s("div",ht,[(X=a.calendar)!=null&&X.is_lucky_day?(u(),C(B,{key:0,type:"danger",size:"small"},{default:l(()=>e[24]||(e[24]=[o("吉")])),_:1})):_("",!0),(Z=a.calendar)!=null&&Z.is_holiday?(u(),C(B,{key:1,type:"warning",size:"small"},{default:l(()=>e[25]||(e[25]=[o("假")])),_:1})):_("",!0)])])],10,kt)}),128))])]),_:1}),t(K,{modelValue:R.value,"onUpdate:modelValue":e[6]||(e[6]=a=>R.value=a),title:((H=i.value)==null?void 0:H.date)+" 档期详情",width:"600px"},{footer:l(()=>[t(b,{onClick:e[5]||(e[5]=a=>R.value=!1)},{default:l(()=>e[31]||(e[31]=[o("取消")])),_:1}),t(b,{type:"primary",onClick:fe},{default:l(()=>e[32]||(e[32]=[o("确定设置")])),_:1})]),default:l(()=>[i.value?(u(),r("div",Et,[i.value.calendar?(u(),r("div",Dt,[s("div",Mt,[i.value.calendar.lunar_date?(u(),r("span",Ut,"农历: "+m(i.value.calendar.lunar_date),1)):_("",!0),i.value.calendar.is_lucky_day?(u(),C(B,{key:1,type:"danger"},{default:l(()=>e[26]||(e[26]=[o("吉日")])),_:1})):_("",!0),i.value.calendar.is_holiday?(u(),C(B,{key:2,type:"warning"},{default:l(()=>[o(m(i.value.calendar.holiday_name),1)]),_:1})):_("",!0)]),i.value.calendar.lucky_events?(u(),r("div",Rt,[e[27]||(e[27]=s("span",{class:"text-green-600"},"宜:",-1)),o(" "+m(i.value.calendar.lucky_events),1)])):_("",!0),i.value.calendar.unlucky_events?(u(),r("div",Yt,[e[28]||(e[28]=s("span",{class:"text-red-600"},"忌:",-1)),o(" "+m(i.value.calendar.unlucky_events),1)])):_("",!0)])):_("",!0),t(O,{model:k.value,"label-width":"80px"},{default:l(()=>[t(v,{label:"时间段"},{default:l(()=>[t(w,{modelValue:k.value.time_slot,"onUpdate:modelValue":e[2]||(e[2]=a=>k.value.time_slot=a),style:{width:"100%"}},{default:l(()=>[t(f,{label:"全天",value:0}),t(f,{label:"早礼",value:1}),t(f,{label:"午宴",value:2}),t(f,{label:"晚宴",value:3})]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"状态"},{default:l(()=>[t(w,{modelValue:k.value.status,"onUpdate:modelValue":e[3]||(e[3]=a=>k.value.status=a),style:{width:"100%"}},{default:l(()=>[t(f,{label:"不可用",value:0}),t(f,{label:"可预约",value:1}),t(f,{label:"内部预留",value:4})]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"备注"},{default:l(()=>[t(xe,{modelValue:k.value.remark,"onUpdate:modelValue":e[4]||(e[4]=a=>k.value.remark=a),type:"textarea",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),i.value.schedules&&i.value.schedules.length>0?(u(),r("div",Bt,[e[30]||(e[30]=s("div",{class:"font-bold mb-2"},"当前档期:",-1)),t(ke,{data:i.value.schedules,size:"small"},{default:l(()=>[t(j,{prop:"time_slot",label:"时间段"},{default:l(({row:a})=>[o(m(q(a.time_slot)),1)]),_:1}),t(j,{prop:"status",label:"状态"},{default:l(({row:a})=>[t(B,{type:ce(a.status),size:"small"},{default:l(()=>[o(m(G(a.status)),1)]),_:2},1032,["type"])]),_:1}),t(j,{label:"操作",width:"120"},{default:l(({row:a})=>[a.status===3||a.status===4?(u(),C(b,{key:0,type:"primary",size:"small",link:"",onClick:z=>_e(a)},{default:l(()=>e[29]||(e[29]=[o(" 释放 ")])),_:2},1032,["onClick"])):_("",!0)]),_:1})]),_:1},8,["data"])])):_("",!0)])):_("",!0)]),_:1},8,["modelValue","title"]),t(K,{modelValue:Y.value,"onUpdate:modelValue":e[14]||(e[14]=a=>Y.value=a),title:"批量设置档期",width:"600px"},{footer:l(()=>[t(b,{onClick:e[13]||(e[13]=a=>Y.value=!1)},{default:l(()=>e[44]||(e[44]=[o("取消")])),_:1}),t(b,{type:"primary",loading:$.value,onClick:ve},{default:l(()=>e[45]||(e[45]=[o("确定")])),_:1},8,["loading"])]),default:l(()=>[t(O,{model:d.value,"label-width":"100px"},{default:l(()=>[t(v,{label:"工作人员",required:""},{default:l(()=>[t(w,{modelValue:d.value.staff_ids,"onUpdate:modelValue":e[7]||(e[7]=a=>d.value.staff_ids=a),multiple:"",style:{width:"100%"}},{default:l(()=>[(u(!0),r(V,null,U(N.value,a=>(u(),C(f,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"日期范围",required:""},{default:l(()=>[t(P,{modelValue:d.value.dateRange,"onUpdate:modelValue":e[8]||(e[8]=a=>d.value.dateRange=a),type:"daterange","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(v,{label:"时间段"},{default:l(()=>[t(A,{modelValue:d.value.time_slots,"onUpdate:modelValue":e[9]||(e[9]=a=>d.value.time_slots=a)},{default:l(()=>[t(g,{label:0},{default:l(()=>e[33]||(e[33]=[o("全天")])),_:1}),t(g,{label:1},{default:l(()=>e[34]||(e[34]=[o("早礼")])),_:1}),t(g,{label:2},{default:l(()=>e[35]||(e[35]=[o("午宴")])),_:1}),t(g,{label:3},{default:l(()=>e[36]||(e[36]=[o("晚宴")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"设置状态",required:""},{default:l(()=>[t(w,{modelValue:d.value.status,"onUpdate:modelValue":e[10]||(e[10]=a=>d.value.status=a),style:{width:"100%"}},{default:l(()=>[t(f,{label:"不可用",value:0}),t(f,{label:"可预约",value:1}),t(f,{label:"内部预留",value:4})]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"特价(可选)"},{default:l(()=>[t(we,{modelValue:d.value.price,"onUpdate:modelValue":e[11]||(e[11]=a=>d.value.price=a),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(v,{label:"跳过休息日"},{default:l(()=>[t(A,{modelValue:d.value.skip_rest_days,"onUpdate:modelValue":e[12]||(e[12]=a=>d.value.skip_rest_days=a)},{default:l(()=>[t(g,{label:0},{default:l(()=>e[37]||(e[37]=[o("周日")])),_:1}),t(g,{label:1},{default:l(()=>e[38]||(e[38]=[o("周一")])),_:1}),t(g,{label:2},{default:l(()=>e[39]||(e[39]=[o("周二")])),_:1}),t(g,{label:3},{default:l(()=>e[40]||(e[40]=[o("周三")])),_:1}),t(g,{label:4},{default:l(()=>e[41]||(e[41]=[o("周四")])),_:1}),t(g,{label:5},{default:l(()=>e[42]||(e[42]=[o("周五")])),_:1}),t(g,{label:6},{default:l(()=>e[43]||(e[43]=[o("周六")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),vl=at(Tt,[["__scopeId","data-v-cbe110ee"]]);export{vl as default};
