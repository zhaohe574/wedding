import{S as P,a1 as A,R}from"./element-plus-ChK2e5qA.js";import{a as V,u as F,l as E,R as b,f as u,d as N}from"./index-D465kfFn.js";import{d as j,s as D,r as p,b as y,c as f,o as i,U as k,K as I,P as _,L as C,H as q,a as m,T as H,ab as K,S as O}from"./@vue-ygbFPFRc.js";const T=j({components:{},props:{type:{type:String,default:"image"},multiple:{type:Boolean,default:!0},limit:{type:Number,default:10},data:{type:Object,default:()=>({})},showProgress:{type:Boolean,default:!1}},emits:["change","error","success","allSuccess"],setup(e,{emit:s}){const g=V(),h=F(),d=D(),v=p(`${E.baseUrl}${E.urlPrefix}/upload/${e.type}`),c=y(()=>({token:g.token,version:h.config.version})),t=p(!1),a=p([]),o=()=>{t.value=!0};let l=0;const L=(r,n)=>{l++,l==a.value.length&&(l=0,a.value=[],s("allSuccess")),s("change",n),r.code==b.SUCCESS&&s("success",r),r.code==b.FAIL&&r.msg&&u.msgError(r.msg)},$=(r,n)=>{var S;l++,l==a.value.length&&(l=0,a.value=[],s("allSuccess")),u.msgError(`${n.name}文件上传失败`),(S=d.value)==null||S.abort(n),t.value=!1,s("change",n),s("error",n)},U=()=>{u.msgError(`超出上传上限${e.limit}，请重新上传`)},w=()=>{a.value=[],t.value=!1},B=y(()=>{switch(e.type){case"image":return".jpg,.png,.gif,.jpeg,.ico";case"video":return".wmv,.avi,.mpg,.mpeg,.3gp,.mov,.mp4,.flv,.rmvb,.mkv";default:return"*"}});return{uploadRefs:d,action:v,headers:c,visible:t,fileList:a,getAccept:B,handleProgress:o,handleSuccess:L,handleError:$,handleExceed:U,handleClose:w}}}),z={class:"upload"},G={class:"file-list p-4"},J={class:"flex-1"};function M(e,s,g,h,d,v){const c=P,t=A,a=R;return i(),f("div",z,[k(c,{"file-list":e.fileList,"onUpdate:fileList":s[0]||(s[0]=o=>e.fileList=o),ref:"uploadRefs",action:e.action,multiple:e.multiple,limit:e.limit,"show-file-list":!1,headers:e.headers,data:e.data,"on-progress":e.handleProgress,"on-success":e.handleSuccess,"on-exceed":e.handleExceed,"on-error":e.handleError,accept:e.getAccept},{default:C(()=>[q(e.$slots,"default")]),_:3},8,["file-list","action","multiple","limit","headers","data","on-progress","on-success","on-exceed","on-error","accept"]),e.showProgress&&e.fileList.length?(i(),I(a,{key:0,modelValue:e.visible,"onUpdate:modelValue":s[1]||(s[1]=o=>e.visible=o),title:"上传进度","close-on-click-modal":!1,width:"500px",modal:!1,onClose:e.handleClose},{default:C(()=>[m("div",G,[(i(!0),f(H,null,K(e.fileList,(o,l)=>(i(),f("div",{key:l,class:"mb-5"},[m("div",null,O(o.name),1),m("div",J,[k(t,{percentage:parseInt(o.percentage)},null,8,["percentage"])])]))),128))])]),_:1},8,["modelValue","onClose"])):_("",!0)])}const Y=N(T,[["render",M]]);export{Y as U};
