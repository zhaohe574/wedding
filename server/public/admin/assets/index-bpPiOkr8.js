import{D as we,B as Ce,C as xe,ae as Ue,J as Ee,K as Se,i as Ne,H as Pe,L as Ae,M as De,N as Re,r as $e,g as Le,O as Fe,T as Oe,U as Te,a8 as ze,F as Be,h as Ie,R as Ke,$ as qe}from"./element-plus-ChK2e5qA.js";import{_ as je}from"./index.vue_vue_type_script_setup_true_lang-CCtv5BMP.js";import{b as Je,f as P}from"./index-D465kfFn.js";import{d as te,a0 as q,r as E,s as Me,a1 as Ge,w as He,at as We,c as w,o as r,U as t,L as a,u as o,a9 as le,R as n,a as f,M as A,K as p,P as S,S as C,i as O,T as j,ab as J}from"./@vue-ygbFPFRc.js";import{h as Qe,i as Xe,j as Ye,k as Ze,l as he,m as el,n as ll}from"./service-CD4Egw8G.js";import{s as tl}from"./staff-C0LmdmFi.js";import{u as al}from"./useDictOptions-DB6N0EUo.js";import{u as ol}from"./usePaging-B2jDzebD.js";import"./@element-plus-C4Lf8veM.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-DRRUpF4H.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DDSL_IW4.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";const sl={class:"package-lists"},il={class:"mb-4"},nl={key:0,class:"ml-1"},rl={class:"flex items-center gap-2"},dl={class:"text-red-500 font-bold"},pl={key:0,class:"text-gray-400 line-through ml-2 text-xs"},ul={class:"flex justify-end mt-4"},ml={key:0,class:"mt-2 w-full"},_l={class:"grid grid-cols-2 gap-4"},fl={class:"w-full"},cl={class:"grid grid-cols-2 gap-4"},gl={class:"mb-4"},yl={class:"font-bold"},bl={class:"ml-4"},kl={class:"text-red-500 font-bold"},vl=te({name:"packageLists"}),st=te({...vl,setup(Vl){const g=q({name:"",category_id:"",package_type:"",is_show:""}),k=E(!1),M=Me(),T=E(!1),x=E(""),i=q({id:"",name:"",category_id:"",package_type:1,booking_type:0,allowed_time_slots:[],staff_id:0,price:0,original_price:0,content:[],description:"",sort:0,is_recommend:0,is_show:1}),ae=q({name:[{required:!0,message:"请输入套餐名称",trigger:"blur"}],category_id:[{required:!0,message:"请选择服务分类",trigger:"change"}],booking_type:[{required:!0,message:"请选择预约类型",trigger:"change"}],price:[{required:!0,message:"请输入套餐价格",trigger:"blur"}]}),z=[{value:1,label:"早礼"},{value:2,label:"午宴"},{value:3,label:"晚宴"}],oe={1:"早礼",2:"午宴",3:"晚宴"},G=s=>{if(Array.isArray(s))return s.map(e=>Number(e)).filter(e=>!Number.isNaN(e));if(typeof s=="string"&&s)try{const e=JSON.parse(s);if(Array.isArray(e))return e.map(u=>Number(u)).filter(u=>!Number.isNaN(u))}catch{return[]}return[]},se=s=>{if(Array.isArray(s))return s;if(typeof s=="string"&&s)try{const e=JSON.parse(s);if(Array.isArray(e))return e}catch{return[]}return[]},ie=s=>{if(s.booking_type!==1)return[];const e=G(s.allowed_time_slots);return e.length?e:z.map(u=>u.value)},ne=(s,e)=>s.map(u=>{const d=e.find(R=>Number(R.time_slot)===u);return{time_slot:u,price:(d==null?void 0:d.price)??null}}),{pager:N,getLists:y,resetPage:H,resetParams:re}=ol({fetchFun:Qe,params:g}),{optionsData:B}=al({categories:{api:ll},staffList:{api:tl}}),U=E(!1),D=E(null),I=E([]),W=s=>{if(s.booking_type!==1){P.msgWarning("全天套餐无需配置场次价格");return}D.value=s;const e=ie(s),u=se(s.slot_prices);I.value=ne(e,u),U.value=!0},de=async()=>{const s=I.value.filter(e=>e.price!==null&&e.price!==void 0&&e.price!=="").map(e=>({time_slot:e.time_slot,price:Number(e.price)}));for(const e of s)if(Number.isNaN(e.price)||e.price<0){P.msgError("价格不能为负数");return}await Xe({id:D.value.id,slot_prices:s}),P.msgSuccess("保存成功"),U.value=!1,y()},Q=()=>{x.value.trim()&&(i.content.push(x.value.trim()),x.value=""),T.value=!1},pe=()=>{Object.assign(i,{id:"",name:"",category_id:"",package_type:1,booking_type:0,allowed_time_slots:[],staff_id:0,price:0,original_price:0,content:[],description:"",sort:0,is_recommend:0,is_show:1}),k.value=!0},ue=s=>{Object.assign(i,{id:s.id,name:s.name,category_id:s.category_id,package_type:s.package_type||1,booking_type:s.booking_type??0,allowed_time_slots:G(s.allowed_time_slots),staff_id:s.staff_id||0,price:s.price,original_price:s.original_price,content:s.content||[],description:s.description,sort:s.sort,is_recommend:s.is_recommend,is_show:s.is_show}),k.value=!0},me=async()=>{var s;if(i.booking_type===1&&(!i.allowed_time_slots||i.allowed_time_slots.length===0)){P.msgError("请选择允许场次");return}i.booking_type===0&&(i.allowed_time_slots=[]),await((s=M.value)==null?void 0:s.validate()),i.id?await Ye(i):await Ze(i),k.value=!1,y()},_e=async(s,e)=>{try{await he({id:e,is_show:s}),y()}catch{y()}},fe=async s=>{await P.confirm("确定要删除该套餐？"),await el({id:s}),y()};return Ge(()=>{y()}),y(),He(()=>i.booking_type,s=>{if(s===0){i.allowed_time_slots=[];return}(!i.allowed_time_slots||i.allowed_time_slots.length===0)&&(i.allowed_time_slots=z.map(e=>e.value))}),(s,e)=>{const u=xe,d=Ce,R=Ue,v=Se,K=Ee,c=Ne,X=we,Y=Pe,Z=Je,_=De,V=Re,ce=$e,ge=Le,h=Ae,ye=je,b=Te,$=Oe,be=Be,ke=ze,L=Ie,ee=Ke,ve=qe,F=We("perms"),Ve=Fe;return r(),w("div",sl,[t(Y,{class:"!border-none",shadow:"never"},{default:a(()=>[t(X,{ref:"formRef",class:"mb-[-16px]",model:o(g),inline:!0},{default:a(()=>[t(d,{class:"w-[200px]",label:"套餐名称"},{default:a(()=>[t(u,{modelValue:o(g).name,"onUpdate:modelValue":e[0]||(e[0]=l=>o(g).name=l),placeholder:"输入套餐名称",clearable:"",onKeyup:le(o(H),["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(d,{class:"w-[200px]",label:"服务分类"},{default:a(()=>[t(R,{modelValue:o(g).category_id,"onUpdate:modelValue":e[1]||(e[1]=l=>o(g).category_id=l),options:o(B).categories,props:{value:"id",label:"name",checkStrictly:!0,emitPath:!1},placeholder:"选择服务分类",clearable:""},null,8,["modelValue","options"])]),_:1}),t(d,{class:"w-[200px]",label:"套餐类型"},{default:a(()=>[t(K,{modelValue:o(g).package_type,"onUpdate:modelValue":e[2]||(e[2]=l=>o(g).package_type=l),placeholder:"选择类型",clearable:""},{default:a(()=>[t(v,{label:"全部",value:""}),t(v,{label:"全局套餐",value:1}),t(v,{label:"员工专属",value:2})]),_:1},8,["modelValue"])]),_:1}),t(d,{class:"w-[200px]",label:"状态"},{default:a(()=>[t(K,{modelValue:o(g).is_show,"onUpdate:modelValue":e[3]||(e[3]=l=>o(g).is_show=l),placeholder:"选择状态",clearable:""},{default:a(()=>[t(v,{label:"全部",value:""}),t(v,{label:"上架",value:1}),t(v,{label:"下架",value:0})]),_:1},8,["modelValue"])]),_:1}),t(d,null,{default:a(()=>[t(c,{type:"primary",onClick:o(H)},{default:a(()=>e[24]||(e[24]=[n("查询")])),_:1},8,["onClick"]),t(c,{onClick:o(re)},{default:a(()=>e[25]||(e[25]=[n("重置")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),t(Y,{class:"!border-none mt-4",shadow:"never"},{default:a(()=>[f("div",il,[A((r(),p(c,{type:"primary",onClick:e[4]||(e[4]=l=>pe())},{icon:a(()=>[t(Z,{name:"el-icon-Plus"})]),default:a(()=>[e[26]||(e[26]=n(" 新增套餐 "))]),_:1})),[[F,["service.package/add"]]])]),A((r(),p(h,{size:"large",data:o(N).lists},{default:a(()=>[t(_,{label:"ID",prop:"id",width:"80"}),t(_,{label:"套餐名称",prop:"name","min-width":"150"}),t(_,{label:"服务分类",prop:"category_name",width:"120"}),t(_,{label:"套餐类型",width:"140"},{default:a(({row:l})=>[l.package_type===1?(r(),p(V,{key:0,type:"primary"},{default:a(()=>e[27]||(e[27]=[n("全局套餐")])),_:1})):(r(),p(V,{key:1,type:"success"},{default:a(()=>[e[28]||(e[28]=n(" 员工专属 ")),l.staff_name?(r(),w("span",nl,"("+C(l.staff_name)+")",1)):S("",!0)]),_:2},1024))]),_:1}),t(_,{label:"预约类型",width:"120"},{default:a(({row:l})=>[l.booking_type===0?(r(),p(V,{key:0,type:"info"},{default:a(()=>e[29]||(e[29]=[n("全天套餐")])),_:1})):(r(),p(V,{key:1,type:"warning"},{default:a(()=>e[30]||(e[30]=[n("分场次套餐")])),_:1}))]),_:1}),t(_,{label:"价格",width:"150"},{default:a(({row:l})=>[f("div",rl,[f("div",null,[f("span",dl,"¥"+C(l.price),1),l.original_price>l.price?(r(),w("span",pl," ¥"+C(l.original_price),1)):S("",!0)]),l.booking_type===1?(r(),p(ce,{key:0,content:"配置场次价格",placement:"top"},{default:a(()=>[t(c,{type:"primary",link:"",size:"small",onClick:m=>W(l)},{default:a(()=>[t(Z,{name:"el-icon-Clock"})]),_:2},1032,["onClick"])]),_:2},1024)):S("",!0)])]),_:1}),t(_,{label:"推荐",width:"80"},{default:a(({row:l})=>[l.is_recommend?(r(),p(V,{key:0,type:"warning"},{default:a(()=>e[31]||(e[31]=[n("推荐")])),_:1})):(r(),p(V,{key:1,type:"info"},{default:a(()=>e[32]||(e[32]=[n("普通")])),_:1}))]),_:1}),t(_,{label:"状态",width:"80"},{default:a(({row:l})=>[A(t(ge,{modelValue:l.is_show,"onUpdate:modelValue":m=>l.is_show=m,"active-value":1,"inactive-value":0,onChange:m=>_e(m,l.id)},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[F,["service.package/changeStatus"]]])]),_:1}),t(_,{label:"排序",prop:"sort",width:"80"}),t(_,{label:"创建时间",prop:"create_time",width:"170"}),t(_,{label:"操作",width:"160",fixed:"right"},{default:a(({row:l})=>[A((r(),p(c,{type:"primary",link:"",onClick:m=>ue(l)},{default:a(()=>e[33]||(e[33]=[n(" 编辑 ")])),_:2},1032,["onClick"])),[[F,["service.package/edit"]]]),l.package_type===1&&l.booking_type===1?(r(),p(c,{key:0,type:"warning",link:"",onClick:m=>W(l)},{default:a(()=>e[34]||(e[34]=[n(" 场次价格 ")])),_:2},1032,["onClick"])):S("",!0),A((r(),p(c,{type:"danger",link:"",onClick:m=>fe(l.id)},{default:a(()=>e[35]||(e[35]=[n(" 删除 ")])),_:2},1032,["onClick"])),[[F,["service.package/delete"]]])]),_:1})]),_:1},8,["data"])),[[Ve,o(N).loading]]),f("div",ul,[t(ye,{modelValue:o(N),"onUpdate:modelValue":e[5]||(e[5]=l=>O(N)?N.value=l:null),onChange:o(y)},null,8,["modelValue","onChange"])])]),_:1}),t(ee,{modelValue:o(k),"onUpdate:modelValue":e[21]||(e[21]=l=>O(k)?k.value=l:null),title:o(i).id?"编辑套餐":"新增套餐",width:"600px"},{footer:a(()=>[t(c,{onClick:e[20]||(e[20]=l=>k.value=!1)},{default:a(()=>e[45]||(e[45]=[n("取消")])),_:1}),t(c,{type:"primary",onClick:me},{default:a(()=>e[46]||(e[46]=[n("保存")])),_:1})]),default:a(()=>[t(X,{ref_key:"editFormRef",ref:M,model:o(i),rules:o(ae),"label-width":"100px"},{default:a(()=>[t(d,{label:"套餐名称",prop:"name"},{default:a(()=>[t(u,{modelValue:o(i).name,"onUpdate:modelValue":e[6]||(e[6]=l=>o(i).name=l),placeholder:"请输入套餐名称",maxlength:"100"},null,8,["modelValue"])]),_:1}),t(d,{label:"服务分类",prop:"category_id"},{default:a(()=>[t(R,{modelValue:o(i).category_id,"onUpdate:modelValue":e[7]||(e[7]=l=>o(i).category_id=l),options:o(B).categories,props:{value:"id",label:"name",checkStrictly:!0,emitPath:!1},placeholder:"选择服务分类",class:"w-full"},null,8,["modelValue","options"])]),_:1}),t(d,{label:"套餐类型",prop:"package_type"},{default:a(()=>[t($,{modelValue:o(i).package_type,"onUpdate:modelValue":e[8]||(e[8]=l=>o(i).package_type=l),disabled:!!o(i).id},{default:a(()=>[t(b,{value:1},{default:a(()=>e[36]||(e[36]=[n("全局套餐")])),_:1}),t(b,{value:2},{default:a(()=>e[37]||(e[37]=[n("员工专属")])),_:1})]),_:1},8,["modelValue","disabled"]),o(i).package_type===2?(r(),w("div",ml,[t(K,{modelValue:o(i).staff_id,"onUpdate:modelValue":e[9]||(e[9]=l=>o(i).staff_id=l),placeholder:"选择所属员工",class:"w-full",disabled:!!o(i).id},{default:a(()=>[(r(!0),w(j,null,J(o(B).staffList,l=>(r(),p(v,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])])):S("",!0)]),_:1}),t(d,{label:"预约类型",prop:"booking_type"},{default:a(()=>[t($,{modelValue:o(i).booking_type,"onUpdate:modelValue":e[10]||(e[10]=l=>o(i).booking_type=l)},{default:a(()=>[t(b,{value:0},{default:a(()=>e[38]||(e[38]=[n("全天套餐")])),_:1}),t(b,{value:1},{default:a(()=>e[39]||(e[39]=[n("分场次套餐")])),_:1})]),_:1},8,["modelValue"])]),_:1}),o(i).booking_type===1?(r(),p(d,{key:0,label:"允许场次",prop:"allowed_time_slots"},{default:a(()=>[t(ke,{modelValue:o(i).allowed_time_slots,"onUpdate:modelValue":e[11]||(e[11]=l=>o(i).allowed_time_slots=l)},{default:a(()=>[(r(),w(j,null,J(z,l=>t(be,{key:l.value,value:l.value,label:l.label},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),_:1})):S("",!0),f("div",_l,[t(d,{label:"套餐价格",prop:"price"},{default:a(()=>[t(L,{modelValue:o(i).price,"onUpdate:modelValue":e[12]||(e[12]=l=>o(i).price=l),min:0,precision:2,class:"w-full"},null,8,["modelValue"])]),_:1}),t(d,{label:"原价",prop:"original_price"},{default:a(()=>[t(L,{modelValue:o(i).original_price,"onUpdate:modelValue":e[13]||(e[13]=l=>o(i).original_price=l),min:0,precision:2,class:"w-full"},null,8,["modelValue"])]),_:1})]),t(d,{label:"套餐内容",prop:"content"},{default:a(()=>[f("div",fl,[(r(!0),w(j,null,J(o(i).content,(l,m)=>(r(),p(V,{key:m,closable:"",class:"mr-2 mb-2",onClose:wl=>o(i).content.splice(m,1)},{default:a(()=>[n(C(l),1)]),_:2},1032,["onClose"]))),128)),o(T)?(r(),p(u,{key:0,ref:"contentInputRef",modelValue:o(x),"onUpdate:modelValue":e[14]||(e[14]=l=>O(x)?x.value=l:null),size:"small",class:"w-[200px]",onKeyup:le(Q,["enter"]),onBlur:Q},null,8,["modelValue"])):(r(),p(c,{key:1,size:"small",onClick:e[15]||(e[15]=l=>T.value=!0)},{default:a(()=>e[40]||(e[40]=[n("+ 添加内容")])),_:1}))])]),_:1}),t(d,{label:"描述",prop:"description"},{default:a(()=>[t(u,{modelValue:o(i).description,"onUpdate:modelValue":e[16]||(e[16]=l=>o(i).description=l),type:"textarea",rows:3,placeholder:"请输入套餐描述",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),f("div",cl,[t(d,{label:"排序",prop:"sort"},{default:a(()=>[t(L,{modelValue:o(i).sort,"onUpdate:modelValue":e[17]||(e[17]=l=>o(i).sort=l),min:0,max:9999,class:"w-full"},null,8,["modelValue"])]),_:1}),t(d,{label:"是否推荐",prop:"is_recommend"},{default:a(()=>[t($,{modelValue:o(i).is_recommend,"onUpdate:modelValue":e[18]||(e[18]=l=>o(i).is_recommend=l)},{default:a(()=>[t(b,{value:1},{default:a(()=>e[41]||(e[41]=[n("是")])),_:1}),t(b,{value:0},{default:a(()=>e[42]||(e[42]=[n("否")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),t(d,{label:"状态",prop:"is_show"},{default:a(()=>[t($,{modelValue:o(i).is_show,"onUpdate:modelValue":e[19]||(e[19]=l=>o(i).is_show=l)},{default:a(()=>[t(b,{value:1},{default:a(()=>e[43]||(e[43]=[n("上架")])),_:1}),t(b,{value:0},{default:a(()=>e[44]||(e[44]=[n("下架")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),t(ee,{modelValue:o(U),"onUpdate:modelValue":e[23]||(e[23]=l=>O(U)?U.value=l:null),title:"场次价格配置",width:"650px"},{footer:a(()=>[t(c,{onClick:e[22]||(e[22]=l=>U.value=!1)},{default:a(()=>e[49]||(e[49]=[n("取消")])),_:1}),t(c,{type:"primary",onClick:de},{default:a(()=>e[50]||(e[50]=[n("保存")])),_:1})]),default:a(()=>[f("div",gl,[t(ve,{type:"info",closable:!1},{title:a(()=>{var l,m;return[e[48]||(e[48]=n(" 套餐：")),f("span",yl,C((l=o(D))==null?void 0:l.name),1),f("span",bl,[e[47]||(e[47]=n("默认价格：")),f("span",kl,"¥"+C((m=o(D))==null?void 0:m.price),1)])]}),_:1})]),e[51]||(e[51]=f("div",{class:"text-xs text-gray-500 mb-2"},"未填写的场次将使用默认价格",-1)),t(h,{data:o(I),border:""},{default:a(()=>[t(_,{label:"场次",width:"140"},{default:a(({row:l})=>[n(C(oe[l.time_slot]||l.time_slot),1)]),_:1}),t(_,{label:"场次价格"},{default:a(({row:l})=>[t(L,{modelValue:l.price,"onUpdate:modelValue":m=>l.price=m,min:0,precision:2,size:"small",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}});export{st as default};
