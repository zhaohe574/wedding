import{D as _e,B as fe,C as ce,J as ve,K as be,V as ye,i as ke,H as xe,L as ge,M as Ve,q as we,N as Ce,O as Ee,W as Pe,X as Ue,v as De,R as Ye}from"./element-plus-ChK2e5qA.js";import{_ as je}from"./index.vue_vue_type_script_setup_true_lang-CCtv5BMP.js";import{d as Z,a0 as A,r as S,a1 as Se,c as E,o as u,U as t,a as d,L as a,u as l,a9 as Q,R as o,S as r,M as Te,K as b,P as _,T as H,O as $e,i as F,ab as Me}from"./@vue-ygbFPFRc.js";import{r as T,f as K,d as ze}from"./index-D465kfFn.js";import{u as Fe}from"./usePaging-B2jDzebD.js";import"./@element-plus-C4Lf8veM.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-DRRUpF4H.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DDSL_IW4.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";function Ke(y){return T.get({url:"/order.orderPause/lists",params:y})}function Re(y){return T.get({url:"/order.orderPause/detail",params:y})}function Be(y){return T.post({url:"/order.orderPause/audit",params:y})}function Le(y){return T.post({url:"/order.orderPause/resume",params:y})}function qe(y){return T.post({url:"/order.orderPause/extend",params:y})}function Ae(y){return T.get({url:"/order.orderPause/statistics",params:y})}const Ie={class:"order-pause-lists"},Ne={class:"mt-4 grid grid-cols-5 gap-4"},Oe={class:"text-center"},He={class:"text-2xl font-bold mt-2 text-orange-500"},Je={class:"text-center"},We={class:"text-2xl font-bold mt-2 text-blue-500"},Xe={class:"text-center"},Ge={class:"text-2xl font-bold mt-2 text-red-500"},Qe={class:"text-center"},Ze={class:"text-2xl font-bold mt-2 text-green-500"},he={class:"text-center"},et={class:"text-2xl font-bold mt-2 text-purple-500"},tt=["onClick"],lt={key:0,class:"flex items-center"},at={class:"ml-2"},st={key:1},ot={class:"text-gray-400 text-xs"},rt={class:"flex justify-end mt-4"},nt={key:0,class:"pause-detail"},dt={class:"text-red-500"},ut={key:0,class:"mt-4"},it=Z({name:"orderPause"}),pt=Z({...it,setup(y){const k=A({pause_sn:"",order_sn:"",pause_type:"",pause_status:"",create_time:[]}),$=S({}),R=S(!1),n=S(null),U=S(!1),p=A({id:0,approved:!0,remark:"",reject_reason:""}),D=S(!1),g=A({id:0,new_service_date:"",remark:""}),Y=S(!1),f=A({id:0,current_end_date:"",new_end_date:"",remark:""}),{pager:M,getLists:j,resetPage:I,resetParams:h}=Fe({fetchFun:Ke,params:k}),z=async()=>{const i=await Ae({});$.value=i},N=i=>{if(!$.value.status_counts)return 0;const e=$.value.status_counts.find(w=>w.status===i);return e?e.count:0},J=i=>({1:"danger",2:"warning",3:"info",4:""})[i]||"",W=i=>({0:"warning",1:"primary",2:"success",3:"danger",4:"info"})[i]||"info",ee=i=>{console.log("View order:",i)},te=async i=>{const e=await Re({id:i.id});n.value=e,R.value=!0},X=(i,e)=>{p.id=i.id,p.approved=e,p.remark="",p.reject_reason="",U.value=!0},le=async()=>{if(!p.approved&&!p.reject_reason){K.msgError("请填写拒绝原因");return}await Be({id:p.id,approved:p.approved?1:0,remark:p.remark,reject_reason:p.reject_reason}),K.msgSuccess("操作成功"),U.value=!1,j(),z()},ae=i=>{g.id=i.id,g.new_service_date="",g.remark="",D.value=!0},se=async()=>{await Le(g),K.msgSuccess("订单已恢复"),D.value=!1,j(),z()},oe=i=>{f.id=i.id,f.current_end_date=i.pause_end_date,f.new_end_date="",f.remark="",Y.value=!0},re=async()=>{if(!f.new_end_date){K.msgError("请选择新结束日期");return}await qe(f),K.msgSuccess("延期成功"),Y.value=!1,j(),z()};return Se(()=>{j(),z()}),j(),z(),(i,e)=>{const w=ce,c=fe,x=be,G=ve,O=ye,v=ke,B=_e,P=xe,V=Ve,ne=we,L=Ce,de=ge,ue=je,m=Ue,ie=Pe,pe=De,q=Ye,me=Ee;return u(),E("div",Ie,[t(P,{class:"!border-none",shadow:"never"},{default:a(()=>[t(B,{ref:"formRef",class:"mb-[-16px]",model:l(k),inline:!0},{default:a(()=>[t(c,{class:"w-[180px]",label:"暂停单号"},{default:a(()=>[t(w,{modelValue:l(k).pause_sn,"onUpdate:modelValue":e[0]||(e[0]=s=>l(k).pause_sn=s),placeholder:"输入暂停单号",clearable:"",onKeyup:Q(l(I),["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(c,{class:"w-[180px]",label:"订单编号"},{default:a(()=>[t(w,{modelValue:l(k).order_sn,"onUpdate:modelValue":e[1]||(e[1]=s=>l(k).order_sn=s),placeholder:"输入订单编号",clearable:"",onKeyup:Q(l(I),["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(c,{class:"w-[120px]",label:"暂停类型"},{default:a(()=>[t(G,{modelValue:l(k).pause_type,"onUpdate:modelValue":e[2]||(e[2]=s=>l(k).pause_type=s),placeholder:"选择类型",clearable:""},{default:a(()=>[t(x,{label:"全部",value:""}),t(x,{label:"疫情",value:1}),t(x,{label:"突发事件",value:2}),t(x,{label:"个人原因",value:3}),t(x,{label:"其他",value:4})]),_:1},8,["modelValue"])]),_:1}),t(c,{class:"w-[120px]",label:"暂停状态"},{default:a(()=>[t(G,{modelValue:l(k).pause_status,"onUpdate:modelValue":e[3]||(e[3]=s=>l(k).pause_status=s),placeholder:"选择状态",clearable:""},{default:a(()=>[t(x,{label:"全部",value:""}),t(x,{label:"待审核",value:0}),t(x,{label:"暂停中",value:1}),t(x,{label:"已恢复",value:2}),t(x,{label:"已拒绝",value:3}),t(x,{label:"已取消",value:4})]),_:1},8,["modelValue"])]),_:1}),t(c,{class:"w-[320px]",label:"申请时间"},{default:a(()=>[t(O,{modelValue:l(k).create_time,"onUpdate:modelValue":e[4]||(e[4]=s=>l(k).create_time=s),type:"daterange","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",clearable:""},null,8,["modelValue"])]),_:1}),t(c,null,{default:a(()=>[t(v,{type:"primary",onClick:l(I)},{default:a(()=>e[19]||(e[19]=[o("查询")])),_:1},8,["onClick"]),t(v,{onClick:l(h)},{default:a(()=>e[20]||(e[20]=[o("重置")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),d("div",Ne,[t(P,{class:"!border-none",shadow:"never"},{default:a(()=>[d("div",Oe,[e[21]||(e[21]=d("div",{class:"text-gray-500 text-sm"},"待审核",-1)),d("div",He,r(N(0)),1)])]),_:1}),t(P,{class:"!border-none",shadow:"never"},{default:a(()=>[d("div",Je,[e[22]||(e[22]=d("div",{class:"text-gray-500 text-sm"},"暂停中",-1)),d("div",We,r(N(1)),1)])]),_:1}),t(P,{class:"!border-none",shadow:"never"},{default:a(()=>[d("div",Xe,[e[23]||(e[23]=d("div",{class:"text-gray-500 text-sm"},"即将到期",-1)),d("div",Ge,r(l($).expiring_count||0),1)])]),_:1}),t(P,{class:"!border-none",shadow:"never"},{default:a(()=>[d("div",Qe,[e[24]||(e[24]=d("div",{class:"text-gray-500 text-sm"},"已恢复",-1)),d("div",Ze,r(N(2)),1)])]),_:1}),t(P,{class:"!border-none",shadow:"never"},{default:a(()=>[d("div",he,[e[25]||(e[25]=d("div",{class:"text-gray-500 text-sm"},"平均暂停天数",-1)),d("div",et,r(l($).avg_pause_days||0),1)])]),_:1})]),t(P,{class:"!border-none mt-4",shadow:"never"},{default:a(()=>[Te((u(),b(de,{size:"large",data:l(M).lists},{default:a(()=>[t(V,{label:"暂停单号",prop:"pause_sn","min-width":"160"}),t(V,{label:"订单编号","min-width":"160"},{default:a(({row:s})=>[d("span",{class:"text-primary cursor-pointer",onClick:C=>ee(s.order_id)},r(s.order_sn),9,tt)]),_:1}),t(V,{label:"用户信息","min-width":"140"},{default:a(({row:s})=>[s.user?(u(),E("div",lt,[t(ne,{src:s.user.avatar,size:28},null,8,["src"]),d("span",at,r(s.user.nickname),1)])):(u(),E("span",st,"-"))]),_:1}),t(V,{label:"暂停类型",width:"100"},{default:a(({row:s})=>[t(L,{type:J(s.pause_type),size:"small"},{default:a(()=>[o(r(s.pause_type_desc),1)]),_:2},1032,["type"])]),_:1}),t(V,{label:"暂停时间","min-width":"180"},{default:a(({row:s})=>[d("div",null,r(s.pause_start_date)+" ~ "+r(s.pause_end_date),1),d("div",ot,[o(" 计划"+r(s.pause_days)+"天 ",1),s.pause_status===1&&s.remain_days!==null?(u(),E(H,{key:0},[e[26]||(e[26]=o(" ，剩余")),d("span",{class:$e(s.remain_days<=3?"text-red-500":"")},r(s.remain_days),3),e[27]||(e[27]=o("天 "))],64)):_("",!0),s.pause_status===2?(u(),E(H,{key:1},[o(" ，实际"+r(s.actual_pause_days)+"天 ",1)],64)):_("",!0)])]),_:1}),t(V,{label:"状态",width:"100"},{default:a(({row:s})=>[t(L,{type:W(s.pause_status),size:"small"},{default:a(()=>[o(r(s.pause_status_desc),1)]),_:2},1032,["type"])]),_:1}),t(V,{label:"暂停原因",prop:"pause_reason","min-width":"120","show-overflow-tooltip":""}),t(V,{label:"申请时间",prop:"create_time",width:"160"}),t(V,{label:"操作",width:"180",fixed:"right"},{default:a(({row:s})=>[t(v,{type:"primary",link:"",onClick:C=>te(s)},{default:a(()=>e[28]||(e[28]=[o("详情")])),_:2},1032,["onClick"]),s.pause_status===0?(u(),b(v,{key:0,type:"success",link:"",onClick:C=>X(s,!0)},{default:a(()=>e[29]||(e[29]=[o("通过")])),_:2},1032,["onClick"])):_("",!0),s.pause_status===0?(u(),b(v,{key:1,type:"danger",link:"",onClick:C=>X(s,!1)},{default:a(()=>e[30]||(e[30]=[o("拒绝")])),_:2},1032,["onClick"])):_("",!0),s.pause_status===1?(u(),b(v,{key:2,type:"warning",link:"",onClick:C=>ae(s)},{default:a(()=>e[31]||(e[31]=[o("恢复")])),_:2},1032,["onClick"])):_("",!0),s.pause_status===1?(u(),b(v,{key:3,type:"info",link:"",onClick:C=>oe(s)},{default:a(()=>e[32]||(e[32]=[o("延期")])),_:2},1032,["onClick"])):_("",!0)]),_:1})]),_:1},8,["data"])),[[me,l(M).loading]]),d("div",rt,[t(ue,{modelValue:l(M),"onUpdate:modelValue":e[5]||(e[5]=s=>F(M)?M.value=s:null),onChange:l(j)},null,8,["modelValue","onChange"])])]),_:1}),t(q,{modelValue:l(R),"onUpdate:modelValue":e[6]||(e[6]=s=>F(R)?R.value=s:null),title:"暂停详情",width:"700px"},{default:a(()=>[l(n)?(u(),E("div",nt,[t(ie,{column:2,border:""},{default:a(()=>[t(m,{label:"暂停单号"},{default:a(()=>[o(r(l(n).pause_sn),1)]),_:1}),t(m,{label:"暂停状态"},{default:a(()=>[t(L,{type:W(l(n).pause_status),size:"small"},{default:a(()=>[o(r(l(n).pause_status_desc),1)]),_:1},8,["type"])]),_:1}),t(m,{label:"订单编号"},{default:a(()=>[o(r(l(n).order_sn),1)]),_:1}),t(m,{label:"暂停类型"},{default:a(()=>[t(L,{type:J(l(n).pause_type),size:"small"},{default:a(()=>[o(r(l(n).pause_type_desc),1)]),_:1},8,["type"])]),_:1}),l(n).user?(u(),b(m,{key:0,label:"申请用户"},{default:a(()=>[o(r(l(n).user.nickname)+" ("+r(l(n).user.mobile)+") ",1)]),_:1})):_("",!0),t(m,{label:"申请时间"},{default:a(()=>[o(r(l(n).create_time),1)]),_:1}),t(m,{label:"暂停开始"},{default:a(()=>[o(r(l(n).pause_start_date),1)]),_:1}),t(m,{label:"暂停结束"},{default:a(()=>[o(r(l(n).pause_end_date),1)]),_:1}),t(m,{label:"计划天数"},{default:a(()=>[o(r(l(n).pause_days)+" 天",1)]),_:1}),l(n).pause_status===2?(u(),b(m,{key:1,label:"实际天数"},{default:a(()=>[o(r(l(n).actual_pause_days)+" 天 ",1)]),_:1})):_("",!0),t(m,{label:"原服务日期"},{default:a(()=>[o(r(l(n).original_service_date||"-"),1)]),_:1}),l(n).new_service_date?(u(),b(m,{key:2,label:"新服务日期"},{default:a(()=>[o(r(l(n).new_service_date),1)]),_:1})):_("",!0),t(m,{label:"暂停原因",span:2},{default:a(()=>[o(r(l(n).pause_reason),1)]),_:1}),l(n).audit_remark?(u(),b(m,{key:3,label:"审核备注",span:2},{default:a(()=>[o(r(l(n).audit_remark),1)]),_:1})):_("",!0),l(n).reject_reason?(u(),b(m,{key:4,label:"拒绝原因",span:2},{default:a(()=>[d("span",dt,r(l(n).reject_reason),1)]),_:1})):_("",!0),l(n).resume_remark?(u(),b(m,{key:5,label:"恢复备注",span:2},{default:a(()=>[o(r(l(n).resume_remark),1)]),_:1})):_("",!0)]),_:1}),l(n).proof_images&&l(n).proof_images.length>0?(u(),E("div",ut,[e[33]||(e[33]=d("h4",{class:"font-bold mb-2"},"证明材料",-1)),(u(!0),E(H,null,Me(l(n).proof_images,(s,C)=>(u(),b(pe,{key:C,src:s,"preview-src-list":l(n).proof_images,"initial-index":C,fit:"cover",class:"w-20 h-20 mr-2 rounded"},null,8,["src","preview-src-list","initial-index"]))),128))])):_("",!0)])):_("",!0)]),_:1},8,["modelValue"]),t(q,{modelValue:l(U),"onUpdate:modelValue":e[10]||(e[10]=s=>F(U)?U.value=s:null),title:l(p).approved?"审核通过":"审核拒绝",width:"500px"},{footer:a(()=>[t(v,{onClick:e[9]||(e[9]=s=>U.value=!1)},{default:a(()=>e[34]||(e[34]=[o("取消")])),_:1}),t(v,{type:l(p).approved?"success":"danger",onClick:le},{default:a(()=>e[35]||(e[35]=[o("确认")])),_:1},8,["type"])]),default:a(()=>[t(B,{model:l(p),"label-width":"100px"},{default:a(()=>[t(c,{label:"审核备注"},{default:a(()=>[t(w,{modelValue:l(p).remark,"onUpdate:modelValue":e[7]||(e[7]=s=>l(p).remark=s),type:"textarea",rows:3,placeholder:"请输入审核备注（选填）"},null,8,["modelValue"])]),_:1}),l(p).approved?_("",!0):(u(),b(c,{key:0,label:"拒绝原因",required:""},{default:a(()=>[t(w,{modelValue:l(p).reject_reason,"onUpdate:modelValue":e[8]||(e[8]=s=>l(p).reject_reason=s),type:"textarea",rows:3,placeholder:"请输入拒绝原因"},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(q,{modelValue:l(D),"onUpdate:modelValue":e[14]||(e[14]=s=>F(D)?D.value=s:null),title:"恢复订单",width:"500px"},{footer:a(()=>[t(v,{onClick:e[13]||(e[13]=s=>D.value=!1)},{default:a(()=>e[36]||(e[36]=[o("取消")])),_:1}),t(v,{type:"primary",onClick:se},{default:a(()=>e[37]||(e[37]=[o("确认恢复")])),_:1})]),default:a(()=>[t(B,{model:l(g),"label-width":"100px"},{default:a(()=>[t(c,{label:"新服务日期"},{default:a(()=>[t(O,{modelValue:l(g).new_service_date,"onUpdate:modelValue":e[11]||(e[11]=s=>l(g).new_service_date=s),type:"date",placeholder:"选择新服务日期（可选）","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(c,{label:"恢复备注"},{default:a(()=>[t(w,{modelValue:l(g).remark,"onUpdate:modelValue":e[12]||(e[12]=s=>l(g).remark=s),type:"textarea",rows:3,placeholder:"请输入恢复备注（选填）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(q,{modelValue:l(Y),"onUpdate:modelValue":e[18]||(e[18]=s=>F(Y)?Y.value=s:null),title:"延长暂停时间",width:"500px"},{footer:a(()=>[t(v,{onClick:e[17]||(e[17]=s=>Y.value=!1)},{default:a(()=>e[38]||(e[38]=[o("取消")])),_:1}),t(v,{type:"primary",onClick:re},{default:a(()=>e[39]||(e[39]=[o("确认延期")])),_:1})]),default:a(()=>[t(B,{model:l(f),"label-width":"120px"},{default:a(()=>[t(c,{label:"当前结束日期"},{default:a(()=>[d("span",null,r(l(f).current_end_date),1)]),_:1}),t(c,{label:"新结束日期",required:""},{default:a(()=>[t(O,{modelValue:l(f).new_end_date,"onUpdate:modelValue":e[15]||(e[15]=s=>l(f).new_end_date=s),type:"date",placeholder:"选择新结束日期","value-format":"YYYY-MM-DD","disabled-date":s=>s<=new Date(l(f).current_end_date)},null,8,["modelValue","disabled-date"])]),_:1}),t(c,{label:"延期说明"},{default:a(()=>[t(w,{modelValue:l(f).remark,"onUpdate:modelValue":e[16]||(e[16]=s=>l(f).remark=s),type:"textarea",rows:3,placeholder:"请输入延期说明（选填）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Ot=ze(pt,[["__scopeId","data-v-b6f796e8"]]);export{Ot as default};
