# 实现计划 - 首页轮播图高度自定义配置

## 概述

本实现计划将轮播图高度自定义配置功能分解为可执行的开发任务。实现顺序遵循"后台配置 → 数据模型 → 前端渲染 → 测试验证"的流程，确保每个阶段都能独立验证功能正确性。

## 任务列表

- [x] 1. 更新数据模型和类型定义
  - 在 `admin/src/views/decoration/component/widgets/banner/options.ts` 中添加 height 字段
  - 添加 TypeScript 类型定义
  - 设置默认值为 undefined（使用默认高度）
  - _需求：2.1, 2.3_

- [x] 2. 实现后台高度配置界面
  - [x] 2.1 添加高度配置表单项
    - 在 `admin/src/views/decoration/component/widgets/banner/attr.vue` 中添加高度输入框
    - 使用 `el-input-number` 组件，设置最小值100、最大值2000、步长10
    - 添加单位后缀 "rpx"
    - _需求：1.1, 1.5, 1.6_

  - [x] 2.2 实现高度提示和警告逻辑
    - 添加 `heightTip` 计算属性，根据样式显示建议范围
    - 添加 `showHeightWarning` 计算属性，判断是否超出建议范围
    - 添加 `heightWarningText` 计算属性，显示警告文字
    - _需求：4.1, 4.3, 4.4, 4.5_

  - [x] 2.3 实现样式切换时的高度处理
    - 监听 `content.style` 变化
    - 当样式切换且高度未自定义时，使用新样式的默认高度
    - _需求：1.2, 1.3_

  - [ ]* 2.4 编写后台配置组件的单元测试
    - 测试高度输入框的数值验证
    - 测试样式切换时的默认高度设置
    - 测试警告提示的显示逻辑
    - _需求：1.1, 1.2, 1.3, 1.5, 1.6_

- [x] 3. 更新后台预览组件
  - [x] 3.1 更新预览高度计算逻辑
    - 在 `admin/src/views/decoration/component/widgets/banner/content.vue` 中添加 `previewHeight` 计算属性
    - 优先使用配置的高度，否则使用默认高度
    - 将 rpx 转换为 px（除以2）用于预览显示
    - _需求：4.2_

  - [ ]* 3.2 编写预览组件的单元测试
    - 测试高度计算逻辑
    - 测试默认值回退
    - 测试单位转换
    - _需求：4.2_

- [x] 4. 实现前端轮播图高度渲染
  - [x] 4.1 更新移动端轮播图组件
    - 在 `uniapp/src/components/widgets/banner/banner.vue` 中添加 `bannerHeight` 计算属性
    - 优先使用 `content.height`，否则根据 `isLargeScreen` 使用默认值
    - 将计算的高度传递给 `LSwiper` 组件
    - _需求：3.1, 3.2, 3.3, 3.4_

  - [ ]* 4.2 编写前端组件的单元测试
    - 测试高度值的正确传递
    - 测试默认高度的回退逻辑
    - 测试不同样式模式下的高度计算
    - _需求：3.1, 3.2, 3.3_

- [x] 5. 实现向后兼容性处理
  - [x] 5.1 添加数据加载时的默认值处理
    - 在前端组件中检查 `content.height` 是否存在
    - 如果不存在或为 null，使用默认值
    - 记录日志以便调试
    - _需求：5.1, 5.2, 5.3_

  - [ ]* 5.2 编写向后兼容性测试
    - 测试不包含 height 字段的旧数据
    - 测试 height 为 null 的情况
    - 测试 height 为非法值的情况
    - _需求：5.1, 5.2, 5.3, 5.4_

- [ ] 6. 属性测试实现
  - [ ]* 6.1 编写属性测试：高度配置范围验证
    - **属性 1：高度配置范围验证**
    - **验证：需求 1.5, 1.6**
    - 生成随机高度值（包括边界值、负数、超大值）
    - 验证只有100-2000范围内的值被接受

  - [ ]* 6.2 编写属性测试：默认高度一致性
    - **属性 2：默认高度一致性**
    - **验证：需求 1.2, 1.3, 3.3**
    - 生成随机样式配置（常规/大屏）
    - 验证未配置高度时使用正确的默认值

  - [ ]* 6.3 编写属性测试：高度值传递完整性
    - **属性 3：高度值传递完整性**
    - **验证：需求 2.1, 2.4, 3.1, 3.2**
    - 生成随机高度配置
    - 验证配置值正确传递到渲染组件

  - [ ]* 6.4 编写属性测试：样式切换高度保持
    - **属性 4：样式切换高度保持**
    - **验证：需求 3.4**
    - 生成随机自定义高度和样式切换序列
    - 验证自定义高度在样式切换后保持不变

  - [ ]* 6.5 编写属性测试：向后兼容性
    - **属性 5：向后兼容性**
    - **验证：需求 5.1, 5.2, 5.3**
    - 生成不包含height字段的旧数据
    - 验证系统正确使用默认值

- [x] 7. 检查点 - 功能验证
  - 在装修系统中测试高度配置功能
  - 验证输入验证和提示是否正常
  - 验证预览效果是否正确
  - 在移动端验证轮播图高度显示
  - 测试旧数据的兼容性
  - 确保所有测试通过，如有问题请向用户反馈

- [x] 8. 集成测试和文档更新
  - [ ]* 8.1 编写端到端集成测试
    - 测试完整的配置到渲染流程
    - 测试多种场景组合
    - _需求：所有需求_

  - [x] 8.2 更新进展文档
    - 在 `doc/` 目录下创建功能实现文档
    - 记录实现细节和注意事项
    - 添加使用说明和示例
    - _需求：所有需求_

## 注意事项

1. **代码规范**：
   - 遵循项目现有的代码风格
   - 使用 TypeScript 类型定义
   - 添加必要的中文注释
   - 使用 Composition API 风格

2. **测试要求**：
   - 属性测试最少运行100次迭代
   - 每个测试用例添加功能标签
   - 确保测试覆盖所有边界情况

3. **兼容性**：
   - 确保不影响现有轮播图功能
   - 测试不同设备和屏幕尺寸
   - 验证旧数据的正常显示

4. **性能**：
   - 使用防抖处理高度配置变化
   - 避免不必要的组件重渲染
   - 优化预览更新逻辑

5. **用户体验**：
   - 提供清晰的输入提示
   - 实时预览配置效果
   - 友好的错误提示信息
