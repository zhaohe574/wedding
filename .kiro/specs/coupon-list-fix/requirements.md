# 需求文档 - 优惠券列表Bug修复

## 简介

修复后台优惠券管理列表中的两个关键问题：创建时间显示错误（显示为1970-01-01）和点击编辑按钮时报错。

## 术语表

- **Coupon**: 优惠券实体
- **CouponLists**: 优惠券列表数据处理类
- **CouponLogic**: 优惠券业务逻辑层
- **create_time**: 创建时间字段
- **valid_start_time**: 有效期开始时间
- **valid_end_time**: 有效期结束时间

## 需求

### 需求 1: 修复创建时间显示错误

**用户故事:** 作为管理员，我希望在优惠券列表中看到正确的创建时间，以便了解优惠券的创建历史。

#### 验收标准

1. WHEN 查询优惠券列表 THEN 系统 SHALL 正确显示每个优惠券的创建时间
2. WHEN 创建时间字段为数字类型 THEN 系统 SHALL 将其转换为正确的日期时间格式
3. WHEN 创建时间字段为字符串类型 THEN 系统 SHALL 先转换为时间戳再格式化
4. WHEN 创建时间为0或无效值 THEN 系统 SHALL 显示空字符串而不是1970-01-01

### 需求 2: 修复编辑功能报错

**用户故事:** 作为管理员，我希望能够正常编辑优惠券信息，以便更新优惠券配置。

#### 验收标准

1. WHEN 点击编辑按钮 THEN 系统 SHALL 成功获取优惠券详情
2. WHEN 获取优惠券详情 THEN 系统 SHALL 正确处理所有时间字段的类型转换
3. WHEN 有效期类型为固定日期 THEN 系统 SHALL 正确转换valid_start_time和valid_end_time为日期格式
4. WHEN 时间字段为字符串类型 THEN 系统 SHALL 先转换为时间戳再进行后续处理
5. WHEN 时间字段为0 THEN 系统 SHALL 返回空字符串而不是1970-01-01的日期

### 需求 3: 确保类型一致性

**用户故事:** 作为系统，我需要确保所有时间相关字段在PHP 8环境下类型一致，以便避免类型转换错误。

#### 验收标准

1. WHEN 处理数据库查询结果 THEN 系统 SHALL 将所有时间字段统一转换为整数类型
2. WHEN 格式化时间显示 THEN 系统 SHALL 先检查时间戳是否大于0再进行格式化
3. WHEN 时间字段可能为字符串 THEN 系统 SHALL 使用is_numeric检查并转换
4. WHEN 返回前端数据 THEN 系统 SHALL 确保所有数值字段类型正确（整数、浮点数）
