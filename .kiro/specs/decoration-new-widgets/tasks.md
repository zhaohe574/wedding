# 实施任务清单：装修组件扩展功能

## 概述

本任务清单将 9 个新增装修组件的开发工作拆分为可执行的任务。任务按照依赖关系和优先级排序，建议按顺序执行。

## 任务列表

### 阶段 1：基础设施准备

- [x] 1. 扩展后端动态数据加载服务
  - [x] 1.1 在 `DecorateDataService.php` 中添加优惠券批量查询方法
    - 实现 `batchGetCouponData()` 方法
    - 查询字段：id, name, type, discount, condition, start_time, end_time, total, received, status
    - 限制查询数量最多 50 个
    - _需求：2.9_
  
  - [x] 1.2 在 `DecorateDataService.php` 中添加公告批量查询方法
    - 实现 `batchGetNoticeData()` 方法
    - 查询字段：id, title, icon, link, create_time, status
    - 限制查询数量最多 50 个
    - _需求：6.9_
  
  - [x] 1.3 在 `DecorateDataService.php` 中添加话题批量查询方法
    - 实现 `batchGetTopicData()` 方法
    - 查询字段：id, name, icon, count, status
    - 自动生成跳转链接
    - 限制查询数量最多 50 个
    - _需求：7.8_
  
  - [x] 1.4 在 `DecorateDataService.php` 中添加热门话题自动获取方法
    - 实现 `getHotTopics()` 方法
    - 按参与人数降序排序
    - 支持限制数量参数
    - _需求：7.4_
  
  - [x] 1.5 更新 `parsePageData()` 方法支持新组件类型
    - 添加 coupon-center、notice-bar、hot-topics 的数据源映射
    - 实现数据合并逻辑
    - _需求：11.2_

- [x] 2. 添加后端接口
  - [x] 2.1 创建优惠券领取接口
    - 路由：POST /api/coupon/receive
    - 参数验证：coupon_id 必填
    - 验证用户登录状态
    - 验证优惠券是否已领取
    - 验证优惠券库存
    - 领取成功后更新 received 字段
    - _需求：2.5_
    - _说明：接口已存在于 CouponController_
  
  - [x] 2.2 创建用户婚期查询接口
    - 路由：GET /api/user/weddingDate
    - 查询用户最近的已支付订单
    - 返回服务日期和剩余天数
    - 无订单时返回 has_order=false
    - _需求：9.1, 9.2_
  
  - [x] 2.3 创建优惠券列表接口（管理后台选择器）
    - 路由：GET /adminapi/decorate/data/couponList
    - 支持分页和状态筛选
    - 返回优惠券基本信息
    - _需求：2.1_
  
  - [x] 2.4 创建公告列表接口（管理后台选择器）
    - 路由：GET /adminapi/decorate/data/noticeList
    - 支持分页和状态筛选
    - 返回公告基本信息
    - _需求：6.1_
  
  - [x] 2.5 创建话题列表接口（管理后台选择器）
    - 路由：GET /adminapi/decorate/data/topicList
    - 支持分页和状态筛选
    - 返回话题基本信息
    - _需求：7.1_

- [x] 3. 检查点 - 基础设施验证
  - 验证所有后端接口正常工作
  - 验证动态数据加载逻辑正确
  - 如有问题，及时修复后再继续


### 阶段 2：管理后台组件开发（第一批：3个组件）

- [x] 4. 开发快捷入口组件（管理后台）
  - [x] 4.1 创建组件目录和基础文件
    - 创建 `admin/src/views/decoration/component/widgets/quick-entry/` 目录
    - 创建 index.ts、attr.vue、content.vue、options.ts 文件
    - _需求：10.7_
  
  - [x] 4.2 实现 options.ts 配置
    - 定义 QuickEntryItem 和 QuickEntryContent 接口
    - 设置默认配置（4个默认入口）
    - 设置 pageScope 为 ['home', 'user']
    - _需求：1.1, 1.8_
  
  - [x] 4.3 实现 attr.vue 配置界面
    - 使用 material-picker 选择图标
    - 使用 link-picker 配置跳转链接
    - 使用 draggable 实现拖拽排序
    - 限制最多添加 12 个入口
    - 配置展示样式（网格/横向滑动）
    - 配置每行显示数量（4/5个）
    - _需求：1.1, 1.2, 1.3, 1.7_
  
  - [x] 4.4 实现 content.vue 预览界面
    - 根据 per_line 计算网格布局
    - 只显示 is_show='1' 的入口
    - 显示图标和标题
    - _需求：1.4_

- [x] 5. 开发优惠券领取组件（管理后台）
  - [x] 5.1 创建组件目录和基础文件
    - 创建 `admin/src/views/decoration/component/widgets/coupon-receive/` 目录
    - 创建 index.ts、attr.vue、content.vue、options.ts 文件
    - _需求：10.7_
  
  - [x] 5.2 实现 options.ts 配置
    - 定义 CouponItem 和 CouponContent 接口
    - 设置默认配置
    - 设置 pageScope 为 ['home', 'user']
    - _需求：2.1, 2.10_
  
  - [x] 5.3 实现 attr.vue 配置界面
    - 创建优惠券选择器（调用 getEnabledCouponList）
    - 只保存 coupon_id、is_show、sort
    - 配置展示样式（横向滑动/纵向列表）
    - 配置显示数量（1-20张）
    - 配置"查看更多"链接
    - _需求：2.1, 2.2, 2.3, 2.8_
  
  - [x] 5.4 实现 content.vue 预览界面
    - 显示优惠券卡片预览
    - 显示优惠券面额和使用条件
    - 显示模拟数据
    - _需求：2.4_

- [x] 6. 开发数据统计卡片组件（管理后台）
  - [x] 6.1 创建组件目录和基础文件
    - 创建 `admin/src/views/decoration/component/widgets/data-stats/` 目录
    - 创建 index.ts、attr.vue、content.vue、options.ts 文件
    - _需求：10.7_
  
  - [x] 6.2 实现 options.ts 配置
    - 定义 StatisticsItem 和 StatisticsContent 接口
    - 设置默认配置（4个默认统计项）
    - 设置 pageScope 为 ['user']
    - _需求：3.1, 3.8_
  
  - [x] 6.3 实现 attr.vue 配置界面
    - 使用 material-picker 选择图标
    - 配置标题、数据类型、单位
    - 配置展示样式（横向排列/纵向排列/网格布局）
    - 支持拖拽排序
    - 限制最多添加 6 个统计项
    - _需求：3.1, 3.2, 3.3, 3.4, 3.6_
  
  - [x] 6.4 实现 content.vue 预览界面
    - 显示统计卡片预览
    - 显示图标、标题、数值、单位
    - 显示模拟数据
    - _需求：3.5_

- [x] 7. 检查点 - 第一批组件验证
  - 验证 3 个组件在管理后台正常显示
  - 验证配置保存和读取正常
  - 验证预览界面显示正确
  - 如有问题，及时修复后再继续


### 阶段 3：管理后台组件开发（第二批：3个组件）

- [x] 8. 开发常见问题（FAQ）组件（管理后台）
  - [x] 8.1 创建组件目录和基础文件
    - 创建 `admin/src/views/decoration/component/widgets/faq/` 目录
    - 创建 index.ts、attr.vue、content.vue、options.ts 文件
    - _需求：10.7_
  
  - [x] 8.2 实现 options.ts 配置
    - 定义 FaqItem 和 FaqContent 接口
    - 设置默认配置（2个默认问题）
    - 设置 pageScope 为 ['home', 'user']
    - _需求：4.1, 4.9_
  
  - [x] 8.3 实现 attr.vue 配置界面
    - 使用 textarea 编辑答案
    - 提供问题分类输入
    - 配置展示样式（折叠面板/列表式）
    - 配置是否显示搜索框
    - 支持拖拽排序
    - 限制最多添加 20 个问题
    - _需求：4.1, 4.2, 4.3, 4.4, 4.7, 4.8_
  
  - [x] 8.4 实现 content.vue 预览界面
    - 显示折叠面板预览
    - 显示问题标题和分类
    - _需求：4.5_

- [x] 9. 开发服务流程组件（管理后台）
  - [x] 9.1 创建组件目录和基础文件
    - 创建 `admin/src/views/decoration/component/widgets/service-process/` 目录
    - 创建 index.ts、attr.vue、content.vue、options.ts 文件
    - _需求：10.7_
  
  - [x] 9.2 实现 options.ts 配置
    - 定义 ProcessStep 和 ProcessContent 接口
    - 设置默认配置（5个默认步骤）
    - 设置 pageScope 为 ['home']
    - _需求：5.1, 5.8_
  
  - [x] 9.3 实现 attr.vue 配置界面
    - 使用 material-picker 选择步骤图标
    - 配置步骤标题和描述
    - 配置展示样式（时间轴/步骤卡片/横向流程图）
    - 配置流程线颜色
    - 配置图标样式（圆形/方形）
    - 支持拖拽排序
    - 限制最多添加 8 个步骤
    - _需求：5.1, 5.2, 5.3, 5.4, 5.6, 5.7_
  
  - [x] 9.4 实现 content.vue 预览界面
    - 显示流程步骤预览
    - 显示步骤图标、标题、描述
    - _需求：5.5_

- [x] 10. 开发公告通知组件（管理后台）
  - [x] 10.1 创建组件目录和基础文件
    - 创建 `admin/src/views/decoration/component/widgets/notice-bar/` 目录
    - 创建 index.ts、attr.vue、content.vue、options.ts 文件
    - _需求：10.7_
  
  - [x] 10.2 实现 options.ts 配置
    - 定义 NoticeItem 和 NoticeContent 接口
    - 设置默认配置
    - 设置 pageScope 为 ['home', 'user', 'news']
    - _需求：6.1, 6.10_
  
  - [x] 10.3 实现 attr.vue 配置界面
    - 创建公告选择器（调用 getDecorateNoticeList）
    - 只保存 notice_id、is_show、sort
    - 配置展示样式（横向滚动/纵向滚动/静态展示）
    - 配置显示数量（1-5条）
    - 配置滚动速度
    - 配置背景颜色和文字颜色
    - _需求：6.1, 6.2, 6.3, 6.4, 6.7, 6.8_
  
  - [x] 10.4 实现 content.vue 预览界面
    - 显示公告预览
    - 显示公告图标和标题
    - _需求：6.5_

- [x] 11. 检查点 - 第二批组件验证
  - 验证 3 个组件在管理后台正常显示
  - 验证配置保存和读取正常
  - 验证预览界面显示正确
  - 如有问题，及时修复后再继续


### 阶段 4：管理后台组件开发（第三批：3个组件）

- [x] 12. 开发热门话题组件（管理后台）
  - [x] 12.1 创建组件目录和基础文件
    - 创建 `admin/src/views/decoration/component/widgets/hot-topics/` 目录
    - 创建 index.ts、attr.vue、content.vue、options.ts 文件
    - _需求：10.7_
  
  - [x] 12.2 实现 options.ts 配置
    - 定义 TopicItem 和 TopicContent 接口
    - 设置默认配置
    - 设置 pageScope 为 ['home', 'news']
    - _需求：7.1, 7.9_
  
  - [x] 12.3 实现 attr.vue 配置界面
    - 创建话题选择器（调用 /adminapi/moment/topicLists）
    - 只保存 topic_id、is_show、sort
    - 配置话题来源（手动选择/自动获取热门）
    - 配置展示样式（标签云/横向滑动/列表式）
    - 配置显示数量（5-20个）
    - _需求：7.1, 7.2, 7.3, 7.4_
  
  - [x] 12.4 实现 content.vue 预览界面
    - 显示话题预览
    - 显示话题名称和参与人数
    - _需求：7.5_

- [x] 13. 开发门店地图组件（管理后台）
  - [x] 13.1 创建组件目录和基础文件
    - 创建 `admin/src/views/decoration/component/widgets/store-map/` 目录
    - 创建 index.ts、attr.vue、content.vue、options.ts 文件
    - _需求：10.7_
  
  - [x] 13.2 实现 options.ts 配置
    - 定义 StoreItem 和 StoreMapContent 接口
    - 设置默认配置（1个默认门店）
    - 设置 pageScope 为 ['home']
    - _需求：8.1, 8.10_
  
  - [x] 13.3 实现 attr.vue 配置界面
    - 使用地图选点组件选择门店位置
    - 自动获取经纬度
    - 配置门店名称、地址、电话、营业时间
    - 配置展示样式（地图+列表/纯地图/纯列表）
    - 配置是否根据距离自动排序
    - 支持拖拽排序
    - 限制最多添加 20 个门店
    - _需求：8.1, 8.2, 8.3, 8.4, 8.9_
  
  - [x] 13.4 实现 content.vue 预览界面
    - 显示地图预览（使用静态地图图片）
    - 显示门店列表
    - _需求：8.5_

- [x] 14. 开发婚礼倒计时组件（管理后台）
  - [x] 14.1 创建组件目录和基础文件
    - 创建 `admin/src/views/decoration/component/widgets/wedding-countdown/` 目录
    - 创建 index.ts、attr.vue、content.vue、options.ts 文件
    - _需求：10.7_
  
  - [x] 14.2 实现 options.ts 配置
    - 定义 CountdownContent 接口
    - 设置默认配置
    - 设置 pageScope 为 ['home', 'personal']
    - _需求：9.8_
  
  - [x] 14.3 实现 attr.vue 配置界面
    - 配置标题文字
    - 配置背景颜色、文字颜色、数字颜色
    - 配置展示样式（卡片式/简约式/浪漫式）
    - 配置显示的时间单位（天、时、分、秒）
    - _需求：9.3, 9.6, 9.7_
  
  - [x] 14.4 实现 content.vue 预览界面
    - 显示倒计时预览
    - 显示标题文字
    - _需求：9.2_

- [x] 15. 检查点 - 第三批组件验证
  - 验证 3 个组件在管理后台正常显示
  - 验证配置保存和读取正常
  - 验证预览界面显示正确
  - 如有问题，及时修复后再继续


### 阶段 5：UniApp 前端组件开发（第一批：3个组件）

- [x] 16. 开发快捷入口组件（UniApp）
  - [x] 16.1 创建组件文件
    - 创建 `uniapp/src/components/widgets/quick-entry/quick-entry.vue`
    - _需求：10.7_
  
  - [x] 16.2 实现组件逻辑
    - 接收 content 和 styles props
    - 过滤 is_show='1' 的入口
    - 根据 style 渲染网格布局或横向滑动
    - 根据 per_line 计算网格列数
    - _需求：1.3, 1.4_
  
  - [x] 16.3 实现组件样式
    - 使用 u-image 组件显示图标
    - 实现网格布局样式
    - 实现横向滑动样式
    - _需求：1.4_
  
  - [x] 16.4 实现跳转功能
    - 根据 link.type 判断跳转方式
    - 使用 navigateTo 工具函数处理跳转
    - _需求：1.5_

- [x] 17. 开发优惠券领取组件（UniApp）
  - [x] 17.1 创建组件文件
    - 创建 `uniapp/src/components/widgets/coupon-receive/coupon-receive.vue`
    - _需求：10.7_
  
  - [x] 17.2 实现组件逻辑
    - 接收 content 和 styles props
    - 从 content.data 获取优惠券数据（动态加载）
    - 根据 style 渲染不同样式
    - 限制显示数量为 show_count
    - _需求：2.2, 2.3, 2.4_
  
  - [x] 17.3 实现组件样式
    - 实现卡片式样式
    - 实现横向滑动样式
    - 实现纵向列表样式
    - _需求：2.2_
  
  - [x] 17.4 实现领取功能
    - 点击领取按钮调用 /api/coupon/receive 接口
    - 验证用户登录状态（未登录跳转登录页）
    - 领取成功后更新按钮状态
    - 显示领取成功提示
    - 已领取状态显示"已领取"并禁用按钮
    - _需求：2.5, 2.6, 2.7_
  
  - [x] 17.5 实现查看更多功能
    - 根据 show_more 配置显示"查看更多"按钮
    - 点击跳转到 more_link 配置的页面
    - _需求：2.8_

- [x] 18. 开发数据统计卡片组件（UniApp）
  - [x] 18.1 创建组件文件
    - 创建 `uniapp/src/components/widgets/data-stats/data-stats.vue`
    - _需求：10.7_
  
  - [x] 18.2 实现组件逻辑
    - 接收 content 和 styles props
    - 过滤 is_show='1' 的统计项
    - 根据 style 渲染不同样式
    - 调用API获取统计数据
    - _需求：3.2, 3.5_
  
  - [x] 18.3 实现组件样式
    - 实现横向排列样式
    - 实现纵向排列样式
    - 实现网格布局样式
    - 使用渐变背景和阴影
    - _需求：3.2_
  
  - [x] 18.4 实现数据加载
    - 调用 getUserCenter 接口获取用户统计数据
    - 调用 getMyCouponStats 接口获取优惠券统计
    - 根据 value 字段映射对应的统计数据
    - _需求：3.6_

- [x] 19. 检查点 - 第一批 UniApp 组件验证
  - 验证 3 个组件创建成功
  - 验证组件语法无错误
  - 验证组件逻辑完整
  - 可以继续开发第二批组件


### 阶段 6：UniApp 前端组件开发（第二批：3个组件）

- [x] 20. 开发常见问题（FAQ）组件（UniApp）
  - [x] 20.1 创建组件文件
    - 创建 `uniapp/src/components/widgets/faq/faq.vue`
    - _需求：10.7_
  
  - [x] 20.2 实现组件逻辑
    - 接收 content 和 styles props
    - 过滤 is_show='1' 的问题
    - 根据 style 渲染不同样式
    - 实现折叠/展开状态管理
    - _需求：4.2, 4.5, 4.6_
  
  - [x] 20.3 实现组件样式
    - 使用 u-collapse 组件实现折叠面板
    - 实现列表式样式
    - 答案内容使用 rich-text 组件渲染
    - _需求：4.2, 4.5_
  
  - [x] 20.4 实现搜索功能
    - 根据 show_search 配置显示搜索框
    - 实现本地搜索过滤
    - 搜索时自动展开第一个结果
    - _需求：4.8_

- [x] 21. 开发服务流程组件（UniApp）
  - [x] 21.1 创建组件文件
    - 创建 `uniapp/src/components/widgets/service-process/service-process.vue`
    - _需求：10.7_
  
  - [x] 21.2 实现组件逻辑
    - 接收 content 和 styles props
    - 过滤 is_show='1' 的步骤
    - 根据 style 渲染不同样式
    - _需求：5.2, 5.5_
  
  - [x] 21.3 实现组件样式
    - 使用 u-steps 组件实现时间轴
    - 实现步骤卡片样式
    - 实现横向流程图样式（使用 scroll-view）
    - 使用配置的 line_color 和 icon_style
    - _需求：5.2, 5.5, 5.6, 5.7_

- [x] 22. 开发公告通知组件（UniApp）
  - [x] 22.1 创建组件文件
    - 创建 `uniapp/src/components/widgets/notice-bar/notice-bar.vue`
    - _需求：10.7_
  
  - [x] 22.2 实现组件逻辑
    - 接收 content 和 styles props
    - 从 content.data 获取公告数据（动态加载）
    - 限制显示数量为 show_count
    - 根据 style 渲染不同样式
    - _需求：6.2, 6.3, 6.5_
  
  - [x] 22.3 实现组件样式
    - 使用 u-notice-bar 组件实现横向滚动
    - 实现纵向滚动样式（swiper 垂直方向）
    - 实现静态展示样式
    - 使用配置的 bg_color 和 text_color
    - _需求：6.2, 6.5, 6.7, 6.8_
  
  - [x] 22.4 实现跳转功能
    - 点击公告跳转到配置的链接
    - 支持跳转到公告详情页
    - _需求：6.6_

- [x] 23. 检查点 - 第二批 UniApp 组件验证
  - 验证 3 个组件创建成功
  - 验证组件语法无错误
  - 验证组件逻辑完整
  - 可以继续开发第三批组件


### 阶段 7：UniApp 前端组件开发（第三批：3个组件）

- [x] 24. 开发热门话题组件（UniApp）
  - [x] 24.1 创建组件文件
    - 创建 `uniapp/src/components/widgets/hot-topics/hot-topics.vue`
    - _需求：10.7_
  
  - [x] 24.2 实现组件逻辑
    - 接收 content 和 styles props
    - 过滤 is_show='1' 的话题
    - 限制显示数量为 show_count
    - 根据 style 渲染不同样式
    - _需求：7.2, 7.3, 7.5_
  
  - [x] 24.3 实现组件样式
    - 使用 u-icon 组件显示图标
    - 实现标签云样式（渐变背景）
    - 实现横向滑动样式
    - 实现列表式样式
    - _需求：7.2, 7.5, 7.7_
  
  - [x] 24.4 实现跳转功能
    - 点击话题跳转到话题动态列表页
    - 传递 topic_id 参数
    - _需求：7.6_

- [x] 25. 开发门店地图组件（UniApp）
  - [x] 25.1 创建组件文件
    - 创建 `uniapp/src/components/widgets/store-map/store-map.vue`
    - _需求：10.7_
  
  - [x] 25.2 实现组件逻辑
    - 接收 content 和 styles props
    - 过滤 is_show='1' 的门店
    - 根据 style 渲染不同样式
    - 根据 auto_sort 配置决定是否按距离排序
    - _需求：8.3, 8.9_
  
  - [x] 25.3 实现地图功能
    - 使用 map 组件显示地图
    - 使用 markers 标注门店位置
    - 点击标注显示门店信息
    - 获取用户位置并计算距离
    - _需求：8.5, 8.6, 8.9_
  
  - [x] 25.4 实现导航和电话功能
    - 导航按钮调用 uni.openLocation
    - 电话按钮调用 uni.makePhoneCall
    - _需求：8.7, 8.8_

- [x] 26. 开发婚礼倒计时组件（UniApp）
  - [x] 26.1 创建组件文件
    - 创建 `uniapp/src/components/widgets/wedding-countdown/wedding-countdown.vue`
    - _需求：10.7_
  
  - [x] 26.2 实现组件逻辑
    - 接收 content 和 styles props
    - 页面加载时调用 /api/user/weddingDate 获取婚期
    - 使用 setInterval 实时更新倒计时
    - 计算天、小时、分钟、秒
    - 没有订单时隐藏组件或显示默认提示
    - _需求：9.1, 9.2, 9.5_
  
  - [x] 26.3 实现组件样式
    - 根据 style 渲染不同样式
    - 实现卡片式倒计时样式
    - 实现简约式倒计时样式
    - 实现浪漫式倒计时样式
    - 使用配置的 bg_color、text_color、number_color
    - 显示标题文字
    - _需求：9.2, 9.3, 9.6, 9.7_

- [x] 27. 检查点 - 第三批 UniApp 组件验证
  - 验证 3 个组件创建成功
  - 验证组件语法无错误
  - 验证组件逻辑完整
  - 可以继续集成测试


### 阶段 8：集成测试与优化

- [ ] 28. 集成测试
  - [ ] 28.1 测试管理后台配置流程
    - 添加所有 9 个组件到首页
    - 配置每个组件的参数
    - 保存装修页面
    - 验证数据库中只保存引用ID
    - _需求：11.1_
  
  - [ ] 28.2 测试动态数据加载
    - 修改优惠券信息
    - 修改公告信息
    - 修改话题信息
    - 刷新前端页面
    - 验证显示最新数据
    - _需求：11.2_
  
  - [ ] 28.3 测试数据删除场景
    - 删除引用的优惠券
    - 删除引用的公告
    - 删除引用的话题
    - 刷新前端页面
    - 验证组件正常显示（过滤已删除项）
    - _需求：11.3_
  
  - [ ] 28.4 测试响应式适配
    - 在微信小程序中测试所有组件
    - 在 H5 中测试所有组件
    - 在不同屏幕尺寸下测试（375px、414px、768px）
    - 验证布局正常、交互正常
    - _需求：12.1, 12.2, 12.3_

- [-] 29. 性能优化
  - [x] 29.1 实现图片懒加载
    - 为所有图片组件添加 lazy-load 属性
    - 验证图片按需加载
    - _需求：13.1_
  
  - [ ] 29.2 实现长列表优化
    - 为 FAQ 组件添加虚拟滚动（问题数量 > 20）
    - 验证滚动性能
    - _需求：13.2_
  
  - [ ] 29.3 实现组件缓存
    - 在 Pinia store 中缓存装修配置数据
    - 设置缓存时间为 5 分钟
    - 验证减少接口请求次数
    - _需求：13.3_
  
  - [ ] 29.4 性能测试
    - 测试页面首屏加载时间（目标 < 2秒）
    - 测试批量查询响应时间（目标 < 500ms）
    - 测试组件配置保存时间（目标 < 1秒）
    - 如性能不达标，进行优化
    - _需求：13.4_

- [ ] 30. 安全加固
  - [ ] 30.1 添加输入验证
    - 管理后台添加前端验证
    - 后端添加参数验证
    - 验证恶意输入被拦截
    - _需求：安全需求 1_
  
  - [ ] 30.2 添加 XSS 防护
    - FAQ 组件答案内容使用 HTMLPurifier 过滤
    - 前端使用 rich-text 组件渲染
    - 验证 XSS 攻击被防御
    - _需求：安全需求 3_
  
  - [ ] 30.3 添加链接白名单验证
    - 后端验证跳转链接
    - 内部页面白名单验证
    - 外部链接域名白名单验证
    - 验证恶意链接被拦截
    - _需求：安全需求 2_

- [ ] 31. 检查点 - 集成测试验证
  - 所有集成测试通过
  - 性能指标达标
  - 安全测试通过
  - 如有问题，及时修复后再继续


### 阶段 9：文档与部署

- [x] 32. 编写技术文档
  - [x] 32.1 更新组件开发文档
    - 记录新组件的开发流程
    - 记录动态数据加载机制
    - 记录常见问题和解决方案
    - 保存到 `doc/装修组件扩展功能实现.md`
  
  - [x] 32.2 更新 API 文档
    - 记录新增的 5 个管理后台接口
    - 记录新增的 3 个前端接口
    - 包含请求参数、返回格式、示例
  
  - [x] 32.3 编写使用手册
    - 编写管理员配置指南
    - 包含每个组件的配置说明
    - 包含配置示例和最佳实践
    - 包含常见问题 FAQ

- [x] 33. 数据库准备
  - [ ] 33.1 检查数据库表结构
    - 检查 la_coupon 表是否有 icon 字段
    - 检查 la_notice 表是否有 icon 和 link 字段
    - 检查 la_moment_topic 表是否有 icon 字段
    - 如缺少字段，编写迁移脚本
  
  - [ ] 33.2 执行数据库迁移
    - 在测试环境执行迁移脚本
    - 验证字段添加成功
    - 在生产环境执行迁移脚本

- [ ] 34. 部署到测试环境
  - [ ] 34.1 部署后端代码
    - 更新代码到测试服务器
    - 安装依赖：composer install
    - 清除缓存：php think clear
    - 执行数据库迁移
  
  - [ ] 34.2 部署管理后台
    - 更新代码到测试服务器
    - 安装依赖：npm install
    - 构建生产版本：npm run build
    - 部署到 server/public/admin
  
  - [ ] 34.3 部署 UniApp
    - 更新代码到测试服务器
    - 安装依赖：npm install
    - 构建小程序：npm run build:mp-weixin
    - 上传到微信小程序测试版
  
  - [ ] 34.4 测试环境验证
    - 验证所有组件正常工作
    - 验证接口正常响应
    - 验证数据加载正确
    - 修复发现的问题

- [ ] 35. 灰度发布
  - [ ] 35.1 小范围灰度（10% 用户）
    - 配置灰度规则
    - 监控错误日志
    - 监控性能指标
    - 收集用户反馈
    - 持续 3-5 天
  
  - [ ] 35.2 扩大灰度（50% 用户）
    - 扩大灰度范围
    - 继续监控系统稳定性
    - 修复发现的问题
    - 持续 2-3 天
  
  - [ ] 35.3 全量发布
    - 所有用户可见新组件
    - 持续监控系统稳定性
    - 准备回滚方案

- [ ] 36. 最终验收
  - [ ] 36.1 功能验收
    - 所有 9 个组件均已实现
    - 管理后台配置正常
    - 前端展示正常
    - 交互功能正常
  
  - [ ] 36.2 性能验收
    - 页面加载时间 < 2秒
    - 接口响应时间 < 500ms
    - 批量查询优化生效
  
  - [ ] 36.3 兼容性验收
    - 微信小程序正常
    - H5 正常
    - 不同设备正常
  
  - [ ] 36.4 文档验收
    - 技术文档完整
    - API 文档完整
    - 使用手册完整

## 任务执行说明

### 执行顺序

1. **必须按阶段顺序执行**：完成一个阶段后再开始下一个阶段
2. **每个阶段结束时执行检查点**：确保质量后再继续
3. **可以并行开发**：同一阶段内的任务可以并行执行

### 任务优先级

- **高优先级**：阶段 1-4（基础设施和管理后台）
- **中优先级**：阶段 5-7（UniApp 前端）
- **低优先级**：阶段 8-9（测试和部署）

### 预估工时

- **阶段 1**：2-3 天（基础设施准备）
- **阶段 2-4**：6-9 天（管理后台 9 个组件）
- **阶段 5-7**：6-9 天（UniApp 9 个组件）
- **阶段 8**：3-4 天（集成测试与优化）
- **阶段 9**：2-3 天（文档与部署）
- **总计**：19-28 天

### 人员分工建议

- **后端开发**：负责阶段 1（基础设施）
- **前端开发 A**：负责阶段 2-4（管理后台组件）
- **前端开发 B**：负责阶段 5-7（UniApp 组件）
- **测试工程师**：负责阶段 8（集成测试）
- **全员**：参与阶段 9（文档与部署）

### 风险提示

1. **动态数据加载**：需要仔细测试，确保数据正确填充
2. **性能优化**：批量查询需要优化，避免 N+1 查询
3. **兼容性**：需要在多个平台测试，确保一致性
4. **安全性**：输入验证和 XSS 防护必须到位

## 注意事项

1. **代码规范**：遵循项目编码规范，使用 TypeScript 类型定义
2. **注释说明**：关键逻辑添加中文注释
3. **错误处理**：所有接口调用添加错误处理
4. **日志记录**：关键操作记录日志
5. **测试覆盖**：每个功能都要测试

---

**文档版本**：v1.0  
**创建日期**：2026-01-22  
**维护者**：开发团队  
**最后更新**：2026-01-22
